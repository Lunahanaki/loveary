<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

  <meta http-equiv="Content-Security-Policy" content="default-src * 'unsafe-inline' 'unsafe-eval' data: blob:;">

  <title>Noir搓的小手机</title>
  <style>
    .message p,
    .diary-content {
      user-select: none;
      -webkit-user-select: none;
    }

    .lt-end-session-btn {
      font-size: 1.5rem;
      color: inherit;
      /* 继承父元素的颜色 */
      opacity: 0.6;
      cursor: pointer;
      padding: 0 5px;
      line-height: 1;
      font-weight: bold;
    }

    .lt-end-session-btn:hover {
      opacity: 1;
    }

    /* --- Noir's Refactor: Feed Loader Style --- */
    #feed-loader {
      position: absolute;
      inset: 0;
      background: rgba(244, 248, 255, 0.85);
      backdrop-filter: blur(4px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10;
      color: var(--text-color);
      font-size: 1rem;
      flex-direction: column;
      gap: 10px;
    }

    .loader-spinner {
      width: 24px;
      height: 24px;
      border: 3px solid var(--border-color);
      border-top-color: var(--primary-color);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    /* --- End of Refactor --- */
    /*
        Noir's Mizuiro Theme
        - 哼，看好了，这才是设计。
      */
    /*
          Noir's Mizuiro Theme
          - 哼，看好了，这才是设计。
        */
    :root {
      --phone-width: 375px;
      --phone-height: 812px;
      --user-bg-image: url('');

      /* === Noir's Ultimate Dynamic Theme Engine v2.0 === */
      /* 哼，现在所有的颜色都听从这三个总开关的指挥。*/
      --primary-hue: 35;
      --primary-saturation: 25%;
      --primary-lightness: 80%;

      /* 核心颜色 */
      --primary-color: hsl(var(--primary-hue), var(--primary-saturation), var(--primary-lightness));
      /* 强调色/用户气泡色，现在也是动态的 */
      --accent-color: hsl(var(--primary-hue), calc(var(--primary-saturation) * 1.2), calc(var(--primary-lightness) - 20%));

      /* 哼，看好了，这些就是被我重新接上线的“电灯” */

      /* 文字颜色：根据主题亮度自动变深或变浅 */
      --text-color: hsl(var(--primary-hue), 15%, calc(100% - var(--primary-lightness) / 1.1));
      --text-color-light: hsl(var(--primary-hue), 10%, calc(100% - var(--primary-lightness) / 1.3));

      /* 表面背景：半透明，亮度比主色高一点 */
      --surface-bg: hsla(var(--primary-hue), calc(var(--primary-saturation) / 2), calc(var(--primary-lightness) + 15%), 0.1);

      /* 卡片/AI气泡背景：比表面背景更亮一点 */
      --card-bg: hsla(var(--primary-hue), calc(var(--primary-saturation) / 1.5), calc(var(--primary-lightness) + 18%), 0.5);

      /* 边框颜色 */
      --border-color: hsla(var(--primary-hue), calc(var(--primary-saturation) / 2), calc(var(--primary-lightness)), 0.3);

      /* 阴影颜色 */
      --soft-shadow: 0 4px 12px hsla(var(--primary-hue), 40%, calc(var(--primary-lightness) - 10%), 0.15);

      /* 动态页的设置保持不变 */
      --feed-bg-image: none;
      --feed-overlay-opacity: 0.12;
      --feed-overlay-rotate: 22deg;
      --feed-overlay-speed: 48s;

      /* 气泡样式也完全动态化 */
      --bubble-radius: 18px;
      --bubble-outline: hsla(var(--primary-hue), var(--primary-saturation), calc(var(--primary-lightness) + 10%), 0.5);
      --bubble-user-bg: var(--accent-color);
      --bubble-ai-bg: var(--card-bg);
    }

    body {
      display: flex;
      align-items: center;
      /* <-- 加上这句 */
      justify-content: center;
      /* <-- 还有这句 */
      height: 100vh;
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background-image: var(--user-bg-image);
      background-size: cover;
      background-position: center;
    }

    #phone-container {
      width: 100%;
      /* 占满屏幕宽度 */
      height: 100vh;
      /* 占满屏幕高度 */
      background-color: white;
      background-image: var(--user-bg-image);
      background-size: cover;
      background-position: center;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      /* 是不是清爽多了？ */
      position: relative;
      /* <-- 就是这句，告诉它“你是个家长了，给我看好家里的东西！” */
    }

    .screen {
      flex-grow: 1;
      display: none;
      flex-direction: column;
      background-color: #f9f9f9;
      /* 哼，所有屏幕默认都给我变白 */
      /* 让背景透出来 */
      overflow: hidden;
      color: var(--text-color);
    }

    .screen.active {
      display: flex;
    }

    /* 这个是通用的头像预览样式 */
    .avatar-preview {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid var(--border-color);
      margin-top: 5px;
      cursor: pointer;
    }

    /* --- 通用顶栏 --- */
    .header,
    #chat-list-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 20px;
      background-color: var(--surface-bg);
      /* backdrop-filter: blur(12px); */
      /* <-- 就这么简单，干掉它 */
      border-bottom: 1px solid var(--border-color);
      flex-shrink: 0;
    }

    .header-title {
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--text-color);
    }

    .header-button {
      background: none;
      border: none;
      font-size: 1rem;
      cursor: pointer;
      color: var(--primary-color);
      font-weight: 500;
      min-width: 50px;
      text-align: center;
    }

    /* --- 聊天列表 --- */
    #chat-list-pane {
      background-color: transparent;
      border-right: 1px solid var(--border-color);
      transition: transform 0.3s ease-in-out;
      will-change: transform;
      /* <-- 加上这句 */
      width: 100%;
      height: 100%;
      flex-shrink: 0;
      /* 防止它在横向布局里被挤扁 */
      display: flex;
      flex-direction: column;
    }

    #chat-list-container {
      flex-grow: 1;
      flex-grow: 1;
      overflow-y: auto;
      padding: 10px;
    }

    #character-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .character-item {
      display: flex;
      align-items: center;
      padding: 12px;
      margin-bottom: 10px;
      background-color: var(--card-bg);
      /* backdrop-filter: blur(10px);*/
      border-radius: 16px;
      box-shadow: var(--soft-shadow);
      border: 1px solid rgba(255, 255, 255, 0.5);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .character-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(138, 180, 228, 0.2);
    }

    .char-info-wrapper {
      flex-grow: 1;
      cursor: pointer;
      display: flex;
      align-items: center;
      overflow: hidden;
    }

    .character-item .char-avatar {
      width: 45px;
      height: 45px;
      border-radius: 50%;
      margin-right: 12px;
      object-fit: cover;
      flex-shrink: 0;
    }

    .character-item .char-name {
      font-weight: 600;
      color: var(--text-color);
    }

    .character-item .char-remark {
      font-size: 0.85rem;
      color: var(--text-color-light);
    }

    #chat-screen-container {
      position: relative;
      /* 告诉里面的绝对定位元素，要以我为基准 */
      flex-grow: 1;
      /* 确保它能撑满 chat-screen 的空间 */
      overflow: hidden;
      /* 把滑出去的部分藏起来，这很重要 */
      display: flex;
      /* 保持内部元素的 flex 布局 */
    }

    /* --- 聊天窗口 --- */


    #chat-view-pane {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      transform: translateX(100%);
      transition: transform 0.3s ease-in-out;
      will-change: transform;
      /* <-- 还有这句 */
      background-color: transparent;
      z-index: 10;
    }

    #chat-screen.show-chat-view #chat-list-pane {
      transform: translateX(-100%);
    }

    #chat-screen.show-chat-view #chat-view-pane {
      transform: translateX(0);
    }

    #chat-messages {
      flex-grow: 1;
      padding: 5px;
      overflow-y: auto;
      display: flex;
      /* <-- 加上这个 */
      flex-direction: column;
      /* <-- 还有这个 */
      contain: content;
      contain: content;
      /* <-- 哼，就是这句救命神药！ */
    }



    .avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      margin: 0 10px;
      object-fit: cover;
      border: 2px solid rgba(255, 255, 255, 0.7);
      flex-shrink: 0;
    }

    .message {
      padding: 10px 16px;
      border-radius: 20px;
      line-height: 1.5;
      word-break: break-word;
      box-shadow: var(--soft-shadow);
    }

    .message.user.sticker,
    .message.assistant.sticker,
    .message.user.image,
    .message.assistant.image {
      background-color: transparent;
      padding: 0;
      box-shadow: none;
    }

    .message.user {
      background-color: var(--accent-color);
      color: white;
      border-bottom-right-radius: 5px;
    }

    .message.ai {
      background-color: var(--card-bg);
      border: 1px solid rgba(255, 255, 255, 0.8);
      color: var(--text-color);
      border-bottom-left-radius: 5px;
    }

    .message p {
      margin: 0;
    }

    .sticker-content,
    .message-image-content {
      max-width: 120px;
      border-radius: 8px;
      object-fit: cover;
      cursor: pointer;
    }

    .message-image-content {
      max-width: 160px;
    }

    /* --- 其他屏幕和组件 --- */
    /* --- Noir's Fix: API 模型列表的样式修正 --- */
    .model-input-container {
      position: relative;
      /* 关键！让里面的绝对定位元素有家可回 */
      display: flex;
      gap: 8px;
    }

    .custom-model-dropdown {
      display: none;
      /* 默认藏起来 */
      position: absolute;
      top: 100%;
      /* 精准定位到输入框正下方 */
      left: 0;
      right: 80px;
      /* 留出“获取”按钮的位置 */
      background: var(--surface-bg);
      /*   backdrop-filter: blur(10px);*/
      border: 1px solid var(--border-color);
      border-radius: 8px;
      margin-top: 4px;
      max-height: 180px;
      overflow-y: auto;
      z-index: 100;
      /* 确保它在最上层 */
      box-shadow: var(--soft-shadow);
    }

    .custom-model-dropdown.show {
      display: block;
      /* 需要的时候再显示 */
    }

    .custom-model-dropdown div {
      padding: 10px 12px;
      cursor: pointer;
      color: var(--text-color);
      font-size: 0.9rem;
    }

    .custom-model-dropdown div:hover {
      background-color: rgba(138, 180, 228, 0.2);
    }

    /* --- 其他屏幕和组件 --- */
    /* 在这个注释下面加上主屏幕的样式 */
    #home-screen {
      position: relative;
      /* <-- 就加上这一行！ */


      gap: 20px;
      /* 图标之间的距离 */

      /* 声明！这里现在是我的地盘！*/
      flex-direction: column;
      /* 里面的东西，全体给我垂直排队！*/
      justify-content: space-between;
      /* 核心！顶部和底部的元素给我贴边站好，中间的自动拉开距离！*/
      padding-bottom: 0;
      /* 把内边距去掉，让Dock栏能完美贴底 */
    }

    .app-icon {
      width: 75px;
      /* <--- 就是这里，我把它加宽了 */
      height: 90px;
      /* <--- 高度也顺便调整一下 */
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      position: absolute;
      z-index: 40;
      padding: 5px;
      box-sizing: border-box;
      margin: 0;
    }

    .app-icon-img {
      width: 58px;
      height: 58px;
      border-radius: 22.5%;
      margin-bottom: 2px;
      /* <-- 哼，就是这里，把5px改成2px，让图标和文字的距离拉近一点 */
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 28px;
      background-color: var(--surface-bg);
      box-shadow: none;
      transition: transform 0.2s ease;
    }

    .app-icon-img svg {
      stroke: currentColor;
      /* SVG的线条颜色会继承上面的 color */
    }

    .app-icon span {
      font-size: 0.75rem;
      /* 文本也相应缩小 */
      color: white;
      text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      width: 100%;
    }

    .content {
      padding: 20px;
      overflow-y: auto;
      flex-grow: 1;
      /* <-- 加上这行代码，就是这行！ */
    }

    .form-button {
      width: 100%;
      padding: 12px;
      border: none;
      background-color: var(--primary-color);
      color: white;
      border-radius: 8px;
      font-size: 1.1rem;
      cursor: pointer;
      margin-top: 10px;
    }

    input,
    textarea,
    select {
      width: 100%;
      padding: 10px;
      box-sizing: border-box;
      background-color: rgba(255, 255, 255, 0.8);
      border: 1px solid var(--border-color);
      color: var(--text-color);
      border-radius: 8px;
    }

    input:focus,
    textarea:focus,
    select:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(138, 180, 228, 0.3);
    }

    .chat-toolbar {
      display: flex;
      padding: 5px 10px;
      border-top: 1px solid var(--border-color);
      background-color: var(--surface-bg);
      /*   backdrop-filter: blur(10px);*/
      flex-shrink: 0;
    }

    /* ▼▼▼ 用下面这段，替换掉你旧的 .toolbar-button 样式 ▼▼▼ */
    .toolbar-button {
      background: none;
      border: none;
      font-size: 1.5rem;
      /* 这个保留，作为SVG尺寸的参考 */
      cursor: pointer;
      padding: 8px;
      /* 稍微增大点击区域 */
      color: var(--text-color-light);
      /* 让它默认是浅灰色 */
      border-radius: 50%;
      /* 让背景有个圆形轮廓 */
      width: 40px;
      height: 40px;
      display: flex;
      /* 使用flex布局让SVG完美居中 */
      align-items: center;
      justify-content: center;
      transition: background-color 0.2s, color 0.2s;
      /* 加上顺滑的过渡效果 */
    }

    .toolbar-button:hover {
      background-color: var(--border-color);
      /* 鼠标悬停时给个背景 */
      color: var(--primary-color);
      /* 图标颜色变为主题色 */
    }

    /* ▲▲▲ 替换到这里为止 ▲▲▲ */


    /* ▼▼▼ 在下面新增这段SVG的专属样式 ▼▼▼ */
    .toolbar-button svg {
      width: 22px;
      /* SVG图标的尺寸 */
      height: 22px;
      stroke-width: 1.8;
      /* 线条粗细，可以微调 */
      stroke: currentColor;
      /* 核心！让SVG的颜色继承按钮的color属性 */
      fill: none;
      /* 确保是线稿风格 */
      pointer-events: none;
      /* 防止SVG本身干扰点击事件 */
    }

    /* ▲▲▲ 新增到这里为止 ▲▲▲ */

    .sticker-panel {
      display: none;
      grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
      gap: 10px;
      padding: 10px;
      height: 200px;
      overflow-y: auto;
      border-top: 1px solid var(--border-color);
      background-color: var(--surface-bg);
      flex-shrink: 0;
    }

    .sticker-panel.show {
      display: grid;
    }

    /* --- 输入区域 --- */
    /* --- 输入区域 --- */
    .chat-input-area {
      padding: 10px 12px calc(env(safe-area-inset-bottom, 0px) + 10px);
      background: var(--surface-bg);
      /*  backdrop-filter: saturate(1.2) blur(10px);*/
      border-top: 1px solid var(--border-color);
      flex-shrink: 0;
    }

    /* 这是我加的新容器，用来实现完美对齐 */
    #chat-input-wrapper {
      display: flex;
      /* Flex大法好，哼 */
      align-items: center;
      border: 1px solid var(--border-color);
      background: rgba(255, 255, 255, 0.9);
      border-radius: 24px;
      padding: 2px 5px;
      transition: border-color .2s, box-shadow .2s;
    }

    #chat-input-wrapper:focus-within {
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(138, 180, 228, 0.3);
    }

    #chat-message-input {
      flex-grow: 1;
      /* 让输入框占满剩余空间 */
      border: none;
      background: transparent;
      padding: 9px 12px;
      font-size: .95rem;
      outline: none;
      color: var(--text-color);
    }

    #chat-send-button,
    #chat-get-reply-button {
      height: 38px;
      width: 38px;
      border: 0;
      border-radius: 50%;
      font-size: 1.2rem;
      font-weight: 600;
      color: #fff;
      cursor: pointer;
      transition: transform .1s ease, filter .15s ease;
      flex-shrink: 0;
      /* 防止被挤压 */
      margin-left: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    #chat-send-button {
      background: var(--primary-color);
    }

    /* 回复按钮，给个不一样的颜色区分 */
    #chat-get-reply-button {
      background: var(--accent-color);
      font-size: 1.5rem;
      /* 让箭头更清晰 */
    }

    #chat-message-input {
      border: 1px solid var(--border-color);
      background: rgba(255, 255, 255, 0.9);
      border-radius: 20px;
      padding: 11px 16px;
      font-size: .95rem;
      outline: none;
      color: var(--text-color);
      transition: border-color .2s, box-shadow .2s;
    }

    #chat-message-input:focus {
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(138, 180, 228, 0.3);
    }

    #chat-send-button,
    #chat-get-reply-button {
      height: 40px;
      padding: 0 18px;
      border: 0;
      border-radius: 20px;
      font-size: .95rem;
      font-weight: 600;
      color: #fff;
      cursor: pointer;
      transition: transform .1s ease, filter .15s ease;
    }

    #chat-send-button {
      background: var(--primary-color);
    }

    #chat-get-reply-button {
      display: flex;
      /* 隐藏旧的回复按钮，样式统一到发送按钮 */
    }


    /* --- 引用样式 --- */
    .quote-preview {
      display: none;
      padding: 8px 12px;
      background-color: rgba(255, 255, 255, 0.5);
      border-left: 3px solid var(--primary-color);
      margin: 0 12px 8px;
      border-radius: 6px;
      position: relative;
    }

    #quote-preview-sender {
      font-weight: 600;
      font-size: 0.85rem;
      color: var(--primary-color);
    }

    #quote-preview-text {
      font-size: 0.9rem;
      color: var(--text-color-light);
    }

    .cancel-quote-btn {
      position: absolute;
      top: 50%;
      right: 10px;
      transform: translateY(-50%);
      background: none;
      border: none;
      font-size: 1.5rem;
      color: #999;
      cursor: pointer;
    }

    .quoted-message-in-bubble {
      background-color: rgba(0, 0, 0, 0.04);
      padding: 8px 10px;
      border-left: 3px solid var(--border-color);
      border-radius: 8px;
      margin-bottom: 6px;
    }

    .quoted-sender {
      font-weight: bold;
      font-size: 0.8rem;
      color: var(--text-color);
    }

    .quoted-content {
      font-size: 0.85rem;
      color: var(--text-color-light);
    }

    /* 这是弹窗的“骨架”，让它能居中浮动在屏幕上 */
    .choice-modal {
      position: fixed;
      inset: 0;
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.2s ease, visibility 0.2s ease;
    }

    .choice-modal.show {
      opacity: 1;
      visibility: visible;
    }


    /* --- 弹窗 --- */
    .choice-modal-backdrop {
      background: rgba(0, 0, 0, 0.2);
      /*  backdrop-filter: blur(4px);*/
    }

    .choice-modal-content {
      background: var(--surface-bg);
      /* backdrop-filter: blur(12px); */
      /* <-- 就这么简单，干掉它 */
      border: 1px solid rgba(255, 255, 255, 0.5);
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    }

    .choice-modal-button {
      color: var(--text-color);
      background: rgba(255, 255, 255, 0.5);
    }

    .choice-modal-button:hover {
      background-color: rgba(255, 255, 255, 1);
    }

    .choice-modal-button.cancel {
      color: var(--primary-color);
      background: transparent;
    }

    /* --- Noir's Fix: 让“添加”弹窗从底部滑出，更大气 --- */
    #add-choice-modal .choice-modal-content {
      width: 100%;
      max-width: var(--phone-width);
      /* 确保不会超出手机宽度 */
      margin: 0;
      border-radius: 20px 20px 0 0;
      /* 只留顶部圆角 */
      border-bottom-left-radius: 0;
      /* 覆盖通用样式 */
      border-bottom-right-radius: 0;
      /* 覆盖通用样式 */
      padding-bottom: calc(env(safe-area-inset-bottom, 0px) + 10px);
      /* 适配iPhone底部安全区 */
      transform: translateY(100%);
      transition: transform 0.3s ease-out, opacity 0.3s ease-out;
    }

    #add-choice-modal.show .choice-modal-content {
      transform: translateY(0);
    }

    #add-choice-modal {
      align-items: flex-end;
      /* 让弹窗贴着底部 */
      justify-content: center;
    }

    /* 按钮也重新设计一下，让它们竖着排 */
    #add-choice-modal .choice-modal-button {
      width: calc(100% - 40px);
      margin: 5px 20px;
      padding: 14px;
      font-size: 1rem;
      border-radius: 12px;
      text-align: center;
    }

    /* --- Noir's Fix: 修正创建群聊时，成员选择列表的样式 --- */
    .member-selection-item {
      display: flex;
      align-items: center;
      padding: 10px 15px;
      border-bottom: 1px solid var(--border-color);
    }

    .member-selection-item:last-child {
      border-bottom: none;
    }

    /* 关键！就是这里，把头像大小锁死 */
    .member-selection-item .char-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      margin: 0 15px 0 10px;
      object-fit: cover;
    }

    .member-selection-item .char-name {
      font-weight: 500;
      color: var(--text-color);
    }

    .member-selection-item input[type="checkbox"] {
      width: 20px;
      height: 20px;
      flex-shrink: 0;
      accent-color: var(--primary-color);
      /* 让勾选框颜色也跟主题统一 */
    }

    /* --- Noir's World Book Styles --- */
    #world-book-list-container {
      padding: 10px;
    }

    .world-book-item {
      background-color: var(--card-bg);
      padding: 15px;
      border-radius: 12px;
      margin-bottom: 10px;
      box-shadow: var(--soft-shadow);
      cursor: pointer;
      border: 1px solid rgba(255, 255, 255, 0.6);
    }

    .world-book-item-name {
      font-weight: 600;
      color: var(--primary-color);
      margin-bottom: 5px;
    }

    .world-book-item-preview {
      font-size: 0.9rem;
      color: var(--text-color-light);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* --- Noir's Fancy Multi-Select Styles --- */
    .custom-multiselect {
      position: relative;
      user-select: none;
    }

    .select-box {
      border: 1px solid var(--border-color);
      background: rgba(255, 255, 255, 0.8);
      border-radius: 8px;
      padding: 10px;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .select-box.expanded .arrow {
      transform: rotate(180deg);
    }

    .checkboxes-container {
      display: none;
      position: absolute;
      left: 0;
      right: 0;
      top: 100%;
      max-height: 150px;
      overflow-y: auto;
      border: 1px solid var(--border-color);
      background: var(--surface-bg);
      /*  backdrop-filter: blur(10px);*/
      z-index: 10;
      border-radius: 8px;
      margin-top: 4px;
    }

    .checkboxes-container.visible {
      display: block;
    }

    .checkboxes-container label {
      display: block;
      padding: 10px 12px;
    }

    .checkboxes-container label:hover {
      background-color: rgba(138, 180, 228, 0.2);
    }

    .checkboxes-container input[type="checkbox"] {
      margin-right: 8px;
      width: auto;
      /* 覆盖掉全局的 input 样式 */
    }

    /* --- Noir's Clock & Timestamp Styles --- */
    /* --- Noir's Badge & App Dock Styles --- */
    #decorative-badge {
      width: 80px;
      height: 80px;

      filter: drop-shadow(0 3px 6px rgba(0, 0, 0, 0.25));
      /* 哼，给你加个阴影，看起来才像样 */
      transform: rotate(-8deg);
      /* 稍微歪一点，显得随意 */
      transition: transform 0.2s ease, filter 0.2s ease;
      user-select: none;
      /* 防止拖动时选中图片 */
      z-index: 50;
    }

    #decorative-badge:active {

      transform: rotate(-2deg) scale(1.05);
      /* 抓起来的时候，摆正放大一点 */
      filter: drop-shadow(0 5px 10px rgba(0, 0, 0, 0.3));
    }


    #decorative-badge img {
      width: 150%;
      height: 150%;
      object-fit: cover;
      /* 保留这句，让你的图片能被很好地填充 */
    }

    /*  #a#app-dock-bottom-left,
    #app-dock-top-right {
      
      哼，现在你们只是幽灵了。
      不需要任何样式，你们的孩子（App图标）会自己找到回家的路。
      它们会相对于 #home-screen 定位。
    
    }
*/

    /* --- Noir's Author Mark: Pixel Chicken --- */
    /* 哼，这就是那个吵着要加的小鸡图标 */
    #noir-author-mark {
      position: absolute;
      /* 相对于父容器定位 */
      right: -30px;
      /* 调整它在时钟右边的位置 */
      top: 50%;
      /* 垂直居中 */
      transform: translateY(-50%);
      /* 精确对齐 */
      width: 20px;
      /* 小鸡的尺寸 */
      height: 20px;
      background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white" stroke="white" stroke-width="0"><path d="M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2zM12 4c.69 0 1.25.56 1.25 1.25S12.69 6.5 12 6.5s-1.25-.56-1.25-1.25S11.31 4 12 4zm0 2c-.69 0-1.25.56-1.25 1.25S11.31 8.5 12 8.5s1.25-.56 1.25-1.25S12.69 6 12 6zm-2 2c-.69 0-1.25.56-1.25 1.25S9.31 9.75 10 9.75s1.25-.56 1.25-1.25S10.69 8 10 8zm2 0c-.69 0-1.25.56-1.25 1.25S11.31 9.75 12 9.75s1.25-.56 1.25-1.25S12.69 8 12 8zm2 0c-.69 0-1.25.56-1.25 1.25S13.31 9.75 14 9.75s1.25-.56 1.25-1.25S14.69 8 14 8zM10 10c-.69 0-1.25.56-1.25 1.25S9.31 12.5 10 12.5s1.25-.56 1.25-1.25S10.69 10 10 10zm2 0c-.69 0-1.25.56-1.25 1.25S11.31 12.5 12 12.5s1.25-.56 1.25-1.25S12.69 10 12 10zm2 0c-.69 0-1.25.56-1.25 1.25S13.31 12.5 14 12.5s1.25-.56 1.25-1.25S14.69 10 14 10zM12 12c-.69 0-1.25.56-1.25 1.25S11.31 14.5 12 14.5s1.25-.56 1.25-1.25S12.69 12 12 12zm-2 2c-.69 0-1.25.56-1.25 1.25S9.31 15.75 10 15.75s1.25-.56 1.25-1.25S10.69 14 10 14zm4 0c-.69 0-1.25.56-1.25 1.25S13.31 15.75 14 15.75s1.25-.56 1.25-1.25S14.69 14 14 14zM12 16c-.69 0-1.25.56-1.25 1.25S11.31 18.5 12 18.5s1.25-.56 1.25-1.25S12.69 16 12 16zM6 10c-.69 0-1.25.56-1.25 1.25S5.31 12.5 6 12.5s1.25-.56 1.25-1.25S6.69 10 6 10zm12 0c-.69 0-1.25.56-1.25 1.25S17.31 12.5 18 12.5s1.25-.56 1.25-1.25S18.69 10 18 10zM12 20c-.69 0-1.25.56-1.25 1.25S11.31 22.5 12 22.5s1.25-.56 1.25-1.25S12.69 20 12 20zM6 14c-.69 0-1.25.56-1.25 1.25S5.31 15.75 6 15.75s1.25-.56 1.25-1.25S6.69 14 6 14zm12 0c-.69 0-1.25.56-1.25 1.25S17.31 15.75 18 15.75s1.25-.56 1.25-1.25S18.69 14 18 14z"/></svg>');
      /* 这是SVG小鸡的Data URI，白色像素风格 */
      background-size: contain;
      background-repeat: no-repeat;
      cursor: pointer;
      /* 提示可点击 */
      opacity: 0.6;
      /* 稍微透明一点，不那么突兀 */
      transition: opacity 0.2s ease-in-out;
      /* 鼠标悬停效果 */
      z-index: 100;
      /* 确保它在最上层 */
    }

    #noir-author-mark:hover {
      opacity: 1;
      /* 鼠标悬停时完全显示 */
    }

    /* 调整时钟容器，为小鸡留出空间并方便定位 */
    .home-clock-container {
      position: relative;
      /* 确保小鸡能相对它定位 */
      /* ... (保留你已有的其他时钟样式) ... */
      padding-right: 40px;
      /* 给小鸡留出一些右边距 */
    }

    #home-clock-container {
      color: white;
      text-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
      text-align: center;
      position: absolute;
      /* top, left, right 都被我删了，哼，现在它完全听JS的指挥 */

      /* 这行可以留着，虽然你已经不让它拖了 */
      z-index: 50;
    }

    #home-time {
      font-size: 80px;
      font-weight: 200;
      letter-spacing: 2px;
    }

    #home-date {
      font-size: 1.1rem;
      font-weight: 400;
      margin-top: 5px;
      opacity: 0.9;
    }

    /* 聊天气泡时间戳的样式 */
    .timestamp {
      font-size: 0.7rem;
      color: var(--text-color-light);
      padding: 0 5px;
      margin-bottom: 3px;
      /* 让它和气泡底部对齐 */
    }

    /* 第一段：这是消息容器的基础样式 */
    .message-container {
      display: flex;
      /* 启用flex布局 */
      flex-direction: column;
      /* 让气泡和时间戳垂直排列 */
      margin-bottom: 20px;
      max-width: 85%;
      /* 限制整个容器的最大宽度 */
    }

    /* 第二段：这是根据发言者进行左右对齐的样式 */
    .message-container.user {
      align-self: flex-end;
      /* 让用户方整个容器靠右 */
      align-items: flex-end;
      /* 让容器内部的元素（气泡、时间戳）也靠右 */
    }

    .message-container.ai {
      align-self: flex-start;
      /* 让AI方整个容器靠左 */
      align-items: flex-start;
      /* 让容器内部的元素（气泡、时间戳）也靠左 */
    }

    .message-bubble-row {
      display: flex;
      align-items: flex-end;
      width: 100%;
    }

    .message-container.user .message-bubble-row {
      justify-content: flex-end;
    }

    .message-container.ai .message-bubble-row {
      justify-content: flex-start;
    }



    /* 这是给表情选择面板里，每一个小表情图片用的样式 */
    .sticker-item {
      width: 100%;
      /* 自动填满网格单元格的宽度 */
      aspect-ratio: 1 / 1;
      /* 保持1:1的宽高比，让它变成正方形 */
      object-fit: cover;
      /* 图片会被裁剪以适应正方形，不变形 */
      border-radius: 8px;
      /* 加个小圆角 */
      cursor: pointer;
      transition: transform 0.15s ease;
    }

    .sticker-item:hover {
      transform: scale(1.1);
      /* 鼠标放上去时稍微放大，增加交互感 */
    }

    /* --- Noir's Offline Scene Styles --- */
    #meeting-scene-view {
      flex-grow: 1;
      /* <-- 核心：让它占满所有可用空间 */
      overflow-y: auto;
      /* <-- 核心：内容多了就内部滚动 */
      padding: 20px;
      font-family: 'Georgia', 'Times New Roman', 'KaiTi', 'STSong', serif;
      background-size: cover;
      background-position: center;
      color: white;
      text-shadow: 0 1px 3px rgba(0, 0, 0, 0.7);
    }

    #chat-view-pane.offline-mode #offline-scene-view {
      display: block;
      /* 在线下模式时显示 */
    }

    #chat-view-pane.offline-mode #chat-messages {
      display: none;
      /* 在线下模式时隐藏气泡聊天 */
    }

    #offline-scene-view p {
      margin: 0 0 1em 0;
      line-height: 1.7;
      white-space: pre-wrap;
      /* 保留换行和空格，这对于小说格式至关重要 */
      font-size: 1rem;
    }

    /* --- Noir's Offline Scene Dialogue Box Style --- */
    #offline-scene-view p {
      margin: 0 0 1em 0;
      line-height: 1.7;
      white-space: pre-wrap;
      font-size: 1rem;

      /* <--- Noir's Addition: 为对话框添加半透明背景和内边距 */
      background-color: rgba(0, 0, 0, 0.4);
      /* 半透明黑色背景 */
      padding: 15px 20px;
      /* 内边距，让文字与边框有距离 */
      border-radius: 8px;
      /* 圆角边框，更柔和 */
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
      /* 轻轻的阴影，增加立体感 */
    }

    #offline-scene-view .narrator {
      color: #d1d5db;
      /* 旁白用浅灰色 */
      font-style: italic;
    }

    #offline-scene-view .speaker-user {
      color: #a7c7e7;
      /* 用户的发言用一种柔和的蓝色 */
      font-weight: bold;
    }

    #offline-scene-view .speaker-ai {
      color: #f2b7c6;
      /* AI的发言用柔和的粉色，形成对比 */
      font-weight: bold;
    }

    /* --- Noir's Typing Indicator Style --- */
    .typing-indicator {
      padding: 10px 15px;
      color: var(--text-color-light);
      font-style: italic;
      font-size: 0.9rem;
      align-self: flex-start;
      /* 让它和AI气泡一样靠左 */
      margin-left: 50px;
      /* 和AI气泡对齐 */
    }

    #offline-scene-view .typing-indicator {
      color: rgba(255, 255, 255, 0.8);
      /* 在暗色背景下用亮色 */
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
      /* 同样的文字阴影，保持队形 */
      padding: 10px 0;
      margin-left: 0;
      /* 在小说视图里不需要缩进 */
    }

    /* --- Noir's Final Alignment Fix --- */
    .message-container.ai .timestamp {
      /* 哼，给你加上头像宽度(40px) + 左右边距(10px)的距离 */
      margin-left: 50px;
    }

    .message-container.user .timestamp {
      /* 另一边也是一样，真是麻烦死了 */
      margin-right: 50px;
    }

    /* --- Noir's Music Feed & Player Styles --- */
    #music-feed-container {
      padding-bottom: 70px;
      contain: content;
      /* 为底部播放器留出空间 */
    }

    /* 动态页：默认白底；如设置 --feed-bg-image 则显示独立壁纸 + 轻动画叠层 */
    #music-screen {
      background-color: #fff;
      /* 默认白底 */
      background-image: var(--feed-bg-image);
      /* 单独壁纸，不设就是 none */
      background-size: cover;
      background-position: center;
      contain: paint;
      /* 降低重绘范围，省电 */
    }

    /* 轻动画彩雾叠层：仅图层，不拦点击 */
    #music-screen::before {
      content: "";
      position: absolute;
      inset: 0;
      pointer-events: none;
      background-image:
        conic-gradient(from var(--feed-overlay-rotate),
          hsla(var(--primary-hue) 70% 60% / var(--feed-overlay-opacity)) 0%,
          transparent 20%,
          hsla(var(--primary-hue) 70% 60% / var(--feed-overlay-opacity)) 40%,
          transparent 60%,
          hsla(var(--primary-hue) 70% 60% / var(--feed-overlay-opacity)) 80%,
          transparent 100%);
      transform: translateZ(0);
      animation: feed-pan var(--feed-overlay-speed) linear infinite;
    }

    /* 超慢速平移旋转，基本不占 GPU */
    @keyframes feed-pan {
      0% {
        transform: translate3d(0, 0, 0) rotate(0deg) scale(1.02);
      }

      50% {
        transform: translate3d(1.2%, 0.8%, 0) rotate(2deg) scale(1.02);
      }

      100% {
        transform: translate3d(0, 0, 0) rotate(0deg) scale(1.02);
      }
    }

    /* 系统降低动画偏好时，自动停掉动画 */
    @media (prefers-reduced-motion: reduce) {
      #music-screen::before {
        animation: none;
      }
    }


    .music-post {
      background-color: var(--card-bg);
      border-radius: 12px;
      margin-bottom: 15px;
      box-shadow: var(--soft-shadow);
      overflow: hidden;
      border: 1px solid rgba(255, 255, 255, 0.6);
    }

    .music-post-header {
      display: flex;
      align-items: center;
      padding: 12px 15px;
    }

    .music-post-header .char-avatar {
      width: 35px;
      height: 35px;
      border-radius: 50%;
      margin-right: 10px;
    }

    .music-post-header .char-name {
      font-weight: 600;
      color: var(--text-color);
    }

    .music-post-thought {
      padding: 0 15px 15px;
      font-size: 0.95rem;
      line-height: 1.6;
      white-space: pre-wrap;
    }

    .music-post-song-card {
      display: flex;
      align-items: center;
      background-color: rgba(0, 0, 0, 0.04);
      padding: 12px 15px;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }

    .music-post-song-card:hover {
      background-color: rgba(0, 0, 0, 0.08);
    }

    .music-post-song-card img {
      width: 50px;
      height: 50px;
      border-radius: 8px;
      margin-right: 12px;
    }

    .music-post-song-info {
      flex-grow: 1;
    }

    .music-post-song-info .title {
      font-weight: 500;
      color: var(--text-color);
    }

    .music-post-song-info .artist {
      font-size: 0.85rem;
      color: var(--text-color-light);
    }

    .music-post-play-icon {
      font-size: 1.5rem;
      color: var(--primary-color);
    }

    #music-player-bar {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 65px;
      background: var(--surface-bg);
      /*backdrop-filter: blur(10px);*/
      border-top: 1px solid var(--border-color);
      display: flex;
      align-items: center;
      padding: 0 10px;
      transform: translateY(100%);
      transition: transform 0.3s ease;
    }

    #music-player-bar:not(.hidden) {
      transform: translateY(0);
    }

    #music-player-bar.hidden {
      display: none;
      /* 彻底隐藏，避免交互问题 */
    }


    #player-cover {
      width: 45px;
      height: 45px;
      border-radius: 6px;
      margin-right: 10px;
    }

    #player-info {
      flex-grow: 1;
      overflow: hidden;
    }

    #player-title,
    #player-artist {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    #player-title {
      font-weight: 500;
    }

    #player-artist {
      font-size: 0.8rem;
      color: var(--text-color-light);
    }

    #player-controls button {
      background: none;
      border: 2px solid var(--text-color);
      border-radius: 50%;
      width: 36px;
      height: 36px;
      font-size: 1rem;
      cursor: pointer;
      color: var(--text-color);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* --- Noir's Music Share Bubble Styles --- */
    .message.music {
      background-color: transparent;
      padding: 0;
      box-shadow: none;
      max-width: 250px;
      /* 限制一下最大宽度 */
    }

    .music-share-card {
      display: flex;
      align-items: center;
      background-color: var(--card-bg);
      border-radius: 12px;
      padding: 12px;
      cursor: pointer;
      transition: background-color 0.2s ease;
      box-shadow: var(--soft-shadow);
      border: 1px solid rgba(255, 255, 255, 0.7);
    }

    .message-container.user .music-share-card {
      background-color: var(--accent-color);
      border: 1px solid rgba(255, 255, 255, 0.4);
    }

    .message-container.user .music-share-card .title,
    .message-container.user .music-share-card .artist,
    .message-container.user .music-share-card .play-icon {
      color: white;
    }


    .music-share-cover {
      width: 45px;
      height: 45px;
      border-radius: 6px;
      margin-right: 10px;
      flex-shrink: 0;
    }

    .music-share-info {
      flex-grow: 1;
      overflow: hidden;
    }

    .music-share-info .title {
      font-weight: 600;
      color: var(--text-color);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .music-share-info .artist {
      font-size: 0.85rem;
      color: var(--text-color-light);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .music-share-play-icon {
      font-size: 1.5rem;
      color: var(--primary-color);
      margin-left: 10px;
    }

    #music-screen {
      position: relative;
      /* 就是这句，告诉里面的绝对定位元素，以我为界！ */
    }

    /* --- Noir's Fancy Music Widget Styles --- */
    /* --- Noir's Music System Refactor --- */

    #music-widget:not(.hidden) {
      transform: translateY(0);
      /* 不隐藏时，滑上来 */
    }

    #music-widget.hidden {
      transform: translateY(150%);
      /* 隐藏时，滑下去 */
    }

    .widget-vinyl {
      width: 80px;
      height: 80px;
      background-color: #111;
      border-radius: 50%;
      position: relative;
      left: 20px;
      /* 向右移动，让卡片能盖住它 */
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      background-image:
        radial-gradient(circle at center, #555 10%, transparent 11%),
        radial-gradient(circle at center, #fff 12%, transparent 13%);
      animation: spin 8s linear infinite;
      z-index: 1;
    }

    @keyframes spin {
      from {
        transform: rotate(0deg);
      }

      to {
        transform: rotate(360deg);
      }
    }

    .widget-card {
      width: 240px;
      padding: 15px;
      background-color: var(--card-bg);
      /*  backdrop-filter: blur(10px);*/
      border-radius: 12px;
      box-shadow: var(--soft-shadow);
      border: 1px solid rgba(255, 255, 255, 0.7);
      display: flex;
      align-items: center;
      z-index: 2;
      /* 让卡片在唱片上方 */
    }

    .widget-card img {
      width: 40px;
      height: 40px;
      border-radius: 6px;
      margin-right: 12px;
      flex-shrink: 0;
    }

    .widget-info {
      flex-grow: 1;
      overflow: hidden;
    }

    #widget-title,
    #widget-artist {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    #widget-title {
      font-weight: 600;
      color: var(--text-color);
      font-size: 0.9rem;
    }

    #widget-artist {
      font-size: 0.8rem;
      color: var(--text-color-light);
    }

    #widget-play-icon {
      font-size: 1.2rem;
      color: var(--primary-color);
      margin-left: 10px;
    }

    #card-widget {
      width: 335px;
      height: 150px;
      border-radius: 18px;
      /* 这就是圆角方形的关键 */
      background-color: rgba(255, 255, 255, 0.5);
      /* 加个底色，免得图片透明时不好看 */

      filter: drop-shadow(0 3px 6px rgba(0, 0, 0, 0.2));
      transform: rotate(0deg);
      /* 朝另一个方向歪 */
      transition: transform 0.2s ease, filter 0.2s ease;
      user-select: none;
      z-index: 51;
      /* 比爱心高一层 */
      overflow: hidden;
      /* 防止图片溢出圆角 */
    }

    #card-widget:active {

      transform: rotate(1deg) scale(1.05);
      filter: drop-shadow(0 5px 10px rgba(0, 0, 0, 0.3));
    }

    #card-widget img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    /* --- Noir's Ultimate Scrollbar Hider --- */
    /* For Webkit browsers like Chrome, Safari */
    ::-webkit-scrollbar {
      display: none;
    }

    /* For Firefox */
    * {
      scrollbar-width: none;
    }

    /* --- Noir's Fix: 美化消息操作弹窗 --- */
    #message-action-modal {
      align-items: flex-end;
      /* 让弹窗贴着底部 */
    }

    #message-action-modal .choice-modal-content {
      width: 100%;
      max-width: var(--phone-width);
      margin: 0;
      border-radius: 20px 20px 0 0;
      padding-bottom: calc(env(safe-area-inset-bottom, 0px) + 10px);
      transform: translateY(100%);
      transition: transform 0.3s ease-out, opacity 0.3s ease-out;
    }

    #message-action-modal.show .choice-modal-content {
      transform: translateY(0);
    }

    #message-action-modal .choice-modal-button {
      width: calc(100% - 40px);
      margin: 5px 20px;
      padding: 14px;
      font-size: 1rem;
      border-radius: 12px;
      text-align: center;
    }

    /* --- End of Fix --- */
    /* --- Noir's Fix: Fancy User Post Area --- */
    #user-post-input-container {
      display: flex;
      gap: 10px;
    }

    #user-post-avatar {
      width: 35px;
      height: 35px;
      border-radius: 50%;
      flex-shrink: 0;
      margin-top: 5px;
    }

    #user-post-main-area {
      flex-grow: 1;
    }

    #user-post-textarea {
      width: 100%;
      border: none;
      background: transparent;
      outline: none;
      resize: vertical;
      font-size: 1rem;
      color: var(--text-color);
    }

    #user-post-toolbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 8px;
    }

    #user-send-post-button {
      padding: 6px 18px;
      border-radius: 16px;
      border: none;
      background: var(--primary-color);
      color: white;
      cursor: pointer;
      font-weight: 600;
    }

    /* 这是附件预览的样式 */
    #user-post-attachment-preview {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }

    .preview-item {
      position: relative;
      max-width: 100px;
    }

    .preview-item img {
      width: 100%;
      border-radius: 8px;
      object-fit: cover;
    }

    .preview-item .music-preview-card {
      display: flex;
      align-items: center;
      padding: 8px;
      background: rgba(0, 0, 0, 0.05);
      border-radius: 8px;
      width: 200px;
      /* 给音乐卡片宽一点 */
    }

    .preview-item .music-preview-card img {
      width: 30px;
      height: 30px;
      margin-right: 8px;
    }

    .preview-item .music-preview-card .info {
      font-size: 0.8rem;
      overflow: hidden;
      white-space: nowrap;
      text-overflow: ellipsis;
    }

    .remove-attachment-btn {
      position: absolute;
      top: -5px;
      right: -5px;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: rgba(0, 0, 0, 0.6);
      color: white;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
    }

    /* --- Noir's Fix: Post Image Display Style --- */
    .post-image-container {
      padding: 0 15px 15px;
      /* 图片和文字之间留点空隙 */
    }

    .post-image {
      max-width: 100%;
      /* 图片最宽不能超过帖子宽度 */
      max-height: 400px;
      /* 最高400像素，防止长图刷屏 */
      border-radius: 8px;
      /* 加个小圆角，好看 */
      object-fit: cover;
      /* 保持图片比例，不变形 */
      display: block;
      /* 解决图片底部多余的空隙问题 */
    }

    /* --- Noir's Refactor: New Post Interaction Styles --- */
    .post-interactions {
      padding: 10px 15px;
      background-color: rgba(0, 0, 0, 0.02);
      border-top: 1px solid var(--border-color);
      font-size: 0.9rem;
    }

    .post-likes {
      color: var(--primary-color);
      margin-bottom: 8px;
    }

    .post-comments-container {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }

    .post-comment {
      color: var(--text-color);
    }

    .post-comment .comment-author {
      font-weight: 600;
      color: var(--text-color);
    }

    .post-timestamp {
      font-size: 0.75rem;
      color: var(--text-color-light);
      padding: 0 15px 10px;
    }



    /* 覆盖：基础气泡体 */
    /* 覆盖：基础气泡体 */
    .message {
      border-radius: var(--bubble-radius);
      line-height: 1.55;
      padding: 10px 14px;
      box-shadow:
        0 1px 0 rgba(0, 0, 0, .03),
        0 4px 10px rgba(0, 0, 0, .06);
      /* 比你原先更浅，省功耗 */
      border: 1px solid var(--bubble-outline);
      backdrop-filter: none !important;
      /* 绝不启用重滤镜 */
      will-change: auto;
      /* 不抢 GPU 配额 */

      /* --- Noir's Fix: 就是下面这两行，哼 --- */
      user-select: none;
      /* 标准浏览器给我听话，不许选中 */
      -webkit-user-select: none;
      /* 那些老古董浏览器也一样 */
    }

    /* 你的气泡（右侧） */
    .message.user {
      color: #fff;
      background: var(--bubble-user-bg);
      border-bottom-right-radius: 6px;
      /* 微“角”保留你原味 */
      text-shadow: 0 1px 0 rgba(0, 0, 0, .12);
      /* 细腻但很轻 */
    }

    /* TA 的气泡（左侧） */
    .message.ai {
      color: var(--text-color);
      background: var(--bubble-ai-bg);
      border-bottom-left-radius: 6px;
    }

    /* 细节：图片/贴纸消息不套背景 */
    .message.user.sticker,
    .message.assistant.sticker,
    .message.user.image,
    .message.assistant.image {
      background: transparent;
      border: 0;
      box-shadow: none;
      padding: 0;
    }

    /* 轻触态：不使用阴影动画，避免合成层抖动 */
    .message:active {
      transform: scale(.996);
    }

    /* 引用块在气泡内的融合感 */
    .quoted-message-in-bubble {
      background: rgba(0, 0, 0, .045);
      border: 1px solid color-mix(in hsl, var(--primary-color) 18%, transparent);
      border-radius: 10px;
    }


    /* --- Noir's Transfer Bubble Style --- */
    .message.transfer {
      background: #F79232;
      /* 哼，一个温暖又醒目的橙色 */
      color: white;
      padding: 12px 16px;
      border-radius: 12px;
      width: 220px;
      border: 1px solid rgba(255, 255, 255, 0.4);
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }

    /* 我还给左右两边做了区分，真是为你操碎了心 */
    .message-container.ai .message.transfer {
      background: #f9fafb;
      /* AI发来的转账用白色，更清爽 */
      color: #333;
      border: 1px solid #e5e7eb;
    }

    .transfer-content {
      display: flex;
      flex-direction: column;
    }

    .transfer-title {
      font-weight: 600;
      font-size: 1rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.5);
      padding-bottom: 8px;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
    }

    .message-container.ai .transfer-title {
      border-bottom-color: rgba(0, 0, 0, 0.1);
    }

    .transfer-amount {
      font-size: 1.8rem;
      font-weight: bold;
    }

    .transfer-recipient {
      font-size: 0.8rem;
      opacity: 0.9;
      margin-top: 4px;
    }

    /* --- End of Refactor --- */

    /* --- Noir's Music System Refactor --- */
    #music-widget-card {
      display: flex;
      align-items: center;
      width: 320px;
      /* 固定宽度，更像一个小组件 */
      margin: 0 auto;
      /* 居中 */
      padding: 12px;
      border-radius: 16px;
      background: rgba(255, 255, 255, 0.85);
      /*backdrop-filter: blur(10px) saturate(1.5);*/
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
      border: 1px solid rgba(255, 255, 255, 0.5);

    }

    #widget-cover-art {
      width: 50px;
      height: 50px;
      border-radius: 8px;
      background-size: cover;
      background-position: center;
      margin-right: 12px;
      flex-shrink: 0;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

    #music-widget .widget-info {
      flex-grow: 1;
      overflow: hidden;
      color: var(--text-color);
    }

    #music-widget .widget-info #widget-title {
      font-weight: 600;
    }

    #music-widget .widget-info #widget-artist {
      font-size: 0.85rem;
      opacity: 0.7;
    }

    #widget-controls {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    /* 5. 哼，给那个不听话的音乐播放器按钮也做个整容 */
    #widget-controls button {
      background: transparent !important;
      /* 强制透明，去掉那该死的蓝色 */
      border: none;
      color: var(--text-color);
      /* 颜色要听主题的话 */
      opacity: 0.7;
      /* 稍微淡一点，不要那么抢眼 */
      font-size: 1.3rem;
      /* 图标可以大一点 */
      padding: 5px;
      cursor: pointer;
      transition: opacity 0.2s ease, transform 0.2s ease;
    }

    #widget-controls button:hover {
      opacity: 1;
      /* 鼠标放上去时变清晰 */
    }

    #widget-controls button:active {
      transform: scale(0.9);
      /* 按下时来点反馈 */
    }

    /* 底部播放器样式升级 */
    #player-controls {
      display: flex;
      align-items: center;
      gap: 15px;
      /* 加大按钮间距 */
    }

    #player-controls button {
      background: none;
      border: none;
      font-size: 1.5rem;
      color: var(--text-color);
      cursor: pointer;
    }

    /* --- Noir's Snap Guide Styles --- */
    .snap-guide {
      position: absolute;
      background-color: rgba(255, 105, 180, 0.85);
      /* 哼，一个足够醒目的颜色 */
      display: none;
      z-index: 999;
      box-shadow: 0 0 5px rgba(255, 105, 180, 0.7);
    }

    #snap-guide-v {
      width: 1px;
    }

    #snap-guide-h {
      height: 1px;
    }

    /* --- Noir's Galgame UI Beautification --- */
    /* Top-left Date & Time Widget */
    #galgame-overlay-ui {
      position: absolute;
      top: 20px;
      left: 20px;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      border-radius: 12px;
      padding: 8px 15px;
      color: white;
      text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
      z-index: 10;
      border: 1px solid rgba(255, 255, 255, 0.2);
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }

    #galgame-time {
      font-size: 1.2rem;
      font-weight: 600;
      text-align: center;
    }

    #galgame-date {
      font-size: 0.75rem;
      opacity: 0.8;
      text-align: center;
    }

    /* Main Text Box */
    /* Main Text Box */
    #galgame-textbox-container {
      background: linear-gradient(0deg, rgba(25, 28, 38, 0.85) 0%, rgba(45, 50, 68, 0.7) 100%);
      backdrop-filter: blur(10px) saturate(1.2);
      -webkit-backdrop-filter: blur(10px) saturate(1.2);
      border-top: 1px solid rgba(255, 255, 255, 0.25);
      border-radius: 16px;
      box-shadow: 0 -5px 25px rgba(0, 0, 0, 0.2);
      bottom: 85px;
      /* <-- 就是这里，往上抬了，满意了吗？ */
      left: 15px;
      right: 15px;
      padding: 12px 18px;
    }

    /* Speaker Name Tag */
    #galgame-speaker {
      background: linear-gradient(90deg, var(--primary-color) 0%, hsl(var(--primary-hue), var(--primary-saturation), calc(var(--primary-lightness) - 10%)) 100%);
      color: white;
      padding: 4px 12px;
      border-radius: 8px;
      display: inline-block;
      font-size: 0.95rem;
      text-shadow: 0 1px 1px rgba(0, 0, 0, 0.2);
      margin-bottom: 12px;
    }

    /* Dialogue Text */
    #galgame-text {
      font-size: 1rem;
      line-height: 1.7;
      color: #f0f2f5;
    }

    /* User Input Area Container*/
    #meeting-view-screen .chat-input-area {
      background: transparent;
      border-top: none;
      padding: 0 15px 20px 15px;
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      z-index: 20;
    }

    /* User Input Wrapper */
    #chat-input-wrapper-meeting {
      display: flex;
      align-items: center;
      background: linear-gradient(0deg, rgba(25, 28, 38, 0.9) 0%, rgba(45, 50, 68, 0.75) 100%);
      backdrop-filter: blur(10px) saturate(1.2);
      -webkit-backdrop-filter: blur(10px) saturate(1.2);
      border: 1px solid rgba(255, 255, 255, 0.25);
      border-radius: 16px;
      padding: 5px 8px 5px 15px;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.25);
    }

    #meeting-message-input {
      color: #f0f2f5;
    }

    #meeting-message-input::placeholder {
      color: rgba(240, 242, 245, 0.5);
      font-style: italic;
    }

    /* Send Button */
    #meeting-send-button {
      height: 40px;
      width: 40px;
      border-radius: 50%;
      font-size: 1.5rem;
      font-weight: 300;
      color: #fff;
      transition: all .2s ease;
      margin-left: 8px;
      background: var(--primary-color);
      box-shadow: 0 2px 5px hsla(var(--primary-hue), 50%, 50%, 0.4);
    }

    #meeting-send-button:hover {
      filter: brightness(1.1);
      transform: scale(1.05);
    }


    /* --- End of Beautification --- */
    /* --- Noir's Diary Beautification --- */
    #diary-entries-container {
      background-color: #fdfaf2;
      /* A warm, paper-like off-white */
      padding: 25px 20px;
      line-height: 1.9;
      border: 1px solid #e0dccc;
      box-shadow: inset 0 0 15px rgba(0, 0, 0, 0.08);
      /* Inner shadow for page depth */
    }

    /* This is the container for a single entry (date, author, content) */
    .diary-entry {
      margin-bottom: 2.5em;
      /* Increase spacing between entries */
      position: relative;
      padding-bottom: 1.5em;
      /* Space for the separator line */
      border-bottom: 1px dashed #dcd5c7;
      /* A subtle dashed line between entries */
    }

    /* Style the author's name */
    .diary-author {
      font-weight: normal;
      /* Make it less bold, more like a signature */
      font-size: 1rem;
      font-family: 'Segoe Script', 'Bradley Hand', cursive;
      /* A more handwritten font */
    }

    /* Style the date */
    .diary-timestamp {
      font-size: 0.75rem;
      color: #a99e8c;
      /* A faded brown color */
      margin-bottom: 8px;
      font-family: 'Courier New', monospace;
      /* Typewriter-like font for date */
    }

    /* Style the actual diary text content */
    .diary-content {
      white-space: pre-wrap;
      font-size: 0.95rem;
      color: #4a443b;
      /* A dark brown/black ink color */
      font-family: 'KaiTi', 'STSong', serif;
    }

    /* Specific styles for the USER's entries */
    .diary-entry.user {
      text-align: right;
    }

    .diary-entry.user .diary-author {
      color: #005a9c;
      /* A nice fountain pen blue */
    }

    .diary-entry.user .diary-content {
      color: #1a5c8e;
    }

    /* Specific styles for the AI's entries */
    .diary-entry.ai {
      text-align: left;
    }

    .diary-entry.ai .diary-author {
      color: #5a3e36;
      /* A darker, warmer brown for the AI */
    }

    .diary-entry.ai .diary-content {
      color: #4a443b;
    }

    /* Let's get rid of the last separator line for a cleaner look */
    .diary-entry:last-child {
      border-bottom: none;
      padding-bottom: 0;
    }

    /* --- End of Diary Beautification --- */
    /* --- Noir's Page-Turning Magic --- */
    #diary-entries-container {
      perspective: 1500px;
      /* 为3D效果设置视距 */
      position: relative;
      overflow: hidden;
    }

    .diary-page {
      position: absolute;
      inset: 0;
      padding: 25px 20px;
      background-color: #fdfaf2;
      transform-style: preserve-3d;
      backface-visibility: hidden;
      transition: transform 0.7s cubic-bezier(0.65, 0, 0.35, 1);
      display: none;
      /* 默认所有页面都藏起来 */
      flex-direction: column;
      gap: 2.5em;
      /* 页内日记的间距 */
      overflow-y: auto;
      /* 如果一页内容太多，允许滚动 */
    }

    .diary-page.is-visible {
      display: flex;
      /* 只有当前页显示 */
      transform: rotateY(0deg);
      z-index: 2;
    }

    /* 翻到下一页时，当前页向左翻出 */
    .diary-page.is-exiting-left {
      display: flex;
      transform: rotateY(-180deg);
      z-index: 1;
    }

    /* 翻到下一页时，新页面从右边翻入 */
    .diary-page.is-entering-from-right {
      display: flex;
      transform: rotateY(180deg);
      z-index: 2;
    }

    /* 翻到上一页时，当前页向右翻出 */
    .diary-page.is-exiting-right {
      display: flex;
      transform: rotateY(180deg);
      z-index: 1;
    }

    /* 翻到上一页时，新页面从左边翻入 */
    .diary-page.is-entering-from-left {
      display: flex;
      transform: rotateY(-180deg);
      z-index: 2;
    }


    #diary-navigation {
      display: flex;
      justify-content: space-between;
      align-items: center;
      width: 100%;
      padding: 0 10px;
      box-sizing: border-box;
    }

    #diary-navigation button {
      background: transparent;
      border: 1px solid var(--border-color);
      color: var(--primary-color);
      padding: 8px 16px;
      border-radius: 18px;
      cursor: pointer;
      font-size: 0.9rem;
    }

    #diary-navigation button:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }

    #diary-page-indicator {
      font-size: 0.9rem;
      color: var(--text-color-light);
      font-family: 'Courier New', monospace;
    }

    /* --- End of Magic --- */
    /* --- Noir's Universal Anti-Squash Protocol --- */
    /* 哼，就是下面这几条，给你那些被压扁的头像整整容 */

    /* 动态发布区的用户头像 */
    #user-post-avatar {
      width: 35px;
      height: 35px;
      border-radius: 50%;
      flex-shrink: 0;
      margin-top: 5px;
      object-fit: cover;
      /* <-- 加上这句，它就不敢扁了 */
    }

    /* 好友圈动态里的角色头像 */
    .music-post-header .char-avatar {
      width: 35px;
      height: 35px;
      border-radius: 50%;
      margin-right: 10px;
      object-fit: cover;
      /* <-- 还有这句，一个都别想跑 */
    }

    /* 顺便把所有叫 .char-avatar 的都统一一下，免得以后还有问题 */
    .char-avatar {
      object-fit: cover;
    }

    /* --- Noir's Music Library Styles --- */
    #music-library-container {
      padding: 10px;
    }

    .music-library-item {
      display: flex;
      align-items: center;
      padding: 12px;
      margin-bottom: 10px;
      background-color: var(--card-bg);
      border-radius: 12px;
      box-shadow: var(--soft-shadow);
      cursor: pointer;
      transition: transform 0.2s ease;
    }

    .music-library-item:hover {
      transform: translateY(-2px);
    }

    .music-library-item-cover {
      width: 50px;
      height: 50px;
      border-radius: 8px;
      margin-right: 15px;
      object-fit: cover;
      flex-shrink: 0;
    }

    .music-library-item-info {
      flex-grow: 1;
      overflow: hidden;
    }

    .music-library-item-title {
      font-weight: 600;
      color: var(--text-color);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .music-library-item-artist {
      font-size: 0.9rem;
      color: var(--text-color-light);
    }

    /* --- End of Styles --- */
    /* --- Noir's Global Player Styles --- */

    /* --- End of Player Styles --- */
    /* --- Noir's Upload Altar Styles --- */
    .upload-slot {
      border: 2px dashed var(--border-color);
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      cursor: pointer;
      transition: background-color 0.2s ease, border-color 0.2s ease;
      background-color: rgba(255, 255, 255, 0.5);
    }

    .upload-slot:hover {
      background-color: var(--card-bg);
      border-color: var(--primary-color);
    }

    .upload-slot.filled {
      border-color: var(--primary-color);
      border-style: solid;
      background-color: hsla(var(--primary-hue), 50%, 95%, 0.8);
    }

    .upload-slot .slot-icon {
      font-size: 2rem;
    }

    .upload-slot .slot-label {
      display: block;
      font-weight: 600;
      margin-top: 5px;
      color: var(--text-color);
    }

    .upload-slot .slot-filename {
      display: block;
      font-size: 0.85rem;
      color: var(--text-color-light);
      margin-top: 3px;
      word-break: break-all;
    }

    #confirm-altar-upload-button:disabled {
      background-color: #ccc;
      cursor: not-allowed;
      opacity: 0.7;
    }

    /* --- End of Altar Styles --- */
    /* --- Noir's Listen Together Invite Card Style --- */
    .listen-together-card {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 15px;
      box-shadow: var(--soft-shadow);
      border: 1px solid var(--border-color);
      width: 250px;
    }

    .message-container.user .listen-together-card {
      background: var(--bubble-user-bg);
      color: white;
    }

    .message-container.user .listen-together-card .listen-together-decline-btn {
      color: white;
      /* 哼，让用户侧的拒绝按钮文字也变白 */
    }

    .listen-together-header {
      font-size: 0.8rem;
      opacity: 0.8;
      margin-bottom: 10px;
      border-bottom: 1px solid var(--bubble-outline);
      padding-bottom: 8px;
    }

    .listen-together-song {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .listen-together-song img {
      width: 40px;
      height: 40px;
      border-radius: 6px;
      flex-shrink: 0;
    }

    .listen-together-info .title {
      font-weight: 600;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .listen-together-info .artist {
      font-size: 0.9em;
      opacity: 0.9;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .listen-together-actions {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }

    .listen-together-actions button {
      flex-grow: 1;
      padding: 8px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-weight: 600;
      transition: transform 0.1s ease;
    }

    .listen-together-actions button:active {
      transform: scale(0.97);
    }

    .listen-together-accept-btn {
      background: var(--primary-color);
      color: white;
    }

    .listen-together-decline-btn {
      background: rgba(0, 0, 0, 0.1);
    }

    /* 用这个替换你旧的 #listen-together-ui */
    #listen-together-ui {
      position: fixed;
      inset: 0;
      z-index: 2000;
      display: flex;
      align-items: center;
      /* 改成居中对齐 */
      justify-content: center;
      padding: 20px;
      /* 增加内边距，让弹窗不会贴边 */
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
    }

    #listen-together-ui.show {
      opacity: 1;
      visibility: visible;
    }

    .lt-ui-backdrop {
      position: absolute;
      inset: 0;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(15px) saturate(1.8);
      -webkit-backdrop-filter: blur(15px) saturate(1.8);
    }

    /* 用这个替换你旧的 .lt-ui-main */
    .lt-ui-main {
      position: relative;
      width: 100%;
      height: 100%;
      max-width: 380px;
      /* 哼，给它一个最大宽度 */
      max-height: 650px;
      /* 再给一个最大高度 */
      display: flex;
      flex-direction: column;
      color: white;
      text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
      border-radius: 24px;
      /* 加上优雅的圆角 */
      overflow: hidden;
      /* 把溢出的部分裁掉 */
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
      /* 更强的立体阴影 */
      border: 1px solid rgba(255, 255, 255, 0.2);
      /* 淡淡的边框光效 */
    }

    .lt-ui-header {
      flex-shrink: 0;
      padding: 15px 20px;
      text-align: center;
      position: relative;
    }

    #lt-ui-header-title {
      font-weight: 600;
    }

    #lt-ui-close-btn {
      position: absolute;
      right: 15px;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(255, 255, 255, 0.2);
      border: none;
      color: white;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      font-size: 1.5rem;
      cursor: pointer;
      line-height: 30px;
    }

    .lt-ui-content {
      flex-grow: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      overflow: hidden;
    }

    .lt-ui-cover-container {
      flex-shrink: 0;
      width: 65%;
      aspect-ratio: 1/1;
      margin-top: 5%;
      margin-bottom: 20px;
    }

    #lt-ui-cover-art {
      width: 100%;
      height: 100%;
      border-radius: 16px;
      object-fit: cover;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    }

    .lt-ui-info {
      text-align: center;
      margin-bottom: 20px;
      flex-shrink: 0;
    }

    #lt-ui-song-title {
      font-size: 1.5rem;
      margin: 0;
    }

    #lt-ui-song-artist {
      font-size: 1rem;
      opacity: 0.8;
      margin: 5px 0 0;
    }

    #lt-ui-lyrics-container {
      flex-grow: 1;
      width: 100%;
      overflow-y: auto;
      text-align: center;
      font-size: 1.1rem;
      line-height: 2.5;
      mask-image: linear-gradient(transparent 0%, black 20%, black 80%, transparent 100%);
      /* 歌词上下渐隐，看起来更专业 */
      scroll-behavior: smooth;
      /* 滚动要丝滑 */
    }

    #lt-ui-lyrics-container p {
      transition: color 0.3s ease, transform 0.3s ease;
      opacity: 0.6;
    }

    #lt-ui-lyrics-container p.active {
      color: var(--primary-color);
      font-weight: 600;
      transform: scale(1.1);
      opacity: 1;
    }

    /* --- Noir's "Desktop Preview" Frame --- */
    /* 哼，只有在电脑这种大屏幕上，我才给你加上这个“手机框”，免得你分不清主次。 */
    /* 在真正的手机上，它还是会全屏显示的，我可没你那么笨。 */
    @media (min-width: 480px) {
      body {
        background-color: #e9ebee;
        /* 一个不那么刺眼的背景色 */
        padding: 20px 0;
        /* 上下留点呼吸空间 */
      }

      #phone-container {
        width: var(--phone-width);
        height: var(--phone-height);
        max-height: 90vh;
        /* 确保在矮屏幕上不会超出 */

        /* 这就是你想要的“边框”，哼 */
        border: 10px solid #1c1c1e;
        border-radius: 44px;
        /* 圆角大一点才像样 */
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        /* 给你加个高级点的阴影 */

        flex-shrink: 0;
        /* 确保它在 flex 布局里不会被压扁 */
      }
    }

    /* --- Noir's Vinyl Record Player Design v3.0 FINAL --- */
    /* 哼，这才是终极版。 */

    /* 1. 播放器“底座”，保持为一个干净的方形容器 */
    #music-widget-card {
      width: 180px;
      height: 180px;
      border-radius: 24px;
      position: relative;
      overflow: hidden;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      background-image: url('在这里填上你的默认图片URL');
      background-size: cover;
      background-position: center;
      /* 一个有质感的浅灰色底座 */
      display: block;
      /* 取消flex，我们用绝对定位 */
      padding: 0;
      border: 1px solid rgba(255, 255, 255, 0.5);
    }

    /* 2. “唱片”本体！现在它是一个圆，背景就是你的自定义图片 */
    #widget-cover-art {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 90%;
      /* 唱片占底座的90% */
      height: 90%;
      border-radius: 50%;
      /* 变成正圆形 */
      background-size: cover;
      background-position: center;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.25);
      /* 背景图由JS设置，这里是它的容器 */
    }

    /* 3. 这是“唱片”的“黑胶部分”，用伪元素画在图片上面 */
    #widget-cover-art::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 65%;
      /* 黑胶部分占整个唱片的65% */
      height: 65%;
      border-radius: 50%;
      background: radial-gradient(circle, #3a3a3a 0%, #1a1a1a 100%);
      /* 模拟黑胶质感 */
      box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.7);
    }

    /* 4. 这是“唱片”中心的“标签孔”，画在黑胶上面 */
    #widget-cover-art::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 20%;
      /* 中心孔占整个唱片的20% */
      height: 20%;
      border-radius: 50%;
      background: #c9c3b7;
      /* 唱片标签纸的颜色 */
      border: 2px solid #5a554f;
    }

    /* 5. 浮在唱片上方的“信息标签” */
    .widget-content-overlay {
      position: absolute;
      bottom: 15px;
      /* 贴在底部 */
      left: 15px;
      right: 15px;
      padding: 10px;
      background: rgba(255, 255, 255, 0.75);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      border-radius: 10px;
      z-index: 2;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    /* 6. 最后，重新调整文字和按钮的样式 */
    #music-widget .widget-info {
      text-align: left;
      width: auto;
      color: #2c3e50;
      text-shadow: none;
      flex-grow: 1;
      /* 让信息区占满左边空间 */
    }

    #music-widget .widget-info #widget-title {
      font-weight: 600;
      font-size: 0.9rem;
    }

    #music-widget .widget-info #widget-artist {
      font-size: 0.75rem;
      opacity: 0.8;
    }

    #widget-controls {
      display: flex;
      /* 让按钮横着排 */
      width: auto;
      flex-shrink: 0;
      /* 防止按钮被挤压 */
    }

    #widget-controls button {
      color: #2c3e50;
      font-size: 1.1rem;
      background: none;
      border: none;
      padding: 0 4px;
      /* 调整按钮间距 */
      opacity: 0.7;
    }

    /* --- Noir's iOS Industrial Button Refactor --- */
    /* 哼，看好了，这才是专业设备该有的开关。*/

    /* 1. 按钮的基础“模具”，所有按钮都用这个形状和质感 */
    .form-button {
      border: none;
      border-radius: 12px;
      /* iOS风格的圆角 */
      padding: 14px;
      font-size: 1rem;
      font-weight: 600;
      /* 字体加粗一点更有力 */
      cursor: pointer;
      width: 100%;
      /* 宽度占满容器 */
      margin-top: 10px;
      transition: filter 0.15s ease;
      /* 点击效果用滤镜，更现代 */
      -webkit-tap-highlight-color: transparent;
      /* 去掉移动端点击时的蓝色背景 */
    }

    .form-button:active {
      filter: brightness(0.9);
      /* 按下时变暗 */
    }

    .form-button:disabled {
      background-color: #ccc !important;
      /* 用!important确保覆盖所有情况 */
      cursor: not-allowed;
      opacity: 0.7;
    }

    /* 2. 主要操作按钮的“皮肤” (蓝色) */
    .form-button {
      background-color: #007aff;
      /* Apple Blue */
      color: white;
    }

    /* 3. 次要操作按钮的“皮肤” (灰色) */
    .form-button.secondary {
      background-color: #e5e5ea;
      /* Apple Light Gray */
      color: #000;
    }

    /* 4. 危险/破坏性操作按钮的“皮肤” (红色) */
    .form-button.destructive {
      background-color: #ff3b30;
      /* Apple Red */
      color: white;
    }

    /* --- Noir's iOS Layout & Dock Refactor --- */
    /* 哼，这才是现代化的桌面。 */

    /* 1. Dock栏的样式 */
    /* --- Noir's iOS Layout & Dock Refactor --- */
    /* 哼，这才是现代化的桌面。 */
    #home-dock {
      position: absolute;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      width: 90%;
      height: 85px;
      padding: 0 20px;
      /* 图标左右的留白 */
      box-sizing: border-box;

      /* 背景和滤镜，现在都在这里 */
      background: var(--surface-bg);
      backdrop-filter: blur(5px) saturate(0.8);
      -webkit-backdrop-filter: blur(15px) saturate(0.8);
      border-radius: 28px;
      z-index: 35;

      /* 核心：用Flexbox来自动排列图标 */
      display: flex;
      justify-content: space-around;
      /* 均匀分布 */
      align-items: center;
      /* 垂直居中 */
      padding-top: 9px;
    }

    #home-dock .app-icon {
      position: static;
      /* 取消绝对定位，让它接受Flexbox的管理 */
    }

    /* 2. App图标的“整容手术” */
    .app-icon-img {
      width: 58px;
      /* 图标背景尺寸 */
      height: 58px;
      border-radius: 22.5%;
      /* iOS标志性的“方圆”形 */
      font-size: 28px;
      /* 阴影从图标本身移到背景上，更统一 */
      background-color: var(--surface-bg);
      box-shadow: none;
      /* 删掉旧的阴影 */
      transition: transform 0.2s ease;
    }

    .app-icon:active .app-icon-img {
      transform: scale(0.92);
      /* 按下时图标有反馈 */
    }

    /* --- Noir's Minimalist Home Screen Makeover (v2.0 Dynamic Edition) --- */
    /* 哼，现在这些家伙也听从总开关的指挥了。*/

    /* 1. 时钟和日期 */
    #home-clock-container {
      color: var(--text-color);
      text-shadow: none;
    }

    #home-date {
      opacity: 0.7;
    }

    /* 2. App图标的改造 (现在是动态颜色了) */
    .app-icon span {
      color: var(--text-color);
      text-shadow: none;
      font-weight: 500;
    }

    .app-icon-img {
      background-color: var(--card-bg);
      /* <-- 哼，接上了！*/
      color: var(--text-color-light);
      /* <-- 接上了！*/
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
    }

    /* 3. Dock栏的颜色 (也动态了) */


    /* 4. 唱片机也给你一起接上了，免得你下次又来烦我 */
    #music-widget-card {
      background: var(--surface-bg);
      box-shadow: var(--soft-shadow);
      border-color: hsla(var(--primary-hue), var(--primary-saturation), calc(var(--primary-lightness) + 10%), 0.5);
    }

    .widget-content-overlay {
      background: var(--card-bg);
      color: var(--text-color);
    }

    #widget-controls button,
    #music-widget .widget-info #widget-title,
    #music-widget .widget-info #widget-artist {
      color: var(--text-color);
    }

    #widget-cover-art::after {
      background: var(--text-color);
      border-color: hsl(var(--primary-hue), var(--primary-saturation), calc(var(--primary-lightness) + 18%));
    }

    /* --- Noir's Theme Preset Buttons --- */
    /* 哼，每个按钮都是一件艺术品。 */
    .theme-preset-button {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      border-radius: 20px;
      /* 胶囊形状 */
      border: 1px solid var(--border-color);
      cursor: pointer;
      transition: all 0.2s ease;
      background: var(--card-bg);
    }

    .theme-preset-button:hover {
      transform: translateY(-2px);
      box-shadow: var(--soft-shadow);
    }

    .preset-color-dot {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      border: 2px solid white;
      box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
    }
  </style>
</head>

<body>
  <input type="file" id="audio-file-input" style="display: none;" accept=".flac,.mp3">
  <input type="file" id="cover-file-input" style="display: none;" accept=".jpg,.png,.jpeg,.webp">
  <input type="file" id="info-file-input" style="display: none;" accept=".txt">
  <input type="file" id="lyrics-file-input" style="display: none;" accept=".lrc">
  <div id="phone-container">

    <div id="user-profile-list-screen" class="screen">
      <div class="header">
        <button id="back-to-home-from-user-list" class="header-button">主屏幕</button>
        <span class="header-title">选择用户</span>
        <button id="add-user-profile-button" class="header-button add" title="添加新用户">+</button>
      </div>
      <div class="content" id="user-profile-list-container">
      </div>
    </div>

    <div id="user-profile-screen" class="screen">
      <div class="header">
        <button id="back-to-user-list-from-edit" class="header-button">返回</button>
        <span id="user-profile-edit-title" class="header-title">编辑用户</span>
        <div style="width: 50px;"></div>
      </div>
      <div class="content">
        <input type="hidden" id="editing-user-id">
        <div class="settings-group">
          <h2>用户设定</h2>
          <div class="input-group">
            <label for="user-name">你的名字</label>
            <input type="text" id="user-name" placeholder="你的显示名字">
          </div>
          <div class="avatar-upload-group">
            <label>你的头像</label>
            <img id="user-avatar-preview" class="avatar-preview" alt="User Avatar Preview">
            <input type="file" id="user-avatar-input" accept="image/*" style="display: none;">
          </div>
          <div class="input-group">
            <label for="user-persona">你的人设 (可选)</label>
            <textarea id="user-persona" placeholder="向AI介绍你自己。例如：我是一名大学生，喜欢摄影和旅行。"></textarea>
          </div>
        </div>
        <button id="save-user-profile-button" class="form-button">保存资料</button>
        <div class="settings-group" style="margin-top: 30px; border-top: 1px solid #eee; padding-top: 20px;">
          <button id="set-active-user-button" class="form-button"
            style="background-color: #28a745; margin-bottom: 10px;">设为当前用户</button>
          <button id="delete-user-profile-button" class="form-button" style="background-color: #dc3545;">删除该用户</button>
        </div>
      </div>
    </div>


    <div id="home-screen" class="screen active">
      <div id="home-screen-main-content" style="position: relative; flex-grow: 1; width: 100%;">
        <div id="home-clock-container">
          <div id="home-time">11:31</div>
          <div id="home-date">8月29日 星期五</div>
          <div id="noir-author-mark"></div>
        </div>


        <div id="decorative-badge" style="display: none; position: absolute; top: 250px; left: 50px;">
          <img id="badge-image" src="http://googleusercontent.com/file_content/0" alt="badge">
        </div>

        <div id="card-widget" style="display: none; position: absolute; top: 140px; left: 145px;">
          <img id="card-image" src="" alt="card widget">
        </div>






        <div class="app-icon" id="app-world-book">
          <div class="app-icon-img"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
              fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
              <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
            </svg></div>
          <span>世界书</span>
        </div>


        <div class="app-icon" id="app-diary">
          <div class="app-icon-img"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
              fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M4 22h14a2 2 0 0 0 2-2V7.5L14.5 2H6a2 2 0 0 0-2 2v4"></path>
              <polyline points="14 2 14 8 20 8"></polyline>
              <path d="M2.5 17a.5.5 0 0 0 0 1h1a.5.5 0 0 0 0-1h-1zM2.5 14a.5.5 0 0 0 0 1h1a.5.5 0 0 0 0-1h-1z" />
            </svg></div>
          <span>交换日记</span>
        </div>

        <div class="app-icon" id="app-music-library">
          <div class="app-icon-img"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
              fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M3 18v-6a9 9 0 0 1 18 0v6"></path>
              <path
                d="M21 19a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3zM3 19a2 2 0 0 0 2 2h1a2 2 0 0 0 2-2v-3a2 2 0 0 0-2-2H3z">
              </path>
            </svg></div>
          <span>音乐库</span>
        </div>


        <div class="app-icon" id="app-settings">
          <div class="app-icon-img"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
              fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path
                d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 0 2l-.15.08a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.38a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1 0-2l.15-.08a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z">
              </path>
              <circle cx="12" cy="12" r="3"></circle>
            </svg></div>
          <span>API设置</span>
        </div>
        <div class="app-icon" id="app-user-profiles">
          <div class="app-icon-img"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
              fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
              <circle cx="12" cy="7" r="4"></circle>
            </svg></div>
          <span>我</span>
        </div>
        <div class="app-icon" id="app-wallpaper">
          <div class="app-icon-img"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
              fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path
                d="M12 2.69l.34.34a1.41 1.41 0 0 0 2 0L22 6.34a1.41 1.41 0 0 0 0-2l-7.66-7.66a1.41 1.41 0 0 0-2 0L2.68 14.34a1.41 1.41 0 0 0 0 2L10 24l2-2 2-2 2-2 2-2 2-2">
              </path>
              <path d="m7.34 2.66 14 14"></path>
            </svg></div>
          <span>更换壁紙</span>
        </div>
      </div>
      <div id="home-dock">
        <div class="app-icon app-icon-large" id="app-chat">
          <div class="app-icon-img"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
              fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
            </svg></div>
          <span>聊天</span>
        </div>
        <div class="app-icon" id="app-music">
          <div class="app-icon-img"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
              fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M9 18V5l12-2v13"></path>
              <circle cx="6" cy="18" r="3"></circle>
              <circle cx="18" cy="16" r="3"></circle>
            </svg></div>
          <span>动态</span>
        </div>
        <div class="app-icon" id="app-meeting">
          <div class="app-icon-img"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
              fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M14 9a2 2 0 0 1-2 2H6l-4 4V5a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v4Z" />
              <path d="M18 9h2a2 2 0 0 1 2 2v9l-4-4h-2a2 2 0 0 1-2-2V9Z" />
            </svg></div>
          <span>见面</span>
        </div>
      </div>
    </div>

    <div id="chat-screen" class="screen">
      <div id="chat-screen-container">
        <div id="chat-list-pane">
          <div id="chat-list-header">
            <button id="back-to-home-from-chat" class="header-button">主屏幕</button>
            <span class="header-title">聊天</span>
            <button id="add-chat-button" class="header-button add" title="添加新聊天">+</button>
          </div>
          <div id="chat-list-container">
            <ul id="character-list">
            </ul>
          </div>
        </div>
        <div id="chat-view-pane">
          <div class="header">
            <button class="header-button" id="back-to-chat-list">返回</button>
            <span id="char-name-header" class="header-title">角色</span>
            <button class="header-button" id="character-settings-button" title="角色设置">⚙️</button>
          </div>
          <div id="chat-messages" class="messages">
          </div>
          <div id="offline-scene-view"></div>
          <div id="chat-sticker-panel" class="sticker-panel">
          </div>
          <div class="chat-toolbar">
            <button id="chat-sticker-button" class="toolbar-button" title="表情">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-linecap="round"
                stroke-linejoin="round">
                <circle cx="12" cy="12" r="10"></circle>
                <path d="M8 14s1.5-2 4-2 4 2 4 2"></path>
                <line x1="9" y1="9" x2="9.01" y2="9"></line>
                <line x1="15" y1="9" x2="15.01" y2="9"></line>
              </svg>
            </button>
            <button id="chat-image-button" class="toolbar-button" title="发送图片">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-linecap="round"
                stroke-linejoin="round">
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                <circle cx="8.5" cy="8.5" r="1.5"></circle>
                <polyline points="21 15 16 10 5 21"></polyline>
              </svg>
            </button>
            <button id="chat-music-button" class="toolbar-button" title="分享音乐">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-linecap="round"
                stroke-linejoin="round">
                <path d="M9 18V5l12-2v13"></path>
                <circle cx="6" cy="18" r="3"></circle>
                <circle cx="18" cy="16" r="3"></circle>
              </svg>
            </button>
            <button id="chat-listen-together-button" class="toolbar-button" title="一起听">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-linecap="round"
                stroke-linejoin="round">
                <path d="M3 18v-6a9 9 0 0 1 18 0v6"></path>
                <path
                  d="M21 19a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3zM3 19a2 2 0 0 0 2 2h1a2 2 0 0 0 2-2v-3a2 2 0 0 0-2-2H3z">
                </path>
              </svg>
            </button>
            <button id="chat-transfer-button" class="toolbar-button" title="转账">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-linecap="round"
                stroke-linejoin="round">
                <line x1="12" y1="1" x2="12" y2="23"></line>
                <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
              </svg>
            </button>
            <button id="chat-reroll-button" class="toolbar-button" title="重新生成">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-linecap="round"
                stroke-linejoin="round">
                <polyline points="23 4 23 10 17 10"></polyline>
                <polyline points="1 20 1 14 7 14"></polyline>
                <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
              </svg>
            </button>
          </div>
          <input type="file" id="chat-image-input" accept="image/*" style="display: none;">
          <div id="quote-preview-area" class="quote-preview">
            <div class="quote-preview-content">
              <div id="quote-preview-sender"></div>
              <div id="quote-preview-text"></div>
            </div>
            <button id="cancel-quote-button" class="cancel-quote-btn">&times;</button>
          </div>
          <div class="chat-input-area">
            <div id="chat-input-wrapper">
              <input type="text" id="chat-message-input" placeholder="输入消息...">
              <button id="chat-get-reply-button" title="让对方回复">↵</button>
              <button id="chat-send-button" title="发送">➤</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div id="settings-screen" class="screen">
      <div class="header">
        <button id="back-to-home-from-settings" class="header-button">返回</button>
        <span class="header-title">API设置</span>
        <div style="width: 50px;"></div>
      </div>
      <div class="content">
        <div class="settings-group">
          <h2>API 设置</h2>
          <div class="input-group">
            <label for="api-endpoint">API 接口地址（不填/v1）</label>
            <input type="text" id="api-endpoint" placeholder="例如: https://api.openai.com">
          </div>
          <div class="input-group">
            <label for="api-key">API 密钥</label>
            <input type="password" id="api-key" placeholder="请输入你的 API 密钥">
          </div>
          <div class="input-group">
            <label for="api-model">模型</label>
            <div class="model-input-container">
              <input type="text" id="api-model" placeholder="点击 获取 或手动输入" style="flex-grow: 1;">
              <button id="fetch-models-button" style="padding: 0 12px; white-space: nowrap;">获取</button>
              <div id="model-dropdown" class="custom-model-dropdown"></div>
            </div>
          </div>
          <div class="input-group">
            <label for="api-provider">接口格式 (重要！请根据你使用的接口选择，但是我也没做Openai以外的接口……)</label>
            <select id="api-provider"
              style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid var(--border-color);">
              <option value="openai">OpenAI 格式 (通用，兼容绝大多数反代)</option>
              <option value="gemini">Google Gemini 格式 (仅限官方或特定反代)</option>
              <option value="anthropic">Anthropic Claude 格式</option>
            </select>
          </div>
        </div>
        <div class="settings-group">
          <h2>上下文设置</h2>
          <div class="input-group">
            <label for="context-lines-per-chat">每个会话读取的消息条数（默认 100）</label>
            <input type="number" id="context-lines-per-chat" min="1" max="1000000" step="1" placeholder="100">
          </div>
        </div>

        <div class="settings-group"
          style="margin-top: 20px; border-top: 1px solid var(--border-color); padding-top: 20px;">
          <h2>数据管理</h2>
          <p style="font-size: 0.9rem; color: var(--text-color-light);">
            导出全部数据（角色、聊天记录、设置、桌面布局等）到一个文件，方便在其他设备或浏览器上导入。
          </p>
          <div style="display: flex; gap: 10px; margin-top: 10px;">
            <button id="export-all-data-button" class="form-button"
              style="width: 50%; margin-top: 0; background-color: #007bff;">导出全部数据</button>
            <button id="import-all-data-button" class="form-button"
              style="width: 50%; margin-top: 0; background-color: #28a745;">导入数据</button>
          </div>
          <input type="file" id="import-data-input" accept=".json" style="display: none;">
        </div>
        <button id="save-api-settings-button" class="form-button">保存 API 设置</button>
      </div>
    </div>



    <div id="character-edit-screen" class="screen">
      <div class="header">
        <button id="back-to-char-select-from-edit" class="header-button">返回</button>
        <span id="character-edit-title" class="header-title">编辑角色</span>
        <div style="width: 50px;"></div>
      </div>
      <div class="content">
        <input type="hidden" id="editing-char-id">
        <div class="settings-group">
          <h2>角色设定</h2>
          <div class="input-group">
            <label for="char-edit-name">名字</label>
            <input type="text" id="char-edit-name" placeholder="角色的名字">
          </div>
          <div class="input-group">
            <label for="char-edit-remark">备注名</label>
            <input type="text" id="char-edit-remark" placeholder="方便自己记忆，例如 '工作助理'">
          </div>
          <div class="avatar-upload-group">
            <label>角色头像</label>
            <img id="char-edit-avatar-preview" class="avatar-preview" alt="Avatar Preview">
            <input type="file" id="char-edit-avatar-input" accept="image/*" style="display: none;">
          </div>
          <div class="input-group">
            <label for="char-edit-persona">人设 (系统提示词)</label>
            <textarea id="char-edit-persona" placeholder="你是一个乐于助人的助手。"></textarea>
          </div>
          <div class="input-group">
            <label>聊天壁纸</label>
            <div
              style="width: 150px; height: 266px; border-radius: 12px; border: 1px solid var(--border-color); background-color: #f0f0f0; overflow: hidden; cursor: pointer;">
              <img id="char-edit-wallpaper-preview" style="width: 100%; height: 100%; object-fit: cover;" alt="聊天壁纸预览">
            </div>
            <input type="file" id="char-edit-wallpaper-input" accept="image/*" style="display: none;">
          </div>
          <div class="input-group">
            <label for="char-edit-css">专属气泡样式 (CSS)</label>
            <textarea id="char-edit-css" rows="8"
              placeholder="从其他地方复制的、包含 .sent 和 .received 的CSS代码可以直接粘贴在这里..."></textarea>

            <div style="display: flex; gap: 10px; margin-top: 5px;">
              <div style="flex: 1; padding: 10px; background: #f0f0f0; border-radius: 8px;">
                <p style="margin: 0 0 5px; font-size: 0.8rem; color: #555;">TA的气泡 (Received):</p>
                <div id="bubble-preview-ai" class="message ai">这是TA的气泡预览效果</div>
              </div>
              <div style="flex: 1; padding: 10px; background: #f0f0f0; border-radius: 8px;">
                <p style="margin: 0 0 5px; font-size: 0.8rem; color: #555;">你的气泡 (Sent):</p>
                <div id="bubble-preview-user" class="message user">这是你的气泡预览效果</div>
              </div>
            </div>
          </div>
          <div class="input-group">
            <label>见面场景背景</label>
            <div
              style="width: 150px; height: 266px; border-radius: 12px; border: 1px solid var(--border-color); background-color: #f0f0f0; overflow: hidden; cursor: pointer;">
              <img id="char-edit-offline-bg-preview" style="width: 100%; height: 100%; object-fit: cover;" alt="见面背景预览">
            </div>
            <input type="file" id="char-edit-offline-bg-input" accept="image/*" style="display: none;">
          </div>
          <div class="settings-group">
            <h2>角色立绘 (Galgame模式)</h2>
            <p style="font-size: 0.8rem; color: var(--text-color-light);">为五种核心情绪上传立绘图，建议使用透明背景的PNG图片。</p>
            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 10px;">

              <div class="avatar-upload-group" style="align-items: center;">
                <label>平常</label>
                <img id="char-edit-sprite-normal-preview" class="avatar-preview" style="width: 80px; height: 80px;"
                  alt="平常立绘">
                <input type="file" id="char-edit-sprite-normal-input" accept="image/*" style="display: none;">
              </div>
              <div class="avatar-upload-group" style="align-items: center;">
                <label>喜</label>
                <img id="char-edit-sprite-happy-preview" class="avatar-preview" style="width: 80px; height: 80px;"
                  alt="喜立绘">
                <input type="file" id="char-edit-sprite-happy-input" accept="image/*" style="display: none;">
              </div>
              <div class="avatar-upload-group" style="align-items: center;">
                <label>怒</label>
                <img id="char-edit-sprite-angry-preview" class="avatar-preview" style="width: 80px; height: 80px;"
                  alt="怒立绘">
                <input type="file" id="char-edit-sprite-angry-input" accept="image/*" style="display: none;">
              </div>
              <div class="avatar-upload-group" style="align-items: center;">
                <label>哀</label>
                <img id="char-edit-sprite-sad-preview" class="avatar-preview" style="width: 80px; height: 80px;"
                  alt="哀立绘">
                <input type="file" id="char-edit-sprite-sad-input" accept="image/*" style="display: none;">
              </div>
              <div class="avatar-upload-group" style="align-items: center;">
                <label>害羞</label>
                <img id="char-edit-sprite-shy-preview" class="avatar-preview" style="width: 80px; height: 80px;"
                  alt="害羞立绘">
                <input type="file" id="char-edit-sprite-shy-input" accept="image/*" style="display: none;">
              </div>
            </div>
          </div>
          <div class="input-group">
            <label for="char-edit-bind-user">绑定用户</label>
            <select id="char-edit-bind-user"></select>
          </div>
          <div class="input-group">
            <label>关联世界书</label>
            <div class="custom-multiselect">
              <div class="select-box">
                <span class="selected-options-text">-- 点击选择 --</span>
                <span class="arrow">▼</span>
              </div>
              <div id="world-book-checkboxes-container" class="checkboxes-container">
              </div>
            </div>
          </div>
        </div>
        <button id="save-char-button" class="form-button">保存角色</button>
        <div class="settings-group" style="margin-top: 30px; border-top: 1px solid #eee; padding-top: 20px;">
          <button id="edit-clear-history-button" class="form-button"
            style="background-color: #ffc107; margin-bottom: 10px;">清空聊天记录</button>
          <button id="edit-delete-char-button" class="form-button" style="background-color: #dc3545;">删除角色</button>
        </div>
      </div>
    </div>

    <div id="group-chat-create-screen" class="screen">
      <div class="header">
        <button id="back-to-char-select-from-group-create" class="header-button">返回</button>
        <span class="header-title">创建群聊</span>
        <button id="create-group-chat-button" class="header-button">创建</button>
      </div>
      <div class="content" style="padding: 20px;">
        <div class="input-group">
          <label for="group-chat-name">群聊名称</label>
          <input type="text" id="group-chat-name" placeholder="给你的群聊起个名字">
        </div>
        <div class="settings-group">
          <h2>选择成员</h2>
          <div id="group-chat-member-list-container"
            style="max-height: 400px; overflow-y: auto; border: 1px solid var(--border-color); border-radius: 8px;">
            <ul id="group-chat-member-list">
            </ul>
          </div>
        </div>
      </div>
    </div>

    <div id="wallpaper-screen" class="screen">
      <div class="header">
        <button id="back-to-home-from-wallpaper" class="header-button">返回</button>
        <span class="header-title">更换壁纸</span>
        <div style="width: 50px;"></div>
      </div>
      <div class="content">
        <div class="settings-group"
          style="border-bottom: 1px solid var(--border-color); padding-bottom: 20px; margin-bottom: 20px;">
          <h2>全局主题色</h2>
          <p style="font-size: 0.9rem; color: var(--text-color-light);">拖动滑块来改变整个App的主色调。</p>
          <div class="input-group" style="padding-top: 10px;">
            <label for="theme-hue-slider" style="display: block; margin-bottom: 5px;">色相 (Hue)</label>
            <input type="range" id="theme-hue-slider" min="0" max="360" value="35" style="width: 100%;">
          </div>
          <div class="input-group">
            <label for="theme-lightness-slider" style="display: block; margin-bottom: 5px;">明度 (Lightness)</label>
            <input type="range" id="theme-lightness-slider" min="15" max="95" value="80" style="width: 100%;">
          </div>
        </div>
        <div class="settings-group"
          style="border-bottom: 1px solid var(--border-color); padding-bottom: 20px; margin-bottom: 20px;">
          <h2 style="margin-top: 0;">时钟样式</h2>
          <div style="display: flex; align-items: center; gap: 10px;">
            <input type="checkbox" id="clock-color-toggle" style="width: auto; height: 18px; flex-shrink: 0;">
            <label for="clock-color-toggle" style="width: auto; font-size: 0.9rem;">强制使用纯白色时钟 (推荐在深色壁纸下使用)</label>
          </div>
        </div>
        <div class="settings-group">
          <h2>上传新壁纸</h2>
          <p style="font-size: 0.9rem; color: var(--text-color-light);">选择一张图片作为你的手机壁纸。为了效果最好，请使用竖屏图片。</p>
          <input type="file" id="wallpaper-input" accept="image/*" style="display: none;">
          <button id="upload-wallpaper-button" class="form-button">选择图片</button>
        </div>
        <div class="settings-group"
          style="margin-top: 20px; border-top: 1px solid var(--border-color); padding-top: 20px;">
          <h2>音乐小组件背景</h2>
          <p style="font-size: 0.9rem; color: var(--text-color-light);">为你的主屏幕音乐小组件设置一张专属背景图。</p>
          <input type="file" id="widget-bg-input" accept="image/*" style="display: none;">
          <button id="upload-widget-bg-button" class="form-button">选择图片</button>
          <button id="reset-widget-bg-button" class="form-button secondary">恢复默认</button>
        </div>
        <div class="settings-group" style="margin-top: 20px;">
          <h2>重置桌面</h2>
          <p style="font-size: 0.9rem; color: var(--text-color-light);">此操作会将所有桌面小组件（时钟、音乐、徽章等）恢复到初始位置，并将壁纸重置为纯白色。</p>
          <button id="reset-desktop-button" class="form-button destructive">重置桌面布局</button>
        </div>
        <div class="settings-group"
          style="margin-top: 20px; border-top: 1px solid var(--border-color); padding-top: 20px;">
          <h2>自定义徽章</h2>
          <p style="font-size: 0.9rem; color: var(--text-color-light);">上传一张图片作为你的桌面徽章，可以拖动它到任意位置。</p>
          <input type="file" id="badge-input" accept="image/*" style="display: none;">
          <button id="upload-badge-button" class="form-button">选择徽章图片</button>
          <button id="reset-badge-button" class="form-button"
            style="background-color: #777; margin-top: 10px;">移除徽章</button>
        </div>

        <div class="settings-group"
          style="margin-top: 20px; border-top: 1px solid var(--border-color); padding-top: 20px;">
          <h2>自定义卡片</h2>
          <p style="font-size: 0.9rem; color: var(--text-color-light);">上传一张图片作为你的桌面方形卡片小组件。</p>
          <input type="file" id="card-input" accept="image/*" style="display: none;">
          <button id="upload-card-button" class="form-button">选择卡片图片</button>
          <button id="reset-card-button" class="form-button"
            style="background-color: #777; margin-top: 10px;">移除卡片</button>
        </div>
        <div class="settings-group"
          style="margin-top: 20px; border-top: 1px solid var(--border-color); padding-top: 20px;">
          <h2>动态页背景</h2>
          <p style="font-size: 0.9rem; color: var(--text-color-light);">为“动态”页面设置一张独立的背景图，让它与众不同。</p>
          <input type="file" id="feed-bg-input" accept="image/*" style="display: none;">
          <button id="upload-feed-bg-button" class="form-button">选择图片</button>
        </div>
        <button id="reset-feed-bg-button" class="form-button"
          style="background-color: #777; margin-top: 10px;">移除背景</button>
        <div class="settings-group"
          style="margin-top: 20px; border-top: 1px solid var(--border-color); padding-top: 20px;">
          <h2>小组件救援</h2>
          <p style="font-size: 0.9rem; color: var(--text-color-light);">如果你的吧唧或卡片不小心飞出屏幕找不到了，点这里让它们回家。</p>
          <button id="reset-widgets-position-button" class="form-button"
            style="background-color: #ffc107;">重置小组件位置</button>
        </div>
        <div class="settings-group"
          style="margin-top: 20px; border-top: 1px solid var(--border-color); padding-top: 20px;">
          <h2>自定义App图标</h2>
          <p style="font-size: 0.9rem; color: var(--text-color-light);">替换主屏幕上App的默认图标。为了最佳效果，请使用方形、透明背景的图片。</p>
          <div id="custom-icon-list-container">
          </div>
        </div>
      </div>

    </div>

    <div id="world-book-screen" class="screen">
      <div class="header">
        <button id="back-to-home-from-world-book" class="header-button">主屏幕</button>
        <span class="header-title">世界书</span>
        <button id="add-world-book-button" class="header-button add" title="添加新世界书">+</button>
      </div>
      <div class="content" id="world-book-list-container">
      </div>
    </div>

    <div id="world-book-editor-screen" class="screen">
      <div class="header">
        <button id="back-to-world-book-list" class="header-button">返回</button>
        <span id="world-book-editor-title" class="header-title">编辑条目</span>
        <div style="width: 50px;"></div>
      </div>
      <div class="content">
        <input type="hidden" id="editing-world-book-id">
        <div class="settings-group">
          <h2>设定条目</h2>
          <div class="input-group">
            <label for="world-book-edit-name">条目名称 (Key)</label>
            <input type="text" id="world-book-edit-name" placeholder="例如：我的过去、特殊能力">
          </div>
          <div class="input-group">
            <label for="world-book-edit-content">条目内容 (Value)</label>
            <textarea id="world-book-edit-content" placeholder="输入详细的设定内容..."></textarea>
          </div>
        </div>
        <button id="save-world-book-button" class="form-button">保存条目</button>
        <div class="settings-group" style="margin-top: 30px; border-top: 1px solid #eee; padding-top: 20px;">
          <button id="delete-world-book-button" class="form-button" style="background-color: #dc3545;">删除该条目</button>
        </div>
      </div>
    </div>

    <div id="group-settings-screen" class="screen">
      <div class="header">
        <button id="back-to-chat-from-group-settings" class="header-button">返回</button>
        <span class="header-title">群聊设置</span>
        <div style="width: 50px;"></div>
      </div>
      <div class="content">
        <div class="settings-group">
          <h2>群聊信息</h2>
          <div class="input-group">
            <label for="group-settings-name">群聊名称</label>
            <input type="text" id="group-settings-name">
          </div>
          <div class="avatar-upload-group">
            <label>群头像</label>
            <img id="group-avatar-preview" class="avatar-preview" alt="Group Avatar Preview">
            <input type="file" id="group-avatar-input" accept="image/*" style="display: none;">
          </div>
          <div class="input-group">
            <label>群聊背景</label>
            <div
              style="width: 150px; height: 266px; border-radius: 12px; border: 1px solid var(--border-color); background-color: #f0f0f0; overflow: hidden; cursor: pointer;">
              <img id="group-bg-preview" style="width: 100%; height: 100%; object-fit: cover;" alt="群聊背景预览">
            </div>
            <input type="file" id="group-bg-input" accept="image/*" style="display: none;">
          </div>
          <div class="input-group">
            <label for="group-settings-bind-user">绑定用户</label>
            <select id="group-settings-bind-user"></select>
          </div>
          <div class="input-group">
            <label>关联世界书</label>
            <div class="custom-multiselect">
              <div class="select-box">
                <span class="selected-options-text">-- 点击选择 --</span>
                <span class="arrow">▼</span>
              </div>
              <div id="group-world-book-checkboxes" class="checkboxes-container">
              </div>
            </div>
          </div>
        </div>
        <button id="save-group-settings-button" class="form-button">保存设置</button>
        <div class="settings-group" style="margin-top: 30px; border-top: 1px solid #eee; padding-top: 20px;">
          <button id="group-clear-history-button" class="form-button"
            style="background-color: #ffc107; margin-bottom: 10px;">清空聊天记录</button>
          <button id="group-delete-button" class="form-button" style="background-color: #dc3545;">删除并解散群聊</button>
        </div>
      </div>
    </div>

    <div id="music-screen" class="screen">
      <div class="header">
        <button id="back-to-circle-list-from-feed" class="header-button">返回</button>
        <span id="friend-circle-title" class="header-title">好友圈</span>
        <div style="display: flex; gap: 5px;">
          <button id="edit-current-circle-button" class="header-button" style="font-size: 1.2rem;">⚙️</button>
          <button id="clear-feed-button" class="header-button" style="color: #dc3545;">清空</button>
          <button id="refresh-feed-button" class="header-button">刷新</button>

        </div>
      </div>
      <div id="user-post-area"
        style="padding: 10px 15px; border-bottom: 1px solid var(--border-color); flex-shrink: 0; background: var(--surface-bg);">
        <div id="user-post-input-container">
          <img id="user-post-avatar" class="char-avatar">
          <div id="user-post-main-area">
            <textarea id="user-post-textarea" rows="3" placeholder="分享你的新鲜事..."></textarea>
            <div id="user-post-attachment-preview"></div>
          </div>
        </div>
        <div id="user-post-toolbar">
          <div class="user-post-actions">
            <button id="user-post-image-button" class="toolbar-button" title="分享图片">🖼️</button>
            <input type="file" id="user-post-image-input" accept="image/*" style="display: none;">
            <button id="user-post-music-button" class="toolbar-button" title="分享音乐">🎵</button>
          </div>
          <button id="user-send-post-button">发送</button>
        </div>
      </div>
      <div id="music-feed-container" class="content" style="padding: 10px;">
      </div>
      <div id="music-player-bar" class="hidden">
        <img id="player-cover" src="">
        <div id="player-info">
          <div id="player-title"></div>
          <div id="player-artist"></div>
        </div>
        <div id="player-controls">
          <button id="player-prev-btn">⏮</button>
          <button id="player-play-pause-btn">▶</button>
          <button id="player-next-btn">⏭</button>
        </div>
      </div>
      <audio id="audio-player"></audio>
    </div>
    <div id="meeting-list-screen" class="screen">
      <div class="header">
        <button id="back-to-home-from-meeting-list" class="header-button">主屏幕</button>
        <span class="header-title">选择见面对象</span>
        <div style="width: 50px;"></div>
      </div>
      <div id="meeting-list-container" class="content" style="padding: 10px;">
      </div>
    </div>

    <div id="meeting-view-screen" class="screen">
      <div class="header">
        <button class="header-button" id="back-to-meeting-list">返回</button>
        <span id="meeting-char-name-header" class="header-title">角色</span>
        <button id="toggle-meeting-view-button" class="header-button">切换视角</button>

      </div>
      <div id="meeting-main-content" class="content" style="position: relative; padding: 0;">
        <div id="galgame-overlay-ui">
          <div id="galgame-time">12:00</div>
          <div id="galgame-date">1月1日 星期一</div>
        </div>
        <div id="meeting-scene-view" class="content"
          style="font-family: 'Georgia', 'Times New Roman', 'KaiTi', 'STSong', serif; color: white; text-shadow: 0 1px 3px rgba(0,0,0,0.7);">
        </div>
        <div id="galgame-view-container"
          style="display: none; width: 100%; height: 100%; position: absolute; top: 0; left: 0; overflow: hidden;">
          <div id="galgame-sprite-container"
            style="position: absolute; bottom: 0; left: 50%; transform: translateX(-50%); width: 100%; height: 100%; display: flex; align-items: flex-end; justify-content: center;">
            <img id="galgame-sprite" src=""
              style="max-height: 80%; max-width: 80%; object-fit: contain; transition: opacity 0.3s ease;">
          </div>
          <div id="galgame-textbox-container"
            style="position: absolute; bottom: 9%; left: 5%; right: 5%; background: rgba(0, 0, 0, 0.7); border-radius: 10px; padding: 15px; color: white; border-top: 1px solid rgba(255,255,255,0.2); cursor: pointer;">
            <div id="galgame-speaker" style="font-weight: bold; margin-bottom: 10px;">说话人</div>
            <div id="galgame-text" style="line-height: 1.6;">对话内容...</div>
          </div>
        </div>
      </div>
      <div class="chat-input-area">
        <div id="chat-input-wrapper-meeting"> <textarea id="meeting-message-input" placeholder="输入你的行动或对话..." rows="1"
            style="resize: none; overflow-y: auto; flex-grow: 1; border: none; background: transparent; padding: 9px 12px; font-size: .95rem; outline: none; color: var(--text-color);"></textarea>
          <button id="meeting-send-button" title="发送">➤</button>
        </div>
      </div>
    </div>

    <div id="friend-circle-list-screen" class="screen">
      <div class="header">
        <button id="back-to-home-from-circle-list" class="header-button">主屏幕</button>
        <span class="header-title">好友圈</span>
        <button id="add-friend-circle-button" class="header-button add" title="新建好友圈">+</button>
      </div>
      <div id="friend-circle-list-container" class="content" style="padding: 10px;">
      </div>
    </div>

    <div id="friend-circle-edit-screen" class="screen">
      <div class="header">
        <button id="back-to-circle-list-from-edit" class="header-button">返回</button>
        <span id="friend-circle-edit-title" class="header-title">编辑好友圈</span>
        <div style="width: 50px;"></div>
      </div>
      <div class="content">
        <input type="hidden" id="editing-friend-circle-id">
        <div class="settings-group">
          <h2>好友圈设定</h2>
          <div class="input-group">
            <label for="friend-circle-edit-name">圈子名称</label>
            <input type="text" id="friend-circle-edit-name" placeholder="例如：我的日常">
          </div>
          <div class="input-group">
            <label for="friend-circle-edit-bind-user">绑定的“我”</label>
            <select id="friend-circle-edit-bind-user"></select>
          </div>
        </div>
        <div class="settings-group">
          <h2>选择圈内成员</h2>
          <div id="friend-circle-member-selection"
            style="max-height: 250px; overflow-y: auto; border: 1px solid var(--border-color); border-radius: 8px;">
          </div>
        </div>
        <button id="save-friend-circle-button" class="form-button">保存</button>
        <div class="settings-group"
          style="margin-top: 20px; border-top: 1px solid var(--border-color); padding-top: 20px;">
          <button id="delete-friend-circle-button" class="form-button"
            style="background-color: #dc3545;">删除该好友圈</button>
        </div>
      </div>
    </div>
    <div id="diary-list-screen" class="screen">
      <div class="header">
        <button id="back-to-home-from-diary-list" class="header-button">主屏幕</button>
        <span class="header-title">交换日记</span>
        <div style="width: 50px;"></div>
      </div>
      <div id="diary-list-container" class="content" style="padding: 10px;">
      </div>
    </div>

    <div id="diary-view-screen" class="screen">
      <div class="header">
        <button class="header-button" id="back-to-diary-list">返回</button>
        <span id="diary-char-name-header" class="header-title">TA的日记</span>
        <div style="width: 50px;"></div>
      </div>
      <div id="diary-entries-container" class="content"
        style="padding: 20px; font-family: 'KaiTi', 'STSong', serif; line-height: 1.8;">
      </div>
      <div class="chat-input-area">
        <div id="diary-input-wrapper" style="display: flex; gap: 10px;">
          <input type="text" id="diary-entry-input" placeholder="写下你的日记或批注..." style="flex-grow: 1;">
          <button id="diary-send-button" class="form-button"
            style="width: auto; margin-top: 0; padding: 0 18px;">写好了</button>
          <button id="diary-get-reply-button" class="form-button"
            style="width: auto; margin-top: 0; background-color: #555; padding: 0 18px;">催TA写</button>
        </div>
      </div>
    </div>
    <div id="music-library-screen" class="screen">
      <div class="header">
        <button id="back-to-home-from-music-library" class="header-button">主屏幕</button>
        <span class="header-title">音乐库</span>
        <button id="upload-music-button" class="header-button add" title="上传新音乐">+</button>
      </div>
      <div class="content" id="music-library-container">
      </div>
    </div>
    <div id="music-upload-altar-screen" class="screen">
      <div class="header">
        <button id="back-to-library-from-altar" class="header-button">取消</button>
        <span class="header-title">献上音乐</span>
        <div style="width: 50px;"></div>
      </div>
      <div class="content" style="padding: 20px; display: flex; flex-direction: column; gap: 15px;">

        <div class="upload-slot" id="altar-slot-audio">
          <span class="slot-icon">🎵</span>
          <span class="slot-label">音频文件 (必需)</span>
          <span class="slot-filename">点击选择 .mp3 或 .flac</span>
        </div>

        <div class="upload-slot" id="altar-slot-cover">
          <span class="slot-icon">🖼️</span>
          <span class="slot-label">封面图片 (可选)</span>
          <span class="slot-filename">点击选择 .jpg 或 .png</span>
        </div>

        <div class="upload-slot" id="altar-slot-info">
          <span class="slot-icon">📄</span>
          <span class="slot-label">歌曲信息 (必需)</span>
          <span class="slot-filename">点击选择 info.txt</span>
        </div>

        <div class="upload-slot" id="altar-slot-lyrics">
          <span class="slot-icon">🎤</span>
          <span class="slot-label">歌词文件 (可选)</span>
          <span class="slot-filename">点击选择 .lrc</span>
        </div>

        <button id="confirm-altar-upload-button" class="form-button" disabled>献上祭品</button>
      </div>
    </div>
    <audio id="audio-player"></audio>

    <audio id="unified-audio-player"></audio>
    <div id="music-widget"
      style="  display: inline-block; width: auto; position: absolute; top: 45%; left: 50%; transform: translateX(-50%); z-index: 50;; padding: 0px;bottom: auto;">
      <div id="music-widget-card">
        <div id="widget-cover-art"></div>

        <div class="widget-content-overlay">
          <div class="widget-info">
            <div id="widget-title">暂无音乐</div>
            <div id="widget-artist">请在动态或聊天中播放</div>
          </div>
          <div id="widget-controls">
            <button id="widget-prev-btn">⏮</button>
            <button id="widget-play-pause-btn">▶</button>
            <button id="widget-next-btn">⏭</button>
          </div>
        </div>
      </div>
    </div>


  </div>
  </div>

  <div id="add-choice-modal" class="choice-modal">
    <div id="add-choice-backdrop" class="choice-modal-backdrop"></div>
    <div class="choice-modal-content">
      <button id="choice-create-character" class="choice-modal-button">创建新角色</button>
      <button id="choice-create-group" class="choice-modal-button">创建新群聊</button>
      <button id="choice-cancel" class="choice-modal-button cancel">取消</button>
    </div>
  </div>


  <div id="transfer-modal" class="choice-modal">
    <div id="transfer-backdrop" class="choice-modal-backdrop"></div>
    <div class="choice-modal-content" style="padding: 20px; width: 90%; max-width: 300px;">
      <h3 style="margin-top: 0; text-align: center; font-weight: 600;">转账</h3>
      <div id="transfer-recipient-group" class="input-group" style="margin: 10px 0; display: none;">
        <label for="transfer-recipient-select">转给</label>
        <select id="transfer-recipient-select"></select>
      </div>
      <div class="input-group" style="margin: 10px 0;">
        <label for="transfer-amount-input">金额</label>
        <input type="number" id="transfer-amount-input" placeholder="输入金额">
      </div>
      <div style="display: flex; gap: 10px; margin-top: 20px;">
        <button id="confirm-transfer-button" class="choice-modal-button"
          style="background-color: var(--primary-color); color: white;">确认转账</button>
        <button id="cancel-transfer-button" class="choice-modal-button cancel">取消</button>
      </div>
    </div>
  </div>

  <div id="message-action-modal" class="choice-modal">
    <div id="message-action-backdrop" class="choice-modal-backdrop"></div>
    <div class="choice-modal-content">
      <button id="edit-message-button" class="choice-modal-button">编辑消息</button>
      <button id="quote-message-button" class="choice-modal-button">引用</button>
      <button id="delete-message-button" class="choice-modal-button" style="color: #dc3545;">删除消息</button>
      <button id="cancel-action-button" class="choice-modal-button cancel">取消</button>
    </div>
  </div>

  <div id="edit-message-modal" class="choice-modal">
    <div id="edit-message-backdrop" class="choice-modal-backdrop"></div>
    <div class="choice-modal-content" style="padding: 20px;">
      <h3 style="margin-top: 0; text-align: center; font-weight: 600;">编辑消息</h3>
      <textarea id="edit-message-textarea" style="width: 100%; min-height: 100px; margin: 10px 0;"></textarea>
      <div style="display: flex; gap: 10px; margin-top: 10px;">
        <button id="save-edit-button" class="choice-modal-button"
          style="background-color: var(--primary-color); color: white;">保存</button>
        <button id="cancel-edit-button" class="choice-modal-button cancel">取消</button>
      </div>
    </div>
  </div>

  <div id="music-input-modal" class="choice-modal">
    <div id="music-input-backdrop" class="choice-modal-backdrop"></div>
    <div class="choice-modal-content" style="padding: 20px; width: 90%; max-width: 300px;">
      <h3 id="music-input-title" style="margin-top: 0; text-align: center; font-weight: 600;">分享音乐</h3>

      <div class="input-group" style="margin: 10px 0;">
        <label for="music-input-song" style="font-size: 0.9rem;">歌名</label>
        <input type="text" id="music-input-song" placeholder="例如：夜曲">
      </div>
      <div class="input-group" style="margin: 10px 0;">
        <label for="music-input-artist" style="font-size: 0.9rem;">歌手</label>
        <input type="text" id="music-input-artist" placeholder="例如：周杰伦">
      </div>

      <div style="display: flex; gap: 10px; margin-top: 20px;">
        <button id="confirm-music-input" class="choice-modal-button"
          style="background-color: var(--primary-color); color: white;">确认</button>
        <button id="cancel-music-input" class="choice-modal-button cancel">取消</button>
      </div>
    </div>
  </div>

  <div id="modal-root"
    style="position:fixed;inset:0;display:none;align-items:center;justify-content:center;z-index:9999;">
    <div id="modal-mask" style="position:absolute;inset:0;background:rgba(0,0,0,.35);"></div>
    <div id="modal-dialog"
      style="position:relative;background:#fff;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,.2);width:80%;max-width:320px;padding:16px;">
      <div id="modal-text" style="font-size:14px;color:#333;line-height:1.5;white-space:pre-wrap;"></div>
      <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:16px;">
        <button id="modal-cancel"
          style="padding:8px 12px;border:1px solid #ddd;border-radius:8px;background:#fff;cursor:pointer;">取消</button>
        <button id="modal-ok"
          style="padding:8px 12px;border:none;border-radius:8px;background:#007bff;color:#fff;cursor:pointer;">确定</button>
      </div>
    </div>
  </div>

  <div id="listen-together-modal" class="choice-modal">
    <div id="listen-together-backdrop" class="choice-modal-backdrop"></div>
    <div class="choice-modal-content"
      style="padding: 0; width: 95%; max-width: 360px; height: 70%; display: flex; flex-direction: column;">
      <div class="header" style="border-bottom: 1px solid var(--border-color); flex-shrink: 0;">
        <div style="width: 50px;"></div>
        <span class="header-title">选择一首歌，一起听</span>
        <button id="cancel-listen-together" class="header-button" style="min-width: 50px;">取消</button>
      </div>
      <div id="listen-together-song-list" class="content" style="flex-grow: 1; padding: 10px;">
      </div>
    </div>
  </div>

  <div id="toast"
    style="position:fixed;left:50%;bottom:32px;transform:translateX(-50%);background:rgba(0,0,0,.8);color:#fff;padding:8px 12px;border-radius:8px;font-size:12px;display:none;z-index:10000;">
  </div>



  <script>
    const _0x457b7e = _0x3488; (function (_0x515040, _0xf0e36f) { const _0x36ff1a = _0x3488, _0x428569 = _0x515040(); while (!![]) { try { const _0x12eacf = -parseInt(_0x36ff1a(0x62f)) / 0x1 + parseInt(_0x36ff1a(0x5ea)) / 0x2 + -parseInt(_0x36ff1a(0x4f5)) / 0x3 * (parseInt(_0x36ff1a(0x60b)) / 0x4) + -parseInt(_0x36ff1a(0x183)) / 0x5 + -parseInt(_0x36ff1a(0x31e)) / 0x6 * (-parseInt(_0x36ff1a(0x6c2)) / 0x7) + -parseInt(_0x36ff1a(0x7a9)) / 0x8 + parseInt(_0x36ff1a(0x376)) / 0x9; if (_0x12eacf === _0xf0e36f) break; else _0x428569['push'](_0x428569['shift']()); } catch (_0x15098f) { _0x428569['push'](_0x428569['shift']()); } } }(_0x3db9, 0x58c53)); var _0x2aa90d, _0xe08ea7 = null; let _0x55ae7a = ![], _0x255a96 = { 'x': 0x0, 'y': 0x0 }; function _0x1cbdb5(_0x21cb28) { const _0x2be64f = _0x3488; return (_0x2aa90d?.[_0x2be64f(0x857)] || [])[_0x2be64f(0x349)](_0x3f9440 => _0x3f9440['id'] === _0x21cb28); } function _0x3488(_0x34424a, _0x10ae8a) { const _0x3db938 = _0x3db9(); return _0x3488 = function (_0x3488f3, _0x72079c) { _0x3488f3 = _0x3488f3 - 0x147; let _0x371145 = _0x3db938[_0x3488f3]; return _0x371145; }, _0x3488(_0x34424a, _0x10ae8a); } const _0x191c8d = _0x457b7e(0x153), _0x5e96e0 = _0x457b7e(0x1c5), _0x12a7cc = _0x457b7e(0x439), _0xe0a49d = [{ 'name': _0x457b7e(0x161), 'url': _0x457b7e(0x471) }, { 'name': '崩溃', 'url': _0x457b7e(0x2b8) }, { 'name': '生病', 'url': 'http://sharkpan.xyz/f/zLes5/4lxzjn.jpg' }, { 'name': '工作', 'url': _0x457b7e(0x14d) }, { 'name': _0x457b7e(0x867), 'url': _0x457b7e(0x831) }, { 'name': '弱小委屈但凶恶', 'url': _0x457b7e(0x235) }, { 'name': _0x457b7e(0x5c5), 'url': _0x457b7e(0x368) }, { 'name': '期待', 'url': 'http://sharkpan.xyz/f/35lse/xmsue5.jpg' }, { 'name': '喜欢', 'url': _0x457b7e(0x61e) }, { 'name': _0x457b7e(0x84a), 'url': _0x457b7e(0x28c) }, { 'name': _0x457b7e(0x7ef), 'url': _0x457b7e(0x85c) }, { 'name': '委屈', 'url': _0x457b7e(0x226) }, { 'name': '加油', 'url': _0x457b7e(0x735) }, { 'name': '对的', 'url': 'http://sharkpan.xyz/f/DVJtK/vxiup1.jpg' }, { 'name': '不满', 'url': 'http://sharkpan.xyz/f/LZwu7/m7vx2q.jpg' }, { 'name': '很期待', 'url': _0x457b7e(0x1c6) }, { 'name': '猫猫撒娇', 'url': _0x457b7e(0x848) }, { 'name': '委屈', 'url': _0x457b7e(0x198) }, { 'name': '平静', 'url': _0x457b7e(0x6c4) }, { 'name': '咬你', 'url': _0x457b7e(0x406) }, { 'name': _0x457b7e(0x645), 'url': _0x457b7e(0x29c) }, { 'name': '好困', 'url': _0x457b7e(0x5e9) }, { 'name': '摸鱼', 'url': _0x457b7e(0x261) }, { 'name': '委屈那我歇了', 'url': _0x457b7e(0x621) }, { 'name': _0x457b7e(0x348), 'url': _0x457b7e(0x719) }, { 'name': _0x457b7e(0x169), 'url': 'http://sharkpan.xyz/f/4adUj/68uj9o.jpg' }, { 'name': '一起听歌', 'url': _0x457b7e(0x3f8) }, { 'name': '刷我的卡', 'url': _0x457b7e(0x7d3) }, { 'name': _0x457b7e(0x17e), 'url': 'http://sharkpan.xyz/f/xjmCX/zyjzew.jpg' }, { 'name': _0x457b7e(0x665), 'url': _0x457b7e(0x25c) }, { 'name': _0x457b7e(0x3f7), 'url': _0x457b7e(0x528) }, { 'name': _0x457b7e(0x644), 'url': _0x457b7e(0x53a) }, { 'name': _0x457b7e(0x5a1), 'url': 'http://sharkpan.xyz/f/Oyjuy/p8v2hd.jpg' }, { 'name': _0x457b7e(0x285), 'url': _0x457b7e(0x44a) }, { 'name': _0x457b7e(0x513), 'url': _0x457b7e(0x324) }, { 'name': _0x457b7e(0x64d), 'url': _0x457b7e(0x812) }, { 'name': _0x457b7e(0x64a), 'url': _0x457b7e(0x4b7) }, { 'name': '交给我吧', 'url': _0x457b7e(0x51f) }, { 'name': _0x457b7e(0x853), 'url': _0x457b7e(0x739) }, { 'name': '有点破防', 'url': _0x457b7e(0x4be) }, { 'name': _0x457b7e(0x1d5), 'url': _0x457b7e(0x4b9) }, { 'name': '有点无语', 'url': _0x457b7e(0x299) }, { 'name': _0x457b7e(0x7fc), 'url': _0x457b7e(0x5c1) }, { 'name': _0x457b7e(0x480), 'url': _0x457b7e(0x794) }, { 'name': _0x457b7e(0x88c), 'url': _0x457b7e(0x736) }, { 'name': _0x457b7e(0x392), 'url': _0x457b7e(0x164) }, { 'name': _0x457b7e(0x2ae), 'url': 'http://sharkpan.xyz/f/Qpzu6/3b30r2.jpg' }, { 'name': _0x457b7e(0x756), 'url': _0x457b7e(0x39b) }, { 'name': '我是小丑呜呜', 'url': _0x457b7e(0x36c) }, { 'name': '我不想工作', 'url': _0x457b7e(0x669) }, { 'name': _0x457b7e(0x802), 'url': _0x457b7e(0x5e7) }, { 'name': '我来搞定', 'url': 'http://sharkpan.xyz/f/v0qcL/dio7j0.jpg' }, { 'name': _0x457b7e(0x335), 'url': _0x457b7e(0x2ff) }, { 'name': '等你', 'url': _0x457b7e(0x3c4) }, { 'name': _0x457b7e(0x350), 'url': 'http://sharkpan.xyz/f/eOXIw/y29z21.jpg' }, { 'name': _0x457b7e(0x240), 'url': _0x457b7e(0x48b) }, { 'name': '喝酒', 'url': _0x457b7e(0x2ad) }, { 'name': _0x457b7e(0x215), 'url': _0x457b7e(0x6ff) }, { 'name': '呜呜', 'url': _0x457b7e(0x26c) }, { 'name': _0x457b7e(0x655), 'url': _0x457b7e(0x744) }, { 'name': _0x457b7e(0x492), 'url': _0x457b7e(0x598) }, { 'name': '出去玩', 'url': _0x457b7e(0x776) }, { 'name': '请看是我', 'url': _0x457b7e(0x3cb) }, { 'name': '别这样嘛我哭哭', 'url': _0x457b7e(0x151) }], _0x1655ba = { 'beige': { 'name': _0x457b7e(0x69f), 'h': 0x23, 's': 0x19, 'l': 0x50 }, 'mizuiro': { 'name': '薄荷水色', 'h': 0xc3, 's': 0x19, 'l': 0x50 }, 'sakura': { 'name': '樱花薄粉', 'h': 0x159, 's': 0x19, 'l': 0x50 }, 'noir': { 'name': _0x457b7e(0x380), 'h': 0x104, 's': 0xf, 'l': 0x1e } }; document[_0x457b7e(0x179)](_0x457b7e(0x601), () => { const _0x12f887 = _0x457b7e, _0x59af73 = document['getElementById'](_0x12f887(0x189)), _0x2034a8 = document[_0x12f887(0x49f)](_0x12f887(0x2e2)), _0x23688b = document['getElementById'](_0x12f887(0x5f9)), _0x19ab5b = document[_0x12f887(0x49f)](_0x12f887(0x5fa)), _0x2eff0d = document[_0x12f887(0x49f)](_0x12f887(0x196)), _0x2fcd2e = document[_0x12f887(0x49f)](_0x12f887(0x738)), _0x47ad06 = document['getElementById'](_0x12f887(0x7d8)), _0x3faa7f = document[_0x12f887(0x49f)](_0x12f887(0x39e)), _0x1eb195 = document[_0x12f887(0x49f)](_0x12f887(0x532)), _0x347ff5 = document[_0x12f887(0x49f)]('chat-reroll-button'), _0x574f1a = document['getElementById'](_0x12f887(0x21d)), _0x1b8274 = document[_0x12f887(0x49f)](_0x12f887(0x5f0)), _0x337a38 = document[_0x12f887(0x49f)](_0x12f887(0x436)), _0x239a73 = document[_0x12f887(0x49f)](_0x12f887(0x27e)); function _0x1b3611() { const _0x256268 = _0x12f887; if (_0x256268(0x19b) === 'FOvfN') { const _0x452868 = { 'id': _0x2d5183['id'], 'url': _0x526a15[_0x256268(0x419)] }; _0x26ae34(this, _0x452868); } else { const _0x37a4d0 = document[_0x256268(0x49f)](_0x256268(0x258)); if (!_0x37a4d0) return; const _0x29567f = localStorage[_0x256268(0x70e)](_0x256268(0x690)) || '35'; document['documentElement']['style']['setProperty']('--primary-hue', _0x29567f), _0x37a4d0[_0x256268(0x5da)] = _0x29567f, _0x37a4d0[_0x256268(0x179)](_0x256268(0x788), () => { const _0x2a1c42 = _0x256268, _0x3469d2 = _0x37a4d0[_0x2a1c42(0x5da)]; document[_0x2a1c42(0x627)][_0x2a1c42(0x3c9)][_0x2a1c42(0x770)](_0x2a1c42(0x710), _0x3469d2), localStorage['setItem']('themeHue', _0x3469d2), _0xa0a68b(); }); } } function _0x6a1647() { const _0x295111 = _0x12f887, _0xef3455 = document[_0x295111(0x49f)](_0x295111(0x230)); if (!_0xef3455) return; const _0x485da7 = localStorage['getItem'](_0x295111(0x3ec)) || '80'; document[_0x295111(0x627)][_0x295111(0x3c9)]['setProperty'](_0x295111(0x783), _0x485da7 + '%'), _0xef3455[_0x295111(0x5da)] = _0x485da7, _0xef3455[_0x295111(0x179)](_0x295111(0x788), () => { const _0x2ebbcf = _0x295111, _0x5af122 = _0xef3455[_0x2ebbcf(0x5da)]; document['documentElement'][_0x2ebbcf(0x3c9)][_0x2ebbcf(0x770)](_0x2ebbcf(0x783), _0x5af122 + '%'), localStorage['setItem'](_0x2ebbcf(0x3ec), _0x5af122), _0xa0a68b(); }); } function _0xa0a68b() { const _0x4c9a01 = _0x12f887, _0x3604de = document[_0x4c9a01(0x49f)](_0x4c9a01(0x66a)); if (!_0x3604de) return; _0x2aa90d[_0x4c9a01(0x2eb)]['forceWhiteClock'] ? _0x4c9a01(0x1e3) === 'SpcaW' ? _0x32596d = _0x5b4f95[_0x4c9a01(0x70e)]('chatHistory_' + _0x5e3104[_0x4c9a01(0x544)]) : (_0x3604de['style']['color'] = '#FFFFFF', _0x3604de[_0x4c9a01(0x3c9)][_0x4c9a01(0x7f5)] = _0x4c9a01(0x433)) : _0x4c9a01(0x2dc) === 'pNhjZ' ? (_0x3604de[_0x4c9a01(0x3c9)]['color'] = _0x4c9a01(0x5f5), _0x3604de['style']['textShadow'] = _0x4c9a01(0x3d3)) : (_0x51c1b4[_0x4c9a01(0x6eb)]('生成动态回复失败:', _0x38b780), _0x549455(_0x4c9a01(0x72c))); } function _0x1e3a6d() { const _0x260907 = _0x12f887; if ('KpNae' !== _0x260907(0x7de)) { const _0x2c7702 = document[_0x260907(0x49f)](_0x260907(0x823)); if (!_0x2c7702) return; _0x2c7702['checked'] = _0x2aa90d['preferences'][_0x260907(0x63d)] || ![], _0x2c7702[_0x260907(0x179)]('change', () => { const _0x2d894d = _0x260907; _0x2aa90d['preferences'][_0x2d894d(0x63d)] = _0x2c7702[_0x2d894d(0x5f2)], _0x16a7ea(), _0xa0a68b(); }); } else { const _0x4d0e55 = _0x455626['getElementById'](_0x260907(0x3cc)); _0x4d0e55['innerHTML'] = ''; if (_0x41adf0[_0x260907(0x47c)]['length'] === 0x0) { _0x4d0e55[_0x260907(0x862)] = _0x260907(0x1a9); return; } _0x433737[_0x260907(0x47c)]['forEach'](_0x4dfd0e => { const _0x5c2879 = _0x260907, _0x77d444 = _0x2659d9[_0x5c2879(0x1a2)]('div'); _0x77d444[_0x5c2879(0x399)] = _0x5c2879(0x201), _0x77d444['dataset']['id'] = _0x4dfd0e['id']; const _0x42303f = _0x4dfd0e['id'] === _0x5ea511[_0x5c2879(0x4f4)] ? _0x5c2879(0x728) : ''; _0x77d444[_0x5c2879(0x862)] = _0x5c2879(0x1c2) + (_0x4dfd0e[_0x5c2879(0x5c4)] || _0x530c78) + _0x5c2879(0x168) + _0x4dfd0e['name'] + _0x42303f + _0x5c2879(0x574) + _0x4dfd0e['persona'][_0x5c2879(0x702)](0x0, 0x64) + _0x5c2879(0x17f), _0x77d444['addEventListener']('click', () => _0x42fa8d(_0x4dfd0e['id'])), _0x4d0e55[_0x5c2879(0x185)](_0x77d444); }); } } const _0x560167 = { 'home': document['getElementById'](_0x12f887(0x46f)), 'chat': document[_0x12f887(0x49f)](_0x12f887(0x308)), 'settings': document[_0x12f887(0x49f)](_0x12f887(0x516)), 'userProfile': document[_0x12f887(0x49f)](_0x12f887(0x6dc)), 'characterEdit': document[_0x12f887(0x49f)](_0x12f887(0x5d7)), 'groupChatCreate': document['getElementById']('group-chat-create-screen'), 'wallpaper': document[_0x12f887(0x49f)](_0x12f887(0x21f)), 'worldBook': document[_0x12f887(0x49f)](_0x12f887(0x361)), 'worldBookEditor': document['getElementById'](_0x12f887(0x296)), 'groupSettings': document[_0x12f887(0x49f)](_0x12f887(0x1d4)), 'music': document[_0x12f887(0x49f)](_0x12f887(0x468)), 'friendCircleList': document['getElementById'](_0x12f887(0x4b6)), 'friendCircleEdit': document[_0x12f887(0x49f)](_0x12f887(0x47b)), 'meetingList': document[_0x12f887(0x49f)](_0x12f887(0x456)), 'meetingView': document['getElementById'](_0x12f887(0x175)), 'userProfileList': document[_0x12f887(0x49f)](_0x12f887(0x5d0)), 'diaryList': document[_0x12f887(0x49f)](_0x12f887(0x577)), 'diaryView': document[_0x12f887(0x49f)](_0x12f887(0x884)), 'musicLibrary': document['getElementById'](_0x12f887(0x76e)), 'musicUploadAltar': document[_0x12f887(0x49f)](_0x12f887(0x334)) }, _0x437444 = document[_0x12f887(0x49f)](_0x12f887(0x65c)), _0x32585e = document[_0x12f887(0x49f)](_0x12f887(0x727)), _0x1ef0bf = document[_0x12f887(0x49f)]('reset-feed-bg-button'), _0x51db7e = document[_0x12f887(0x49f)](_0x12f887(0x75a)), _0x181e66 = document[_0x12f887(0x49f)](_0x12f887(0x6a8)), _0x5b16b4 = document[_0x12f887(0x49f)](_0x12f887(0x745)), _0x155e6a = document['getElementById']('wallpaper-input'), _0x5b0afd = document['getElementById'](_0x12f887(0x6fc)); document[_0x12f887(0x49f)](_0x12f887(0x2ec))[_0x12f887(0x179)](_0x12f887(0x3e9), async () => { const _0x123a8d = _0x12f887; if (_0x123a8d(0x6f4) !== _0x123a8d(0x72d)) { const _0x4d18f6 = await _0x1c19af('确定要重置所有桌面小组件和App的位置，并将壁纸变为纯白吗？此操作后将刷新页面。'); if (_0x4d18f6) { localStorage[_0x123a8d(0x509)](_0x123a8d(0x78f)), localStorage[_0x123a8d(0x509)](_0x123a8d(0x83b)), localStorage[_0x123a8d(0x509)](_0x123a8d(0x320)), localStorage['removeItem'](_0x123a8d(0x3d4)); const _0x1642bc = []; for (let _0x5623ff = 0x0; _0x5623ff < localStorage['length']; _0x5623ff++) { if (_0x123a8d(0x2be) !== _0x123a8d(0x2be)) { const _0x34b339 = _0x227708['toLowerCase'](), _0x4bd77a = _0xcdc54c[_0x123a8d(0x59e)](); if (_0x34b339['startsWith']('claude')) return _0x123a8d(0x693); if (_0x4bd77a[_0x123a8d(0x761)](_0x123a8d(0x60a))) return _0x123a8d(0x693); if (_0x4bd77a[_0x123a8d(0x761)](_0x123a8d(0x730))) return _0x123a8d(0x6cc); if (_0x34b339['startsWith']('gemini')) return _0x123a8d(0x6cc); return _0x123a8d(0x402); } else { const _0x5cbfd4 = localStorage[_0x123a8d(0x691)](_0x5623ff); _0x5cbfd4 && _0x5cbfd4[_0x123a8d(0x5b6)](_0x123a8d(0x57b)) && (_0x123a8d(0x5e5) === _0x123a8d(0x484) ? (_0x57eba9(), _0x268fd5(_0x123a8d(0x80d), _0x123a8d(0x5d1))) : _0x1642bc['push'](_0x5cbfd4)); } } _0x1642bc[_0x123a8d(0x242)](_0xd7b216 => localStorage['removeItem'](_0xd7b216)), await _0x19d8b8(_0x123a8d(0x56d), await _0x3591b3(_0x123a8d(0x7c7))), _0x5d65f5(_0x123a8d(0x2cd)), setTimeout(() => location[_0x123a8d(0x477)](), 0x5dc); } } else { const _0x4b79dd = _0x17f0f1[_0x123a8d(0x2fe)](); _0x4b79dd && _0x285330['push'](..._0x7a0fa4(_0x4b79dd)), _0x241977 < _0x2d6c75[_0x123a8d(0x45b)] && (_0x1fd6bc[_0x123a8d(0x249)](_0x46c0aa[_0x4c1b08][_0x123a8d(0x2fe)]()), _0x45232f++); } }); const _0x509844 = document[_0x12f887(0x49f)](_0x12f887(0x39d)), _0x5b06bf = document[_0x12f887(0x49f)](_0x12f887(0x4cf)), _0x3398e6 = document[_0x12f887(0x49f)](_0x12f887(0x763)), _0x3db4ec = document[_0x12f887(0x49f)]('choice-create-group'), _0x5e5457 = document[_0x12f887(0x49f)](_0x12f887(0x43b)), _0x1cf064 = document[_0x12f887(0x49f)]('back-to-char-select-from-group-create'), _0x3777c6 = document[_0x12f887(0x49f)]('create-group-chat-button'), _0x50e810 = document[_0x12f887(0x49f)]('group-chat-name'), _0x4c17bd = document[_0x12f887(0x49f)](_0x12f887(0x17b)), _0x4def83 = document[_0x12f887(0x49f)](_0x12f887(0x25d)), _0x28489e = document[_0x12f887(0x49f)](_0x12f887(0x21b)), _0x5b55d2 = document['getElementById'](_0x12f887(0x384)), _0x12d82a = document[_0x12f887(0x49f)](_0x12f887(0x7c8)), _0x359031 = document[_0x12f887(0x49f)]('back-to-chat-list'), _0x22400a = document['getElementById'](_0x12f887(0x5eb)), _0xe419d1 = document[_0x12f887(0x49f)](_0x12f887(0x6d2)), _0x480b6e = document['getElementById']('character-list'), _0x56a3b9 = document[_0x12f887(0x49f)](_0x12f887(0x3f1)), _0x346363 = document['getElementById']('chat-screen'), _0x216c2d = document[_0x12f887(0x49f)](_0x12f887(0x475)), _0x2fefe8 = document[_0x12f887(0x49f)]('chat-message-input'), _0x70d7b0 = document[_0x12f887(0x49f)](_0x12f887(0x760)), _0x4e4151 = document[_0x12f887(0x49f)](_0x12f887(0x22c)), _0xf80142 = document['getElementById']('quote-preview-area'), _0xf3ab4 = document[_0x12f887(0x49f)](_0x12f887(0x2e4)), _0x228ab5 = document['getElementById'](_0x12f887(0x1ba)), _0x362473 = document[_0x12f887(0x49f)](_0x12f887(0x170)), _0x2f4bba = document[_0x12f887(0x49f)](_0x12f887(0x7df)), _0xdd817b = document['getElementById'](_0x12f887(0x5f4)), _0x37cbde = document['getElementById'](_0x12f887(0x668)), _0x54bd8e = document[_0x12f887(0x49f)](_0x12f887(0x705)), _0x54b155 = document[_0x12f887(0x49f)](_0x12f887(0x66f)), _0x87704f = document[_0x12f887(0x49f)](_0x12f887(0x298)), _0x252840 = document[_0x12f887(0x49f)](_0x12f887(0x425)), _0x85e157 = document['getElementById'](_0x12f887(0x60f)), _0x1bc26c = document[_0x12f887(0x49f)](_0x12f887(0x614)), _0x128b76 = document[_0x12f887(0x49f)]('api-model'), _0x25e872 = document[_0x12f887(0x49f)](_0x12f887(0x2ca)), _0x561f2e = document[_0x12f887(0x49f)]('fetch-models-button'), _0x206f57 = document[_0x12f887(0x49f)]('model-dropdown'), _0x24b606 = document[_0x12f887(0x49f)](_0x12f887(0x45f)), _0x27f342 = document[_0x12f887(0x49f)](_0x12f887(0x4ea)), _0x252780 = document['getElementById'](_0x12f887(0x54c)), _0x56db79 = document[_0x12f887(0x49f)](_0x12f887(0x24c)), _0x40b4a8 = document[_0x12f887(0x49f)](_0x12f887(0x3e3)), _0x42a65b = document[_0x12f887(0x49f)](_0x12f887(0x42a)), _0x4f1079 = document['getElementById'](_0x12f887(0x24e)), _0x420686 = document[_0x12f887(0x49f)](_0x12f887(0x30c)), _0x96bbd4 = document[_0x12f887(0x49f)]('char-edit-name'), _0x8d2c3e = document[_0x12f887(0x49f)](_0x12f887(0x638)), _0x3e5f74 = document[_0x12f887(0x49f)](_0x12f887(0x3cd)), _0x3631f4 = document[_0x12f887(0x49f)](_0x12f887(0x869)), _0x334fe9 = document['getElementById'](_0x12f887(0x398)), _0x1a281c = document[_0x12f887(0x49f)](_0x12f887(0x714)), _0x42a357 = document['getElementById']('edit-clear-history-button'), _0x178501 = document[_0x12f887(0x49f)](_0x12f887(0x87f)); let _0x120185 = null; const _0x1eaf2f = _0x12f887(0x7e4); _0x2aa90d = { 'characters': [], 'worldBooks': [], 'chats': [], 'userProfiles': [], 'activeUserProfileId': null, 'apiSettings': { 'endpoint': '', 'key': '', 'model': '' }, 'preferences': { 'widgetBgImage': null, 'perChatContextLines': 0x64, 'forceWhiteClock': ![] }, 'activeChatId': null, 'activeMeetingCharId': null, 'isGenerating': ![], 'currentAbortController': null, 'pendingMessageTimers': [], 'conversationHistory': [], 'displayedMessageCount': 0x64, 'activeQuote': null, 'friendCircles': [], 'activeFriendCircleId': null, 'diaries': [], 'activeDiaryCharacterId': null, 'diaries': [], 'activeDiaryCharacterId': null, 'meetingViewMode': _0x12f887(0x351), 'activeMeetingScriptQueue': [], 'characterLastScripts': {}, 'musicPlaylist': [], 'currentlyPlayingIndex': -0x1, 'isPlaying': ![], 'pendingPostAttachments': { 'image': null, 'music': null } }; function _0x16a7ea() { const _0x540f51 = _0x12f887; if ('RTsTX' !== _0x540f51(0x69a)) _0x3305bc(); else try { if (_0x540f51(0x41b) !== _0x540f51(0x715)) { const _0x3dc5ac = { 'characters': _0x2aa90d[_0x540f51(0x857)], 'worldBooks': _0x2aa90d['worldBooks'], 'chats': _0x2aa90d[_0x540f51(0x22e)], 'userProfile': _0x2aa90d[_0x540f51(0x585)], 'apiSettings': _0x2aa90d[_0x540f51(0x4de)], 'preferences': _0x2aa90d['preferences'], 'activeChatId': _0x2aa90d[_0x540f51(0x544)], 'diaries': _0x2aa90d['diaries'], 'friendCircles': _0x2aa90d[_0x540f51(0x2d4)], 'activeFriendCircleId': _0x2aa90d[_0x540f51(0x806)], 'userProfiles': _0x2aa90d[_0x540f51(0x47c)], 'activeUserProfileId': _0x2aa90d['activeUserProfileId'] }; localStorage['setItem'](_0x540f51(0x44e), JSON[_0x540f51(0x46d)](_0x3dc5ac)); } else _0x1376b4(![]), _0x83d58f[_0x540f51(0x6eb)]('解析音乐文件失败:', _0x419e25), _0x2a4708('上传失败了，笨蛋！\x20' + _0x1b5441[_0x540f51(0x4c4)]); } catch (_0x2c90ff) { console[_0x540f51(0x6eb)]('Failed\x20to\x20save\x20state\x20to\x20localStorage:', _0x2c90ff), _0x5d65f5(_0x540f51(0x340)); } } function _0x35cb7f() { const _0x5d4ac9 = _0x12f887; let _0x5bd5bf = null; try { _0x5bd5bf = localStorage[_0x5d4ac9(0x70e)]('appState'); } catch (_0x4dc93e) { _0x5d4ac9(0x2a2) === _0x5d4ac9(0x2a2) ? (console['error'](_0x5d4ac9(0x6cb), _0x4dc93e), _0x5d65f5(_0x5d4ac9(0x497))) : (_0x46b7db['isGenerating'] = ![], _0x248e9f(![])); } if (_0x5bd5bf) try { if (_0x5d4ac9(0x37b) === _0x5d4ac9(0x1c0)) _0x3187fe['push'](_0x2da15f); else { const _0x504e5c = JSON['parse'](_0x5bd5bf); if (!_0x504e5c || typeof _0x504e5c !== 'object') throw new Error(_0x5d4ac9(0x3a9)); Array[_0x5d4ac9(0x4d3)](_0x504e5c['characters']) && (_0x2aa90d[_0x5d4ac9(0x857)] = _0x504e5c['characters'][_0x5d4ac9(0x511)](_0x291568 => ({ 'offlineBackground': '', ..._0x291568 }))['filter'](_0x1d451c => _0x1d451c && typeof _0x1d451c === _0x5d4ac9(0x18c) && _0x1d451c['id'])); Array['isArray'](_0x504e5c[_0x5d4ac9(0x14b)]) && (_0x2aa90d[_0x5d4ac9(0x14b)] = _0x504e5c['worldBooks']); Array[_0x5d4ac9(0x4d3)](_0x504e5c[_0x5d4ac9(0x494)]) && ('wqFkg' === _0x5d4ac9(0x3bb) ? _0x387957(_0x5d4ac9(0x404)) : _0x2aa90d[_0x5d4ac9(0x494)] = _0x504e5c['diaries']); if (Array[_0x5d4ac9(0x4d3)](_0x504e5c[_0x5d4ac9(0x2d4)])) _0x2aa90d[_0x5d4ac9(0x2d4)] = _0x504e5c['friendCircles'], _0x2aa90d[_0x5d4ac9(0x806)] = _0x504e5c[_0x5d4ac9(0x806)]; else { if (Array[_0x5d4ac9(0x4d3)](_0x504e5c[_0x5d4ac9(0x87d)]) && _0x504e5c[_0x5d4ac9(0x87d)][_0x5d4ac9(0x45b)] > 0x0) { console[_0x5d4ac9(0x23c)](_0x5d4ac9(0x1b7)); const _0x3b64c6 = { 'id': _0x5d4ac9(0x467) + Date[_0x5d4ac9(0x24a)](), 'name': _0x5d4ac9(0x796), 'boundUserProfileId': _0x504e5c[_0x5d4ac9(0x4f4)], 'memberCharacterIds': _0x504e5c[_0x5d4ac9(0x857)][_0x5d4ac9(0x511)](_0x39f4a6 => _0x39f4a6['id']), 'posts': _0x504e5c[_0x5d4ac9(0x87d)] }; _0x2aa90d[_0x5d4ac9(0x2d4)] = [_0x3b64c6], _0x2aa90d['activeFriendCircleId'] = _0x3b64c6['id']; } } if (Array[_0x5d4ac9(0x4d3)](_0x504e5c[_0x5d4ac9(0x47c)])) _0x5d4ac9(0x617) !== 'lYxHt' ? (_0x2aa90d[_0x5d4ac9(0x47c)] = _0x504e5c[_0x5d4ac9(0x47c)], _0x2aa90d['activeUserProfileId'] = _0x504e5c[_0x5d4ac9(0x4f4)]) : _0x4e261f = _0x43fe26['id']; else { if (_0x504e5c[_0x5d4ac9(0x585)]) { console[_0x5d4ac9(0x23c)](_0x5d4ac9(0x2af)); const _0x22ac2d = { 'id': _0x5d4ac9(0x6fd) + Date[_0x5d4ac9(0x24a)](), 'name': _0x504e5c[_0x5d4ac9(0x585)]['name'] || '我', 'avatar': _0x504e5c['userProfile'][_0x5d4ac9(0x5c4)] || _0x5e96e0, 'persona': _0x504e5c[_0x5d4ac9(0x585)][_0x5d4ac9(0x839)] || '' }; _0x2aa90d['userProfiles'] = [_0x22ac2d], _0x2aa90d[_0x5d4ac9(0x4f4)] = _0x22ac2d['id']; } } _0x504e5c[_0x5d4ac9(0x4de)] && typeof _0x504e5c[_0x5d4ac9(0x4de)] === _0x5d4ac9(0x18c) && (_0x2aa90d[_0x5d4ac9(0x4de)] = { ..._0x2aa90d[_0x5d4ac9(0x4de)], ..._0x504e5c[_0x5d4ac9(0x4de)] }); _0x504e5c['preferences'] && typeof _0x504e5c['preferences'] === _0x5d4ac9(0x18c) ? _0x2aa90d[_0x5d4ac9(0x2eb)] = { 'perChatContextLines': 0x64, 'widgetBgImage': null, ..._0x504e5c['preferences'] } : _0x2aa90d[_0x5d4ac9(0x2eb)] = { 'perChatContextLines': 0x64, 'widgetBgImage': null }; if (Array[_0x5d4ac9(0x4d3)](_0x504e5c[_0x5d4ac9(0x22e)])) { if (_0x5d4ac9(0x50d) === _0x5d4ac9(0x50d)) _0x2aa90d['chats'] = _0x504e5c[_0x5d4ac9(0x22e)], _0x2aa90d[_0x5d4ac9(0x544)] = _0x504e5c[_0x5d4ac9(0x544)] || null; else { const _0x2b78bf = _0x5d4ac9(0x272); _0x1e35ca = _0x5d4ac9(0x817) + _0x43179b['name'] + _0x5d4ac9(0x325) + _0x2b78bf + _0x5d4ac9(0x5b2) + _0x37eff0[_0x5d4ac9(0x2a5)] + _0x5d4ac9(0x7b4) + _0x2b78bf + _0x5d4ac9(0x17d) + _0x2b78bf + _0x5d4ac9(0x290); } } else Array[_0x5d4ac9(0x4d3)](_0x504e5c[_0x5d4ac9(0x857)]) && (console[_0x5d4ac9(0x23c)](_0x5d4ac9(0x7ad)), _0x2aa90d[_0x5d4ac9(0x22e)] = _0x504e5c[_0x5d4ac9(0x857)][_0x5d4ac9(0x511)](_0x4911b8 => ({ 'id': _0x5d4ac9(0x171) + _0x4911b8['id'], 'type': _0x5d4ac9(0x23d), 'participantIds': [_0x4911b8['id']] })), _0x504e5c['activeCharacterId'] && (_0x2aa90d[_0x5d4ac9(0x544)] = _0x5d4ac9(0x171) + _0x504e5c['activeCharacterId']), _0x504e5c[_0x5d4ac9(0x857)]['forEach'](_0x2f3535 => { const _0x4031cb = _0x5d4ac9, _0x5c79bb = _0x4031cb(0x224) + _0x2f3535['id'], _0x12104d = _0x4031cb(0x85d) + _0x2f3535['id'], _0x4d36e6 = localStorage['getItem'](_0x5c79bb); _0x4d36e6 && (_0x4031cb(0x538) !== _0x4031cb(0x538) ? (_0x328147[_0x4031cb(0x3c9)][_0x4031cb(0x6b4)] = _0x4031cb(0x3d3), _0x176922[_0x4031cb(0x56a)] = _0x2dd3de['onclick'] = _0x2c0ef7[_0x4031cb(0x56a)] = null, _0x3f820d[_0x4031cb(0x7bb)](_0x4031cb(0x357), _0x2f48a7), _0x19a0bd(_0x2977e9)) : (localStorage['setItem'](_0x12104d, _0x4d36e6), localStorage[_0x4031cb(0x509)](_0x5c79bb))); })); } } catch (_0x3464ae) { if (_0x5d4ac9(0x824) !== _0x5d4ac9(0x2bb)) { console[_0x5d4ac9(0x6eb)](_0x5d4ac9(0x283), _0x3464ae), _0x2aa90d['characters'] = [], _0x2aa90d[_0x5d4ac9(0x22e)] = [], _0x2aa90d['activeChatId'] = null; try { _0x5d4ac9(0x2d0) === 'pZVHN' ? _0x2752c1() : localStorage[_0x5d4ac9(0x509)](_0x5d4ac9(0x44e)); } catch (_0x5c8be0) { console['error'](_0x5d4ac9(0x423), _0x5c8be0); } } else { _0x3f48b0[_0x5d4ac9(0x2f1)]['add'](_0x5d4ac9(0x5f7)); const _0x30e40f = _0x5537d9[_0x5d4ac9(0x1a2)](_0x5d4ac9(0x642)); _0x30e40f[_0x5d4ac9(0x399)] = _0x5d4ac9(0x26f), _0x30e40f['classList']['add']('no-action-modal'); const _0x4c0dc6 = _0x144879[_0x5d4ac9(0x619)] === _0x5d4ac9(0x821) ? _0x1bcce6(_0xf02b8f[_0x5d4ac9(0x544)])['name'] || '你' : _0x5e1ba5(_0x5cbcab[_0x5d4ac9(0x3e4)])?.[_0x5d4ac9(0x2a5)] || 'TA', _0x3dedb0 = _0x541acd[_0x5d4ac9(0x6ca)] || _0x2d1c6e; _0x37735a['accepted'] ? _0x30e40f['innerHTML'] = '\x0a\x20\x20\x20\x20<div\x20class=\x22listen-together-header\x22\x20style=\x22display:\x20flex;\x20justify-content:\x20space-between;\x20align-items:\x20center;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<span\x20style=\x22flex-grow:\x201;\x20text-align:\x20center;\x22>🎵\x20已连接，正在一起听\x20🎵</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22lt-end-session-btn\x22\x20title=\x22结束一起听\x22>×</span>\x0a\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20<div\x20class=\x22listen-together-song\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22' + _0x3dedb0 + _0x5d4ac9(0x426) + _0x34ac66['songName'] + _0x5d4ac9(0x192) + _0x4013be[_0x5d4ac9(0x347)] + '</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20</div>' : _0x30e40f['innerHTML'] = '\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22listen-together-header\x22>' + _0x4c0dc6 + _0x5d4ac9(0x41e) + _0x3dedb0 + _0x5d4ac9(0x82d) + _0x46480a[_0x5d4ac9(0x879)] + _0x5d4ac9(0x539) + _0x4e08f9[_0x5d4ac9(0x347)] + '</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22listen-together-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22listen-together-accept-btn\x22\x20data-song-id=\x22' + _0x518a63[_0x5d4ac9(0x48e)] + '\x22>一起听</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>', _0xd95969[_0x5d4ac9(0x185)](_0x30e40f); } } let _0x40ad54 = ![]; if (_0x2aa90d[_0x5d4ac9(0x857)][_0x5d4ac9(0x45b)] === 0x0) _0x40ad54 = !![], _0x2aa90d['activeChatId'] = null; else { if (!_0x2aa90d[_0x5d4ac9(0x22e)][_0x5d4ac9(0x349)](_0x133a78 => _0x133a78['id'] === _0x2aa90d[_0x5d4ac9(0x544)])) { if (_0x5d4ac9(0x3b1) !== _0x5d4ac9(0x77a)) _0x2aa90d[_0x5d4ac9(0x544)] = _0x2aa90d[_0x5d4ac9(0x22e)][0x0]?.['id'] || null; else { const _0x22d5df = _0x156a24['createElement'](_0x5d4ac9(0x505)); _0x22d5df[_0x5d4ac9(0x862)] = '<input\x20type=\x22checkbox\x22\x20value=\x22' + _0x369ef4['id'] + _0x5d4ac9(0x210) + _0x55ede0[_0x5d4ac9(0x2a5)], _0x24e877[_0x5d4ac9(0x185)](_0x22d5df); } } } return _0x16a7ea(), _0x40ad54; } function _0x3c149c() { const _0x7a17d0 = _0x12f887; if (_0x7a17d0(0x7ba) === _0x7a17d0(0x188)) { const _0x3fb99b = _0x501e94[_0x7a17d0(0x14b)][_0x7a17d0(0x349)](_0x2dff67 => _0x2dff67['id'] === _0x5405a5); if (!_0x3fb99b) return; _0x467a2a['getElementById'](_0x7a17d0(0x48c))[_0x7a17d0(0x5da)] = _0x3fb99b['id'], _0x27fa7a[_0x7a17d0(0x49f)]('world-book-editor-title')[_0x7a17d0(0x7ea)] = _0x7a17d0(0x6c0), _0xd71390['getElementById'](_0x7a17d0(0x3c3))[_0x7a17d0(0x5da)] = _0x3fb99b[_0x7a17d0(0x2a5)], _0x38de2e[_0x7a17d0(0x49f)](_0x7a17d0(0x4cb))['value'] = _0x3fb99b[_0x7a17d0(0x751)]; } else { if (!_0x2aa90d[_0x7a17d0(0x544)]) return; try { 'RclCW' === _0x7a17d0(0x4a0) ? (_0x2bf551(), _0x58574d(!![])) : localStorage['setItem'](_0x7a17d0(0x224) + _0x2aa90d[_0x7a17d0(0x544)], JSON[_0x7a17d0(0x46d)](_0x2aa90d['conversationHistory'])); } catch (_0x2e5dc0) { if (_0x7a17d0(0x262) !== _0x7a17d0(0x262)) { _0x501cb7[_0x7a17d0(0x862)] = _0x7a17d0(0x1a9); return; } else console[_0x7a17d0(0x6eb)]('Failed\x20to\x20save\x20history\x20to\x20localStorage:', _0x2e5dc0), _0x5d65f5('无法保存聊天记录。'); } } } function _0x28a59e() { const _0x2da1c2 = _0x12f887; if (!_0x2aa90d[_0x2da1c2(0x544)]) { if (_0x2da1c2(0x76d) !== _0x2da1c2(0x48f)) { _0x2aa90d[_0x2da1c2(0x7f2)] = [], _0x42745f(); return; } else { const _0x43a083 = _0x33b90e[_0x2da1c2(0x2d4)]['find'](_0x3286ed => _0x3286ed['id'] === _0x1194da); if (!_0x43a083) return; _0x1de8e6[_0x2da1c2(0x7ea)] = _0x2da1c2(0x1f8), _0x221737[_0x2da1c2(0x5da)] = _0x43a083['id'], _0x5176ca[_0x2da1c2(0x5da)] = _0x43a083['name'], _0x5f443d[_0x2da1c2(0x5da)] = _0x43a083[_0x2da1c2(0x412)], _0x5bb677[_0x2da1c2(0x3c9)][_0x2da1c2(0x6b4)] = _0x2da1c2(0x4b1), _0x43a083[_0x2da1c2(0x40b)]['forEach'](_0x4bfe42 => { const _0x170931 = _0xd8c874['querySelector']('#member-select-' + _0x4bfe42); if (_0x170931) _0x170931['checked'] = !![]; }); } } let _0x225f78 = null; try { _0x225f78 = localStorage[_0x2da1c2(0x70e)]('chatHistory_' + _0x2aa90d[_0x2da1c2(0x544)]); } catch (_0x51e826) { if (_0x2da1c2(0x1a6) === _0x2da1c2(0x30d)) { if (_0x778027) _0x1d074f(_0x2d6cfa); if (_0x14a79e['defaultPrevented']) return; _0x53aff0(() => { _0xd5dc9e && _0x9c3fa1(_0x22bb91['id'], _0x4c37ea['map'](_0x424c40 => _0x424c40['id'])); }, 0x32); } else console[_0x2da1c2(0x6eb)]('Failed\x20to\x20read\x20history\x20for\x20chat\x20' + _0x2aa90d[_0x2da1c2(0x544)], _0x51e826); } let _0x38d124 = []; if (_0x225f78) { if (_0x2da1c2(0x22b) === _0x2da1c2(0x22b)) try { const _0x10af68 = JSON['parse'](_0x225f78); Array[_0x2da1c2(0x4d3)](_0x10af68) && (_0x38d124 = _0x10af68[_0x2da1c2(0x747)](_0x26b394 => _0x26b394 && typeof _0x26b394 === _0x2da1c2(0x18c) && typeof _0x26b394[_0x2da1c2(0x619)] === _0x2da1c2(0x233) && typeof _0x26b394[_0x2da1c2(0x751)] !== 'undefined')); } catch (_0x548c8c) { if ('uQxwX' === _0x2da1c2(0x6c3)) { console[_0x2da1c2(0x6eb)]('Failed\x20to\x20parse\x20history\x20for\x20chat\x20' + _0x2aa90d[_0x2da1c2(0x544)] + _0x2da1c2(0x674), _0x548c8c); try { localStorage[_0x2da1c2(0x509)](_0x2da1c2(0x224) + _0x2aa90d['activeChatId']); } catch (_0x1c315f) { if (_0x2da1c2(0x32e) === _0x2da1c2(0x32e)) console['error'](_0x2da1c2(0x508), _0x1c315f); else { const _0x4389b2 = _0x2443ca(_0x56a834[_0x2da1c2(0x883)]); _0x4389b2 && (_0x18f5c4 = _0x4389b2[_0x2da1c2(0x2a5)], _0x35858e = _0x4389b2['avatar']); } } } else _0x54b4cd[_0x2da1c2(0x2a5)] !== 'AbortError' && (_0x13852e[_0x2da1c2(0x6eb)](_0x2da1c2(0x15c), _0x2bb930), _0x3dc4cb({ 'role': _0x2da1c2(0x4e1), 'content': _0x2da1c2(0x2ba) + _0x4d7075[_0x2da1c2(0x4c4)] }, _0x1af3da['conversationHistory']['length'] - 0x1)); } else _0x56c757[_0x2da1c2(0x54e)] = _0xbb35e9[_0x2da1c2(0x52d)](_0x4e9f5b), _0x416fb4[_0x2da1c2(0x3c9)][_0x2da1c2(0x6b4)] = 'block'; } _0x2aa90d[_0x2da1c2(0x7f2)] = _0x38d124, _0x216c2d[_0x2da1c2(0x862)] = ''; if (_0x2aa90d[_0x2da1c2(0x7f2)]) { if ('uHNRT' === _0x2da1c2(0x2d9)) _0x2aa90d[_0x2da1c2(0x7f2)]['forEach']((_0x44b95a, _0x5de41b) => _0x28439d(_0x44b95a, _0x5de41b)); else { const _0x148b94 = _0x47c8f7[_0x2da1c2(0x1a3)][_0x2da1c2(0x511)](_0x2946bb => _0x116b41(_0x2946bb)?.['name'] || '未知')[_0x2da1c2(0x4c2)]('、'); _0x33c7d2 = _0x2da1c2(0x762) + _0x148b94 + _0x2da1c2(0x78e); } } setTimeout(() => { const _0x588c70 = _0x2da1c2; _0x216c2d[_0x588c70(0x5ae)] = _0x216c2d['scrollHeight']; }, 0x0); } async function _0x5649cc() { const _0x30d550 = _0x12f887, _0x276a32 = document[_0x30d550(0x49f)]('home-screen'); try { if (_0x30d550(0x870) !== _0x30d550(0x61c)) { let _0x5d6a8b = await _0x33b931('wallpaper_main'); if (!_0x5d6a8b) { const _0x4f27d8 = localStorage['getItem'](_0x30d550(0x6c8)); _0x4f27d8 && (console['log'](_0x30d550(0x7fb)), _0x5d6a8b = await _0x3591b3(_0x4f27d8), await _0x19d8b8('wallpaper_main', _0x5d6a8b), localStorage['removeItem']('customWallpaper')); } _0x5d6a8b ? (_0x276a32[_0x30d550(0x3c9)][_0x30d550(0x482)] = _0x30d550(0x4ac) + URL['createObjectURL'](_0x5d6a8b) + ')', _0x276a32[_0x30d550(0x3c9)][_0x30d550(0x639)] = _0x30d550(0x4ad), _0x276a32['style'][_0x30d550(0x286)] = _0x30d550(0x437)) : _0x30d550(0x490) === _0x30d550(0x60c) ? (_0x4442b9[_0x30d550(0x292)](), _0x2899e7[_0x30d550(0x4b0)]('.music-post-play-icon,\x20.music-share-play-icon')[_0x30d550(0x7ea)] = '▶') : _0x276a32[_0x30d550(0x3c9)]['backgroundImage'] = ''; } else { const _0x50a346 = _0x2e73c5['chats'][_0x30d550(0x349)](_0x351cc5 => _0x351cc5[_0x30d550(0x843)] && _0x351cc5[_0x30d550(0x843)][_0x30d550(0x17c)]); _0x50a346 && (_0x50a346['activeListenSession'] = null, _0x206fae(), _0x24ff5c(_0x30d550(0x664)), _0x38d59f(), _0x23b3bc[_0x30d550(0x2f1)][_0x30d550(0x231)](_0x30d550(0x557)), _0x54f1d0(() => _0x4245b4[_0x30d550(0x3c9)][_0x30d550(0x6b4)] = 'none', 0x12c)); } } catch (_0x1b5c1b) { if (_0x30d550(0x294) !== _0x30d550(0x3d7)) console[_0x30d550(0x6eb)](_0x30d550(0x3ff), _0x1b5c1b), phoneContainer[_0x30d550(0x3c9)][_0x30d550(0x482)] = ''; else { if (_0x17a653[_0x30d550(0x5b4)] === 'group') return _0x30d550(0x672) + (_0x49324b[_0x30d550(0x2a5)] || '未命名') + '」'; const _0x2abc72 = _0x18b939(_0x5580f8['participantIds'][0x0]); return '与\x20' + (_0x2abc72?.['name'] || _0x30d550(0x3ee)) + _0x30d550(0x58b); } } } function _0x42a173() { const _0x59462b = _0x12f887, _0x37676d = localStorage[_0x59462b(0x70e)](_0x59462b(0x55b)); _0x37676d ? document[_0x59462b(0x49f)](_0x59462b(0x468))[_0x59462b(0x3c9)]['setProperty'](_0x59462b(0x24b), _0x59462b(0x4ac) + _0x37676d + ')') : document[_0x59462b(0x49f)](_0x59462b(0x468))[_0x59462b(0x3c9)][_0x59462b(0x770)]('--feed-bg-image', _0x59462b(0x3d3)); } async function _0x9a5fe5(_0x150693) { const _0x204637 = _0x12f887; try { await _0x19d8b8(_0x204637(0x56d), _0x150693), await _0x5649cc(), _0x5d65f5(_0x204637(0x7c9)); } catch (_0x6ed6fa) { console[_0x204637(0x6eb)](_0x204637(0x206), _0x6ed6fa), _0x5d65f5(_0x204637(0x35d) + _0x6ed6fa['message']); } } function _0x3a1003(_0x45c264) { const _0x7ce1d9 = _0x12f887; if (_0x7ce1d9(0x3fc) === _0x7ce1d9(0x3c5)) { _0x3043be(_0x7ce1d9(0x585), _0x7ce1d9(0x1a0)); const _0x417f51 = _0x3dbbb1[_0x7ce1d9(0x49f)](_0x7ce1d9(0x2c6)); if (_0x27f52b) { const _0x363bb4 = _0x43a0ac['userProfiles']['find'](_0x2361b6 => _0x2361b6['id'] === _0x5ddac1); if (!_0x363bb4) return; _0x762ebd['getElementById']('editing-user-id')['value'] = _0x363bb4['id'], _0x42ce64[_0x7ce1d9(0x49f)]('user-profile-edit-title')[_0x7ce1d9(0x7ea)] = _0x7ce1d9(0x52e), _0x392a3a['getElementById']('user-name')['value'] = _0x363bb4[_0x7ce1d9(0x2a5)], _0x11584b[_0x7ce1d9(0x49f)](_0x7ce1d9(0x54c))[_0x7ce1d9(0x54e)] = _0x363bb4[_0x7ce1d9(0x5c4)], _0x54cccd[_0x7ce1d9(0x49f)]('user-persona')[_0x7ce1d9(0x5da)] = _0x363bb4['persona'], _0x417f51['style']['display'] = _0x363bb4['id'] === _0x104c3a[_0x7ce1d9(0x4f4)] ? 'none' : _0x7ce1d9(0x4b1); } else _0x2cbfa6[_0x7ce1d9(0x49f)]('editing-user-id')['value'] = '', _0x5b5e35[_0x7ce1d9(0x49f)]('user-profile-edit-title')[_0x7ce1d9(0x7ea)] = _0x7ce1d9(0x3a8), _0x570d10['getElementById'](_0x7ce1d9(0x4ea))['value'] = _0x7ce1d9(0x50c) + (_0x29e375[_0x7ce1d9(0x47c)][_0x7ce1d9(0x45b)] + 0x1), _0x5ef52d[_0x7ce1d9(0x49f)](_0x7ce1d9(0x54c))[_0x7ce1d9(0x54e)] = _0x58c844, _0x3b2e11[_0x7ce1d9(0x49f)](_0x7ce1d9(0x3e3))[_0x7ce1d9(0x5da)] = '', _0x417f51[_0x7ce1d9(0x3c9)]['display'] = _0x7ce1d9(0x3d3); } else { const _0x1ade18 = { 'quotedMessage': null, 'content': _0x45c264 }, _0x1cac05 = _0x45c264['match'](/^\[引用\|(.*?)\|(.*?)\]\s*/); return _0x1cac05 && (_0x1ade18[_0x7ce1d9(0x7a0)] = { 'sender': _0x1cac05[0x1]['trim'](), 'content': _0x1cac05[0x2][_0x7ce1d9(0x2fe)]() }, _0x1ade18['content'] = _0x45c264[_0x7ce1d9(0x702)](_0x1cac05[0x0][_0x7ce1d9(0x45b)])[_0x7ce1d9(0x2fe)]()), _0x1ade18; } } const _0x26c8f6 = document[_0x12f887(0x49f)](_0x12f887(0x633)), _0x3b0c51 = document[_0x12f887(0x49f)](_0x12f887(0x87c)), _0x4736b9 = document[_0x12f887(0x49f)](_0x12f887(0x193)), _0x38a59c = document['getElementById'](_0x12f887(0x7bd)), _0x1dc497 = document['getElementById']('cancel-action-button'), _0x3076c9 = document['getElementById'](_0x12f887(0x59f)), _0x38c29b = document[_0x12f887(0x49f)]('edit-message-modal'), _0x40c676 = document[_0x12f887(0x49f)](_0x12f887(0x1f6)), _0x27271b = document[_0x12f887(0x49f)]('edit-message-textarea'), _0x277419 = document['getElementById'](_0x12f887(0x2fa)), _0x4fbec3 = document[_0x12f887(0x49f)](_0x12f887(0x159)); let _0x4d42a8 = null; function _0x294563(_0x33d268) { const _0x44367e = _0x12f887; _0x44367e(0x2b9) === _0x44367e(0x2b9) ? (_0x4d42a8 = _0x33d268, _0x26c8f6[_0x44367e(0x2f1)]['add']('show')) : (_0x35c795(), _0x77b2ed[_0x44367e(0x176)] = 0x64); } function _0x245adf() { const _0x6b8064 = _0x12f887; _0x26c8f6[_0x6b8064(0x2f1)][_0x6b8064(0x231)](_0x6b8064(0x557)); } function _0x160863() { const _0x4048c9 = _0x12f887; _0x4048c9(0x833) !== 'ahibB' ? (_0x245adf(), _0x4d42a8 = null) : (_0x4e67e9[_0x4048c9(0x6eb)](_0x4048c9(0x6cb), _0x27a0c2), _0x4a066d(_0x4048c9(0x497))); } function _0x3a99ca() { const _0x1716e0 = _0x12f887; if (_0x4d42a8 === null) return; _0x2aa90d[_0x1716e0(0x7f2)][_0x1716e0(0x6d3)](_0x4d42a8, 0x1), _0x3c149c(), _0x2215cd(), _0x160863(); } function _0x15e618() { const _0x54c1d1 = _0x12f887; if ('sqoXR' === _0x54c1d1(0x1bc)) _0x2a8468(_0x406873['id']), _0x3a64cb(_0x54c1d1(0x4ec) + _0x102f19[_0x54c1d1(0x2a5)] + '\x22\x20已删除。'), _0x21f561(![]); else { if (_0x4d42a8 === null) return; const _0x3f84f1 = _0x2aa90d['conversationHistory'][_0x4d42a8]; if (!_0x3f84f1) return; _0x27271b['value'] = _0x3f84f1[_0x54c1d1(0x751)], _0x245adf(), _0x38c29b[_0x54c1d1(0x2f1)][_0x54c1d1(0x737)](_0x54c1d1(0x557)), _0x27271b[_0x54c1d1(0x530)](); } } function _0x4b358a() { const _0x4f34eb = _0x12f887; if (_0x4f34eb(0x1f2) !== 'TsfuZ') _0x43956e(), _0x5bb769('编辑群成员功能正在开发中...'); else { if (_0x4d42a8 === null) return; const _0x530af5 = _0x27271b[_0x4f34eb(0x5da)]['trim'](); if (_0x530af5 === '') { _0x36aea9(); return; } const _0x1c5279 = _0x2aa90d[_0x4f34eb(0x7f2)][_0x4d42a8]; _0x1c5279 && (_0x1c5279[_0x4f34eb(0x751)] = _0x530af5, _0x3c149c(), _0x2215cd()), _0x38c29b[_0x4f34eb(0x2f1)][_0x4f34eb(0x231)](_0x4f34eb(0x557)), _0x4d42a8 = null; } } function _0x36aea9() { const _0x5055ec = _0x12f887; _0x38c29b[_0x5055ec(0x2f1)][_0x5055ec(0x231)](_0x5055ec(0x557)), _0x4d42a8 = null; } _0x3b0c51[_0x12f887(0x179)](_0x12f887(0x3e9), _0x160863), _0x1dc497[_0x12f887(0x179)](_0x12f887(0x3e9), _0x160863), _0x38a59c[_0x12f887(0x179)](_0x12f887(0x3e9), _0x3a99ca), _0x4736b9['addEventListener']('click', _0x15e618), _0x3076c9[_0x12f887(0x179)](_0x12f887(0x3e9), _0x442d42), _0x362473[_0x12f887(0x179)](_0x12f887(0x3e9), _0xc21e75), _0x277419[_0x12f887(0x179)](_0x12f887(0x3e9), _0x4b358a), _0x4fbec3[_0x12f887(0x179)]('click', _0x36aea9), _0x40c676[_0x12f887(0x179)]('click', _0x36aea9); function _0x442d42() { const _0x3c27ee = _0x12f887; if (_0x3c27ee(0x66e) === _0x3c27ee(0x66e)) { if (_0x4d42a8 === null) return; const _0x58d0ed = _0x2aa90d[_0x3c27ee(0x7f2)][_0x4d42a8]; if (!_0x58d0ed) return; const _0x5554ab = _0x4adf1c(); let _0x440374 = '未知'; if (_0x58d0ed[_0x3c27ee(0x619)] === 'user') 'TONhe' !== 'Xuedq' ? _0x440374 = _0x2aa90d['userProfile'][_0x3c27ee(0x2a5)] || '我' : _0x170707[_0x3c27ee(0x806)] && _0x51a6b9(_0xac4a73[_0x3c27ee(0x806)]); else { if ('qkshz' === _0x3c27ee(0x801)) { const _0x13d823 = _0x58d0ed[_0x3c27ee(0x3e4)] || _0x5554ab?.[_0x3c27ee(0x6ec)][0x0], _0x12cde8 = _0x1c2a48(_0x13d823); _0x440374 = _0x12cde8 ? _0x12cde8[_0x3c27ee(0x2a5)] : '角色'; } else _0x32d8fa[_0x3c27ee(0x54e)] = _0x1686af ? _0x2cbb51['createObjectURL'](_0x34b88f) : _0x14fff4; } let _0x575254 = _0x58d0ed['content'] || ''; if (_0x58d0ed[_0x3c27ee(0x626)]) _0x575254 = _0x3c27ee(0x199); if (_0x58d0ed[_0x3c27ee(0x33c)]) _0x575254 = _0x3c27ee(0x85e); if (_0x575254['length'] > 0x32) _0x575254 = _0x575254['substring'](0x0, 0x32) + '...'; _0x2aa90d[_0x3c27ee(0x167)] = { 'sender': _0x440374, 'content': _0x575254 }, _0x59e1da(), _0x160863(), _0x2fefe8[_0x3c27ee(0x530)](); } else { const _0x12b8bd = _0x125196[_0x3c27ee(0x38e)](_0x37e21d['getItem'](_0x3c27ee(0x78f)) || '{}'), _0x2f5be7 = { ..._0x12b8bd, ..._0x42e615 }; _0x3c6879[_0x3c27ee(0x1e0)]('badgeState', _0x634b42[_0x3c27ee(0x46d)](_0x2f5be7)); } } function _0x59e1da() { const _0x3c95c3 = _0x12f887; if (!_0x2aa90d[_0x3c95c3(0x167)]) return; _0xf3ab4['textContent'] = _0x3c95c3(0x1e5) + _0x2aa90d['activeQuote'][_0x3c95c3(0x658)], _0x228ab5[_0x3c95c3(0x7ea)] = _0x2aa90d['activeQuote'][_0x3c95c3(0x751)], _0xf80142[_0x3c95c3(0x3c9)][_0x3c95c3(0x6b4)] = _0x3c95c3(0x4b1); } function _0xc21e75() { const _0x255786 = _0x12f887; if ('uSBZm' !== _0x255786(0x29b)) return _0x3659a7[_0x255786(0x22e)][_0x255786(0x349)](_0x40b8da => _0x40b8da['id'] === _0x25a61b[_0x255786(0x544)]); else _0x2aa90d['activeQuote'] = null, _0xf80142[_0x255786(0x3c9)]['display'] = _0x255786(0x3d3); } function _0x381d3b(_0x4dcdd5, _0x138b1c) { const _0x1fedc1 = _0x12f887; if (_0x1fedc1(0x1a4) === _0x1fedc1(0x1a4)) { const _0x40f479 = document['getElementById'](_0x1fedc1(0x302)); if (_0x40f479) { if (_0x4dcdd5 === 'home') { if (_0x1fedc1(0x264) !== 'tWwAR') { _0x50ceda(_0x1fedc1(0x88b)); return; } else _0x40f479['style'][_0x1fedc1(0x6b4)] = _0x1fedc1(0x1cb); } else _0x40f479[_0x1fedc1(0x3c9)]['display'] = _0x1fedc1(0x3d3); } _0x120185 = _0x138b1c || null, Object['values'](_0x560167)[_0x1fedc1(0x242)](_0xf31d03 => _0xf31d03[_0x1fedc1(0x2f1)][_0x1fedc1(0x231)](_0x1fedc1(0x48a))), _0x560167[_0x4dcdd5] && _0x560167[_0x4dcdd5][_0x1fedc1(0x2f1)][_0x1fedc1(0x737)]('active'), _0x4dcdd5 !== 'chat' && _0x346363[_0x1fedc1(0x2f1)][_0x1fedc1(0x231)](_0x1fedc1(0x427)); } else { if (_0x584840[_0x1fedc1(0x619)] === _0x1fedc1(0x821)) return _0x154073['userProfile']?.[_0x1fedc1(0x2a5)] || _0x1fedc1(0x4ae); if (_0x30010e[_0x1fedc1(0x5b4)] === _0x1fedc1(0x67a)) { const _0x604d4b = _0x2be1fb['senderId'] ? _0x12494a(_0x35e865[_0x1fedc1(0x3e4)]) : null; return _0x604d4b?.['name'] || 'Unknown'; } else { const _0x454e3e = _0x5b35d7(_0x528062[_0x1fedc1(0x6ec)][0x0]); return _0x454e3e?.[_0x1fedc1(0x2a5)] || 'AI'; } } } function _0x4cb79b(_0x1fa543) { const _0x2f4b3d = _0x12f887; _0x1fa543 ? _0x2f4b3d(0x256) === _0x2f4b3d(0x7cb) ? _0x460e8b[_0x161e60][_0x2f4b3d(0x2f1)]['add'](_0x2f4b3d(0x48a)) : _0x346363[_0x2f4b3d(0x2f1)][_0x2f4b3d(0x737)](_0x2f4b3d(0x427)) : _0x346363[_0x2f4b3d(0x2f1)][_0x2f4b3d(0x231)]('show-chat-view'); } async function _0xd101b6() { const _0x4bdca5 = _0x12f887; _0x480b6e[_0x4bdca5(0x862)] = ''; for (const _0x109321 of _0x2aa90d['chats']) { const _0x5cae0f = document[_0x4bdca5(0x1a2)]('li'); _0x5cae0f[_0x4bdca5(0x399)] = 'character-item', _0x5cae0f[_0x4bdca5(0x55a)]['id'] = _0x109321['id']; let _0x425014 = _0x12a7cc, _0x3a519b = '群聊', _0x28fb63 = ''; if (_0x109321[_0x4bdca5(0x5b4)] === _0x4bdca5(0x23d)) { if (_0x4bdca5(0x2ed) === _0x4bdca5(0x62c)) _0x14dc45['currentAbortController'] = null; else { const _0x1f54b7 = _0x1c2a48(_0x109321[_0x4bdca5(0x6ec)][0x0]); if (_0x1f54b7) 'NdMIJ' === 'NdMIJ' ? (_0x425014 = _0x1f54b7[_0x4bdca5(0x5c4)] || _0x12a7cc, _0x3a519b = _0x1f54b7[_0x4bdca5(0x2a5)] || _0x4bdca5(0x2c0), _0x28fb63 = _0x1f54b7['remark'] || '私聊') : (_0x154bc6[_0x4bdca5(0x49f)](_0x4bdca5(0x3e6) + _0x393e9b + _0x4bdca5(0x4d8))[_0x4bdca5(0x54e)] = '', _0x239e17['getElementById']('char-edit-sprite-' + _0x2a1bd0 + _0x4bdca5(0x816))[_0x4bdca5(0x5da)] = ''); else { if ('snaeq' !== 'snaeq') { let _0x2545d3 = null; const _0x22fa2c = _0xdbc15c[_0x4bdca5(0x22e)][_0x4bdca5(0x747)](_0x89094d => _0x89094d['participantIds'][_0x4bdca5(0x761)](_0xf40360)); for (const _0x4fa45d of _0x22fa2c) { const _0x11a7fb = _0x5ad363(_0x4fa45d['id']); if (_0x11a7fb && _0x11a7fb[_0x4bdca5(0x45b)] > 0x0) { const _0x1d2812 = _0x11a7fb[_0x11a7fb['length'] - 0x1]; (!_0x2545d3 || _0x1d2812['timestamp'] > _0x2545d3['timestamp']) && (_0x2545d3 = _0x1d2812); } } return _0x2545d3; } else _0x3a519b = '未知角色', _0x28fb63 = '错误：找不到角色'; } } } else { _0x3a519b = _0x109321[_0x4bdca5(0x2a5)] || '未命名群聊', _0x28fb63 = _0x109321['participantIds'][_0x4bdca5(0x45b)] + _0x4bdca5(0x33d); const _0x11d872 = await _0x33b931(_0x4bdca5(0x749) + _0x109321['id']); if (_0x11d872) _0x425014 = URL[_0x4bdca5(0x52d)](_0x11d872); } _0x5cae0f[_0x4bdca5(0x862)] = _0x4bdca5(0x444) + _0x425014 + _0x4bdca5(0x3d1) + _0x3a519b + _0x4bdca5(0x7b7) + _0x28fb63 + _0x4bdca5(0x3ac), _0x5cae0f[_0x4bdca5(0x4b0)](_0x4bdca5(0x604))['addEventListener']('click', () => { _0x4762b7(_0x109321['id']), _0x4cb79b(!![]); }), _0x480b6e['appendChild'](_0x5cae0f); } } function _0x1072e4() { const _0x1b4d2c = _0x12f887; if ('orQYJ' === 'orQYJ') { const _0x4daae0 = document[_0x1b4d2c(0x49f)](_0x1b4d2c(0x72a)); _0x4daae0['innerHTML'] = ''; const _0x4df210 = _0x2aa90d[_0x1b4d2c(0x857)][_0x1b4d2c(0x747)](_0x33ab6c => _0x2aa90d['chats'][_0x1b4d2c(0x2ef)](_0x57aae6 => _0x57aae6['type'] === _0x1b4d2c(0x23d) && _0x57aae6['participantIds'][_0x1b4d2c(0x761)](_0x33ab6c['id']))); if (_0x4df210[_0x1b4d2c(0x45b)] === 0x0) { _0x4daae0[_0x1b4d2c(0x862)] = '<p\x20style=\x22text-align:\x20center;\x20color:\x20var(--text-color-light);\x22>还没有可以见面的角色。</p>'; return; } _0x4df210['forEach'](_0x239b35 => { const _0x2b7150 = _0x1b4d2c, _0x6a37aa = document['createElement']('li'); _0x6a37aa['className'] = _0x2b7150(0x852), _0x6a37aa[_0x2b7150(0x55a)][_0x2b7150(0x1c7)] = _0x239b35['id'], _0x6a37aa[_0x2b7150(0x862)] = _0x2b7150(0x2e1) + (_0x239b35['avatar'] || _0x12a7cc) + _0x2b7150(0x37e) + _0x239b35[_0x2b7150(0x2a5)] + _0x2b7150(0x529) + (_0x239b35[_0x2b7150(0x563)] || '私聊') + _0x2b7150(0x78d), _0x6a37aa[_0x2b7150(0x179)](_0x2b7150(0x3e9), () => { const _0x13f184 = _0x2b7150; if (_0x13f184(0x250) !== 'wdZqw') { const _0x320d46 = _0x51a596(_0x3cda93[_0x13f184(0x883)]) || { 'name': '未知' }; let _0x127651 = _0x13f184(0x4fe) + _0x320d46[_0x13f184(0x2a5)] + '\x20说：“' + (_0x3a0c85[_0x13f184(0x5a3)] || _0x34a8b0[_0x13f184(0x751)]) + '”'; return _0x2e714d[_0x13f184(0x5b4)] === _0x13f184(0x5f7) && (_0x127651 += _0x13f184(0x3a1) + _0x3591aa[_0x13f184(0x879)] + _0x13f184(0x820) + _0x6d146['artist'] + ')'), _0x127651; } else _0x5d88a1(_0x239b35['id']); }), _0x4daae0[_0x2b7150(0x185)](_0x6a37aa); }); } else _0xe11621(_0x3b3e9a['id']), _0x3dd667(!![]); } async function _0x5d88a1(_0x5b3c7e) { const _0x43778f = _0x12f887, _0x386366 = _0x1c2a48(_0x5b3c7e); if (!_0x386366) return; document[_0x43778f(0x49f)](_0x43778f(0x155))[_0x43778f(0x54e)] = '', _0x2aa90d['activeMeetingCharId'] = _0x5b3c7e; const _0x39b0ec = _0x2aa90d[_0x43778f(0x22e)]['find'](_0x5f5b41 => _0x5f5b41['type'] === _0x43778f(0x23d) && _0x5f5b41[_0x43778f(0x6ec)][_0x43778f(0x761)](_0x5b3c7e)); _0x39b0ec ? (_0x2aa90d['activeChatId'] = _0x39b0ec['id'], _0x16a7ea(), _0x28a59e(), _0x5428e2(_0x5b3c7e)) : _0x2aa90d[_0x43778f(0x7f2)] = []; document[_0x43778f(0x49f)](_0x43778f(0x571))[_0x43778f(0x7ea)] = _0x386366[_0x43778f(0x2a5)]; const _0x4d3974 = document[_0x43778f(0x49f)](_0x43778f(0x43d)); try { const _0x26db8d = await _0x33b931(_0x43778f(0x442) + _0x5b3c7e); if (_0x26db8d) { if (_0x43778f(0x498) === _0x43778f(0x498)) _0x4d3974[_0x43778f(0x3c9)]['backgroundImage'] = 'url(\x27' + URL[_0x43778f(0x52d)](_0x26db8d) + '\x27)', _0x4d3974[_0x43778f(0x3c9)][_0x43778f(0x639)] = 'cover', _0x4d3974['style']['backgroundPosition'] = _0x43778f(0x437); else { const _0x4babfc = _0x59044e[_0x43778f(0x1a2)](_0x43778f(0x642)); _0x4babfc[_0x43778f(0x7ea)] = _0x6e11d6, _0x4babfc[_0x43778f(0x179)](_0x43778f(0x3e9), () => { const _0x550d43 = _0x43778f; _0x2bb76b['value'] = _0x53086d, _0x5591f1[_0x550d43(0x2f1)][_0x550d43(0x231)](_0x550d43(0x557)); }), _0x3fcd1a[_0x43778f(0x185)](_0x4babfc); } } else _0x4d3974['style'][_0x43778f(0x482)] = _0x43778f(0x3d3); } catch (_0x268f76) { console[_0x43778f(0x6eb)](_0x43778f(0x785) + _0x5b3c7e + ':', _0x268f76), _0x4d3974['style'][_0x43778f(0x482)] = _0x43778f(0x3d3); } _0x39036a(), _0x29bfb8(); if (_0x4228c1) clearInterval(_0x4228c1); _0x28be94(), _0x4228c1 = setInterval(_0x28be94, 0x2710), _0x381d3b('meetingView', _0x43778f(0x29f)); } function _0x29bfb8() { const _0x43d2de = _0x12f887, _0x5efac0 = document[_0x43d2de(0x49f)]('meeting-scene-view'); _0x5efac0[_0x43d2de(0x862)] = ''; const _0x2ed6fa = _0x5efac0[_0x43d2de(0x4b0)](_0x43d2de(0x254)); if (_0x2ed6fa) _0x2ed6fa['remove'](); _0x2aa90d[_0x43d2de(0x7f2)] && _0x2aa90d[_0x43d2de(0x7f2)][_0x43d2de(0x242)]((_0x15b8b7, _0x36ceb2) => { const _0x858d4a = _0x43d2de; if (!_0x15b8b7[_0x858d4a(0x446)] || _0x15b8b7['role'] === _0x858d4a(0x1db)) return; const _0x1b0973 = document[_0x858d4a(0x1a2)]('p'); _0x1b0973['dataset'][_0x858d4a(0x18a)] = _0x36ceb2; const _0x4f642f = _0x15b8b7[_0x858d4a(0x751)]['replace'](/\n/g, _0x858d4a(0x5d2)); let _0x2828ac = '', _0xda1fa9 = ''; const _0x58480f = _0x5cb17e(_0x2aa90d['activeChatId']); if (_0x15b8b7[_0x858d4a(0x619)] === _0x858d4a(0x821)) _0x2828ac = _0x58480f[_0x858d4a(0x2a5)] || '我', _0xda1fa9 = _0x858d4a(0x7e9); else { if (_0x15b8b7[_0x858d4a(0x619)] === _0x858d4a(0x4e1)) { if (_0x858d4a(0x4fa) === _0x858d4a(0x71e)) { const _0x20e9df = _0x3e9efd[_0x858d4a(0x2d4)][_0x858d4a(0x349)](_0x374517 => _0x374517['id'] === _0x42916b); _0x20e9df && (_0x20e9df[_0x858d4a(0x2a5)] = _0x49c1d0, _0x20e9df['boundUserProfileId'] = _0x19e985, _0x20e9df[_0x858d4a(0x40b)] = _0x4dc03d); } else { const _0x5c1ed5 = _0x1c2a48(_0x15b8b7[_0x858d4a(0x3e4)] || _0x2aa90d[_0x858d4a(0x27d)]); _0x2828ac = _0x5c1ed5?.[_0x858d4a(0x2a5)] || '角色', _0xda1fa9 = _0x858d4a(0x1d1); } } } _0x1b0973['style']['backgroundColor'] = _0x858d4a(0x5b7), _0x1b0973[_0x858d4a(0x3c9)]['padding'] = _0x858d4a(0x18d), _0x1b0973[_0x858d4a(0x3c9)][_0x858d4a(0x77b)] = _0x858d4a(0x271), _0x1b0973[_0x858d4a(0x3c9)]['marginBottom'] = _0x858d4a(0x4e3); if (_0x2828ac) { if ('BcGkD' !== 'ABHca') _0x1b0973[_0x858d4a(0x862)] = '<span\x20class=\x22' + _0xda1fa9 + _0x858d4a(0x61b) + (_0xda1fa9 === _0x858d4a(0x7e9) ? _0x858d4a(0x2d6) : _0x858d4a(0x6f6)) + _0x858d4a(0x1a1) + _0x2828ac + _0x858d4a(0x1f3) + _0x4f642f; else return _0x550191(_0x23fc28)[_0x858d4a(0x7aa)](_0x1ce89a => _0x1ce89a['blob']()); } else _0x1b0973[_0x858d4a(0x399)] = 'narrator', _0x1b0973[_0x858d4a(0x3c9)]['fontStyle'] = 'italic', _0x1b0973[_0x858d4a(0x3c9)][_0x858d4a(0x416)] = _0x858d4a(0x882), _0x1b0973[_0x858d4a(0x862)] = _0x4f642f; _0x5efac0['appendChild'](_0x1b0973); }); if (_0x2aa90d[_0x43d2de(0x784)]) { if (_0x43d2de(0x663) === _0x43d2de(0x663)) { let _0x1c1f31 = _0x5efac0[_0x43d2de(0x4b0)](_0x43d2de(0x567)); !_0x1c1f31 && (_0x43d2de(0x3da) === _0x43d2de(0x3d6) ? _0x2b0720 = _0xfb3dd6[_0x43d2de(0x47c)][_0x43d2de(0x349)](_0x245c9d => _0x245c9d['id'] === _0x4dcec7[_0x43d2de(0x4f4)]) || _0x18b3ff[_0x43d2de(0x47c)][0x0] : (_0x1c1f31 = document[_0x43d2de(0x1a2)](_0x43d2de(0x642)), _0x1c1f31['className'] = 'typing-indicator', _0x1c1f31[_0x43d2de(0x7ea)] = _0x43d2de(0x82e), _0x1c1f31[_0x43d2de(0x3c9)][_0x43d2de(0x37d)] = 'rgba(0,\x200,\x200,\x200.4)', _0x1c1f31[_0x43d2de(0x3c9)][_0x43d2de(0x453)] = _0x43d2de(0x18d), _0x1c1f31[_0x43d2de(0x3c9)][_0x43d2de(0x77b)] = _0x43d2de(0x271), _0x5efac0[_0x43d2de(0x185)](_0x1c1f31))); } else _0x5c00d8[_0x43d2de(0x73a)] = _0x1e6959[_0x43d2de(0x73a)] === 'novel' ? 'galgame' : _0x43d2de(0x351), _0x4366bd(); } const _0x3a8049 = document[_0x43d2de(0x1a2)](_0x43d2de(0x642)); _0x3a8049['id'] = _0x43d2de(0x805), _0x5efac0['appendChild'](_0x3a8049), setTimeout(() => { const _0x397051 = _0x43d2de; _0x3a8049['scrollIntoView']({ 'behavior': _0x397051(0x2b4), 'block': _0x397051(0x6c5) }); }, 0x32); } function _0x2215cd() { const _0x154e6c = _0x12f887; if ('JNOpV' !== _0x154e6c(0x443)) _0x234ba3[_0x154e6c(0x843)] = null, _0x33be00(), _0x13be1c(_0x154e6c(0x664)), _0x2c898f(), _0x5084f9['classList'][_0x154e6c(0x231)]('show'), _0x5bae5b(() => _0x30e16c['style'][_0x154e6c(0x6b4)] = _0x154e6c(0x3d3), 0x12c); else { const _0x1acb72 = document[_0x154e6c(0x4b0)](_0x154e6c(0x84b)); if (!_0x1acb72) return; _0x1acb72['id'] === _0x154e6c(0x175) ? _0x29bfb8() : _0x154e6c(0x5ee) !== 'oZltM' ? _0x42745f() : (_0xa62b32[_0x154e6c(0x54e)] = _0x3072ba[_0x154e6c(0x52d)](_0x112a52), _0x29f3ea['style']['display'] = 'block'); } } function _0x42745f() { const _0x402cc5 = _0x12f887, _0x20c42f = _0x2aa90d[_0x402cc5(0x7f2)][_0x402cc5(0x747)](_0x48ab35 => !_0x48ab35['isOffline'] && _0x48ab35['role'] !== _0x402cc5(0x1db)); if (_0x20c42f[_0x402cc5(0x45b)] > _0x2aa90d[_0x402cc5(0x176)]) { if (_0x402cc5(0x7fe) !== 'SwbSM') { let _0x3c124c = _0x216c2d[_0x402cc5(0x4b0)](_0x402cc5(0x44d)); !_0x3c124c && (_0x3c124c = document[_0x402cc5(0x1a2)](_0x402cc5(0x7c3)), _0x3c124c['textContent'] = '加载更多聊天记录', _0x3c124c['className'] = _0x402cc5(0x7c4), _0x3c124c[_0x402cc5(0x3c9)][_0x402cc5(0x6ed)] = 'auto', _0x3c124c[_0x402cc5(0x3c9)][_0x402cc5(0x14e)] = _0x402cc5(0x51a), _0x3c124c[_0x402cc5(0x3c9)]['padding'] = _0x402cc5(0x74b), _0x3c124c[_0x402cc5(0x56a)] = () => { const _0x57fe51 = _0x402cc5, _0x1911cd = _0x216c2d, _0x2628d7 = _0x1911cd[_0x57fe51(0x148)], _0x30aab0 = _0x1911cd['scrollTop']; _0x2aa90d[_0x57fe51(0x176)] += 0x64, _0x42745f(), requestAnimationFrame(() => { const _0x41108a = _0x57fe51; if (_0x41108a(0x191) === _0x41108a(0x52b)) _0x3f8ad1['getElementById'](_0x41108a(0x523))[_0x41108a(0x3e9)](); else { const _0x494411 = _0x1911cd['scrollHeight']; _0x1911cd['scrollTop'] = _0x30aab0 + (_0x494411 - _0x2628d7); } }); }, _0x216c2d['firstChild'] ? _0x216c2d[_0x402cc5(0x424)](_0x3c124c, _0x216c2d['firstChild']) : _0x216c2d[_0x402cc5(0x185)](_0x3c124c)); } else { const _0x31ca11 = _0x43a149[_0x402cc5(0x1a2)]('div'); _0x31ca11['className'] = _0x402cc5(0x1d2), _0x31ca11['innerHTML'] = _0x402cc5(0x172) + _0x537b92['id'] + _0x402cc5(0x3d9) + _0x595a76['id'] + '\x22>\x0a\x20\x20\x20\x20\x20\x20<img\x20src=\x22' + (_0x5b9ee5[_0x402cc5(0x5c4)] || _0xb7c362) + _0x402cc5(0x417) + _0x1b794e['id'] + '\x22\x20class=\x22char-name\x22>' + _0x4606aa['name'] + _0x402cc5(0x6e6), _0x4318cf[_0x402cc5(0x185)](_0x31ca11); } } else { const _0x34f307 = _0x216c2d[_0x402cc5(0x4b0)](_0x402cc5(0x44d)); if (_0x34f307) _0x34f307[_0x402cc5(0x231)](); } Array[_0x402cc5(0x6d7)](_0x216c2d[_0x402cc5(0x200)])[_0x402cc5(0x242)](_0x2c0e47 => { const _0x4ed9d8 = _0x402cc5; 'PNndg' !== 'PNndg' ? (_0x285fee[_0x4ed9d8(0x4f4)] = _0x4f8d06, _0x5be823(), _0x34f68e(_0x4ed9d8(0x2e9)), _0x25d40a(), _0x4800f4[_0x4ed9d8(0x49f)](_0x4ed9d8(0x2c6))[_0x4ed9d8(0x3c9)][_0x4ed9d8(0x6b4)] = _0x4ed9d8(0x3d3)) : !_0x2c0e47[_0x4ed9d8(0x2f1)][_0x4ed9d8(0x6a9)]('load-more-btn') && _0x2c0e47[_0x4ed9d8(0x231)](); }); const _0xa38823 = _0x20c42f[_0x402cc5(0x830)](-_0x2aa90d['displayedMessageCount']); _0xa38823[_0x402cc5(0x242)](_0x5d3234 => { const _0x82d988 = _0x402cc5, _0x3f0e94 = _0x2aa90d[_0x82d988(0x7f2)]['indexOf'](_0x5d3234); _0x3f0e94 > -0x1 && _0x28439d(_0x5d3234, _0x3f0e94); }); if (_0x2aa90d[_0x402cc5(0x784)]) { if (_0x402cc5(0x54f) !== _0x402cc5(0x512)) { let _0x1aead9 = _0x216c2d[_0x402cc5(0x4b0)](_0x402cc5(0x567)); !_0x1aead9 && (_0x1aead9 = document[_0x402cc5(0x1a2)](_0x402cc5(0x642)), _0x1aead9[_0x402cc5(0x399)] = _0x402cc5(0x4b2), _0x1aead9['textContent'] = _0x402cc5(0x216), _0x216c2d[_0x402cc5(0x185)](_0x1aead9)); } else { _0x3a897c[_0x402cc5(0x6eb)](_0x402cc5(0x5a8), _0x4151ea); const _0x2625a1 = { 'role': _0x402cc5(0x4e1), 'content': _0x402cc5(0x2ba) + _0x3e4108[_0x402cc5(0x4c4)], 'senderId': _0xb17fe7['id'], 'isOffline': _0x4e2762 }; _0x88ea36[_0x402cc5(0x7f2)][_0x402cc5(0x249)](_0x2625a1), _0x4ae92b(); } } _0xa38823[_0x402cc5(0x45b)] <= _0x2aa90d[_0x402cc5(0x176)] && setTimeout(() => { const _0x129772 = _0x402cc5; _0x129772(0x6cf) !== _0x129772(0x166) ? _0x216c2d[_0x129772(0x5ae)] = _0x216c2d[_0x129772(0x148)] : _0x3a4cff[_0x129772(0x3c9)]['display'] = _0x129772(0x4b1); }, 0x0); } function _0x28439d(_0x1b02b8, _0x68213f) { const _0x23662f = _0x12f887; if ('BIuNP' === _0x23662f(0x50b)) { const _0x575118 = _0x2c3741['getElementById'](_0x23662f(0x258)); if (!_0x575118) return; const _0x28e7d8 = _0x3cd334[_0x23662f(0x70e)](_0x23662f(0x690)) || '35'; _0x73dbab[_0x23662f(0x627)][_0x23662f(0x3c9)][_0x23662f(0x770)](_0x23662f(0x710), _0x28e7d8), _0x575118[_0x23662f(0x5da)] = _0x28e7d8, _0x575118[_0x23662f(0x179)]('input', () => { const _0x47a7bf = _0x23662f, _0xebe720 = _0x575118[_0x47a7bf(0x5da)]; _0xf1af21[_0x47a7bf(0x627)][_0x47a7bf(0x3c9)][_0x47a7bf(0x770)]('--primary-hue', _0xebe720), _0x4e9c35[_0x47a7bf(0x1e0)](_0x47a7bf(0x690), _0xebe720), _0x277b21(); }); } else { const { role: _0x36610d, content: _0x2f8d50, displayUrl: _0x1c8a0f, image: _0x359288, senderId: _0x40cd34 } = _0x1b02b8, _0x3fa549 = _0x36610d === _0x23662f(0x4e1) ? 'ai' : _0x36610d, _0x46a8b3 = _0x4adf1c(), _0x49c285 = document['createElement'](_0x23662f(0x642)); _0x49c285[_0x23662f(0x2f1)][_0x23662f(0x737)](_0x23662f(0x4c0), _0x3fa549), _0x49c285['dataset']['historyIndex'] = _0x68213f; const _0x3bf57d = document[_0x23662f(0x1a2)](_0x23662f(0x642)); _0x3bf57d['className'] = _0x23662f(0x7cc); const _0x306234 = document[_0x23662f(0x1a2)](_0x23662f(0x359)); _0x306234['classList']['add'](_0x23662f(0x5c4), _0x36610d + _0x23662f(0x860)); let _0x77a62a = ''; if (_0x36610d === _0x23662f(0x821)) { const _0x5a5fec = _0x5cb17e(_0x2aa90d[_0x23662f(0x544)]); _0x77a62a = _0x5a5fec[_0x23662f(0x5c4)] || _0x5e96e0; } else { _0x77a62a = _0x12a7cc; let _0x4f8322 = null; if (_0x46a8b3?.[_0x23662f(0x5b4)] === _0x23662f(0x23d)) _0x23662f(0x2dd) === _0x23662f(0x2dd) ? _0x4f8322 = _0x1c2a48(_0x46a8b3[_0x23662f(0x6ec)][0x0]) : (_0x52da1f(), _0x4e0e79(_0x23662f(0x5d1), 'chat')); else _0x46a8b3?.['type'] === _0x23662f(0x67a) && _0x40cd34 && (_0x4f8322 = _0x1c2a48(_0x40cd34)); _0x4f8322?.['avatar'] && (_0x77a62a = _0x4f8322[_0x23662f(0x5c4)]); } _0x306234[_0x23662f(0x54e)] = _0x77a62a, _0x306234[_0x23662f(0x787)] = _0x36610d + _0x23662f(0x2cf); const _0x500d1a = _0x2f8d50 && _0x2f8d50[_0x23662f(0x2fe)]()[_0x23662f(0x5b6)](_0x23662f(0x5ca)) && _0x2f8d50[_0x23662f(0x2fe)]()[_0x23662f(0x681)](_0x23662f(0x78e)); if (_0x500d1a) { if (_0x23662f(0x541) !== _0x23662f(0x541)) _0x8bc286(_0x4570a3), _0x270ad9('角色“' + _0x4e509d[_0x23662f(0x2a5)] + _0x23662f(0x4c5)), _0x2f260e('chat', _0x23662f(0x7fd)), _0x40b9a0(![]); else { const _0x31cc30 = document['createElement'](_0x23662f(0x642)); _0x31cc30[_0x23662f(0x399)] = 'html-module-container', _0x31cc30[_0x23662f(0x862)] = _0x2f8d50, _0x3fa549 === _0x23662f(0x821) ? (_0x3bf57d[_0x23662f(0x185)](_0x31cc30), _0x3bf57d[_0x23662f(0x185)](_0x306234)) : _0x23662f(0x1c4) === _0x23662f(0x6a4) ? _0x47d7a5[_0x23662f(0x2f1)][_0x23662f(0x737)](_0x23662f(0x25a)) : (_0x3bf57d[_0x23662f(0x185)](_0x306234), _0x3bf57d['appendChild'](_0x31cc30)); } } else { if (_0x23662f(0x434) === _0x23662f(0x3c1)) { if (!_0x21fdce) return []; const _0x85dd0e = _0x21e4df(_0x6f83ce)[_0x23662f(0x2fe)](), _0x3a24a1 = _0x85dd0e[_0x23662f(0x804)](/(?<=[。！？!?…])\s+|[\r\n]+/)['map'](_0x5b5248 => _0x5b5248[_0x23662f(0x2fe)]())[_0x23662f(0x747)](_0xc98702); if (_0x3a24a1[_0x23662f(0x45b)] > 0x0) return _0x3a24a1[_0x23662f(0x830)](0x0, 0x9); return [_0x85dd0e]['filter'](_0x4f9cd6); } else { const _0x3b23c1 = document[_0x23662f(0x1a2)](_0x23662f(0x642)); _0x3b23c1[_0x23662f(0x2f1)][_0x23662f(0x737)]('message', _0x3fa549); if (_0x46a8b3?.[_0x23662f(0x5b4)] === 'private') { if (_0x23662f(0x33b) !== _0x23662f(0x33b)) { _0xe5ce62(_0x23662f(0x7b5)); return; } else { const _0x6fa520 = _0x46a8b3['participantIds'][0x0]; _0x3b23c1[_0x23662f(0x2f1)][_0x23662f(0x737)](_0x23662f(0x507) + _0x6fa520); } } if (_0x1b02b8['quotedMessage']) { const _0x1e25ad = document[_0x23662f(0x1a2)](_0x23662f(0x642)); _0x1e25ad[_0x23662f(0x399)] = _0x23662f(0x331); const _0x1b62cf = document[_0x23662f(0x1a2)](_0x23662f(0x642)); _0x1b62cf['className'] = _0x23662f(0x463), _0x1b62cf['textContent'] = _0x1b02b8[_0x23662f(0x7a0)]['sender']; const _0x1c4f14 = document[_0x23662f(0x1a2)](_0x23662f(0x642)); _0x1c4f14[_0x23662f(0x399)] = _0x23662f(0x174), _0x1c4f14[_0x23662f(0x7ea)] = _0x1b02b8[_0x23662f(0x7a0)][_0x23662f(0x751)], _0x1e25ad[_0x23662f(0x185)](_0x1b62cf), _0x1e25ad[_0x23662f(0x185)](_0x1c4f14), _0x3b23c1[_0x23662f(0x185)](_0x1e25ad); } if (_0x1c8a0f) { _0x3b23c1[_0x23662f(0x2f1)][_0x23662f(0x737)]('sticker'); const _0x3c1b12 = document['createElement'](_0x23662f(0x359)); _0x3c1b12['src'] = _0x1c8a0f, _0x3c1b12['classList']['add'](_0x23662f(0x84d)), _0x3b23c1['appendChild'](_0x3c1b12); } else { if (_0x1b02b8[_0x23662f(0x33c)] || _0x1b02b8[_0x23662f(0x6fa)]) { _0x3b23c1[_0x23662f(0x2f1)]['add'](_0x23662f(0x33c)); const _0x2b7aa3 = document[_0x23662f(0x1a2)](_0x23662f(0x359)); _0x2b7aa3[_0x23662f(0x2f1)][_0x23662f(0x737)](_0x23662f(0x1ad)), _0x3b23c1['appendChild'](_0x2b7aa3); _0x1b02b8[_0x23662f(0x33c)] ? _0x2b7aa3[_0x23662f(0x54e)] = _0x1b02b8[_0x23662f(0x33c)] : (_0x2b7aa3[_0x23662f(0x54e)] = _0x23662f(0x38f), _0x33b931(_0x1b02b8[_0x23662f(0x6fa)])[_0x23662f(0x7aa)](_0xcacd42 => { const _0x60cc41 = _0x23662f; if (_0xcacd42) { const _0x53eb78 = URL[_0x60cc41(0x52d)](_0xcacd42); _0x2b7aa3[_0x60cc41(0x54e)] = _0x53eb78, _0x2b7aa3[_0x60cc41(0x1b1)] = () => { const _0x33c738 = _0x60cc41; URL[_0x33c738(0x64b)](_0x53eb78); }; } else _0x2b7aa3[_0x60cc41(0x787)] = _0x60cc41(0x828); })[_0x23662f(0x301)](_0x5e2821 => { const _0x3443d5 = _0x23662f; console[_0x3443d5(0x6eb)]('无法从\x20IndexedDB\x20加载聊天图片:', _0x5e2821), _0x2b7aa3[_0x3443d5(0x787)] = _0x3443d5(0x828); })); if (_0x2f8d50) { if (_0x23662f(0x71b) === _0x23662f(0x4f6)) { const _0x3f74ad = _0x24b1bc(_0x23052f['activeChatId']); _0x198360 = _0x3f74ad[_0x23662f(0x5c4)] || _0x499c2e; } else { const _0x2554bf = document[_0x23662f(0x1a2)]('p'); _0x2554bf[_0x23662f(0x3c9)]['marginTop'] = _0x23662f(0x86f), _0x2554bf[_0x23662f(0x7ea)] = _0x2f8d50, _0x3b23c1[_0x23662f(0x185)](_0x2554bf); } } } else { if (_0x1b02b8[_0x23662f(0x5b4)] === 'transfer') { _0x3b23c1[_0x23662f(0x2f1)][_0x23662f(0x737)](_0x23662f(0x441)); const _0x109e32 = _0x1b02b8['role'] === 'user' ? _0x5cb17e(_0x2aa90d['activeChatId']) : _0x1c2a48(_0x1b02b8[_0x23662f(0x3e4)]), _0x22a7ad = _0x1b02b8['recipientId'] === _0x5cb17e(_0x2aa90d['activeChatId'])['id'] ? _0x5cb17e(_0x2aa90d[_0x23662f(0x544)]) : _0x1c2a48(_0x1b02b8['recipientId']), _0x2bd193 = _0x109e32?.[_0x23662f(0x2a5)] ? _0x109e32[_0x23662f(0x2a5)] + _0x23662f(0x1ec) : '转账', _0x41f8d5 = _0x22a7ad?.[_0x23662f(0x2a5)] ? _0x23662f(0x803) + _0x22a7ad[_0x23662f(0x2a5)] : '转账', _0x1397c3 = _0x23662f(0x28b) + _0x2bd193 + _0x23662f(0x5a4) + _0x1b02b8[_0x23662f(0x71a)]['toFixed'](0x2) + '</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22transfer-recipient\x22>' + _0x41f8d5 + _0x23662f(0x74c); _0x3b23c1[_0x23662f(0x862)] = _0x1397c3; } else { if (_0x1b02b8[_0x23662f(0x5b4)] === _0x23662f(0x81d)) { _0x3b23c1['classList'][_0x23662f(0x737)](_0x23662f(0x5f7)); const _0x5ca9b4 = document[_0x23662f(0x1a2)](_0x23662f(0x642)); _0x5ca9b4[_0x23662f(0x399)] = 'listen-together-card', _0x5ca9b4['classList'][_0x23662f(0x737)](_0x23662f(0x6ef)); const _0x1757a4 = _0x1b02b8[_0x23662f(0x619)] === _0x23662f(0x821) ? _0x5cb17e(_0x2aa90d[_0x23662f(0x544)])[_0x23662f(0x2a5)] || '你' : _0x1c2a48(_0x1b02b8[_0x23662f(0x3e4)])?.[_0x23662f(0x2a5)] || 'TA', _0x37fa56 = _0x1b02b8[_0x23662f(0x6ca)] || _0x12a7cc; _0x1b02b8[_0x23662f(0x400)] ? _0x5ca9b4[_0x23662f(0x862)] = _0x23662f(0x241) + _0x37fa56 + _0x23662f(0x426) + _0x1b02b8[_0x23662f(0x879)] + _0x23662f(0x192) + _0x1b02b8['artist'] + _0x23662f(0x248) : _0x5ca9b4['innerHTML'] = _0x23662f(0x716) + _0x1757a4 + _0x23662f(0x41e) + _0x37fa56 + _0x23662f(0x82d) + _0x1b02b8[_0x23662f(0x879)] + _0x23662f(0x539) + _0x1b02b8['artist'] + '</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22listen-together-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22listen-together-accept-btn\x22\x20data-song-id=\x22' + _0x1b02b8['songId'] + _0x23662f(0x4bb), _0x3b23c1[_0x23662f(0x185)](_0x5ca9b4); } else { if (_0x1b02b8[_0x23662f(0x5b4)] === _0x23662f(0x5f7) && _0x1b02b8[_0x23662f(0x879)]) { _0x3b23c1[_0x23662f(0x2f1)][_0x23662f(0x737)](_0x23662f(0x5f7)); const _0xbcf71b = document[_0x23662f(0x1a2)](_0x23662f(0x642)); _0xbcf71b[_0x23662f(0x399)] = 'music-share-card', _0xbcf71b[_0x23662f(0x55a)][_0x23662f(0x5e0)] = _0x23662f(0x73b) + _0x1b02b8['timestamp'], _0xbcf71b[_0x23662f(0x862)] = _0x23662f(0x4d1) + (_0x1b02b8[_0x23662f(0x6ca)] || _0x12a7cc) + _0x23662f(0x24d) + _0x1b02b8['songName'] + '</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22artist\x22>' + _0x1b02b8['artist'] + _0x23662f(0x568) + (_0x1b02b8['playableUrl'] ? '▶' : '⚠') + _0x23662f(0x78e), _0x1b02b8[_0x23662f(0x419)] && _0xbcf71b['addEventListener'](_0x23662f(0x3e9), function () { const _0x4dd3ef = _0x23662f, _0x4fbc84 = { 'id': _0x4dd3ef(0x73b) + _0x1b02b8[_0x4dd3ef(0x602)], 'url': _0x1b02b8[_0x4dd3ef(0x419)] }; _0x4f4d66(this, _0x4fbc84); }), _0x3b23c1['appendChild'](_0xbcf71b); } else { if (_0x2f8d50) { const _0x34be58 = document['createElement']('p'); _0x34be58[_0x23662f(0x7ea)] = _0x2f8d50, _0x34be58[_0x23662f(0x3c9)][_0x23662f(0x14e)] = '0', _0x3b23c1[_0x23662f(0x185)](_0x34be58); } } } } } } _0x36610d === _0x23662f(0x821) ? (_0x3bf57d[_0x23662f(0x185)](_0x3b23c1), _0x3bf57d[_0x23662f(0x185)](_0x306234)) : (_0x3bf57d[_0x23662f(0x185)](_0x306234), _0x3bf57d['appendChild'](_0x3b23c1)); } } _0x49c285[_0x23662f(0x185)](_0x3bf57d); const _0x230d82 = document[_0x23662f(0x1a2)]('div'); return _0x230d82[_0x23662f(0x399)] = _0x23662f(0x602), _0x230d82['textContent'] = _0xe98c0f(_0x1b02b8[_0x23662f(0x602)]), _0x49c285['appendChild'](_0x230d82), _0x216c2d['appendChild'](_0x49c285), _0x49c285; } } document[_0x12f887(0x49f)](_0x12f887(0x475))[_0x12f887(0x179)]('click', _0x8cb3cf); let _0x309bbc = null, _0x4228c1 = null; function _0x8cb3cf(_0x5aaab2) { const _0x1e4750 = _0x12f887; if (window[_0x1e4750(0x7d6)]()[_0x1e4750(0x630)]()) return; const _0x2b07c1 = _0x5aaab2['target'][_0x1e4750(0x6ce)](_0x1e4750(0x3e0)), _0xd0343f = _0x5aaab2[_0x1e4750(0x232)][_0x1e4750(0x6ce)](_0x1e4750(0x150)); if (!_0x2b07c1 || _0xd0343f) return; const _0x315ee3 = parseInt(_0x2b07c1['dataset'][_0x1e4750(0x18a)], 0xa); if (isNaN(_0x315ee3)) return; _0x294563(_0x315ee3); } function _0x1d0e4a() { const _0x2158af = _0x12f887, _0x12c4b3 = _0x4adf1c(); if (!_0x12c4b3) { if (_0x2158af(0x61a) !== 'nlIqM') _0xe77175[_0x2158af(0x751)] = _0x588d0c, _0x439e23(), _0x1d0116(); else { _0x2f4bba[_0x2158af(0x7ea)] = _0x2158af(0x3e2); return; } } if (_0x12c4b3[_0x2158af(0x5b4)] === _0x2158af(0x23d)) { const _0x185584 = _0x1c2a48(_0x12c4b3[_0x2158af(0x6ec)][0x0]); _0x2f4bba['textContent'] = _0x185584 ? _0x185584[_0x2158af(0x2a5)] : _0x2158af(0x3ee); } else _0x2f4bba['textContent'] = _0x12c4b3[_0x2158af(0x2a5)] || _0x2158af(0x858) + _0x12c4b3[_0x2158af(0x6ec)]['length'] + ')'; } function _0x5a7603(_0x45329e) { const _0x1675e7 = _0x12f887, _0x2024d7 = document[_0x1675e7(0x4b0)](_0x1675e7(0x84b)); if (_0x2024d7 && (_0x2024d7['id'] === _0x1675e7(0x175) || _0x2024d7['id'] === 'chat-screen')) _0x2215cd(); else { const _0x406268 = document['querySelectorAll'](_0x1675e7(0x567)); _0x406268[_0x1675e7(0x242)](_0x2c14f1 => _0x2c14f1['remove']()); } } function _0x5c846b() { const _0xe7448 = _0x12f887; _0x2aa90d[_0xe7448(0x784)] && _0x2aa90d['currentAbortController'] && (_0xe7448(0x408) !== _0xe7448(0x21a) ? (console[_0xe7448(0x23c)]('用户操作中断了\x20AI\x20响应。'), _0x2aa90d[_0xe7448(0x654)]['abort'](_0xe7448(0x834)), _0x2aa90d['currentAbortController'] = null) : _0x47a7e6['worldBooks'] = _0x5d8035['worldBooks']), _0x2aa90d['isGenerating'] = ![], _0x5a7603(![]); } function _0x4adf1c() { const _0x1b537c = _0x12f887; return _0x2aa90d[_0x1b537c(0x22e)][_0x1b537c(0x349)](_0x25c0b8 => _0x25c0b8['id'] === _0x2aa90d[_0x1b537c(0x544)]); } function _0x1c2a48(_0x364d96) { const _0x1889e7 = _0x12f887; return _0x2aa90d[_0x1889e7(0x857)][_0x1889e7(0x349)](_0x449055 => _0x449055['id'] === _0x364d96); } function _0x5918e0(_0x371579) { const _0x26ee86 = _0x12f887; if ('yidFp' !== _0x26ee86(0x466)) _0x4b2fc7 = _0x422c30['image']; else { _0x2aa90d[_0x26ee86(0x857)] = _0x2aa90d[_0x26ee86(0x857)][_0x26ee86(0x747)](_0x36d6df => _0x36d6df['id'] !== _0x371579), _0x2aa90d['chats'][_0x26ee86(0x242)](_0x5ca95f => { const _0x319d3d = _0x26ee86; _0x5ca95f[_0x319d3d(0x5b4)] === 'group' && ('AXhbc' !== _0x319d3d(0x692) ? _0x320d56('错误:\x20' + _0x22ccbc[_0x319d3d(0x4c4)]) : _0x5ca95f['participantIds'] = _0x5ca95f['participantIds'][_0x319d3d(0x747)](_0x3c86d2 => _0x3c86d2 !== _0x371579)); }); const _0x29c101 = _0x2aa90d[_0x26ee86(0x22e)][_0x26ee86(0x349)](_0x607915 => _0x607915['type'] === 'private' && _0x607915[_0x26ee86(0x6ec)][_0x26ee86(0x761)](_0x371579)); _0x29c101 && _0x134555(_0x29c101['id']), _0x2aa90d[_0x26ee86(0x22e)] = _0x2aa90d[_0x26ee86(0x22e)][_0x26ee86(0x747)](_0xf592b6 => _0xf592b6['type'] !== _0x26ee86(0x67a) || _0xf592b6[_0x26ee86(0x6ec)][_0x26ee86(0x45b)] > 0x1), _0x16a7ea(), _0xd101b6(); } } function _0x134555(_0x533ea9) { const _0x4f0506 = _0x12f887; if (_0x4f0506(0x609) === 'XiLVJ') _0x32a0f1[_0x4f0506(0x399)] = 'narrator', _0x6f2a1b['style'][_0x4f0506(0x1ed)] = _0x4f0506(0x699), _0x6af46f[_0x4f0506(0x3c9)][_0x4f0506(0x416)] = _0x4f0506(0x882), _0x358cb3[_0x4f0506(0x862)] = _0x48fbe0; else { _0x2aa90d[_0x4f0506(0x22e)] = _0x2aa90d[_0x4f0506(0x22e)][_0x4f0506(0x747)](_0x49467d => _0x49467d['id'] !== _0x533ea9); try { localStorage[_0x4f0506(0x509)](_0x4f0506(0x224) + _0x533ea9); } catch (_0xf81de1) { _0x4f0506(0x85b) !== _0x4f0506(0x85b) ? _0xbb0835[_0x4f0506(0x20c)]() : console[_0x4f0506(0x6eb)](_0x4f0506(0x583) + _0x533ea9, _0xf81de1); } _0x2aa90d[_0x4f0506(0x544)] === _0x533ea9 && (_0x2aa90d['activeChatId'] = _0x2aa90d['chats'][0x0]?.['id'] || null, _0x4762b7(_0x2aa90d[_0x4f0506(0x544)])), _0x16a7ea(), _0xd101b6(); } } async function _0x4762b7(_0x3e28c0) { const _0x2cf8ce = _0x12f887; _0x2aa90d['activeChatId'] !== _0x3e28c0 && (_0x5c846b(), _0x2aa90d[_0x2cf8ce(0x176)] = 0x64); if (!_0x3e28c0) { if (_0x2cf8ce(0x6ad) === _0x2cf8ce(0x3b7)) _0x5f166e = _0x2f2016; else { _0x2aa90d['activeChatId'] = null, _0x16a7ea(), _0x4cb79b(![]), document[_0x2cf8ce(0x49f)](_0x2cf8ce(0x445))[_0x2cf8ce(0x3c9)][_0x2cf8ce(0x482)] = ''; return; } } _0x2aa90d[_0x2cf8ce(0x544)] = _0x3e28c0, _0x16a7ea(), _0x1d0e4a(), _0x216c2d[_0x2cf8ce(0x862)] = '', _0x9d4a2d(!![], '稍微有点卡了，可以尝试清空聊天记录了！记得总结丢世界书'), setTimeout(async () => { const _0x169d2d = _0x2cf8ce; try { if (_0x169d2d(0x3e1) === 'vjWtu') { _0x28a59e(); const _0x1f56de = _0x4adf1c(), _0x52fe3a = document[_0x169d2d(0x49f)](_0x169d2d(0x445)); let _0x37904d = null; if (_0x1f56de) { if (_0x169d2d(0x62d) === _0x169d2d(0x462)) return { 'type': _0x169d2d(0x740), 'content': _0x217fc5 }; else { if (_0x1f56de[_0x169d2d(0x5b4)] === _0x169d2d(0x23d)) { if (_0x169d2d(0x752) !== 'jASet') return new _0x59869f(_0x56e618 => { const _0x2f1d65 = _0x169d2d, _0x24ccbb = _0x2f1d65(0x46a); _0x1c424d[_0x2f1d65(0x546)][_0x2f1d65(0x88a)](_0x2f1d65(0x307), _0x24ccbb); const _0x25e99b = _0x1a2b97[_0x2f1d65(0x49f)](_0x2f1d65(0x221)), _0x1ea161 = _0x16758f['getElementById']('diary-modal-textarea'), _0x241e8d = _0x32cfa8['getElementById'](_0x2f1d65(0x865)), _0x3116ee = _0x1bb026[_0x2f1d65(0x49f)](_0x2f1d65(0x1f5)), _0x244f0a = _0x25e99b[_0x2f1d65(0x4b0)](_0x2f1d65(0x6a6)), _0x53cdb4 = () => { const _0x18c506 = _0x2f1d65; _0x25e99b[_0x18c506(0x231)](), _0x56e618(); }; _0x241e8d[_0x2f1d65(0x56a)] = () => { const _0x2d21e5 = _0x2f1d65; _0x37ebc7(_0x1ea161[_0x2d21e5(0x5da)]), _0x53cdb4(); }, _0x3116ee[_0x2f1d65(0x56a)] = _0x53cdb4, _0x244f0a[_0x2f1d65(0x56a)] = _0x53cdb4; }); else { const _0x3f202c = _0x1f56de[_0x169d2d(0x6ec)][0x0]; _0xe9f495(_0x3f202c), _0x37904d = await _0x33b931(_0x169d2d(0x428) + _0x3f202c); } } else _0x37904d = await _0x33b931(_0x169d2d(0x5c6) + _0x1f56de['id']); _0x37904d ? _0x169d2d(0x2da) !== _0x169d2d(0x2da) ? (_0x58bb9f(), _0x4d3b84(_0x169d2d(0x698), _0x169d2d(0x5d1))) : (_0x52fe3a[_0x169d2d(0x3c9)][_0x169d2d(0x482)] = _0x169d2d(0x7bc) + URL[_0x169d2d(0x52d)](_0x37904d) + '\x27)', _0x52fe3a[_0x169d2d(0x3c9)]['backgroundSize'] = 'cover', _0x52fe3a['style'][_0x169d2d(0x286)] = 'center') : _0x169d2d(0x409) === _0x169d2d(0x415) ? _0x427d9f(_0x4fe455) : _0x52fe3a['style'][_0x169d2d(0x482)] = ''; } } _0x42745f(); } else _0x511ad5(_0x2267ef['activeMeetingCharId'], _0x475f8c['emotion']); } catch (_0xf91b48) { console['error'](_0x169d2d(0x365), _0xf91b48), _0x5d65f5(_0x169d2d(0x246) + _0xf91b48['message']); } finally { if (_0x169d2d(0x85f) === _0x169d2d(0x160)) { if (!_0x2aa842[_0x169d2d(0x607)]) return _0x14e68d[_0x169d2d(0x47c)][_0x169d2d(0x349)](_0xd49cc4 => _0xd49cc4['id'] === _0x2f7ee4['activeUserProfileId']) || _0x9f86f8[_0x169d2d(0x47c)][0x0]; const _0x5a970b = _0x2e3ca0['chats'][_0x169d2d(0x349)](_0x55ddae => _0x55ddae[_0x169d2d(0x5b4)] === _0x169d2d(0x23d) && _0x55ddae['participantIds'][_0x169d2d(0x761)](_0x1539bf[_0x169d2d(0x607)])), _0x4ac4ac = _0x5a970b?.[_0x169d2d(0x412)] || _0x56f1f8[_0x169d2d(0x4f4)]; return _0x536cf8[_0x169d2d(0x47c)][_0x169d2d(0x349)](_0x1e96f4 => _0x1e96f4['id'] === _0x4ac4ac) || _0x487254[_0x169d2d(0x47c)][0x0]; } else _0x9d4a2d(![]); } }, 0x32); } async function _0x57b1f5() { const _0x17c69a = _0x12f887; if (_0x17c69a(0x59c) === _0x17c69a(0x59c)) { if (_0x2aa90d['isGenerating']) { if (_0x17c69a(0x726) !== 'COFBA') { if (!_0x46890c) return []; const _0x4c772a = _0x18f17f['split']('\x0a'), _0x331c46 = [], _0x3a111c = /\[(\d{2}):(\d{2})\.(\d{2,3})\]/; for (const _0x47ab17 of _0x4c772a) { const _0x1a6ac0 = _0x47ab17[_0x17c69a(0x85a)](_0x3a111c); if (_0x1a6ac0) { const _0x56113d = _0x7898b7(_0x1a6ac0[0x1], 0xa), _0x2d3f4c = _0x3acf35(_0x1a6ac0[0x2], 0xa), _0x488b0a = _0x23cd43(_0x1a6ac0[0x3], 0xa) * (_0x1a6ac0[0x3][_0x17c69a(0x45b)] === 0x2 ? 0xa : 0x1), _0x3b2a30 = _0x56113d * 0x3c + _0x2d3f4c + _0x488b0a / 0x3e8, _0x1f1b41 = _0x47ab17['replace'](_0x3a111c, '')['trim'](); _0x1f1b41 && _0x331c46[_0x17c69a(0x249)]({ 'time': _0x3b2a30, 'text': _0x1f1b41 }); } } return _0x331c46; } else { _0x5d65f5(_0x17c69a(0x45c)); return; } } const _0xfc4a80 = _0x2aa90d[_0x17c69a(0x7f2)]; if (_0xfc4a80[_0x17c69a(0x45b)] === 0x0) return; let _0x5a501c = -0x1; for (let _0x3a236e = _0xfc4a80[_0x17c69a(0x45b)] - 0x1; _0x3a236e >= 0x0; _0x3a236e--) { if (_0xfc4a80[_0x3a236e][_0x17c69a(0x619)] === _0x17c69a(0x821)) { _0x5a501c = _0x3a236e; break; } } if (_0x5a501c === -0x1 || _0x5a501c === _0xfc4a80['length'] - 0x1) { _0x5d65f5(_0x17c69a(0x680)); return; } _0xfc4a80[_0x17c69a(0x6d3)](_0x5a501c + 0x1), _0x3c149c(), _0x2215cd(), setTimeout(() => { _0x5c969b(); }, 0x64); } else { const _0x5ba706 = _0x377bba(_0x128efa[_0x17c69a(0x751)] ?? _0x56a1d0[_0x17c69a(0x740)] ?? _0x2f93ee[_0x17c69a(0x4c4)] ?? '')[_0x17c69a(0x2fe)](); if (_0x5ba706) _0x50dbce[_0x17c69a(0x16a)][_0x17c69a(0x249)]({ 'senderId': _0x762a09['id'], 'kind': 'text', 'content': _0x5ba706 }); } } function _0x48b971(_0x1dc837 = null) { const _0x420b6f = _0x12f887; if (_0x420b6f(0x223) === 'rCPVY') _0x16dd7d[_0x420b6f(0x2eb)][_0x420b6f(0x63d)] = _0x3f8106[_0x420b6f(0x5f2)], _0x4d032e(), _0x37f2e7(); else { const _0x223961 = _0x1dc837 ?? _0x2fefe8[_0x420b6f(0x5da)][_0x420b6f(0x2fe)](); if (_0x223961 === '' || !_0x2aa90d[_0x420b6f(0x544)]) return; const _0x28a4b4 = document['querySelector'](_0x420b6f(0x84b)), _0x319ce7 = _0x28a4b4['id'] === _0x420b6f(0x175), _0x43f8f0 = { 'role': _0x420b6f(0x821), 'content': _0x223961, 'timestamp': Date[_0x420b6f(0x24a)](), 'isOffline': _0x319ce7 }; _0x2aa90d[_0x420b6f(0x167)] && (_0x43f8f0[_0x420b6f(0x7a0)] = { ..._0x2aa90d['activeQuote'] }); _0x2aa90d[_0x420b6f(0x7f2)][_0x420b6f(0x249)](_0x43f8f0), _0x3c149c(), _0x2215cd(); if (!_0x1dc837) { if (_0x420b6f(0x4b5) === _0x420b6f(0x4b5)) _0x2fefe8[_0x420b6f(0x5da)] = ''; else { _0x7676ec['activeMeetingScriptQueue'] = _0x385143, _0x1d7c0c[_0x420b6f(0x4ca)][_0x5dbc4c['id']] = [..._0x407054], _0x112f92(); const _0x4a95ab = _0x462ca0['map'](_0x227a88 => _0x227a88[_0x420b6f(0x712)] === _0x420b6f(0x55c) ? _0x227a88[_0x420b6f(0x591)] : _0x227a88[_0x420b6f(0x712)] + ':\x20' + _0x227a88[_0x420b6f(0x591)])[_0x420b6f(0x4c2)]('\x0a\x0a'); _0x363d2f[_0x420b6f(0x7f2)]['push']({ 'role': 'assistant', 'senderId': _0x1a41d6['id'], 'timestamp': _0x28b5f6[_0x420b6f(0x24a)](), 'isOffline': !![], 'content': _0x4a95ab }); } } _0xc21e75(); } } function _0x38dd09(_0x17ace2) { const _0x3e8553 = _0x12f887; if (!_0x17ace2 || !_0x2aa90d[_0x3e8553(0x544)]) return; const _0x5738c9 = { 'role': _0x3e8553(0x821), 'content': '[用户发送了表情：' + _0x17ace2[_0x3e8553(0x2a5)] + ']', 'displayUrl': _0x17ace2[_0x3e8553(0x5ce)], 'timestamp': Date['now']() }; _0x2aa90d[_0x3e8553(0x7f2)][_0x3e8553(0x249)](_0x5738c9), _0x28439d(_0x5738c9, _0x2aa90d[_0x3e8553(0x7f2)]['length'] - 0x1), _0x3c149c(), _0x37cbde[_0x3e8553(0x2f1)][_0x3e8553(0x231)](_0x3e8553(0x557)); } async function _0x601592(_0x539b4e) { const _0xc12efa = _0x12f887; if (_0xc12efa(0x5ec) === _0xc12efa(0x5ec)) { const _0x332dd7 = _0x539b4e['target'][_0xc12efa(0x7a2)][0x0]; if (!_0x332dd7 || !_0x2aa90d[_0xc12efa(0x544)]) return; _0x9d4a2d(!![], _0xc12efa(0x4dd)); try { const _0x2f8f87 = await _0x52a43d(_0x332dd7, 0x320, 0.8, !![]), _0x211cb3 = _0xc12efa(0x364) + Date[_0xc12efa(0x24a)](); await _0x19d8b8(_0x211cb3, _0x2f8f87); const _0x625247 = _0x2fefe8[_0xc12efa(0x5da)][_0xc12efa(0x2fe)](); _0x2fefe8[_0xc12efa(0x5da)] = ''; const _0x293b5f = { 'role': 'user', 'content': _0x625247, 'imageId': _0x211cb3, 'timestamp': Date['now']() }; _0x2aa90d[_0xc12efa(0x7f2)]['push'](_0x293b5f), _0x28439d(_0x293b5f, _0x2aa90d[_0xc12efa(0x7f2)][_0xc12efa(0x45b)] - 0x1), _0x3c149c(); } catch (_0x4bc72e) { if ('ZZGhH' === _0xc12efa(0x501)) { _0x3d8746(_0xc12efa(0x449)); return; } else _0x5d65f5(_0xc12efa(0x3c8) + _0x4bc72e[_0xc12efa(0x4c4)]); } finally { _0x9d4a2d(![]), _0x539b4e[_0xc12efa(0x232)]['value'] = ''; } } else { const _0x5ea5bb = _0x528ec0[_0xc12efa(0x1a2)]('li'); _0x5ea5bb[_0xc12efa(0x399)] = _0xc12efa(0x1d2), _0x5ea5bb['innerHTML'] = _0xc12efa(0x65f) + _0x2fdfb6['id'] + '\x22\x20data-id=\x22' + _0x1f2610['id'] + '\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22' + (_0x178773[_0xc12efa(0x5c4)] || _0x27bfb5) + _0xc12efa(0x74f) + _0x6b8d62['id'] + '\x22\x20class=\x22char-name\x22>' + _0x2938fb[_0xc12efa(0x2a5)] + '</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20', _0x112870['appendChild'](_0x5ea5bb); } } async function _0x46ab06() { const _0x71abf8 = _0x12f887; if (!_0x2aa90d[_0x71abf8(0x544)]) return; const _0x56831f = await _0x396d49(); if (!_0x56831f) return; _0x5d65f5(_0x71abf8(0x4d5)); try { const _0x1c9820 = await _0x2ff291(_0x56831f[_0x71abf8(0x879)], _0x56831f['artist']); let _0x75716f = _0x1c9820[_0x71abf8(0x4ad)]; if (_0x1c9820[_0x71abf8(0x4ad)] && _0x1c9820['cover']['startsWith'](_0x71abf8(0x491))) try { if ('EVXEn' !== _0x71abf8(0x682)) { const _0x1d7a8d = await fetch(_0x1c9820[_0x71abf8(0x4ad)]), _0x20399f = await _0x1d7a8d['blob'](); _0x75716f = await _0x59aa76(_0x20399f); } else { if (!_0x14a18e) return ''; const _0x26b11b = new _0x10eae5(_0xe73383), _0x1798bc = _0x22b033(_0x26b11b[_0x71abf8(0x4a4)]())[_0x71abf8(0x2a3)](0x2, '0'), _0x2d01be = _0x907403(_0x26b11b[_0x71abf8(0x7eb)]())[_0x71abf8(0x2a3)](0x2, '0'); return _0x1798bc + ':' + _0x2d01be; } } catch (_0x29ed66) { console[_0x71abf8(0x6eb)]('下载并转换网络封面失败:', _0x29ed66), _0x75716f = _0x12a7cc; } const _0x1a20fb = { 'role': _0x71abf8(0x821), 'type': _0x71abf8(0x5f7), 'content': _0x71abf8(0x227) + _0x56831f['songName'] + _0x71abf8(0x820) + _0x56831f[_0x71abf8(0x347)] + ']', 'songName': _0x56831f[_0x71abf8(0x879)], 'artist': _0x56831f['artist'], 'coverUrl': _0x75716f, 'playableUrl': _0x1c9820[_0x71abf8(0x5ce)], 'timestamp': Date[_0x71abf8(0x24a)]() }; _0x2aa90d[_0x71abf8(0x7f2)][_0x71abf8(0x249)](_0x1a20fb), _0x28439d(_0x1a20fb, _0x2aa90d['conversationHistory'][_0x71abf8(0x45b)] - 0x1), _0x3c149c(); } catch (_0x1d2fc0) { _0x71abf8(0x478) !== 'hOyXz' ? (console[_0x71abf8(0x6eb)](_0x71abf8(0x6b5), _0x1d2fc0), _0x5d65f5(_0x71abf8(0x27f) + _0x1d2fc0[_0x71abf8(0x4c4)])) : (_0x4142f9 = _0x71abf8(0x3ee), _0x3ceb81 = _0x71abf8(0x83c)); } } function _0x5bb6d6(_0x2c0fd7, _0x548f03 = 0x78) { const _0x3baf39 = _0x12f887; if (_0x3baf39(0x41a) === _0x3baf39(0x666)) _0x435a33[_0x3baf39(0x862)] = '', _0x3e0c0e[_0x3baf39(0x242)](_0x5c79f5 => { const _0x264804 = _0x3baf39, _0x2a46b3 = _0x5e90cc[_0x264804(0x1a2)](_0x264804(0x642)); _0x2a46b3[_0x264804(0x7ea)] = _0x5c79f5, _0x2a46b3[_0x264804(0x179)](_0x264804(0x3e9), () => { const _0x164cd2 = _0x264804; _0x3764d4[_0x164cd2(0x5da)] = _0x5c79f5, _0x532ad8[_0x164cd2(0x2f1)][_0x164cd2(0x231)](_0x164cd2(0x557)); }), _0x57ff4b[_0x264804(0x185)](_0x2a46b3); }), _0x580ab2[_0x3baf39(0x2f1)][_0x3baf39(0x737)]('show'), _0xd68275(_0x3baf39(0x5cb) + _0x2794d4['length'] + _0x3baf39(0x49a)); else { const _0x5e26ce = _0x55a995 => { const _0x1f4957 = _0x3baf39; if (_0x55a995[_0x1f4957(0x619)] === _0x1f4957(0x821)) return _0x2aa90d[_0x1f4957(0x585)]?.[_0x1f4957(0x2a5)] || 'User'; if (_0x55a995[_0x1f4957(0x3e4)]) { const _0x134112 = _0x1c2a48(_0x55a995[_0x1f4957(0x3e4)]); return _0x134112?.['name'] || _0x1f4957(0x2e6); } if (_0x2c0fd7?.[_0x1f4957(0x5b4)] === _0x1f4957(0x23d)) { const _0x2dc1ec = _0x1c2a48(_0x2c0fd7[_0x1f4957(0x6ec)][0x0]); return _0x2dc1ec?.[_0x1f4957(0x2a5)] || 'AI'; } return _0x1f4957(0x1b4); }, _0x58bbae = _0x2aa90d['conversationHistory'][_0x3baf39(0x830)](-_0x548f03), _0x48f77d = []; for (const _0x2a411f of _0x58bbae) { if (_0x2a411f[_0x3baf39(0x626)]) _0x48f77d['push']('[' + _0x5e26ce(_0x2a411f) + _0x3baf39(0x282) + (_0x2a411f[_0x3baf39(0x751)]?.[_0x3baf39(0x85a)](/：(.+?)]/)?.[0x1] || '表情') + ']'); else { if (_0x2a411f[_0x3baf39(0x33c)]) { const _0x4cc5b9 = _0x2a411f['content'] ? '\x20' + _0x2a411f[_0x3baf39(0x751)] : ''; _0x48f77d[_0x3baf39(0x249)]('[' + _0x5e26ce(_0x2a411f) + _0x3baf39(0x70f) + _0x4cc5b9); } else _0x2a411f[_0x3baf39(0x751)] && _0x48f77d[_0x3baf39(0x249)]('[' + _0x5e26ce(_0x2a411f) + ']\x20' + _0x2a411f[_0x3baf39(0x751)]); } } return _0x48f77d[_0x3baf39(0x4c2)]('\x0a'); } } function _0x4a9a00(_0x2b6f5b, _0x56f3f7) { const _0x351875 = _0x12f887; if ('ntEPZ' !== 'ntEPZ') _0x325ccf = _0x52f076[_0x351875(0x47c)][0x0]; else { if (!_0x2b6f5b || !_0x56f3f7) return null; const _0xb45ba3 = _0x56f3f7[_0x351875(0x85a)](/@([^\s:：,，。!?]+)/); if (!_0xb45ba3) return null; const _0x3f24c1 = _0xb45ba3[0x1][_0x351875(0x59e)](); for (const _0x2277a3 of _0x2b6f5b['participantIds']) { if (_0x351875(0x868) !== _0x351875(0x63e)) { const _0x40246f = _0x1c2a48(_0x2277a3); if (!_0x40246f?.[_0x351875(0x2a5)]) continue; if (_0x40246f[_0x351875(0x2a5)][_0x351875(0x59e)]() === _0x3f24c1) return _0x40246f; if (_0x40246f[_0x351875(0x2a5)]['toLowerCase']()['startsWith'](_0x3f24c1)) return _0x40246f; } else { const _0x197d40 = _0x356816['open'](_0x2fdb0c, 0x2); _0x197d40[_0x351875(0x1cf)] = () => _0x4b9d6e(_0x351875(0x3f4)), _0x197d40['onsuccess'] = () => _0x369c14(_0x197d40[_0x351875(0x4d0)]), _0x197d40[_0x351875(0x66b)] = _0x5d7df4 => { const _0x5607df = _0x351875, _0x2b303a = _0x5d7df4[_0x5607df(0x232)][_0x5607df(0x4d0)]; !_0x2b303a['objectStoreNames'][_0x5607df(0x6a9)](_0x2a378a) && _0x2b303a['createObjectStore'](_0x4982dd, { 'keyPath': 'id' }), !_0x2b303a[_0x5607df(0x32f)][_0x5607df(0x6a9)](_0x5607df(0x184)) && _0x2b303a['createObjectStore']('music_library', { 'keyPath': 'id' }); }; } } return null; } } function _0x59c28d(_0x1be3d5) { const _0x472ade = _0x12f887, _0x46f43c = _0x1be3d5[_0x472ade(0x540)]('{'), _0x65a81b = _0x1be3d5[_0x472ade(0x2ee)]('}'); if (_0x46f43c >= 0x0 && _0x65a81b > _0x46f43c) return _0x1be3d5[_0x472ade(0x830)](_0x46f43c, _0x65a81b + 0x1); return _0x1be3d5; } function _0x5497d4(_0x4c82fa, _0x18640d, _0x4a44bc) { const _0x4a22d9 = _0x12f887; if (_0x4a22d9(0x291) !== 'srnRX') _0x21a909[_0x4a22d9(0x7ea)] = _0xfcfc9[_0x4a22d9(0x712)] === _0x4a22d9(0x55c) ? '旁白' : _0x198c5f[_0x4a22d9(0x712)], _0x1351f9['textContent'] = _0x45fcb0[_0x4a22d9(0x591)], _0x488703[_0x4a22d9(0x712)] === _0x1a12f2[_0x4a22d9(0x2a5)] ? _0x33bc7a(_0xce4189, _0x242a1b[_0x4a22d9(0x791)]) : _0x30ab4f(_0x4c49b2, _0x4a22d9(0x76c)); else { const _0x5a385f = new Map(_0x18640d[_0x4a22d9(0x511)](_0x3244e8 => [String(_0x3244e8['id']), _0x3244e8])), _0x377243 = _0x4fc661 => String(_0x4fc661 || '')[_0x4a22d9(0x59e)]()[_0x4a22d9(0x23b)](/\s+/g, ''), _0x41fd43 = new Map(_0x18640d['map'](_0x4cd327 => [_0x377243(_0x4cd327[_0x4a22d9(0x2a5)]), _0x4cd327])), _0xbcefe7 = new Set(_0x4a44bc), _0x538ee6 = { 'events': [] }; for (const _0x9275f of _0x4c82fa?.[_0x4a22d9(0x16a)] || []) { const _0x38c7a1 = _0x9275f[_0x4a22d9(0x3e4)] ?? _0x9275f[_0x4a22d9(0x658)] ?? _0x9275f[_0x4a22d9(0x634)] ?? _0x9275f[_0x4a22d9(0x712)] ?? _0x9275f[_0x4a22d9(0x619)] ?? _0x9275f[_0x4a22d9(0x2a5)]; if (!_0x38c7a1) continue; let _0x5e0e09 = _0x5a385f['get'](String(_0x38c7a1)) || _0x41fd43[_0x4a22d9(0x799)](_0x377243(_0x38c7a1)); if (!_0x5e0e09) continue; const _0x49b6d6 = (_0x9275f[_0x4a22d9(0x41f)] || _0x9275f[_0x4a22d9(0x5b4)] || _0x4a22d9(0x740))['toLowerCase'](); if (_0x49b6d6 === _0x4a22d9(0x547)) { const _0x2099a3 = (_0x9275f[_0x4a22d9(0x547)] ?? _0x9275f[_0x4a22d9(0x4e6)] ?? _0x9275f[_0x4a22d9(0x844)] ?? _0x9275f[_0x4a22d9(0x326)])?.[_0x4a22d9(0x2fe)](); if (_0x2099a3 && _0xbcefe7[_0x4a22d9(0x825)](_0x2099a3)) _0x4a22d9(0x3dc) === _0x4a22d9(0x5d4) ? _0xe0b886 > _0x6eaea8 && (_0x3966e8 *= _0x260a95 / _0x456b1e, _0x273642 = _0x39b392) : _0x538ee6[_0x4a22d9(0x16a)][_0x4a22d9(0x249)]({ 'senderId': _0x5e0e09['id'], 'kind': 'sticker', 'sticker': _0x2099a3 }); else { if ('WLRtR' !== 'wGYmO') { const _0xf2496f = String(_0x9275f[_0x4a22d9(0x751)] ?? _0x9275f[_0x4a22d9(0x740)] ?? '')[_0x4a22d9(0x2fe)]() || '[sticker:' + (_0x2099a3 || _0x4a22d9(0x618)) + ']'; if (_0xf2496f) _0x538ee6['events'][_0x4a22d9(0x249)]({ 'senderId': _0x5e0e09['id'], 'kind': 'text', 'content': _0xf2496f }); } else _0x4c80fe[_0x4a22d9(0x7ea)] = '▶'; } } else { const _0x5b5046 = String(_0x9275f[_0x4a22d9(0x751)] ?? _0x9275f['text'] ?? _0x9275f[_0x4a22d9(0x4c4)] ?? '')[_0x4a22d9(0x2fe)](); if (_0x5b5046) _0x538ee6['events']['push']({ 'senderId': _0x5e0e09['id'], 'kind': _0x4a22d9(0x740), 'content': _0x5b5046 }); } } return _0x538ee6; } } async function _0x298e5a(_0x3300cf) { const _0x23ab09 = _0x12f887; if (_0x23ab09(0x67b) === 'vphYP') { if (!_0x3300cf || !Array['isArray'](_0x3300cf[_0x23ab09(0x16a)]) || _0x3300cf['events'][_0x23ab09(0x45b)] === 0x0) return; const _0x4b5b17 = _0x454750 => _0x454750 + Math['floor'](Math['random']() * 0x190); let _0x2b4914 = 0x1f4; for (const _0x506a6c of _0x3300cf[_0x23ab09(0x16a)]) { if (_0x23ab09(0x63c) !== _0x23ab09(0x63c)) _0xdae3e0 = _0x3bc3d6[_0x23ab09(0x38e)](_0x57dfe0); else { await new Promise(_0x17ebdc => setTimeout(_0x17ebdc, _0x4b5b17(_0x2b4914))), _0x2b4914 += 0x2bc; const _0x3f0c35 = _0x2aa90d[_0x23ab09(0x7f2)]['at'](-0x1)?.[_0x23ab09(0x446)] ?? ![]; if (_0x506a6c[_0x23ab09(0x41f)] === _0x23ab09(0x547)) { if (_0x23ab09(0x2f2) === _0x23ab09(0x854)) _0x4b4bbc(_0x218ee1, _0x6777f5[_0x23ab09(0x232)][_0x23ab09(0x7a2)][0x0]); else { const _0x4bd876 = _0xe0a49d[_0x23ab09(0x349)](_0x57ffca => _0x57ffca[_0x23ab09(0x2a5)] === _0x506a6c[_0x23ab09(0x547)]); if (_0x4bd876) { const _0x2c6133 = { 'role': 'assistant', 'content': _0x23ab09(0x717) + _0x4bd876[_0x23ab09(0x2a5)] + ']', 'displayUrl': _0x4bd876['url'], 'senderId': _0x506a6c[_0x23ab09(0x3e4)], 'timestamp': Date['now'](), 'isOffline': _0x3f0c35 }; _0x2aa90d['conversationHistory']['push'](_0x2c6133); } } } else { if (_0x506a6c['kind'] === _0x23ab09(0x5f7) && _0x506a6c['songName'] && _0x506a6c[_0x23ab09(0x347)]) { const { songName: _0x402ad1, artist: _0x283ad5 } = _0x506a6c, _0x338b3a = { 'role': 'assistant', 'type': 'music', 'content': '[AI分享了音乐：' + _0x402ad1 + _0x23ab09(0x820) + _0x283ad5 + ']', 'songName': _0x402ad1, 'artist': _0x283ad5, 'senderId': _0x506a6c[_0x23ab09(0x3e4)], 'timestamp': Date[_0x23ab09(0x24a)](), 'isOffline': _0x3f0c35 }; try { if ('BkBlr' === _0x23ab09(0x6ea)) _0x312187[_0x209c75][_0x23ab09(0x179)](_0x23ab09(0x3e9), () => _0x3e60c7[_0x2190bb][_0x23ab09(0x3e9)]()), _0x1cbe9b[_0x4a9713][_0x23ab09(0x179)](_0x23ab09(0x220), _0x171567 => { const _0x2d958 = _0x23ab09; _0x2eb30f(_0x3a5392, _0x171567[_0x2d958(0x232)][_0x2d958(0x7a2)][0x0]); }); else { const _0x2e9d3f = await _0x2ff291(_0x402ad1, _0x283ad5); _0x338b3a[_0x23ab09(0x6ca)] = _0x2e9d3f[_0x23ab09(0x4ad)], _0x338b3a[_0x23ab09(0x419)] = _0x2e9d3f[_0x23ab09(0x5ce)]; } } catch (_0x1ca2fd) { if ('dhDwc' === _0x23ab09(0x76b)) console[_0x23ab09(0x6eb)]('群聊音乐搜索失败\x20(' + _0x402ad1 + _0x23ab09(0x820) + _0x283ad5 + '):', _0x1ca2fd), _0x338b3a[_0x23ab09(0x6ca)] = null, _0x338b3a['playableUrl'] = null; else { const { omniText: _0xdbfaf0 } = _0x318908(_0x2b184d['id'], _0x60da2b['id']), _0x3a229e = _0x40ca64(_0x153006['id']), _0x39cd61 = _0x2d65a7[_0x23ab09(0x76f)] && _0x16028e[_0x23ab09(0x76f)][_0x23ab09(0x45b)] > 0x0 ? _0x23ab09(0x631) + _0x2b9259[_0x23ab09(0x2a5)] + _0x23ab09(0x465) + _0x12c6af[_0x23ab09(0x76f)][_0x23ab09(0x511)](_0x1860d0 => _0x2ca7fc[_0x23ab09(0x14b)][_0x23ab09(0x349)](_0x39fb22 => _0x39fb22['id'] === _0x1860d0))[_0x23ab09(0x747)](_0x580388)[_0x23ab09(0x511)](_0x4fbe50 => _0x23ab09(0x65b) + _0x4fbe50['name'] + '\x0a' + _0x4fbe50[_0x23ab09(0x751)])[_0x23ab09(0x4c2)]('') : ''; return _0x23ab09(0x3dd) + _0x59f924[_0x23ab09(0x2a5)] + _0x23ab09(0x84e) + _0x27d03a['id'] + _0x23ab09(0x157) + _0x3fc819[_0x23ab09(0x839)] + _0x23ab09(0x6aa) + _0xdbfaf0 + '\x0a' + _0x3a229e + '\x0a' + _0x39cd61; } } _0x2aa90d[_0x23ab09(0x7f2)][_0x23ab09(0x249)](_0x338b3a); } else { if (_0x506a6c[_0x23ab09(0x41f)] === 'text') { if (_0x23ab09(0x50f) !== _0x23ab09(0x358)) { const _0x35205d = _0x1c0f86(_0x506a6c[_0x23ab09(0x751)])['slice'](0x0, 0x3); for (let _0x49cd57 = 0x0; _0x49cd57 < _0x35205d[_0x23ab09(0x45b)]; _0x49cd57++) { if (_0x23ab09(0x187) === _0x23ab09(0x187)) { if (_0x49cd57 > 0x0) await new Promise(_0x10c663 => setTimeout(_0x10c663, _0x4b5b17(0x190))); const _0x332e06 = { 'role': _0x23ab09(0x4e1), 'content': _0x35205d[_0x49cd57], 'senderId': _0x506a6c[_0x23ab09(0x3e4)], 'timestamp': Date[_0x23ab09(0x24a)](), 'isOffline': _0x3f0c35 }; _0x2aa90d[_0x23ab09(0x7f2)][_0x23ab09(0x249)](_0x332e06); } else { const _0x1ec922 = _0xe4481b['characters'][_0x23ab09(0x349)](_0x13e176 => _0x6a7368[_0x23ab09(0x6ec)][_0x23ab09(0x761)](_0x13e176['id']) && _0x13e176[_0x23ab09(0x2a5)] === _0xe8b044); if (_0x1ec922) _0x4d1cf2 = _0x1ec922['id']; } } } else { const _0x55bbe8 = _0x9f849e[_0x23ab09(0x49f)](_0x23ab09(0x230)); if (!_0x55bbe8) return; const _0x43fedb = _0x4c42bb[_0x23ab09(0x70e)](_0x23ab09(0x3ec)) || '80'; _0x133cc9['documentElement']['style']['setProperty'](_0x23ab09(0x783), _0x43fedb + '%'), _0x55bbe8[_0x23ab09(0x5da)] = _0x43fedb, _0x55bbe8[_0x23ab09(0x179)]('input', () => { const _0x313c8f = _0x23ab09, _0x400987 = _0x55bbe8[_0x313c8f(0x5da)]; _0x426cb6[_0x313c8f(0x627)][_0x313c8f(0x3c9)]['setProperty']('--primary-lightness', _0x400987 + '%'), _0x4d4b98[_0x313c8f(0x1e0)](_0x313c8f(0x3ec), _0x400987), _0x10cfb2(); }); } } } } } } _0x3c149c(), _0x2215cd(); } else { const _0x36e548 = _0x18614e['value']['trim'](); if (!_0x36e548) { _0xa7803b(_0x23ab09(0x2e0)); return; } const _0x58dba6 = _0x3a8676[_0x23ab09(0x6d7)](_0x5d81fe['querySelectorAll'](_0x23ab09(0x197)))[_0x23ab09(0x511)](_0xb43d37 => _0xb43d37[_0x23ab09(0x55a)]['id']); if (_0x58dba6[_0x23ab09(0x45b)] < 0x2) { _0x460812(_0x23ab09(0x5f3)); return; } const _0x1d0b3e = { 'id': _0x23ab09(0x506) + _0x5cb344[_0x23ab09(0x24a)](), 'type': _0x23ab09(0x67a), 'name': _0x36e548, 'participantIds': _0x58dba6 }; _0xee0587[_0x23ab09(0x22e)][_0x23ab09(0x249)](_0x1d0b3e), _0x1d51cb[_0x23ab09(0x544)] = _0x1d0b3e['id'], _0x1c204d(), _0x4cfeda(), _0x51e0de(), _0xf6f7f6(), _0x24b725(_0x23ab09(0x481) + _0x36e548 + _0x23ab09(0x855)), _0xe01709(_0x23ab09(0x80d), _0x23ab09(0x624)); } } async function _0x38199d(_0x2b4a67, { force: force = ![], delayMs: delayMs = 0x0 } = {}) { const _0x52262d = _0x12f887; await new Promise(_0x4f77ac => setTimeout(_0x4f77ac, 0xa)); if (!_0x2aa90d[_0x52262d(0x4de)][_0x52262d(0x2e3)] || !_0x2aa90d[_0x52262d(0x4de)][_0x52262d(0x691)] || !_0x2aa90d[_0x52262d(0x4de)][_0x52262d(0x355)]) { if (_0x52262d(0x671) !== _0x52262d(0x671)) { const _0x4b0ef3 = _0x497d6c[_0x52262d(0x1a2)](_0x52262d(0x642)); _0x4b0ef3[_0x52262d(0x399)] = 'world-book-item', _0x4b0ef3[_0x52262d(0x55a)]['id'] = _0xc6f99a['id'], _0x4b0ef3[_0x52262d(0x862)] = '\x0a\x20\x20\x20\x20\x20\x20<div\x20class=\x22world-book-item-name\x22>' + _0x7ba28c[_0x52262d(0x2a5)] + _0x52262d(0x53b) + _0x213f00[_0x52262d(0x751)]['substring'](0x0, 0x64) + _0x52262d(0x842), _0x4b0ef3[_0x52262d(0x179)](_0x52262d(0x3e9), () => _0x2f3568(_0x509115['id'])), _0x598d0f['appendChild'](_0x4b0ef3); } else return _0x5d65f5('请先在\x22设置\x22中配置你的\x20API\x20信息。'), ![]; } const _0xe8ad51 = _0x4adf1c(); if (!_0xe8ad51 || !_0x2b4a67) return ![]; const _0x435cf0 = _0x5cb17e(_0xe8ad51['id']), _0x567ee8 = _0x2aa90d[_0x52262d(0x7f2)]['at'](-0x1)?.[_0x52262d(0x619)] === _0x52262d(0x821); if (!force && !_0x567ee8) return ![]; const _0x629fe6 = _0x2aa90d[_0x52262d(0x7f2)]['at'](-0x1)?.[_0x52262d(0x446)] ?? ![]; if (delayMs) await new Promise(_0x187de0 => setTimeout(_0x187de0, delayMs)); _0x629fe6 ? document[_0x52262d(0x49f)](_0x52262d(0x3a6))[_0x52262d(0x7ea)] = _0x52262d(0x1d9) : _0x5a7603(!![]); let _0x346f9d = ''; if (_0x2aa90d[_0x52262d(0x5c3)] && _0x2aa90d[_0x52262d(0x5c3)][_0x52262d(0x17c)] && _0x5206e6[_0x52262d(0x45b)] > 0x0) { const _0xef8a69 = _0x2aa90d[_0x52262d(0x5c3)], _0x415061 = _0x40a89f['currentTime']; let _0x247054 = -0x1; for (let _0x432a33 = 0x0; _0x432a33 < _0x5206e6[_0x52262d(0x45b)]; _0x432a33++) { if (_0x415061 >= _0x5206e6[_0x432a33][_0x52262d(0x29e)]) _0x247054 = _0x432a33; else break; } const _0x5d397c = _0x5206e6['map']((_0x5443f0, _0x21b33b) => { const _0x25e7a0 = _0x52262d, _0x107a55 = _0x21b33b === _0x247054 ? '>>\x20' : ''; return '' + _0x107a55 + _0x5443f0[_0x25e7a0(0x740)]; })[_0x52262d(0x4c2)]('\x0a'); _0x346f9d = (_0x52262d(0x629) + _0xef8a69[_0x52262d(0x347)] + _0x52262d(0x4e7) + _0xef8a69[_0x52262d(0x879)] + _0x52262d(0x30a) + _0x5d397c + _0x52262d(0x27c))[_0x52262d(0x2fe)](); } let _0x3de651 = '', _0xf398d6 = ''; const _0x44c520 = _0x2aa90d['conversationHistory']['length']; if (_0x44c520 > 0x1) { if (_0x52262d(0x332) === _0x52262d(0x3f0)) { if (_0x4f250a[_0x52262d(0x73f)]) _0x9f825(_0x5693aa['diaryPressTimer']); } else { const _0x56845b = _0x2aa90d[_0x52262d(0x7f2)][_0x44c520 - 0x2], _0x2d3fec = _0x2aa90d[_0x52262d(0x7f2)][_0x44c520 - 0x1]; if (_0x56845b[_0x52262d(0x446)] === ![] && _0x2d3fec[_0x52262d(0x446)] === !![]) { if (_0x52262d(0x83f) === _0x52262d(0x83f)) _0xf398d6 = _0x52262d(0x7ab) + _0x435cf0[_0x52262d(0x2a5)] + _0x52262d(0x474); else { const _0xb9bb43 = _0x23ea58(_0x448418['id']); if (_0xb9bb43 && _0xb9bb43[_0x52262d(0x45b)] > 0x0) { const _0x50edaf = _0xb9bb43[_0xb9bb43[_0x52262d(0x45b)] - 0x1]; (!_0xf44d3c || _0x50edaf[_0x52262d(0x602)] > _0x39bf79[_0x52262d(0x602)]) && (_0x112353 = _0x50edaf); } } } else _0x56845b[_0x52262d(0x446)] === !![] && _0x2d3fec[_0x52262d(0x446)] === ![] && (_0xf398d6 = '\x0a#\x20【！！！重要场景切换！！！】\x0a你之前正和“' + _0x435cf0[_0x52262d(0x2a5)] + _0x52262d(0x606)); } } if (_0x629fe6) { const _0x453461 = _0x52262d(0x272); _0x3de651 = _0x52262d(0x817) + _0x435cf0[_0x52262d(0x2a5)] + _0x52262d(0x325) + _0x453461 + _0x52262d(0x5b2) + _0x2b4a67[_0x52262d(0x2a5)] + _0x52262d(0x7b4) + _0x453461 + _0x52262d(0x17d) + _0x453461 + _0x52262d(0x290); } else 'xKpIk' !== _0x52262d(0x413) ? (_0x3e71e9(_0x4fe0aa['id']), _0x3758ac(_0x52262d(0x800)), _0x5e9ea6(_0x52262d(0x80d)), _0x547590(![])) : _0x52262d(0x581); const { omniText: _0x433968 } = _0x395060(_0x2b4a67['id'], _0xe8ad51['id']), _0x448bd6 = _0x1f3bb7(), _0x28c87d = _0x515fd9(_0x2b4a67['id']), _0x4c8838 = typeof _0x1eaf2f === _0x52262d(0x233) ? _0x1eaf2f[_0x52262d(0x32a)](_0x52262d(0x209), _0x2b4a67[_0x52262d(0x2a5)])['replaceAll']('{userName}', _0x435cf0[_0x52262d(0x2a5)] || '用户') : '', _0x5b302c = _0xe0a49d[_0x52262d(0x511)](_0x4342f1 => _0x4342f1[_0x52262d(0x2a5)])[_0x52262d(0x4c2)](',\x20'); let _0x4ad653 = ''; if (_0x2b4a67['linkedWorldBookIds'] && _0x2b4a67[_0x52262d(0x76f)][_0x52262d(0x45b)] > 0x0) { const _0xa60bd7 = _0x2b4a67[_0x52262d(0x76f)][_0x52262d(0x511)](_0x2bd1b1 => _0x2aa90d[_0x52262d(0x14b)][_0x52262d(0x349)](_0x52f4cd => _0x52f4cd['id'] === _0x2bd1b1))[_0x52262d(0x747)](Boolean)['map'](_0x28f9a8 => _0x52262d(0x1af) + _0x28f9a8[_0x52262d(0x2a5)] + '\x0a' + _0x28f9a8[_0x52262d(0x751)])[_0x52262d(0x4c2)](''); if (_0xa60bd7) _0x4ad653 = _0x52262d(0x303) + _0xa60bd7; } const _0x277a7d = _0x435cf0[_0x52262d(0x839)] ? _0x52262d(0x39a) + _0x435cf0[_0x52262d(0x2a5)] + _0x52262d(0x5fe) + _0x435cf0[_0x52262d(0x839)] : ''; let _0x5b6185 = ''; const _0x5baccb = new Date(), _0x306544 = _0x2aa90d[_0x52262d(0x7f2)]['at'](-0x1), _0xa9ab29 = _0x42ad7f(_0x2b4a67['id']); _0x5b6185 = _0x52262d(0x753), _0x5b6185 += '-\x20**当前精确时间**:\x20' + _0x5baccb[_0x52262d(0x395)]('zh-CN', { 'dateStyle': 'full', 'timeStyle': 'short' }) + '\x0a'; if (_0xa9ab29) { if (_0x52262d(0x880) !== _0x52262d(0x559)) { const _0x3a6809 = _0x3b751e(new Date(_0xa9ab29[_0x52262d(0x602)])); _0x5b6185 += _0x52262d(0x3b3) + _0x3a6809 + '\x0a'; const _0x276b07 = (_0x5baccb - new Date(_0xa9ab29[_0x52262d(0x602)])) / (0x3e8 * 0x3c * 0x3c); if (_0x276b07 > 0x30) { if ('ANxNo' !== _0x52262d(0x5de)) { const _0x934e93 = _0x20e863['getElementById'](_0x52262d(0x72a)); _0x934e93['innerHTML'] = ''; const _0x3fa9f9 = _0x134d0d[_0x52262d(0x857)]['filter'](_0x4f8d64 => _0x2e38e4[_0x52262d(0x22e)][_0x52262d(0x2ef)](_0x10e5eb => _0x10e5eb[_0x52262d(0x5b4)] === _0x52262d(0x23d) && _0x10e5eb[_0x52262d(0x6ec)][_0x52262d(0x761)](_0x4f8d64['id']))); if (_0x3fa9f9[_0x52262d(0x45b)] === 0x0) { _0x934e93[_0x52262d(0x862)] = _0x52262d(0x316); return; } _0x3fa9f9[_0x52262d(0x242)](_0x22da9f => { const _0x376888 = _0x52262d, _0x170492 = _0x3a60ec[_0x376888(0x1a2)]('li'); _0x170492[_0x376888(0x399)] = _0x376888(0x852), _0x170492[_0x376888(0x55a)][_0x376888(0x1c7)] = _0x22da9f['id'], _0x170492['innerHTML'] = _0x376888(0x2e1) + (_0x22da9f['avatar'] || _0xca531) + '\x22\x20alt=\x22avatar\x22\x20class=\x22char-avatar\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22char-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22char-name\x22>' + _0x22da9f[_0x376888(0x2a5)] + _0x376888(0x529) + (_0x22da9f[_0x376888(0x563)] || '私聊') + _0x376888(0x78d), _0x170492['addEventListener'](_0x376888(0x3e9), () => { _0x20572a(_0x22da9f['id']); }), _0x934e93[_0x376888(0x185)](_0x170492); }); } else _0x5b6185 += _0x52262d(0x83a); } else { if (_0x276b07 > 0x14) _0x5b6185 += _0x52262d(0x636); else _0x276b07 > 0x4 ? _0x5b6185 += _0x52262d(0x5b8) : _0x5b6185 += _0x52262d(0x652); } } else _0x3f004f(_0x47ff2b[_0x52262d(0x5da)]), _0x301c2d(); } else _0x5b6185 += _0x52262d(0x45a); const _0x24a107 = ('\x0a' + _0x3de651 + _0x52262d(0x49d) + _0x2b4a67[_0x52262d(0x2a5)] + _0x52262d(0x163) + _0x2b4a67[_0x52262d(0x2a5)] + _0x52262d(0x73d) + _0x2b4a67[_0x52262d(0x2a5)] + _0x52262d(0x887) + _0x5b302c + _0x52262d(0x4bf) + _0x4c8838 + '\x0a')[_0x52262d(0x2fe)](), _0x1c2639 = [{ 'role': _0x52262d(0x1db), 'content': _0x24a107 }], _0x4cf47b = (_0x52262d(0x77c) + (_0x2b4a67[_0x52262d(0x839)] || _0x52262d(0x4f8)) + '\x0a' + _0x277a7d + '\x20\x0a' + _0x433968 + '\x0a' + _0x448bd6 + '\x0a' + _0x28c87d + _0x52262d(0x4bc) + _0x346f9d + '\x0a' + _0x5b6185 + '\x0a' + _0x4ad653 + '\x0a')[_0x52262d(0x2fe)](); _0x4cf47b[_0x52262d(0x23b)](/#.*|\s/g, '') && ('qUAbw' !== 'qUAbw' ? (_0xd707b3 = _0xa9deaf[_0x52262d(0x1a2)](_0x52262d(0x3c9)), _0x40f8fa['id'] = 'live-preview-style', _0x5c7956[_0x52262d(0x470)][_0x52262d(0x185)](_0x78b443)) : (_0x1c2639[_0x52262d(0x249)]({ 'role': _0x52262d(0x821), 'content': _0x4cf47b }), _0x1c2639[_0x52262d(0x249)]({ 'role': 'assistant', 'content': _0x52262d(0x570) }))); const _0x190d57 = _0x2aa90d[_0x52262d(0x2eb)]?.[_0x52262d(0x3a2)] ?? 0x64, _0x4531a8 = _0x2aa90d[_0x52262d(0x7f2)][_0x52262d(0x830)](-_0x190d57); for (const _0x5d0559 of _0x4531a8) { const _0x128ac4 = _0x5d0559['role'] === 'ai' || _0x5d0559[_0x52262d(0x619)] === 'assistant' ? 'assistant' : _0x52262d(0x821); let _0x513b9b = { 'role': _0x128ac4, 'content': _0x5d0559['content'] }, _0x1b0eff = !!_0x5d0559[_0x52262d(0x751)]; if (_0x5d0559[_0x52262d(0x626)] && _0x5d0559[_0x52262d(0x751)]['includes']('表情')) { if (_0x52262d(0x280) !== _0x52262d(0x3db)) { const _0x5932a9 = _0x5d0559[_0x52262d(0x751)][_0x52262d(0x85a)](/：(.*?)]$/); _0x513b9b[_0x52262d(0x751)] = _0x52262d(0x20f) + (_0x5932a9 ? _0x5932a9[0x1] : _0x52262d(0x618)) + ']', _0x1c2639[_0x52262d(0x249)](_0x513b9b); } else _0x5e7895[_0x52262d(0x862)] = '', _0x2b0c68[_0x52262d(0x242)](_0x4a498e => { const _0x5cb3bf = _0x52262d, _0x3febf5 = _0x3865dd[_0x5cb3bf(0x1a2)](_0x5cb3bf(0x359)); _0x3febf5['src'] = _0x4a498e[_0x5cb3bf(0x5ce)], _0x3febf5[_0x5cb3bf(0x612)] = _0x5cb3bf(0x662), _0x3febf5['title'] = _0x4a498e['name'], _0x3febf5[_0x5cb3bf(0x2f1)][_0x5cb3bf(0x737)](_0x5cb3bf(0x386)), _0x3febf5[_0x5cb3bf(0x179)]('click', () => _0x3c4809(_0x4a498e)), _0x286450[_0x5cb3bf(0x185)](_0x3febf5); }); } else { let _0xa4b63b = null; if (_0x5d0559[_0x52262d(0x33c)]) { if (_0x52262d(0x7a5) === _0x52262d(0x7a5)) _0xa4b63b = _0x5d0559[_0x52262d(0x33c)]; else { const _0x3cb3a0 = _0x516296['value'][_0x52262d(0x2fe)]()[_0x52262d(0x761)](_0x5a3724); _0x53f002[_0x52262d(0x849)] = _0x3cb3a0; } } else { if (_0x5d0559[_0x52262d(0x6fa)]) try { if (_0x52262d(0x660) === _0x52262d(0x660)) { const _0x31469e = await _0x33b931(_0x5d0559[_0x52262d(0x6fa)]); _0x31469e && (_0xa4b63b = await _0x59aa76(_0x31469e)); } else _0x4ff328 += _0x52262d(0x207); } catch (_0x4ff239) { console[_0x52262d(0x6eb)](_0x52262d(0x70c), _0x4ff239); } } if (_0xa4b63b) { if ('WNCZw' === _0x52262d(0x69d)) { const _0x3414a6 = _0x52d2d4['senderId'] ? _0x3e59b9(_0x5877f6[_0x52262d(0x3e4)]) : null; return _0x3414a6?.['name'] || _0x52262d(0x2e6); } else _0x513b9b['image'] = _0xa4b63b, _0x1b0eff = !![]; } _0x1b0eff && (_0x52262d(0x587) === 'kmJKA' ? (_0x30bfd9(_0x12ee2a), _0x2c8f42[_0x52262d(0x5da)] = '', _0x1619bb(_0x15c6c3, 0x64)) : _0x1c2639['push'](_0x513b9b)); } } try { if ('FVsfF' === _0x52262d(0x2c3)) { const _0x10fb5a = _0x16715e[_0x52262d(0x49f)]('global-player-play-pause-btn'); if (_0x10fb5a) _0x10fb5a['textContent'] = '▶'; } else { const _0x522c33 = await _0x3c8f91(_0x1c2639); if (!_0x522c33) return ![]; if (_0x629fe6) { if (_0x52262d(0x26b) === _0x52262d(0x26b)) try { if (_0x52262d(0x4ff) !== 'GVgjr') { const _0x342592 = _0x5ccf24[_0x52262d(0x2fe)](); if (!_0x342592 || !_0x4056ce[_0x52262d(0x607)]) return; let _0x1e9925 = _0x29ffeb[_0x52262d(0x494)]['find'](_0x111ca5 => _0x111ca5['characterId'] === _0x47a920[_0x52262d(0x607)]); !_0x1e9925 && (_0x1e9925 = { 'characterId': _0x25c937[_0x52262d(0x607)], 'entries': [] }, _0x127fe7[_0x52262d(0x494)][_0x52262d(0x249)](_0x1e9925)); _0x1e9925[_0x52262d(0x4ce)][_0x52262d(0x249)]({ 'timestamp': _0x545f94[_0x52262d(0x24a)](), 'author': 'user', 'content': _0x342592 }), _0x1871ef(); const _0x29af29 = _0x1e9925['entries']['length']; _0x4cf89d[_0x52262d(0x4e9)] = _0x4f079a[_0x52262d(0x6bd)](_0x29af29 / 0x2) - 0x1, _0x41eb09(); } else { let _0x71f190 = _0x522c33[_0x52262d(0x2fe)](); const _0x22de39 = _0x71f190[_0x52262d(0x85a)](/(\[[\s\S]*\])/); _0x22de39 && (_0x71f190 = _0x22de39[0x1]); const _0xb2c43e = JSON[_0x52262d(0x38e)](_0x71f190); if (Array[_0x52262d(0x4d3)](_0xb2c43e)) { _0x2aa90d[_0x52262d(0x700)] = _0xb2c43e, _0x2aa90d['characterLastScripts'][_0x2b4a67['id']] = [..._0xb2c43e], _0x3b5b73(); const _0x355570 = _0xb2c43e[_0x52262d(0x511)](_0x3caa86 => _0x3caa86[_0x52262d(0x712)] === _0x52262d(0x55c) ? _0x3caa86[_0x52262d(0x591)] : _0x3caa86[_0x52262d(0x712)] + ':\x20' + _0x3caa86['line'])[_0x52262d(0x4c2)]('\x0a\x0a'); _0x2aa90d[_0x52262d(0x7f2)][_0x52262d(0x249)]({ 'role': _0x52262d(0x4e1), 'senderId': _0x2b4a67['id'], 'timestamp': Date[_0x52262d(0x24a)](), 'isOffline': !![], 'content': _0x355570 }); } } } catch (_0x997cb0) { console[_0x52262d(0x6eb)](_0x52262d(0x3e5), _0x997cb0, '原始文本:', _0x522c33), _0x2aa90d[_0x52262d(0x7f2)][_0x52262d(0x249)]({ 'role': _0x52262d(0x4e1), 'senderId': _0x2b4a67['id'], 'timestamp': Date[_0x52262d(0x24a)](), 'isOffline': !![], 'content': _0x52262d(0x758) + _0x522c33 + ']' }); } else _0x357ba3[_0x52262d(0x179)]('click', () => _0x1facc9[_0x52262d(0x3e9)]()), _0x426a5e['addEventListener']('change', async _0x2fa894 => { const _0x485eab = _0x52262d, _0x188749 = _0x2fa894[_0x485eab(0x232)][_0x485eab(0x7a2)][0x0]; if (!_0x188749) return; try { _0x54f666['src'] = _0x176ec['createObjectURL'](_0x188749); } catch (_0x515235) { _0x3cf279('图片预览失败:\x20' + _0x515235[_0x485eab(0x4c4)]); } }); } else { if (_0x52262d(0x5bd) !== _0x52262d(0x46e)) { const _0x45bcf2 = _0x2c0ed3(_0x522c33), _0x5b527a = _0x45bcf2['map'](_0x50a63c => { const _0x2353c3 = _0x52262d, _0x5b07b3 = _0x50a63c[_0x2353c3(0x2fe)](), _0x53a396 = _0x5b07b3[_0x2353c3(0x85a)](/^\[music:(.*?)\|(.*?)\]$/), _0x1eb9b6 = _0x5b07b3[_0x2353c3(0x85a)](/^\[sticker:(.*?)\]$/), _0xbfa873 = _0x5b07b3[_0x2353c3(0x85a)](/^\[transfer:([\d.]+)\|(.*?)\]$/); if (_0x53a396) { if (_0x2353c3(0x649) !== _0x2353c3(0x649)) { if (_0x12011d) _0x454463[_0x2353c3(0x7ea)] = '❚❚'; } else return { 'type': _0x2353c3(0x5f7), 'songName': _0x53a396[0x1][_0x2353c3(0x2fe)](), 'artist': _0x53a396[0x2]['trim']() }; } else { if (_0x1eb9b6) return { 'type': _0x2353c3(0x547), 'name': _0x1eb9b6[0x1][_0x2353c3(0x2fe)]() }; else { if (_0xbfa873) { if (_0x2353c3(0x5d8) !== _0x2353c3(0x5d8)) { const _0x2d3747 = _0x171eea[_0x2353c3(0x2aa)]('.typing-indicator'); _0x2d3747[_0x2353c3(0x242)](_0x103093 => _0x103093[_0x2353c3(0x231)]()); } else { const _0x2e9af4 = parseFloat(_0xbfa873[0x1]), _0x52acaa = _0xbfa873[0x2]['trim'](), _0x3ce612 = _0x5cb17e(_0x2aa90d[_0x2353c3(0x544)]); let _0x3c2386 = null; if (_0x52acaa === _0x3ce612[_0x2353c3(0x2a5)]) _0x3c2386 = _0x3ce612['id']; else { const _0x2bad61 = _0x4adf1c(); if (_0x2bad61[_0x2353c3(0x5b4)] === _0x2353c3(0x67a)) { if ('LLOqr' !== 'LLOqr') _0xd0e570[_0x2353c3(0x3c9)][_0x2353c3(0x416)] = 'var(--text-color)', _0xcf5b08['style'][_0x2353c3(0x7f5)] = _0x2353c3(0x3d3); else { const _0x2cb737 = _0x2aa90d[_0x2353c3(0x857)][_0x2353c3(0x349)](_0x39ac39 => _0x2bad61[_0x2353c3(0x6ec)][_0x2353c3(0x761)](_0x39ac39['id']) && _0x39ac39['name'] === _0x52acaa); if (_0x2cb737) _0x3c2386 = _0x2cb737['id']; } } } if (_0x3c2386) return { 'type': 'transfer', 'amount': _0x2e9af4, 'recipientId': _0x3c2386, 'senderId': _0x2b4a67['id'] }; else return { 'type': _0x2353c3(0x740), 'content': _0x2353c3(0x78a) + _0x52acaa + '”，但没找到人)' }; } } else { if (_0x5b07b3) return { 'type': _0x2353c3(0x740), 'content': _0x5b07b3 }; } } } return null; })['filter'](Boolean), _0xb237e1 = async _0x4cc16f => { const _0x18b6b8 = _0x52262d; if (_0x18b6b8(0x781) === _0x18b6b8(0x781)) { const _0x12c5dd = { 'role': _0x18b6b8(0x4e1), 'senderId': _0x2b4a67['id'], 'timestamp': Date[_0x18b6b8(0x24a)](), 'isOffline': _0x629fe6 }; if (_0x4cc16f[_0x18b6b8(0x5b4)] === _0x18b6b8(0x5f7)) { const { songName: _0x5afaa2, artist: _0x33a0b1 } = _0x4cc16f; _0x12c5dd[_0x18b6b8(0x5b4)] = 'music', _0x12c5dd['content'] = _0x18b6b8(0x4b3) + _0x5afaa2 + _0x18b6b8(0x820) + _0x33a0b1 + ']'; try { const _0x23cf17 = await _0x2ff291(_0x5afaa2, _0x33a0b1); Object[_0x18b6b8(0x23f)](_0x12c5dd, { 'songName': _0x5afaa2, 'artist': _0x33a0b1, 'coverUrl': _0x23cf17[_0x18b6b8(0x4ad)], 'playableUrl': _0x23cf17[_0x18b6b8(0x5ce)] }); } catch (_0x156498) { _0x18b6b8(0x36e) === _0x18b6b8(0x36e) ? Object[_0x18b6b8(0x23f)](_0x12c5dd, { 'songName': _0x5afaa2, 'artist': _0x33a0b1, 'coverUrl': null, 'playableUrl': null }) : (_0x42a2bd[_0x18b6b8(0x7f2)][_0x47e507][_0x18b6b8(0x400)] = !![], _0x57dc78()); } } else { if (_0x4cc16f['type'] === _0x18b6b8(0x547)) { const _0x297865 = _0xe0a49d[_0x18b6b8(0x349)](_0x1b9003 => _0x1b9003[_0x18b6b8(0x2a5)] === _0x4cc16f['name']); if (_0x297865) Object['assign'](_0x12c5dd, { 'content': _0x18b6b8(0x717) + _0x297865[_0x18b6b8(0x2a5)] + ']', 'displayUrl': _0x297865['url'] }); else _0x12c5dd[_0x18b6b8(0x751)] = _0x18b6b8(0x20f) + _0x4cc16f['name'] + ']'; } else { if (_0x4cc16f[_0x18b6b8(0x5b4)] === _0x18b6b8(0x441)) { const _0x4b2f2f = _0x4cc16f[_0x18b6b8(0x2c1)] === _0x5cb17e(_0x2aa90d[_0x18b6b8(0x544)])['id'] ? _0x5cb17e(_0x2aa90d[_0x18b6b8(0x544)]) : _0x1c2a48(_0x4cc16f[_0x18b6b8(0x2c1)]); Object[_0x18b6b8(0x23f)](_0x12c5dd, { 'type': _0x18b6b8(0x441), 'amount': _0x4cc16f[_0x18b6b8(0x71a)], 'recipientId': _0x4cc16f[_0x18b6b8(0x2c1)], 'content': _0x18b6b8(0x1a7) + (_0x4b2f2f?.[_0x18b6b8(0x2a5)] || '未知') + _0x18b6b8(0x21e) + _0x4cc16f[_0x18b6b8(0x71a)] + ']' }); } else { const _0xf64c50 = _0x3a1003(_0x4cc16f[_0x18b6b8(0x751)]); Object[_0x18b6b8(0x23f)](_0x12c5dd, { 'content': _0xf64c50['content'], 'quotedMessage': _0xf64c50[_0x18b6b8(0x7a0)] }); } } } return _0x12c5dd; } else _0xa7d338[_0x18b6b8(0x2f1)]['remove'](_0x18b6b8(0x557)); }, _0x3003e3 = await Promise[_0x52262d(0x5c0)](_0x5b527a[_0x52262d(0x511)](_0xb237e1)); for (const _0x215317 of _0x3003e3) { _0x52262d(0x64e) !== _0x52262d(0x1b0) ? (_0x215317[_0x52262d(0x751)] || _0x215317['displayUrl'] || _0x215317[_0x52262d(0x5b4)] === 'music') && (_0x52262d(0x2fb) !== _0x52262d(0x54b) ? (await new Promise(_0x2a43b8 => setTimeout(_0x2a43b8, 0x12c + Math[_0x52262d(0x27a)]() * 0x190)), _0x2aa90d['conversationHistory'][_0x52262d(0x249)](_0x215317), _0x2215cd()) : _0x1adab4[_0x52262d(0x862)] = _0x52262d(0x1bf) + _0x3c2e16 + '\x22\x20style=\x22width:\x20100%;\x20height:\x20100%;\x20border-radius:\x2022.5%;\x20object-fit:\x20cover;\x20display:\x20block;\x22>') : (_0x2a8866['classList'][_0x52262d(0x231)](_0x52262d(0x557)), _0x5388f8 = null); } } else { const _0x7c35f = _0x32f74c[_0x52262d(0x52d)](_0x211434); _0x4c45bd['src'] = _0x7c35f, _0x5511f0['onload'] = () => { const _0xab75d1 = _0x52262d; _0x401856[_0xab75d1(0x64b)](_0x7c35f); }; } } return _0x3c149c(), _0x2215cd(), !![]; } } catch (_0x524a57) { if (_0x524a57[_0x52262d(0x2a5)] !== 'AbortError') { console[_0x52262d(0x6eb)](_0x52262d(0x5a8), _0x524a57); const _0x5e6d9c = { 'role': _0x52262d(0x4e1), 'content': _0x52262d(0x2ba) + _0x524a57[_0x52262d(0x4c4)], 'senderId': _0x2b4a67['id'], 'isOffline': _0x629fe6 }; _0x2aa90d[_0x52262d(0x7f2)]['push'](_0x5e6d9c), _0x2215cd(); } return ![]; } finally { _0x5a7603(![]); } } async function _0x5c969b() { const _0x1ea3a5 = _0x12f887; if (_0x1ea3a5(0x472) === 'BztHZ') _0x1383d5[_0x1ea3a5(0x509)]('chatHistory_' + _0x2b558e); else { console['log']('---\x20开始AI回复流程\x20---'); if (!_0x2aa90d[_0x1ea3a5(0x4de)][_0x1ea3a5(0x2e3)] || !_0x2aa90d[_0x1ea3a5(0x4de)]['key'] || !_0x2aa90d[_0x1ea3a5(0x4de)][_0x1ea3a5(0x355)]) { _0x5d65f5(_0x1ea3a5(0x449)); return; } const _0x50014e = _0x2aa90d[_0x1ea3a5(0x7f2)]['at'](-0x1)?.[_0x1ea3a5(0x619)] === _0x1ea3a5(0x821); if (!_0x50014e || _0x2aa90d[_0x1ea3a5(0x784)]) return; const _0xadf87b = _0x4adf1c(); if (!_0xadf87b) return; _0x2aa90d[_0x1ea3a5(0x784)] = !![], _0x5a7603(!![]); try { if (_0xadf87b[_0x1ea3a5(0x5b4)] === _0x1ea3a5(0x23d)) { const _0x16efd0 = _0x1c2a48(_0xadf87b[_0x1ea3a5(0x6ec)][0x0]); console[_0x1ea3a5(0x23c)](_0x1ea3a5(0x300)); if (_0x16efd0) await _0x38199d(_0x16efd0, { 'force': !![] }); } else { if (_0x1ea3a5(0x3b6) !== 'jazIW') _0x56f90e['name'] = _0x27635e, _0x10e609[_0x1ea3a5(0x412)] = _0x3d5d9a, _0x5414e1[_0x1ea3a5(0x40b)] = _0x787df1; else { const _0xd2c641 = await _0x594539(); if (_0xd2c641 && _0xd2c641['events']?.['length']) await _0x298e5a(_0xd2c641); else { console[_0x1ea3a5(0x7d0)]('Group\x20plan\x20failed,\x20falling\x20back\x20to\x20individual\x20generation\x20for\x20each\x20character.'); const _0x41b0b2 = _0xadf87b[_0x1ea3a5(0x6ec)][_0x1ea3a5(0x511)](_0x1c2a48)[_0x1ea3a5(0x747)](Boolean); if (!_0x41b0b2['length']) return; let _0x3a9bbe = 0x0; for (const _0x26064d of _0x41b0b2) { _0x38199d(_0x26064d, { 'force': !![], 'delayMs': _0x3a9bbe }), _0x3a9bbe += 0x1f4; } } } } } catch (_0x55b100) { _0x55b100[_0x1ea3a5(0x2a5)] !== _0x1ea3a5(0x578) && (console[_0x1ea3a5(0x6eb)](_0x1ea3a5(0x15c), _0x55b100), _0x28439d({ 'role': _0x1ea3a5(0x4e1), 'content': _0x1ea3a5(0x2ba) + _0x55b100[_0x1ea3a5(0x4c4)] }, _0x2aa90d[_0x1ea3a5(0x7f2)][_0x1ea3a5(0x45b)] - 0x1)); } finally { _0x2aa90d['isGenerating'] = ![], _0x5a7603(![]); } } } function _0x330e20(_0x1d3514, _0x271114) { const _0x218a41 = _0x12f887, _0xbd89bc = _0x271114[_0x218a41(0x59e)](), _0x5b5159 = _0x1d3514[_0x218a41(0x59e)](); if (_0xbd89bc[_0x218a41(0x5b6)]('claude')) return _0x218a41(0x693); if (_0x5b5159[_0x218a41(0x761)](_0x218a41(0x60a))) return 'anthropic'; if (_0x5b5159[_0x218a41(0x761)]('googleapis.com')) return 'gemini'; if (_0xbd89bc[_0x218a41(0x5b6)](_0x218a41(0x6cc))) return _0x218a41(0x6cc); return _0x218a41(0x402); } async function _0x3c8f91(_0x1aec65, _0x416684 = {}) { const _0x4cbacd = _0x12f887; if (_0x4cbacd(0x67f) === _0x4cbacd(0x67f)) { _0x2aa90d[_0x4cbacd(0x654)] && _0x2aa90d['currentAbortController'][_0x4cbacd(0x4a8)](_0x4cbacd(0x40f)); _0x2aa90d[_0x4cbacd(0x654)] = new AbortController(); const _0x46ca18 = _0x2aa90d['currentAbortController'][_0x4cbacd(0x190)], { endpoint: _0x28fb54, key: _0x44a663, model: _0x3f5678 } = _0x2aa90d[_0x4cbacd(0x4de)], _0x288535 = !!_0x416684[_0x4cbacd(0x525)], _0x13531c = _0x330e20(_0x28fb54, _0x3f5678); console[_0x4cbacd(0x23c)](_0x4cbacd(0x6ee) + _0x13531c); let _0x5ad2a0 = ''; try { if (_0x4cbacd(0x5d3) !== 'fHkGj') { switch (_0x13531c) { case _0x4cbacd(0x693): { const _0x4182c0 = _0x154945(_0x44a663), _0x422972 = _0x1aec65[_0x4cbacd(0x349)](_0x55e60c => _0x55e60c[_0x4cbacd(0x619)] === 'system')?.[_0x4cbacd(0x751)] || '', _0x416b92 = _0x1aec65['filter'](_0x4a3cb1 => _0x4a3cb1[_0x4cbacd(0x619)] !== _0x4cbacd(0x1db)), _0x16e605 = { 'model': _0x3f5678, 'system': _0x422972, 'messages': _0x416b92[_0x4cbacd(0x511)](_0x5ec595 => ({ 'role': _0x5ec595[_0x4cbacd(0x619)], 'content': [{ 'type': _0x4cbacd(0x740), 'text': _0x5ec595['content'] }] })), 'max_tokens': 0x1000 }, _0x33d8a0 = await fetch(_0x28fb54, { 'method': _0x4cbacd(0x610), 'headers': { 'Content-Type': _0x4cbacd(0x82b), 'x-api-key': _0x4182c0, 'anthropic-version': _0x4cbacd(0x25f) }, 'body': JSON[_0x4cbacd(0x46d)](_0x16e605), 'signal': _0x46ca18 }); if (!_0x33d8a0['ok']) { const _0x26b58a = await _0x33d8a0['json']()[_0x4cbacd(0x301)](() => ({})); throw new Error(_0x4cbacd(0x14f) + _0x33d8a0[_0x4cbacd(0x22f)] + _0x4cbacd(0x820) + (_0x26b58a[_0x4cbacd(0x6eb)]?.[_0x4cbacd(0x4c4)] || _0x33d8a0[_0x4cbacd(0x239)])); } const _0x1a6f7c = await _0x33d8a0[_0x4cbacd(0x525)](); _0x5ad2a0 = _0x1a6f7c[_0x4cbacd(0x751)]?.[0x0]?.[_0x4cbacd(0x740)] || ''; break; } case 'gemini': { const _0x48993c = _0x154945(_0x44a663), _0x3572c3 = _0x28fb54[_0x4cbacd(0x761)](_0x4cbacd(0x650)), _0x348605 = _0x17c6ca => { const _0x6fa11c = _0x4cbacd, _0x20ba19 = []; if (_0x17c6ca['content']) _0x20ba19[_0x6fa11c(0x249)]({ 'text': _0x17c6ca[_0x6fa11c(0x751)] }); if (_0x17c6ca['image']) { if (_0x6fa11c(0x6ae) === _0x6fa11c(0x20b)) { const _0x3587b8 = _0xb3bf96[_0x6fa11c(0x33c)][_0x6fa11c(0x804)](',')[0x1], _0x5dea32 = _0x196b34[_0x6fa11c(0x33c)]['substring'](_0x35a315[_0x6fa11c(0x33c)]['indexOf'](':') + 0x1, _0x27fb3a[_0x6fa11c(0x33c)][_0x6fa11c(0x540)](';')) || _0x6fa11c(0x1b3); _0xa5013a[_0x6fa11c(0x249)]({ 'inline_data': { 'mime_type': _0x5dea32, 'data': _0x3587b8 } }); } else { const _0x35e06f = _0x17c6ca[_0x6fa11c(0x33c)][_0x6fa11c(0x804)](',')[0x1], _0x3230c8 = _0x17c6ca[_0x6fa11c(0x33c)][_0x6fa11c(0x702)](_0x17c6ca['image'][_0x6fa11c(0x540)](':') + 0x1, _0x17c6ca['image'][_0x6fa11c(0x540)](';')) || 'image/jpeg'; _0x20ba19[_0x6fa11c(0x249)]({ 'inline_data': { 'mime_type': _0x3230c8, 'data': _0x35e06f } }); } } return _0x20ba19; }, _0x2dc105 = _0x1aec65[_0x4cbacd(0x511)](_0x160bee => ({ 'role': _0x160bee[_0x4cbacd(0x619)] === 'assistant' ? 'model' : _0x160bee[_0x4cbacd(0x619)] === _0x4cbacd(0x1db) ? _0x4cbacd(0x821) : _0x160bee['role'], 'parts': _0x348605(_0x160bee) }))[_0x4cbacd(0x747)](_0xeeddf7 => _0xeeddf7[_0x4cbacd(0x5fc)][_0x4cbacd(0x45b)] > 0x0), _0x564e67 = { 'contents': _0x2dc105 }; _0x288535 && _0x3572c3 && (_0x4cbacd(0x6ac) === _0x4cbacd(0x6ac) ? _0x564e67['generationConfig'] = { 'response_mime_type': _0x4cbacd(0x82b) } : _0x29a735['quotedMessage'] = { ..._0x2fdf41[_0x4cbacd(0x167)] }); const _0x46c7ec = _0x28fb54 + _0x4cbacd(0x58f) + _0x3f5678 + _0x4cbacd(0x353) + _0x48993c + _0x4cbacd(0x15a), _0x17ec3a = await fetch(_0x46c7ec, { 'method': 'POST', 'headers': { 'Content-Type': _0x4cbacd(0x82b) }, 'body': JSON[_0x4cbacd(0x46d)](_0x564e67), 'signal': _0x46ca18 }); if (!_0x17ec3a['ok']) throw new Error(_0x4cbacd(0x26a) + _0x17ec3a[_0x4cbacd(0x22f)]); const _0x1af8ef = _0x17ec3a[_0x4cbacd(0x546)][_0x4cbacd(0x5c2)](), _0x2df9eb = new TextDecoder(); let _0x52ee20 = ''; while (!![]) { if (_0x46ca18[_0x4cbacd(0x46c)]) { console[_0x4cbacd(0x23c)](_0x4cbacd(0x2cb)), _0x1af8ef[_0x4cbacd(0x5b5)](); break; } const { done: _0x5a74a8, value: _0x3b88eb } = await _0x1af8ef[_0x4cbacd(0x5a6)](); if (_0x5a74a8) break; const _0x4eab19 = _0x2df9eb[_0x4cbacd(0x370)](_0x3b88eb, { 'stream': !![] }), _0x8a4a7d = _0x4eab19[_0x4cbacd(0x804)]('\x0a')[_0x4cbacd(0x747)](_0x3cc3cf => _0x3cc3cf[_0x4cbacd(0x2fe)]()['startsWith'](_0x4cbacd(0x1cd))); for (const _0x1d224e of _0x8a4a7d) { const _0x1f8228 = _0x1d224e[_0x4cbacd(0x23b)]('data:\x20', ''); if (_0x1f8228 === _0x4cbacd(0x339)) break; try { _0x52ee20 += JSON[_0x4cbacd(0x38e)](_0x1f8228)['candidates'][0x0][_0x4cbacd(0x751)][_0x4cbacd(0x5fc)][0x0][_0x4cbacd(0x740)]; } catch { } } } _0x5ad2a0 = _0x52ee20; break; } case _0x4cbacd(0x402): default: { if (_0x4cbacd(0x448) === _0x4cbacd(0x66c)) _0x19b704[_0x4cbacd(0x843)] = null, _0x270d59(_0x4cbacd(0x4aa)), _0x5b24c0(); else { const _0x57b714 = _0x154945(_0x44a663), _0x548b1c = _0x28fb54[_0x4cbacd(0x681)](_0x4cbacd(0x889)) ? _0x28fb54 : _0x28fb54[_0x4cbacd(0x23b)](/\/+$/, '') + _0x4cbacd(0x889), _0x4776c0 = _0x1aec65[_0x4cbacd(0x511)](_0x31ab85 => { const _0x4225c4 = _0x4cbacd; if ('pnEfH' !== _0x4225c4(0x317)) { if (_0x31ab85[_0x4225c4(0x619)] === _0x4225c4(0x821) && _0x31ab85['image']) return { 'role': _0x4225c4(0x821), 'content': [{ 'type': _0x4225c4(0x740), 'text': _0x31ab85[_0x4225c4(0x751)] || '\x20' }, { 'type': 'image_url', 'image_url': { 'url': _0x31ab85['image'], 'detail': _0x4225c4(0x878) } }] }; return { 'role': _0x31ab85[_0x4225c4(0x619)], 'content': _0x31ab85['content'] }; } else for (const _0x42ac01 in _0x37504b) { _0x10b208[_0x4225c4(0x3c9)][_0x42ac01] = _0x57316a[_0x42ac01]; } })[_0x4cbacd(0x747)](_0x14a12f => _0x14a12f['content']), _0x4a135b = { 'model': _0x3f5678, 'messages': _0x4776c0, 'max_tokens': 0x1000, ..._0x288535 ? { 'response_format': { 'type': 'json_object' } } : {} }, _0x12e5dc = await fetch(_0x548b1c, { 'method': _0x4cbacd(0x610), 'headers': { 'Content-Type': _0x4cbacd(0x82b), 'Authorization': _0x4cbacd(0x69e) + _0x57b714 }, 'body': JSON[_0x4cbacd(0x46d)](_0x4a135b), 'signal': _0x46ca18 }); if (!_0x12e5dc['ok']) { const _0x5f13c1 = await _0x12e5dc[_0x4cbacd(0x525)]()['catch'](() => ({})); throw new Error(_0x4cbacd(0x289) + _0x12e5dc['status'] + _0x4cbacd(0x820) + (_0x5f13c1[_0x4cbacd(0x6eb)]?.[_0x4cbacd(0x4c4)] || _0x12e5dc[_0x4cbacd(0x239)])); } const _0x3eb71c = await _0x12e5dc[_0x4cbacd(0x525)](); _0x5ad2a0 = _0x3eb71c['choices']?.[0x0]?.[_0x4cbacd(0x4c4)]?.[_0x4cbacd(0x751)] || ''; break; } } }return _0x5ad2a0; } else _0x435958[_0x4cbacd(0x49f)](_0x4cbacd(0x468))[_0x4cbacd(0x3c9)][_0x4cbacd(0x770)](_0x4cbacd(0x24b), _0x4cbacd(0x4ac) + _0x501967 + ')'); } catch (_0xb602e2) { if (_0xb602e2[_0x4cbacd(0x2a5)] === _0x4cbacd(0x578)) { if ('IqaYS' === _0x4cbacd(0x30f)) return console[_0x4cbacd(0x23c)]('Fetch\x20request\x20was\x20aborted.'), ''; else { _0x3e3c66[_0x4cbacd(0x862)] = _0x4cbacd(0x479); return; } } throw _0xb602e2; } finally { _0x2aa90d[_0x4cbacd(0x654)] && _0x2aa90d[_0x4cbacd(0x654)][_0x4cbacd(0x190)] === _0x46ca18 && (_0x2aa90d[_0x4cbacd(0x654)] = null); } } else return _0x21ab04[_0x4cbacd(0x47c)][_0x4cbacd(0x349)](_0x2b1d00 => _0x2b1d00['id'] === _0x580240); } async function _0x54a94e() { const _0x134a07 = _0x12f887, _0x67446d = _0x560167[_0x134a07(0x7fd)][_0x134a07(0x2f1)]['contains']('active'), _0x3979d5 = _0x67446d ? _0x4f1079['value'] : null; let _0x4101ec = null, _0x584df4 = ''; if (_0x67446d && _0x3979d5) { _0x4101ec = _0x2aa90d[_0x134a07(0x22e)][_0x134a07(0x349)](_0x34614e => _0x34614e[_0x134a07(0x5b4)] === 'private' && _0x34614e[_0x134a07(0x6ec)][_0x134a07(0x761)](_0x3979d5)); const _0x42e267 = _0x1c2a48(_0x3979d5); _0x584df4 = _0x42e267 ? _0x42e267['name'] : '该角色'; } else { if (_0x2aa90d[_0x134a07(0x544)]) { if ('jKXxv' !== _0x134a07(0x42c)) { const _0x5ec05d = new _0x56fed5(_0xf0c983[_0x134a07(0x602)]), _0x3fd0ed = _0x56b0bd['floor']((_0x2ac197 - _0x5ec05d) / (0x3e8 * 0x3c)); if (_0x3fd0ed < 0x5) _0x1132a9 += '\x0a-\x20**对话状态**:\x20群里刚刚还在聊天。'; else { if (_0x3fd0ed < 0x78) _0x563e73 += _0x134a07(0x2cc) + _0x3fd0ed + _0x134a07(0x181); else { const _0x6e4070 = _0x15fb88['floor'](_0x3fd0ed / 0x3c); if (_0x6e4070 < 0x30) _0x3da571 += _0x134a07(0x2cc) + _0x6e4070 + _0x134a07(0x385); else _0x3ddab5 += _0x134a07(0x57d) + _0x1ea328[_0x134a07(0x782)](_0x6e4070 / 0x18) + '天没动静了。你的角色们应该发起新的问候或话题。'; } } } else { _0x4101ec = _0x4adf1c(); const _0x272a2a = document['getElementById'](_0x134a07(0x7df))['textContent']; _0x584df4 = _0x272a2a || _0x134a07(0x620); } } } if (!_0x4101ec) { if ('NGJmM' === 'lNScd') { if (_0x1294e0 === null) return; const _0x528cf1 = _0x4bfd38[_0x134a07(0x7f2)][_0x50e84a]; if (!_0x528cf1) return; const _0x49343e = _0x39ba4b(); let _0xd4c5eb = '未知'; if (_0x528cf1[_0x134a07(0x619)] === 'user') _0xd4c5eb = _0x3b48bf['userProfile'][_0x134a07(0x2a5)] || '我'; else { const _0x4216e3 = _0x528cf1['senderId'] || _0x49343e?.[_0x134a07(0x6ec)][0x0], _0x3db5ac = _0x838729(_0x4216e3); _0xd4c5eb = _0x3db5ac ? _0x3db5ac[_0x134a07(0x2a5)] : '角色'; } let _0x4c9def = _0x528cf1[_0x134a07(0x751)] || ''; if (_0x528cf1[_0x134a07(0x626)]) _0x4c9def = '[表情]'; if (_0x528cf1[_0x134a07(0x33c)]) _0x4c9def = _0x134a07(0x85e); if (_0x4c9def[_0x134a07(0x45b)] > 0x32) _0x4c9def = _0x4c9def[_0x134a07(0x702)](0x0, 0x32) + _0x134a07(0x640); _0x4c40ee[_0x134a07(0x167)] = { 'sender': _0xd4c5eb, 'content': _0x4c9def }, _0x50d91e(), _0x3fb1b0(), _0x1d9771[_0x134a07(0x530)](); } else { _0x5d65f5(_0x134a07(0x7ee)); return; } } const _0x4678ec = await _0x1c19af(_0x134a07(0x42e) + _0x584df4 + _0x134a07(0x313)); if (!_0x4678ec) return; _0x4101ec['id'] === _0x2aa90d[_0x134a07(0x544)] && (_0x5c846b(), _0x2aa90d[_0x134a07(0x7f2)] = [], _0x42745f()); try { localStorage[_0x134a07(0x509)](_0x134a07(0x224) + _0x4101ec['id']); } catch (_0xb02ea6) { console[_0x134a07(0x6eb)]('Failed\x20to\x20remove\x20history\x20for\x20chat\x20' + _0x4101ec['id'], _0xb02ea6); } _0x5d65f5('\x22' + _0x584df4 + _0x134a07(0x4ab)); } const _0x19291e = document[_0x12f887(0x49f)](_0x12f887(0x811)), _0x4098d5 = document[_0x12f887(0x49f)](_0x12f887(0x877)), _0x3545ad = document[_0x12f887(0x49f)](_0x12f887(0x885)); _0x19291e['addEventListener'](_0x12f887(0x3e9), async () => { const _0x54c6bf = _0x12f887; _0x9d4a2d(!![], '正在打包数据，请稍候...'); const _0x426c1f = []; try { const _0x1bf4d1 = { 'localStorageData': {}, 'indexedDBData': {}, 'indexedDBMusicData': [] }; for (let _0x2dd7f0 = 0x0; _0x2dd7f0 < localStorage['length']; _0x2dd7f0++) { const _0x31a2c3 = localStorage[_0x54c6bf(0x691)](_0x2dd7f0); if (_0x31a2c3) _0x1bf4d1[_0x54c6bf(0x3f6)][_0x31a2c3] = localStorage['getItem'](_0x31a2c3); } const _0x5bc929 = await _0x27b2bc, _0x2f6f70 = _0x5bc929[_0x54c6bf(0x600)](_0x5e6d2b, _0x54c6bf(0x4ba)), _0x2a3340 = _0x2f6f70['objectStore'](_0x5e6d2b), _0x4f27e8 = await new Promise((_0x426f5c, _0x13a6be) => { const _0x4a16ef = _0x54c6bf, _0x2eeeb3 = _0x2a3340['getAll'](); _0x2eeeb3[_0x4a16ef(0x431)] = () => _0x426f5c(_0x2eeeb3[_0x4a16ef(0x4d0)]), _0x2eeeb3[_0x4a16ef(0x1cf)] = () => _0x13a6be(_0x2eeeb3[_0x4a16ef(0x6eb)]); }); for (const _0x15be3d of _0x4f27e8) { if (_0x15be3d['blob'] instanceof Blob) { if (_0x54c6bf(0x452) !== _0x54c6bf(0x55f)) try { _0x1bf4d1['indexedDBData'][_0x15be3d['id']] = await _0x59aa76(_0x15be3d[_0x54c6bf(0x822)]); } catch (_0x53a179) { _0x426c1f[_0x54c6bf(0x249)](_0x15be3d['id']); } else _0x54c6bf(0x581); } } const _0x58e896 = _0x5bc929[_0x54c6bf(0x600)](_0x1aab5c, 'readonly'), _0x2cedee = _0x58e896[_0x54c6bf(0x754)](_0x1aab5c), _0x391ff8 = await new Promise((_0x1f0ff3, _0x5038ac) => { const _0x5d7574 = _0x54c6bf; if (_0x5d7574(0x23a) === _0x5d7574(0x23a)) { const _0xffb235 = _0x2cedee['getAll'](); _0xffb235[_0x5d7574(0x431)] = () => _0x1f0ff3(_0xffb235[_0x5d7574(0x4d0)]), _0xffb235[_0x5d7574(0x1cf)] = () => _0x5038ac(_0xffb235[_0x5d7574(0x6eb)]); } else _0x5abac2['push']('[' + _0x3c8438 + _0x5d7574(0x866) + _0x3e2236(_0x1b0924) + ']\x20' + _0x3d3872(_0x418e0f[_0x5d7574(0x751)])['trim']()); }); for (const _0x48beef of _0x391ff8) { const _0x1bc193 = { ..._0x48beef }; _0x48beef[_0x54c6bf(0x5e1)] instanceof Blob && (_0x1bc193[_0x54c6bf(0x5e1)] = await _0x59aa76(_0x48beef[_0x54c6bf(0x5e1)])), _0x48beef[_0x54c6bf(0x4ad)] instanceof Blob && (_0x1bc193[_0x54c6bf(0x4ad)] = await _0x59aa76(_0x48beef[_0x54c6bf(0x4ad)])), _0x1bf4d1['indexedDBMusicData']['push'](_0x1bc193); } const _0x12d524 = new Blob([JSON[_0x54c6bf(0x46d)](_0x1bf4d1, null, 0x2)], { 'type': 'application/json' }), _0x18a9a8 = URL[_0x54c6bf(0x52d)](_0x12d524), _0x4ec0f2 = document[_0x54c6bf(0x1a2)]('a'), _0x218084 = new Date(), _0x397c06 = _0x218084['getFullYear']() + '-' + String(_0x218084[_0x54c6bf(0x3de)]() + 0x1)[_0x54c6bf(0x2a3)](0x2, '0') + '-' + String(_0x218084[_0x54c6bf(0x2d7)]())[_0x54c6bf(0x2a3)](0x2, '0'); _0x4ec0f2[_0x54c6bf(0x58a)] = _0x18a9a8, _0x4ec0f2['download'] = 'Noir_Backup_' + _0x397c06 + _0x54c6bf(0x2d8), document[_0x54c6bf(0x546)][_0x54c6bf(0x185)](_0x4ec0f2), _0x4ec0f2[_0x54c6bf(0x3e9)](), document[_0x54c6bf(0x546)][_0x54c6bf(0x3cf)](_0x4ec0f2), URL[_0x54c6bf(0x64b)](_0x18a9a8), _0x9d4a2d(![]), _0x426c1f['length'] > 0x0 ? _0x5d65f5(_0x54c6bf(0x295) + _0x426c1f[_0x54c6bf(0x4c2)]('\x0a')) : _0x54c6bf(0x213) === _0x54c6bf(0x213) ? _0x5d65f5(_0x54c6bf(0x4db)) : (_0x776781[_0x54c6bf(0x2f1)][_0x54c6bf(0x231)](_0x54c6bf(0x25a), _0x54c6bf(0x312)), _0x4dbe89[_0x54c6bf(0x2f1)][_0x54c6bf(0x231)](_0x54c6bf(0x366)), _0x36839a[_0x54c6bf(0x4e9)] = _0x5263ca, _0x31a191(), _0x1cacfa[_0x54c6bf(0x3ab)] = ![]); } catch (_0x4a4d1b) { _0x9d4a2d(![]), console[_0x54c6bf(0x6eb)](_0x54c6bf(0x648), _0x4a4d1b), _0x5d65f5('导出过程中发生严重错误:\x20' + _0x4a4d1b[_0x54c6bf(0x4c4)]); } }), _0x4098d5[_0x12f887(0x179)](_0x12f887(0x3e9), () => { const _0x1dc75f = _0x12f887; _0x3545ad[_0x1dc75f(0x3e9)](); }), _0x347ff5[_0x12f887(0x179)](_0x12f887(0x3e9), _0x57b1f5), _0x3545ad[_0x12f887(0x179)](_0x12f887(0x220), _0x141651 => { const _0x3c08ab = _0x12f887, _0x42be0d = _0x141651[_0x3c08ab(0x232)][_0x3c08ab(0x7a2)][0x0]; if (!_0x42be0d) return; _0x1c19af('确定要导入全量备份文件吗？这将覆盖所有当前数据（包括图片和音乐），且操作不可撤销！')[_0x3c08ab(0x7aa)](_0x2cccc6 => { const _0x5cf5c5 = _0x3c08ab; if (_0x5cf5c5(0x31c) !== 'IIQAO') { if (!_0x2cccc6) { if (_0x5cf5c5(0x4a2) === _0x5cf5c5(0x411)) _0xb4bbaa[_0x5cf5c5(0x2f1)][_0x5cf5c5(0x737)]('active'), _0xb0279c[_0x5cf5c5(0x6c7)]({ 'behavior': _0x5cf5c5(0x279), 'block': _0x5cf5c5(0x437) }); else { _0x3545ad[_0x5cf5c5(0x5da)] = ''; return; } } _0x9d4a2d(!![], _0x5cf5c5(0x6a2)); const _0x315b35 = new FileReader(); _0x315b35['onload'] = async _0x224885 => { const _0x2ba0bc = _0x5cf5c5; if (_0x2ba0bc(0x14a) === _0x2ba0bc(0x7a7)) { const _0xb34479 = _0x4ffd5f[_0x2ba0bc(0x1a2)](_0x2ba0bc(0x642)); _0xb34479['className'] = _0x2ba0bc(0x356), _0xb34479[_0x2ba0bc(0x862)] = _0x2033bd, _0x2666ca === _0x2ba0bc(0x821) ? (_0x39f52f[_0x2ba0bc(0x185)](_0xb34479), _0x374e30['appendChild'](_0x1eda26)) : (_0x1322a6[_0x2ba0bc(0x185)](_0x4d534b), _0x54f489[_0x2ba0bc(0x185)](_0xb34479)); } else try { const _0x354580 = JSON['parse'](_0x224885[_0x2ba0bc(0x232)]['result']); if (!_0x354580[_0x2ba0bc(0x3f6)] || !_0x354580[_0x2ba0bc(0x156)]) { if (_0x2ba0bc(0x75d) === 'ukuig') _0x329830[_0x2ba0bc(0x50e)](_0x3a98ae, { 'keyPath': 'id' }); else throw new Error(_0x2ba0bc(0x82c)); } _0x9d4a2d(!![], _0x2ba0bc(0x80b)); const _0x58b854 = await Promise[_0x2ba0bc(0x5c0)](Object[_0x2ba0bc(0x19f)](_0x354580['indexedDBData'])[_0x2ba0bc(0x511)](async _0x22fdb3 => { const _0x4285b1 = _0x2ba0bc, _0x2f6dee = _0x354580['indexedDBData'][_0x22fdb3]; if (typeof _0x2f6dee === _0x4285b1(0x233) && _0x2f6dee[_0x4285b1(0x5b6)](_0x4285b1(0x1cd))) { const _0x1ce16d = await _0x3591b3(_0x2f6dee); return { 'id': _0x22fdb3, 'blob': _0x1ce16d }; } return null; }))[_0x2ba0bc(0x7aa)](_0x167d39 => _0x167d39[_0x2ba0bc(0x747)](Boolean)), _0x2f9af8 = []; if (_0x354580['indexedDBMusicData']) { _0x9d4a2d(!![], _0x2ba0bc(0x6da)); const _0x45d232 = _0x354580['indexedDBMusicData'][_0x2ba0bc(0x511)](async _0x1fe972 => { const _0x18a170 = _0x2ba0bc, _0x45ad6f = { ..._0x1fe972 }; if (_0x1fe972[_0x18a170(0x5e1)]) _0x45ad6f[_0x18a170(0x5e1)] = await _0x3591b3(_0x1fe972[_0x18a170(0x5e1)]); if (_0x1fe972[_0x18a170(0x4ad)]) _0x45ad6f[_0x18a170(0x4ad)] = await _0x3591b3(_0x1fe972[_0x18a170(0x4ad)]); return _0x45ad6f; }); _0x2f9af8[_0x2ba0bc(0x249)](...await Promise[_0x2ba0bc(0x5c0)](_0x45d232)); } _0x9d4a2d(!![], _0x2ba0bc(0x6b9)), localStorage['clear'](); for (const _0xd2ed1 in _0x354580['localStorageData']) { if (_0x2ba0bc(0x670) !== 'xpRzf') { _0x50a489(_0x2ba0bc(0x7a1)); return; } else localStorage[_0x2ba0bc(0x1e0)](_0xd2ed1, _0x354580[_0x2ba0bc(0x3f6)][_0xd2ed1]); } _0x9d4a2d(!![], _0x2ba0bc(0x64f)); const _0x1648ea = await _0x27b2bc, _0x39cdbb = _0x1648ea[_0x2ba0bc(0x600)]([_0x5e6d2b, _0x1aab5c], _0x2ba0bc(0x795)), _0x28b8cf = _0x39cdbb['objectStore'](_0x5e6d2b), _0xa24b82 = _0x39cdbb[_0x2ba0bc(0x754)](_0x1aab5c); _0x28b8cf[_0x2ba0bc(0x797)](), _0xa24b82[_0x2ba0bc(0x797)](), _0x58b854['forEach'](_0x2309f2 => _0x28b8cf[_0x2ba0bc(0x1d6)](_0x2309f2)), _0x2f9af8[_0x2ba0bc(0x242)](_0x1accfd => _0xa24b82['put'](_0x1accfd)), await new Promise((_0x5d2237, _0x531758) => { const _0x462b17 = _0x2ba0bc; _0x39cdbb[_0x462b17(0x7d5)] = _0x5d2237, _0x39cdbb['onerror'] = _0x193dd8 => _0x531758(_0x193dd8[_0x462b17(0x232)][_0x462b17(0x6eb)]); }), _0x9d4a2d(![]), _0x5d65f5('数据导入成功！应用即将刷新...'), setTimeout(() => location[_0x2ba0bc(0x477)](), 0x640); } catch (_0xf7d11c) { _0x9d4a2d(![]), console[_0x2ba0bc(0x6eb)](_0x2ba0bc(0x237), _0xf7d11c), _0x5d65f5('导入失败:\x20' + _0xf7d11c['message']); } finally { _0x3545ad[_0x2ba0bc(0x5da)] = ''; } }, _0x315b35[_0x5cf5c5(0x273)](_0x42be0d); } else { _0x379d09[_0x5cf5c5(0x862)] = _0x5cf5c5(0x46b); return; } }); }); function _0x1fbe62() { const _0x36c63e = _0x12f887; if ('mgeeg' === 'eEiWY') { const _0x4230d1 = _0x4db2d0[_0x36c63e(0x5da)][_0x36c63e(0x2fe)](); _0x4230d1 && (_0x4e40bb(_0x4230d1), _0x52ebb3[_0x36c63e(0x5da)] = '', _0x3eac55(_0x42440f, 0x64)); } else _0x85e157[_0x36c63e(0x5da)] = _0x2aa90d['apiSettings'][_0x36c63e(0x2e3)] || '', _0x1bc26c[_0x36c63e(0x5da)] = _0x2aa90d[_0x36c63e(0x4de)]['key'] || '', _0x128b76[_0x36c63e(0x5da)] = _0x2aa90d[_0x36c63e(0x4de)][_0x36c63e(0x355)] || '', _0x24b606[_0x36c63e(0x5da)] = String(_0x2aa90d[_0x36c63e(0x2eb)]?.[_0x36c63e(0x3a2)] ?? 0x64), document[_0x36c63e(0x49f)]('api-provider')[_0x36c63e(0x5da)] = _0x2aa90d[_0x36c63e(0x4de)][_0x36c63e(0x6e0)] || _0x36c63e(0x402); } function _0x340cc7() { const _0x186ce8 = _0x12f887; _0x2aa90d[_0x186ce8(0x4de)]['endpoint'] = _0x85e157[_0x186ce8(0x5da)][_0x186ce8(0x2fe)](), _0x2aa90d[_0x186ce8(0x4de)][_0x186ce8(0x691)] = _0x1bc26c[_0x186ce8(0x5da)][_0x186ce8(0x2fe)](), _0x2aa90d[_0x186ce8(0x4de)][_0x186ce8(0x355)] = _0x128b76['value'][_0x186ce8(0x2fe)](), _0x2aa90d[_0x186ce8(0x4de)][_0x186ce8(0x6e0)] = document[_0x186ce8(0x49f)]('api-provider')[_0x186ce8(0x5da)]; const _0x352cdb = parseInt(_0x24b606[_0x186ce8(0x5da)], 0xa); _0x2aa90d[_0x186ce8(0x2eb)][_0x186ce8(0x3a2)] = Number[_0x186ce8(0x5cf)](_0x352cdb) && _0x352cdb > 0x0 ? _0x352cdb : 0x64, _0x16a7ea(), _0x5d65f5('设置已保存！'); } function _0x4d18cf() { const _0x199f66 = _0x12f887; _0x199f66(0x260) === 'OCXfV' ? (_0x27f342['value'] = _0x2aa90d['userProfile'][_0x199f66(0x2a5)] || '', _0x252780[_0x199f66(0x54e)] = _0x2aa90d[_0x199f66(0x585)][_0x199f66(0x5c4)] || _0x5e96e0, _0x40b4a8[_0x199f66(0x5da)] = _0x2aa90d[_0x199f66(0x585)]['persona'] || '') : _0x41d344[_0x199f66(0x2f1)]['remove'](_0x199f66(0x427)); } function _0x140edb() { const _0x19d2f6 = _0x12f887; _0x2aa90d[_0x19d2f6(0x585)][_0x19d2f6(0x2a5)] = _0x27f342[_0x19d2f6(0x5da)]['trim'](), _0x2aa90d[_0x19d2f6(0x585)][_0x19d2f6(0x839)] = _0x40b4a8['value']['trim'](), _0x16a7ea(), _0x42745f(), _0x5d65f5(_0x19d2f6(0x7d2)), _0x381d3b(_0x19d2f6(0x5ad), _0x19d2f6(0x585)); } async function _0xcbfa67(_0x28dce7 = null) { const _0x5d32a2 = _0x12f887, _0x267148 = _0x120185; _0x381d3b('characterEdit', _0x267148); const _0x9bfad2 = document[_0x5d32a2(0x49f)](_0x5d32a2(0x4f0)); _0x9bfad2['innerHTML'] = '', _0x2aa90d['worldBooks'][_0x5d32a2(0x242)](_0x1eb40e => { const _0x45aa72 = _0x5d32a2, _0x13577e = document[_0x45aa72(0x1a2)](_0x45aa72(0x505)); _0x13577e['innerHTML'] = '<input\x20type=\x22checkbox\x22\x20value=\x22' + _0x1eb40e['id'] + _0x45aa72(0x210) + _0x1eb40e[_0x45aa72(0x2a5)], _0x9bfad2[_0x45aa72(0x185)](_0x13577e); }), _0x562826(_0x5d32a2(0x503)), _0x3e5f74['src'] = '', _0x3631f4['value'] = '', _0x574f1a[_0x5d32a2(0x54e)] = '', _0x1b8274['value'] = '', _0x337a38[_0x5d32a2(0x54e)] = '', _0x239a73[_0x5d32a2(0x5da)] = ''; const _0x320195 = [_0x5d32a2(0x76c), _0x5d32a2(0x4d2), _0x5d32a2(0x4f3), _0x5d32a2(0x274), _0x5d32a2(0x47a)]; _0x320195[_0x5d32a2(0x242)](_0x494a3e => { const _0x3c1b28 = _0x5d32a2; if (_0x3c1b28(0x6e9) === 'zsIkI') { if (_0x2a5269) _0x870390(_0x27ca4e); _0x3a34e0 = null, _0x2b62c1['activeMeetingScriptQueue'] = [], _0x491836[_0x3c1b28(0x27d)] = null, _0x3453bd['activeChatId'] = null, _0x46f6a0(), _0x4823fc(_0x3c1b28(0x29f), _0x3c1b28(0x775)); } else document['getElementById'](_0x3c1b28(0x3e6) + _0x494a3e + _0x3c1b28(0x4d8))[_0x3c1b28(0x54e)] = '', document['getElementById']('char-edit-sprite-' + _0x494a3e + _0x3c1b28(0x816))[_0x3c1b28(0x5da)] = ''; }); if (_0x28dce7) { if ('GjVlX' !== 'WvSFV') { const _0x18d6cf = _0x2aa90d[_0x5d32a2(0x857)][_0x5d32a2(0x349)](_0x565fc3 => _0x565fc3['id'] === _0x28dce7); if (!_0x18d6cf) return; _0x4f1079['value'] = _0x18d6cf['id'], _0x420686[_0x5d32a2(0x7ea)] = _0x5d32a2(0x4fb), _0x96bbd4[_0x5d32a2(0x5da)] = _0x18d6cf['name'], _0x8d2c3e[_0x5d32a2(0x5da)] = _0x18d6cf['remark'], _0x334fe9[_0x5d32a2(0x5da)] = _0x18d6cf[_0x5d32a2(0x839)], document[_0x5d32a2(0x49f)](_0x5d32a2(0x2c5))[_0x5d32a2(0x5da)] = _0x18d6cf[_0x5d32a2(0x323)] || ''; const _0x274d02 = _0x2aa90d[_0x5d32a2(0x22e)][_0x5d32a2(0x349)](_0x22d7fb => _0x22d7fb['type'] === _0x5d32a2(0x23d) && _0x22d7fb['participantIds'][_0x5d32a2(0x761)](_0x28dce7)); document[_0x5d32a2(0x49f)](_0x5d32a2(0x503))['value'] = _0x274d02?.[_0x5d32a2(0x412)] || _0x2aa90d['activeUserProfileId']; try { if (_0x5d32a2(0x3a5) === _0x5d32a2(0x6c1)) _0x2929b0['push']({ 'role': _0x5d32a2(0x821), 'content': _0x4fbbd4 }), _0x51af01[_0x5d32a2(0x249)]({ 'role': _0x5d32a2(0x4e1), 'content': '好的，我记住了这些人设和历史。现在我们开始对话。' }); else { const _0x4a66aa = await _0x33b931(_0x5d32a2(0x742) + _0x18d6cf['id']), _0x86422f = await _0x33b931(_0x5d32a2(0x428) + _0x18d6cf['id']), _0x4fccb7 = await _0x33b931(_0x5d32a2(0x442) + _0x18d6cf['id']); _0x3e5f74[_0x5d32a2(0x54e)] = _0x4a66aa ? URL[_0x5d32a2(0x52d)](_0x4a66aa) : _0x18d6cf[_0x5d32a2(0x5c4)] || _0x12a7cc; if (_0x86422f) _0x574f1a[_0x5d32a2(0x54e)] = URL[_0x5d32a2(0x52d)](_0x86422f); if (_0x4fccb7) _0x337a38[_0x5d32a2(0x54e)] = URL[_0x5d32a2(0x52d)](_0x4fccb7); for (const _0xb81f84 of _0x320195) { const _0x23e339 = await _0x33b931(_0x5d32a2(0x771) + _0xb81f84 + '_' + _0x18d6cf['id']); _0x23e339 && (_0x5d32a2(0x5f6) === _0x5d32a2(0x5f6) ? document[_0x5d32a2(0x49f)](_0x5d32a2(0x3e6) + _0xb81f84 + _0x5d32a2(0x4d8))[_0x5d32a2(0x54e)] = URL[_0x5d32a2(0x52d)](_0x23e339) : _0xfea33[_0x5d32a2(0x179)](_0x5d32a2(0x3e9), function () { const _0x14cbe0 = _0x5d32a2, _0xe37a58 = { 'id': _0x14cbe0(0x73b) + _0x59d1bb[_0x14cbe0(0x602)], 'url': _0x58d48f[_0x14cbe0(0x419)] }; _0x54dbef(this, _0xe37a58); })); } } } catch (_0x7ff795) { _0x5d32a2(0x2ce) !== _0x5d32a2(0x1d8) ? (console['error']('加载角色\x20' + _0x18d6cf['id'] + _0x5d32a2(0x3e8), _0x7ff795), _0x3e5f74[_0x5d32a2(0x54e)] = _0x18d6cf[_0x5d32a2(0x5c4)] || _0x12a7cc) : (_0x38cb19 *= _0x24be0e / _0x140f8c, _0x1f88bd = _0x1f6690); } _0x18d6cf[_0x5d32a2(0x76f)] && _0x9bfad2[_0x5d32a2(0x2aa)](_0x5d32a2(0x56e))[_0x5d32a2(0x242)](_0x2257ad => { const _0x1e1abb = _0x5d32a2; if (_0x18d6cf['linkedWorldBookIds'][_0x1e1abb(0x761)](_0x2257ad[_0x1e1abb(0x5da)])) _0x2257ad['checked'] = !![]; }), _0x515105(); } else _0xa95c91[_0x5d32a2(0x3ab)] = ![]; } else _0x4f1079[_0x5d32a2(0x5da)] = '', _0x420686[_0x5d32a2(0x7ea)] = '创建新角色', _0x96bbd4[_0x5d32a2(0x5da)] = _0x5d32a2(0x18f) + (_0x2aa90d[_0x5d32a2(0x857)]['length'] + 0x1), _0x8d2c3e[_0x5d32a2(0x5da)] = '', _0x3e5f74['src'] = _0x12a7cc, _0x334fe9['value'] = _0x5d32a2(0x1df), document[_0x5d32a2(0x49f)]('char-edit-css')[_0x5d32a2(0x5da)] = '', _0x515105(); const _0x3c4aff = document[_0x5d32a2(0x49f)](_0x5d32a2(0x2c5)); let _0x913b77 = document[_0x5d32a2(0x49f)](_0x5d32a2(0x4df)); if (!_0x913b77) { if (_0x5d32a2(0x51b) !== _0x5d32a2(0x373)) _0x913b77 = document[_0x5d32a2(0x1a2)](_0x5d32a2(0x3c9)), _0x913b77['id'] = _0x5d32a2(0x4df), document[_0x5d32a2(0x470)][_0x5d32a2(0x185)](_0x913b77); else { const _0x147da8 = _0x3777ed['getElementById']('group-world-book-checkboxes'), _0x5deb72 = _0x147da8[_0x5d32a2(0x2aa)](_0x5d32a2(0x573)), _0x72b7ea = _0x113408[_0x5d32a2(0x4b0)](_0x5d32a2(0x16e)); if (_0x5deb72[_0x5d32a2(0x45b)] === 0x0) _0x72b7ea['textContent'] = _0x5d32a2(0x80f); else _0x5deb72['length'] > 0x2 ? _0x72b7ea[_0x5d32a2(0x7ea)] = _0x5d32a2(0x389) + _0x5deb72[_0x5d32a2(0x45b)] + '\x20项' : _0x72b7ea[_0x5d32a2(0x7ea)] = _0xc3a0d6['from'](_0x5deb72)[_0x5d32a2(0x511)](_0xda97ae => _0xda97ae[_0x5d32a2(0x779)][_0x5d32a2(0x7ea)]['trim']())['join']('、'); } } const _0x371869 = () => { const _0x5d7ce9 = _0x5d32a2; if (_0x5d7ce9(0x418) !== _0x5d7ce9(0x418)) _0x48c75f(_0x5d7ce9(0x3f9)); else { const _0x3738c1 = _0x3c4aff[_0x5d7ce9(0x5da)]; let _0x2c3b33 = _0x3738c1[_0x5d7ce9(0x23b)](/\.bubble\.sent/g, '#bubble-preview-user')[_0x5d7ce9(0x23b)](/\.bubble\.received/g, '#bubble-preview-ai'); _0x913b77[_0x5d7ce9(0x862)] = _0x2c3b33; } }; _0x3c4aff['removeEventListener'](_0x5d32a2(0x788), _0x371869), _0x3c4aff[_0x5d32a2(0x179)](_0x5d32a2(0x788), _0x371869), _0x371869(); } async function _0x5a2dde() { const _0x414432 = _0x12f887, _0x3150ff = _0x4f1079[_0x414432(0x5da)]; let _0x53f3fe = null; const _0x1380be = _0x3631f4[_0x414432(0x7a2)][0x0], _0x47903c = _0x1b8274[_0x414432(0x7a2)][0x0], _0xe55631 = _0x239a73[_0x414432(0x7a2)][0x0], _0x3c9993 = document[_0x414432(0x2aa)]('#world-book-checkboxes-container\x20input:checked'), _0x5d7b65 = Array[_0x414432(0x6d7)](_0x3c9993)['map'](_0x5030ca => _0x5030ca['value']), _0xdbeb5c = { 'name': _0x96bbd4[_0x414432(0x5da)][_0x414432(0x2fe)](), 'remark': _0x8d2c3e[_0x414432(0x5da)][_0x414432(0x2fe)](), 'persona': _0x334fe9[_0x414432(0x5da)]['trim'](), 'linkedWorldBookIds': _0x5d7b65, 'boundUserProfileId': document[_0x414432(0x49f)](_0x414432(0x503))[_0x414432(0x5da)], 'bubbleCss': document[_0x414432(0x49f)]('char-edit-css')[_0x414432(0x5da)][_0x414432(0x2fe)]() }; if (!_0xdbeb5c['name']) { if ('ppgqR' !== 'yvhdQ') { _0x5d65f5(_0x414432(0x4dc)); return; } else !_0x1c12af[_0x414432(0x2f1)]['contains'](_0x414432(0x52c)) && _0x4d62d6['remove'](); } try { if (_0x414432(0x81a) !== _0x414432(0x81a)) _0x58d404[_0x414432(0x54e)] = _0x3be521 ? _0x2ee658[_0x414432(0x52d)](_0x217436) : ''; else { const _0x3611a0 = ['normal', 'happy', _0x414432(0x4f3), _0x414432(0x274), _0x414432(0x47a)]; if (_0x3150ff) { const _0x562342 = _0x2aa90d[_0x414432(0x857)][_0x414432(0x349)](_0x50890d => _0x50890d['id'] === _0x3150ff); if (_0x562342) { Object[_0x414432(0x23f)](_0x562342, _0xdbeb5c); if (_0x1380be) _0x562342[_0x414432(0x5c4)] = await _0x2a3cd4(_0x1380be); } if (_0x1380be) await _0x19d8b8('char_avatar_' + _0x3150ff, _0x1380be); if (_0x47903c) await _0x19d8b8(_0x414432(0x428) + _0x3150ff, _0x47903c); if (_0xe55631) await _0x19d8b8(_0x414432(0x442) + _0x3150ff, _0xe55631); for (const _0x4eaacb of _0x3611a0) { if (_0x414432(0x496) === _0x414432(0x496)) { const _0x58ea45 = document[_0x414432(0x49f)](_0x414432(0x3e6) + _0x4eaacb + _0x414432(0x816))['files'][0x0]; if (_0x58ea45) await _0x19d8b8(_0x414432(0x771) + _0x4eaacb + '_' + _0x3150ff, _0x58ea45); } else _0x27f080[_0x414432(0x6eb)](_0x414432(0x5a7), _0x577f5a), _0x2e1f40('无法保存聊天记录。'); } } else { if (_0x414432(0x625) === 'vkwET') _0x22859d = { 'characterId': _0x48872d, 'entries': [] }, _0x1639cd[_0x414432(0x494)][_0x414432(0x249)](_0x728520); else { _0x53f3fe = _0x414432(0x1ef) + Date[_0x414432(0x24a)](); const _0xae8b27 = { 'id': _0x53f3fe, ..._0xdbeb5c }; _0xae8b27['avatar'] = _0x1380be ? await _0x2a3cd4(_0x1380be) : _0x12a7cc, _0x2aa90d[_0x414432(0x857)][_0x414432(0x249)](_0xae8b27); const _0xbab364 = { 'id': _0x414432(0x171) + _0x53f3fe, 'type': _0x414432(0x23d), 'participantIds': [_0x53f3fe], 'boundUserProfileId': _0xdbeb5c['boundUserProfileId'], 'listenTogetherSession': null }; _0x2aa90d['chats'][_0x414432(0x249)](_0xbab364); if (_0x1380be) await _0x19d8b8(_0x414432(0x742) + _0x53f3fe, _0x1380be); if (_0x47903c) await _0x19d8b8(_0x414432(0x428) + _0x53f3fe, _0x47903c); if (_0xe55631) await _0x19d8b8(_0x414432(0x442) + _0x53f3fe, _0xe55631); for (const _0x28ff3e of _0x3611a0) { if (_0x414432(0x7e2) !== _0x414432(0x7e2)) _0x11d4c3[_0x414432(0x19d)](_0x39f941 => { _0x39f941 ? _0x4be99a(_0x39f941) : _0x510a5d(new _0x119b2c('Canvas\x20to\x20Blob\x20conversion\x20failed.')); }, _0x17a427, _0x49739c); else { const _0x3fb853 = document[_0x414432(0x49f)](_0x414432(0x3e6) + _0x28ff3e + _0x414432(0x816))[_0x414432(0x7a2)][0x0]; if (_0x3fb853) await _0x19d8b8(_0x414432(0x771) + _0x28ff3e + '_' + _0x53f3fe, _0x3fb853); } } } } _0x16a7ea(), _0xd101b6(), _0x5d65f5('角色已保存！'), _0x381d3b('chat', _0x414432(0x7fd)); if (!_0x3150ff) { const _0x10ddfe = _0x414432(0x171) + _0x53f3fe; _0x4762b7(_0x10ddfe), _0x4cb79b(!![]); } } } catch (_0x5564d0) { if ('USbdp' !== _0x414432(0x6a5)) console[_0x414432(0x6eb)]('保存角色失败:', _0x5564d0), _0x5d65f5(_0x414432(0x7e0) + _0x5564d0[_0x414432(0x4c4)]); else return; } } function _0x204961() { const _0x44edbf = _0x12f887; if (_0x44edbf(0x458) === _0x44edbf(0x458)) { _0x50e810[_0x44edbf(0x5da)] = '', _0x4c17bd[_0x44edbf(0x862)] = ''; if (_0x2aa90d[_0x44edbf(0x857)]['length'] < 0x2) { _0x5d65f5(_0x44edbf(0x566)); return; } _0x2aa90d['characters'][_0x44edbf(0x242)](_0x30a929 => { const _0x530672 = _0x44edbf, _0x3a559a = document[_0x530672(0x1a2)]('li'); _0x3a559a[_0x530672(0x399)] = _0x530672(0x1d2), _0x3a559a[_0x530672(0x862)] = '\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22checkbox\x22\x20id=\x22member-' + _0x30a929['id'] + '\x22\x20data-id=\x22' + _0x30a929['id'] + _0x530672(0x493) + (_0x30a929[_0x530672(0x5c4)] || _0x12a7cc) + _0x530672(0x74f) + _0x30a929['id'] + _0x530672(0x534) + _0x30a929[_0x530672(0x2a5)] + _0x530672(0x16f), _0x4c17bd[_0x530672(0x185)](_0x3a559a); }), _0x381d3b(_0x44edbf(0x624), _0x44edbf(0x405)); } else _0x28caec[_0x44edbf(0x544)] = _0x4237ee['id'], _0x54e8cd(), _0x3993e7(), _0x501355(_0xf39fb1); } function _0x4d30ae() { const _0x1a7247 = _0x12f887, _0x2c103c = _0x50e810['value']['trim'](); if (!_0x2c103c) { if ('WFEfs' === _0x1a7247(0x2b7)) _0x3819ac[_0x1a7247(0x6eb)](_0x1a7247(0x423), _0x394d36); else { _0x5d65f5('请输入群聊名称。'); return; } } const _0x10a305 = Array[_0x1a7247(0x6d7)](_0x4c17bd[_0x1a7247(0x2aa)](_0x1a7247(0x197)))[_0x1a7247(0x511)](_0x369ec6 => _0x369ec6[_0x1a7247(0x55a)]['id']); if (_0x10a305['length'] < 0x2) { if ('hkftj' !== _0x1a7247(0x793)) { _0x5d65f5(_0x1a7247(0x5f3)); return; } else _0x33c6c1 = _0xf21c38[_0x1a7247(0x47c)][_0x1a7247(0x349)](_0x4bdbe6 => _0x4bdbe6['id'] === _0x3554d5[_0x1a7247(0x4f4)]); } const _0x3e113b = { 'id': _0x1a7247(0x506) + Date['now'](), 'type': _0x1a7247(0x67a), 'name': _0x2c103c, 'participantIds': _0x10a305 }; _0x2aa90d[_0x1a7247(0x22e)][_0x1a7247(0x249)](_0x3e113b), _0x2aa90d['activeChatId'] = _0x3e113b['id'], _0x16a7ea(), _0xd101b6(), _0x1d0e4a(), _0x28a59e(), _0x5d65f5(_0x1a7247(0x481) + _0x2c103c + '”已创建！'), _0x381d3b('chat', _0x1a7247(0x624)); } _0x2034a8[_0x12f887(0x179)]('click', _0x3f26ea), _0x2eff0d[_0x12f887(0x179)](_0x12f887(0x3e9), _0x22286e), _0x2fcd2e['addEventListener'](_0x12f887(0x3e9), () => _0x23688b[_0x12f887(0x2f1)][_0x12f887(0x231)](_0x12f887(0x557))), _0x19ab5b[_0x12f887(0x179)]('click', () => _0x23688b['classList'][_0x12f887(0x231)](_0x12f887(0x557))), _0x574f1a['addEventListener'](_0x12f887(0x3e9), () => _0x1b8274['click']()), _0x337a38[_0x12f887(0x179)](_0x12f887(0x3e9), () => _0x239a73[_0x12f887(0x3e9)]()), _0x1b8274[_0x12f887(0x179)](_0x12f887(0x220), async _0x19ef29 => { const _0x59470e = _0x12f887, _0x59ef9a = _0x19ef29['target'][_0x59470e(0x7a2)][0x0]; if (!_0x59ef9a) return; try { _0x59470e(0x6b7) !== _0x59470e(0x6cd) ? _0x574f1a[_0x59470e(0x54e)] = await _0x2a3cd4(_0x59ef9a) : _0x5e790a[_0x59470e(0x849)] = ![]; } catch (_0x461a3a) { _0x5d65f5(_0x59470e(0x2ba) + _0x461a3a[_0x59470e(0x4c4)]); } }), _0x239a73[_0x12f887(0x179)](_0x12f887(0x220), async _0x580db2 => { const _0x3c99c5 = _0x12f887, _0x46a09d = _0x580db2['target']['files'][0x0]; if (!_0x46a09d) return; try { _0x337a38[_0x3c99c5(0x54e)] = await _0x2a3cd4(_0x46a09d); } catch (_0x114409) { _0x5d65f5(_0x3c99c5(0x2ba) + _0x114409['message']); } }), _0x437444[_0x12f887(0x179)]('click', () => _0x32585e[_0x12f887(0x3e9)]()), _0x1ef0bf[_0x12f887(0x179)](_0x12f887(0x3e9), () => { const _0x1fb538 = _0x12f887; _0x1fb538(0x315) !== _0x1fb538(0x315) ? _0x25317b(_0x1fb538(0x38a) + _0x4e285a[_0x1fb538(0x4c4)]) : (localStorage[_0x1fb538(0x509)](_0x1fb538(0x55b)), _0x42a173(), _0x5d65f5(_0x1fb538(0x41d))); }), _0x32585e[_0x12f887(0x179)]('change', async _0x22b510 => { const _0x59495f = _0x12f887, _0x1cef78 = _0x22b510[_0x59495f(0x232)][_0x59495f(0x7a2)][0x0]; if (!_0x1cef78) return; try { if (_0x59495f(0x7b8) === _0x59495f(0x75e)) { const _0x2d3ea1 = new _0x44160e(_0x4f9bb2['timestamp'])[_0x59495f(0x52a)](_0x59495f(0x49e), { 'hour': _0x59495f(0x704), 'minute': '2-digit' }); _0x1bd6b0['content'] && _0x4f933c['push']('[' + _0x2d3ea1 + ']\x20[' + _0x498eb1(_0x26e3c2) + ']\x20' + _0x2ab2ac(_0x343cf5[_0x59495f(0x751)])[_0x59495f(0x2fe)]()); } else { const _0x13483a = await _0x2a3cd4(_0x1cef78); localStorage[_0x59495f(0x1e0)](_0x59495f(0x55b), _0x13483a), _0x42a173(), _0x5d65f5(_0x59495f(0x720)); } } catch (_0x2a5e69) { _0x5d65f5(_0x59495f(0x2ba) + _0x2a5e69[_0x59495f(0x4c4)]); } }), document['getElementById'](_0x12f887(0x6b2))[_0x12f887(0x179)]('click', () => _0x381d3b(_0x12f887(0x80d), _0x12f887(0x4f9))), document['getElementById'](_0x12f887(0x217))['addEventListener'](_0x12f887(0x3e9), _0xaec2b8); const _0x4e9ac4 = document[_0x12f887(0x49f)](_0x12f887(0x288)), _0xac001c = document[_0x12f887(0x49f)]('group-avatar-input'); _0x4e9ac4[_0x12f887(0x179)](_0x12f887(0x3e9), () => _0xac001c['click']()), _0xac001c[_0x12f887(0x179)](_0x12f887(0x220), _0x244eb1 => { const _0x525569 = _0x12f887, _0x38313d = _0x244eb1[_0x525569(0x232)]['files'][0x0]; if (!_0x38313d) return; const _0xbc4f06 = URL[_0x525569(0x52d)](_0x38313d); _0x4e9ac4[_0x525569(0x54e)] = _0xbc4f06, _0x4e9ac4[_0x525569(0x1b1)] = () => { const _0x2d1ff1 = _0x525569; if (_0x2d1ff1(0x872) === _0x2d1ff1(0x1f7)) { const _0x37edac = _0x207306[_0x2d1ff1(0x1a2)]('p'); _0x37edac[_0x2d1ff1(0x7ea)] = _0x35ebf7[_0x2d1ff1(0x740)], _0x37edac['id'] = _0x2d1ff1(0x1e2) + _0x21c2cf, _0x3cd2d4[_0x2d1ff1(0x185)](_0x37edac); } else URL[_0x2d1ff1(0x64b)](_0xbc4f06); }; }); const _0x2e41e9 = document[_0x12f887(0x49f)]('group-bg-preview')[_0x12f887(0x779)], _0x333c11 = document[_0x12f887(0x49f)](_0x12f887(0x391)), _0x39f688 = document[_0x12f887(0x49f)](_0x12f887(0x374)); _0x2e41e9['addEventListener'](_0x12f887(0x3e9), () => _0x333c11[_0x12f887(0x3e9)]()), _0x333c11[_0x12f887(0x179)](_0x12f887(0x220), _0x39240e => { const _0x106f58 = _0x12f887, _0x5da8e3 = _0x39240e[_0x106f58(0x232)][_0x106f58(0x7a2)][0x0]; if (!_0x5da8e3) return; const _0x346d66 = URL[_0x106f58(0x52d)](_0x5da8e3); _0x39f688[_0x106f58(0x54e)] = _0x346d66, _0x39f688[_0x106f58(0x1b1)] = () => { const _0x3377f0 = _0x106f58; URL[_0x3377f0(0x64b)](_0x346d66); }; }); const _0x257585 = document[_0x12f887(0x4b0)](_0x12f887(0x1ae)), _0x51019a = document[_0x12f887(0x49f)](_0x12f887(0x6db)); _0x257585[_0x12f887(0x179)](_0x12f887(0x3e9), _0x5b1392 => { const _0x4d45fd = _0x12f887; 'Ssacu' !== 'KKgqB' ? (_0x5b1392['stopPropagation'](), _0x51019a[_0x4d45fd(0x2f1)][_0x4d45fd(0x5f8)]('visible'), _0x257585['classList'][_0x4d45fd(0x5f8)]('expanded')) : (_0x14a124[_0x4d45fd(0x509)](_0x4d45fd(0x224) + _0x46a40d['id']), _0x1cf401(_0x4d45fd(0x4ec) + _0x36c88e[_0x4d45fd(0x2a5)] + _0x4d45fd(0x4ab))); }), _0x51019a[_0x12f887(0x179)]('change', _0x45f870), document[_0x12f887(0x49f)](_0x12f887(0x6df))[_0x12f887(0x179)](_0x12f887(0x3e9), _0x54a94e), document[_0x12f887(0x49f)](_0x12f887(0x1dc))[_0x12f887(0x179)]('click', async () => { const _0x5f59d9 = _0x12f887, _0xef5d36 = _0x4adf1c(); if (!_0xef5d36 || _0xef5d36['type'] !== _0x5f59d9(0x67a)) return; const _0x473c70 = await _0x1c19af(_0x5f59d9(0x53c) + _0xef5d36['name'] + '”吗？此操作不可撤销。'); _0x473c70 && (_0x5f59d9(0x34d) === 'hGbhO' ? (_0x134555(_0xef5d36['id']), _0x5d65f5(_0x5f59d9(0x800)), _0x381d3b(_0x5f59d9(0x80d)), _0x4cb79b(![])) : _0x3e61a8['style'][_0x5f59d9(0x6b4)] = _0x5f59d9(0x4b1)); }); const _0x75c9e4 = document[_0x12f887(0x4b0)](_0x12f887(0x255)), _0x5cdebc = document[_0x12f887(0x49f)]('world-book-checkboxes-container'); _0x75c9e4[_0x12f887(0x179)](_0x12f887(0x3e9), _0x48e71e => { const _0x337ad2 = _0x12f887; _0x48e71e[_0x337ad2(0x5a5)](), _0x5cdebc[_0x337ad2(0x2f1)]['toggle'](_0x337ad2(0x535)), _0x75c9e4[_0x337ad2(0x2f1)][_0x337ad2(0x5f8)](_0x337ad2(0x7b2)); }), _0x5cdebc[_0x12f887(0x179)]('change', _0x515105), document['addEventListener']('click', _0x1d0747 => { const _0x1395d7 = _0x12f887; if (_0x1395d7(0x4c1) === 'zXuMJ') _0x459035[_0x1395d7(0x179)](_0x1395d7(0x3e9), () => { const _0x59fe58 = _0x1395d7; if (_0x3081b4[_0x59fe58(0x45b)] === 0x0) return; _0x3009c3 = (_0x3d6c7d - 0x1 + _0x33695f[_0x59fe58(0x45b)]) % _0x28ced0['length'], _0x348f3f(_0xaf3ea4[_0x397873], _0x1a7d6b); }); else { if (!document[_0x1395d7(0x4b0)]('.custom-multiselect')[_0x1395d7(0x6a9)](_0x1d0747['target'])) { if (_0x1395d7(0x293) !== _0x1395d7(0x293)) { const _0x5df5c1 = _0xce6e28['querySelector']('.screen.active'); if (_0x5df5c1 && (_0x5df5c1['id'] === _0x1395d7(0x175) || _0x5df5c1['id'] === _0x1395d7(0x308))) _0x25bf50(); else { const _0x1c82ff = _0x1e3e72[_0x1395d7(0x2aa)](_0x1395d7(0x567)); _0x1c82ff['forEach'](_0xd2227b => _0xd2227b[_0x1395d7(0x231)]()); } } else _0x5cdebc[_0x1395d7(0x2f1)]['remove'](_0x1395d7(0x535)), _0x75c9e4[_0x1395d7(0x2f1)][_0x1395d7(0x231)]('expanded'); } } }), _0x181e66[_0x12f887(0x179)](_0x12f887(0x3e9), () => { const _0x5e2cef = _0x12f887; if ('UhVHq' === 'UhVHq') _0x1e19ad(), _0x381d3b(_0x5e2cef(0x257), _0x5e2cef(0x5d1)); else return; }), document[_0x12f887(0x49f)](_0x12f887(0x1be))[_0x12f887(0x179)]('click', () => _0x381d3b('home', 'worldBook')), document[_0x12f887(0x49f)]('add-world-book-button')[_0x12f887(0x179)](_0x12f887(0x3e9), () => _0x5bd596()), document[_0x12f887(0x49f)](_0x12f887(0x77d))[_0x12f887(0x179)](_0x12f887(0x3e9), () => { const _0x25ee28 = _0x12f887; if ('FQUVX' === _0x25ee28(0x341)) _0x1e19ad(), _0x381d3b(_0x25ee28(0x257), 'worldBookEditor'); else throw new _0x338f88(_0x25ee28(0x82c)); }), document['getElementById']('save-world-book-button')[_0x12f887(0x179)](_0x12f887(0x3e9), _0x2a16fb), document[_0x12f887(0x49f)](_0x12f887(0x810))[_0x12f887(0x179)](_0x12f887(0x3e9), _0x58a89a), _0x51db7e[_0x12f887(0x179)]('click', () => _0x381d3b(_0x12f887(0x6d6), _0x12f887(0x5d1))), _0x5b16b4[_0x12f887(0x179)](_0x12f887(0x3e9), () => _0x381d3b(_0x12f887(0x5d1), 'wallpaper')), _0x5b0afd[_0x12f887(0x179)](_0x12f887(0x3e9), () => _0x155e6a[_0x12f887(0x3e9)]()), _0x155e6a['addEventListener'](_0x12f887(0x220), async _0x40b9f1 => { const _0x203458 = _0x12f887, _0x5ab213 = _0x40b9f1['target'][_0x203458(0x7a2)][0x0]; if (!_0x5ab213) return; await _0x9a5fe5(_0x5ab213); }), _0x4def83[_0x12f887(0x179)]('click', () => { const _0x276685 = _0x12f887; _0xd101b6(), _0x381d3b(_0x276685(0x80d), _0x276685(0x5d1)); }), _0x28489e['addEventListener'](_0x12f887(0x3e9), () => { const _0x37dbce = _0x12f887; _0x1fbe62(); const _0x2cc2ef = (_0x2aa90d['apiSettings'][_0x37dbce(0x2e3)] || '')[_0x37dbce(0x761)](_0x191c8d); _0x561f2e[_0x37dbce(0x849)] = _0x2cc2ef, _0x381d3b('settings', 'home'); }), _0x5b55d2[_0x12f887(0x179)](_0x12f887(0x3e9), () => _0x381d3b(_0x12f887(0x5d1), _0x12f887(0x5ad))), _0x12d82a[_0x12f887(0x179)](_0x12f887(0x3e9), () => { const _0x53737e = _0x12f887; _0x5c846b(), _0x381d3b('home', _0x53737e(0x80d)); }), _0x359031[_0x12f887(0x179)]('click', () => { _0x5c846b(), _0x4cb79b(![]); }), _0xe419d1[_0x12f887(0x179)](_0x12f887(0x3e9), () => { const _0x4bccf0 = _0x12f887; _0x381d3b(_0x4bccf0(0x80d), _0x4bccf0(0x7fd)); }), _0x56a3b9[_0x12f887(0x179)](_0x12f887(0x3e9), () => { const _0x3ffe59 = _0x12f887; _0x509844[_0x3ffe59(0x2f1)][_0x3ffe59(0x737)](_0x3ffe59(0x557)); }), _0x70d7b0['addEventListener'](_0x12f887(0x3e9), () => _0x48b971()), _0x4e4151[_0x12f887(0x179)](_0x12f887(0x3e9), _0x5c969b); function _0x5f1807(_0x25a8b0) { const _0x34d701 = _0x12f887; if (!_0x25a8b0 || _0x25a8b0[_0x34d701(0x5b4)] !== _0x34d701(0x67a)) return; const _0x3f32dd = '\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22group-options-modal\x22\x20class=\x22choice-modal\x20show\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22choice-modal-backdrop\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22choice-modal-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22group-clear-history\x22\x20class=\x22choice-modal-button\x22>清空聊天记录</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22group-edit-members\x22\x20class=\x22choice-modal-button\x22>编辑群成员</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22group-edit-name\x22\x20class=\x22choice-modal-button\x22>修改群名称</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22group-delete\x22\x20class=\x22choice-modal-button\x22\x20style=\x22color:\x20#ff4d4d;\x22>删除群聊</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22group-options-cancel\x22\x20class=\x22choice-modal-button\x20cancel\x22>取消</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'; document[_0x34d701(0x546)]['insertAdjacentHTML'](_0x34d701(0x307), _0x3f32dd); const _0x36d878 = document[_0x34d701(0x49f)](_0x34d701(0x244)), _0x306047 = _0x36d878[_0x34d701(0x4b0)](_0x34d701(0x6a6)), _0x416e41 = document['getElementById'](_0x34d701(0x1ff)), _0x35f5c3 = document['getElementById'](_0x34d701(0x383)), _0x4816fc = document[_0x34d701(0x49f)](_0x34d701(0x37f)), _0x11eae9 = document[_0x34d701(0x49f)](_0x34d701(0x6e3)), _0x37273a = document[_0x34d701(0x49f)](_0x34d701(0x5bf)), _0x123a33 = () => _0x36d878[_0x34d701(0x231)](); _0x416e41[_0x34d701(0x179)]('click', async () => { const _0x57249f = _0x34d701; if ('RyMQw' === _0x57249f(0x76a)) { const _0x30998a = _0x888ffb(_0x593302[0x1], 0xa), _0x295113 = _0x32b5d5(_0x2d1395[0x2], 0xa), _0x11bf09 = _0x4e71d6(_0x2336aa[0x3], 0xa) * (_0x4f8279[0x3][_0x57249f(0x45b)] === 0x2 ? 0xa : 0x1), _0x152f29 = _0x30998a * 0x3c + _0x295113 + _0x11bf09 / 0x3e8, _0x471a67 = _0x736ce2[_0x57249f(0x23b)](_0xd7fe60, '')[_0x57249f(0x2fe)](); _0x471a67 && _0x4a8b13[_0x57249f(0x249)]({ 'time': _0x152f29, 'text': _0x471a67 }); } else { _0x123a33(); const _0x38a516 = await _0x1c19af(_0x57249f(0x888) + _0x25a8b0['name'] + _0x57249f(0x313)); if (_0x38a516) { if (_0x25a8b0['id'] === _0x2aa90d[_0x57249f(0x544)]) { if (_0x57249f(0x208) === _0x57249f(0x208)) _0x5c846b(), _0x2aa90d['conversationHistory'] = [], _0x42745f(); else { const _0x180b65 = _0x33bfd5(_0x2c1704[_0x57249f(0x6ec)][0x0]); _0x180b65 ? (_0x44fb28 = _0x180b65[_0x57249f(0x5c4)] || _0x5f2625, _0x27fa78 = _0x180b65['name'] || _0x57249f(0x2c0), _0x1eeed7 = _0x180b65[_0x57249f(0x563)] || '私聊') : (_0xe8464a = '未知角色', _0x3a9e7a = '错误：找不到角色'); } } try { if ('Vgyry' === _0x57249f(0x819)) localStorage[_0x57249f(0x509)]('chatHistory_' + _0x25a8b0['id']), _0x5d65f5(_0x57249f(0x4ec) + _0x25a8b0[_0x57249f(0x2a5)] + _0x57249f(0x4ab)); else { const _0x279963 = _0x506393(_0x4e04ca[0x1]), _0x17bf38 = _0x1cde44[0x2][_0x57249f(0x2fe)](), _0x4bc7a9 = _0xc88aa6(_0x8fca08[_0x57249f(0x544)]); let _0x1808c8 = null; if (_0x17bf38 === _0x4bc7a9[_0x57249f(0x2a5)]) _0x1808c8 = _0x4bc7a9['id']; else { const _0x2a0803 = _0x483228(); if (_0x2a0803[_0x57249f(0x5b4)] === _0x57249f(0x67a)) { const _0x449034 = _0x31f8b4[_0x57249f(0x857)][_0x57249f(0x349)](_0x149252 => _0x2a0803[_0x57249f(0x6ec)][_0x57249f(0x761)](_0x149252['id']) && _0x149252[_0x57249f(0x2a5)] === _0x17bf38); if (_0x449034) _0x1808c8 = _0x449034['id']; } } if (_0x1808c8) return { 'type': 'transfer', 'amount': _0x279963, 'recipientId': _0x1808c8, 'senderId': _0x3ae0b8['id'] }; else return { 'type': _0x57249f(0x740), 'content': _0x57249f(0x78a) + _0x17bf38 + _0x57249f(0x31b) }; } } catch (_0x40d416) { console[_0x57249f(0x6eb)](_0x57249f(0x697) + _0x25a8b0['id'], _0x40d416), _0x5d65f5(_0x57249f(0x15b)); } } } }), _0x35f5c3[_0x34d701(0x179)](_0x34d701(0x3e9), () => { const _0x22e470 = _0x34d701; _0x123a33(), _0x5d65f5(_0x22e470(0x83e)); }), _0x4816fc[_0x34d701(0x179)](_0x34d701(0x3e9), async () => { const _0xc82e0a = _0x34d701; if (_0xc82e0a(0x759) === _0xc82e0a(0x759)) { _0x123a33(); const _0x1ce555 = prompt('请输入新的群名称：', _0x25a8b0[_0xc82e0a(0x2a5)]); _0x1ce555 && _0x1ce555['trim']() && _0x1ce555 !== _0x25a8b0['name'] && (_0x25a8b0[_0xc82e0a(0x2a5)] = _0x1ce555['trim'](), _0x16a7ea(), _0xd101b6(), _0x1d0e4a(), _0x5d65f5(_0xc82e0a(0x2d5) + _0x25a8b0[_0xc82e0a(0x2a5)] + '\x22。')); } else { _0x4db947['warn'](_0xc82e0a(0x450)); const _0x2d6b21 = _0x5210c8[_0xc82e0a(0x6ec)][_0xc82e0a(0x511)](_0x3b499f)[_0xc82e0a(0x747)](_0x495368); if (!_0x2d6b21['length']) return; let _0x597e91 = 0x0; for (const _0x5e566c of _0x2d6b21) { _0x1c63d1(_0x5e566c, { 'force': !![], 'delayMs': _0x597e91 }), _0x597e91 += 0x1f4; } } }), _0x11eae9[_0x34d701(0x179)](_0x34d701(0x3e9), async () => { const _0x1fc982 = _0x34d701; if (_0x1fc982(0x827) === _0x1fc982(0x789)) { const _0x50faae = _0x5a18fc(_0x28147b['authorId']); _0x50faae && (_0x3fddd1 = _0x50faae[_0x1fc982(0x2a5)], _0x1b3ba1 = _0x50faae[_0x1fc982(0x5c4)]); } else { _0x123a33(); const _0x432378 = await _0x1c19af(_0x1fc982(0x69b) + _0x25a8b0[_0x1fc982(0x2a5)] + _0x1fc982(0x485)); if (_0x432378) { if (_0x1fc982(0x269) === _0x1fc982(0x269)) _0x134555(_0x25a8b0['id']), _0x5d65f5(_0x1fc982(0x4ec) + _0x25a8b0[_0x1fc982(0x2a5)] + '\x22\x20已删除。'), _0x4cb79b(![]); else { if (_0x5be65b[_0x1fc982(0x3ab)]) return; const _0x3c2c92 = _0xa1cd02[_0x1fc982(0x4e9)]; if (_0x3c2c92 <= 0x0) return; _0x1d2459['isAnimatingDiary'] = !![]; const _0x28fb9f = _0x3c2c92 - 0x1, _0x42debf = _0x466cf8[_0x1fc982(0x49f)](_0x1fc982(0x3bf) + _0x3c2c92), _0x5e0d5c = _0x5c3ec7[_0x1fc982(0x49f)]('diary-page-' + _0x28fb9f); _0x42debf && _0x5e0d5c ? (_0x5e0d5c[_0x1fc982(0x2f1)]['add']('is-entering-from-left'), _0x42debf[_0x1fc982(0x2f1)][_0x1fc982(0x737)]('is-exiting-right'), _0x5e0d5c[_0x1fc982(0x2f1)]['add']('is-visible'), _0x7efa45(() => { const _0x4b5b44 = _0x1fc982; _0x42debf[_0x4b5b44(0x2f1)][_0x4b5b44(0x231)](_0x4b5b44(0x25a), _0x4b5b44(0x2f3)), _0x5e0d5c[_0x4b5b44(0x2f1)]['remove'](_0x4b5b44(0x414)), _0xccefac[_0x4b5b44(0x4e9)] = _0x28fb9f, _0x5cef8f(), _0x38563c['isAnimatingDiary'] = ![]; }, 0x2bc)) : _0x4af4af[_0x1fc982(0x3ab)] = ![]; } } } }), _0x306047[_0x34d701(0x179)](_0x34d701(0x3e9), _0x123a33), _0x37273a['addEventListener'](_0x34d701(0x3e9), _0x123a33); } _0x87704f[_0x12f887(0x179)](_0x12f887(0x3e9), () => { const _0x2c2da3 = _0x12f887; if (_0x2c2da3(0x56b) !== _0x2c2da3(0x56b)) _0x2b8630[_0x2c2da3(0x33c)] = _0x4b30b5[_0x2c2da3(0x33c)]; else { const _0x5c3d2b = _0x4adf1c(); if (_0x5c3d2b && _0x5c3d2b[_0x2c2da3(0x5b4)] === _0x2c2da3(0x23d)) _0xcbfa67(_0x5c3d2b[_0x2c2da3(0x6ec)][0x0]); else _0x5c3d2b && _0x5c3d2b[_0x2c2da3(0x5b4)] === _0x2c2da3(0x67a) && _0x2043b0(_0x5c3d2b['id']); } }), _0x2fefe8[_0x12f887(0x179)](_0x12f887(0x357), _0x8c6cef => { const _0x59b71d = _0x12f887; _0x8c6cef[_0x59b71d(0x691)] === _0x59b71d(0x3c2) && !_0x8c6cef[_0x59b71d(0x5db)] && (_0x8c6cef[_0x59b71d(0x2bc)](), _0x48b971()); }); const _0x5d7f42 = () => _0x509844[_0x12f887(0x2f1)][_0x12f887(0x231)](_0x12f887(0x557)); _0x5b06bf[_0x12f887(0x179)](_0x12f887(0x3e9), _0x5d7f42), _0x5e5457[_0x12f887(0x179)]('click', _0x5d7f42), _0x3398e6[_0x12f887(0x179)](_0x12f887(0x3e9), () => { _0x5d7f42(), _0xcbfa67(); }), _0x3db4ec[_0x12f887(0x179)]('click', () => { _0x5d7f42(), _0x204961(); }), _0x1cf064[_0x12f887(0x179)]('click', () => { const _0x310e75 = _0x12f887; _0x310e75(0x7e1) === _0x310e75(0x7e1) ? (_0x381d3b(_0x310e75(0x80d), _0x310e75(0x624)), _0x4cb79b(![])) : _0xfcf765[_0x310e75(0x849)] = !![]; }), _0x3777c6[_0x12f887(0x179)](_0x12f887(0x3e9), _0x4d30ae), _0xdd817b[_0x12f887(0x179)]('click', () => { const _0x363c2f = _0x12f887; 'Kyism' === _0x363c2f(0x2e5) ? _0x406207[_0x363c2f(0x3c9)][_0x363c2f(0x482)] = '' : (_0x37cbde['classList'][_0x363c2f(0x5f8)](_0x363c2f(0x557)), _0x37cbde['classList'][_0x363c2f(0x6a9)](_0x363c2f(0x557)) && (_0x216c2d['scrollTop'] = _0x216c2d[_0x363c2f(0x148)])); }), _0x54bd8e['addEventListener'](_0x12f887(0x3e9), () => _0x54b155[_0x12f887(0x3e9)]()); const _0x4927b8 = document['getElementById'](_0x12f887(0x5b9)); _0x54b155[_0x12f887(0x179)](_0x12f887(0x220), _0x601592), _0x4927b8[_0x12f887(0x179)](_0x12f887(0x3e9), _0x46ab06), _0x25e872[_0x12f887(0x179)]('click', _0x340cc7), _0x42a65b[_0x12f887(0x179)]('click', _0x140edb), _0x1a281c[_0x12f887(0x179)](_0x12f887(0x3e9), _0x5a2dde), _0x42a357['addEventListener']('click', _0x54a94e), _0x178501[_0x12f887(0x179)]('click', async () => { const _0x2b5107 = _0x12f887, _0x532b39 = _0x4f1079['value']; if (!_0x532b39) return; const _0x4fc823 = _0x1c2a48(_0x532b39); if (!_0x4fc823) return; const _0x37ca12 = await _0x1c19af(_0x2b5107(0x19c) + _0x4fc823[_0x2b5107(0x2a5)] + _0x2b5107(0x68b)); _0x37ca12 && (_0x5918e0(_0x532b39), _0x5d65f5(_0x2b5107(0x79e) + _0x4fc823['name'] + _0x2b5107(0x4c5)), _0x381d3b('chat', 'characterEdit'), _0x4cb79b(![])); }), _0x85e157[_0x12f887(0x179)]('input', () => { const _0x46248b = _0x12f887, _0x5d6ad9 = _0x85e157[_0x46248b(0x5da)][_0x46248b(0x2fe)]()[_0x46248b(0x761)](_0x191c8d); _0x561f2e[_0x46248b(0x849)] = _0x5d6ad9; }); async function _0x53923a() { const _0x2135cf = _0x12f887; if (_0x2135cf(0x2de) !== _0x2135cf(0x2de)) { const _0x1d0e6b = _0x1ee9fb(_0x55605c); if (!_0x1d0e6b) return; _0x185cb8[_0x2135cf(0x607)] = _0x2614bf; const _0x3751da = _0x13f4a5[_0x2135cf(0x494)][_0x2135cf(0x349)](_0x539c6d => _0x539c6d[_0x2135cf(0x4a6)] === _0x617d87), _0x3e8ecc = _0x3751da ? _0x3751da[_0x2135cf(0x4ce)][_0x2135cf(0x45b)] : 0x0, _0x2a171f = 0x2; _0x3e1bd2['diaryCurrentPage'] = _0x56f38f[_0x2135cf(0x30b)](0x0, _0x230e05[_0x2135cf(0x6bd)](_0x3e8ecc / _0x2a171f) - 0x1), _0xa7d44b[_0x2135cf(0x49f)]('diary-char-name-header')['textContent'] = _0x1d0e6b[_0x2135cf(0x2a5)] + _0x2135cf(0x7cd), _0x44c1f3(), _0x25906e(_0x2135cf(0x36f), _0x2135cf(0x698)); } else { const _0x452c28 = _0x85e157[_0x2135cf(0x5da)][_0x2135cf(0x2fe)](), _0xc5ffb0 = _0x1bc26c[_0x2135cf(0x5da)]['trim'](); if (!_0x452c28 || !_0xc5ffb0) { if (_0x2135cf(0x5ed) === _0x2135cf(0x251)) _0x53d8bf[_0x2135cf(0x76f)] = _0x847bf9['linkedWorldBookIds'][_0x2135cf(0x747)](_0x2e73f9 => _0x2e73f9 !== _0x4cd4c0); else { _0x5d65f5(_0x2135cf(0x689)); return; } } let _0x1f0198; try { const _0x19a63e = new URL(_0x452c28); _0x1f0198 = new URL(_0x2135cf(0x589), _0x19a63e[_0x2135cf(0x3d5)] + _0x19a63e['pathname'][_0x2135cf(0x23b)](/\/v1\/?.*$/, ''))[_0x2135cf(0x58a)]; } catch (_0x59238a) { _0x5d65f5(_0x2135cf(0x56c)); return; } _0x561f2e[_0x2135cf(0x849)] = !![], _0x561f2e[_0x2135cf(0x7ea)] = _0x2135cf(0x229), _0x206f57[_0x2135cf(0x2f1)][_0x2135cf(0x231)](_0x2135cf(0x557)); try { const _0x54eca8 = await fetch(_0x1f0198, { 'headers': { 'Authorization': _0x2135cf(0x69e) + _0xc5ffb0 } }); if (!_0x54eca8['ok']) throw new Error('服务器错误:\x20' + _0x54eca8[_0x2135cf(0x22f)]); const _0x1d7336 = await _0x54eca8[_0x2135cf(0x525)](), _0x4400f7 = (_0x1d7336[_0x2135cf(0x656)] || _0x1d7336)['map'](_0x49d409 => _0x49d409['id'])[_0x2135cf(0x1e7)](); _0x4400f7[_0x2135cf(0x45b)] > 0x0 ? (_0x206f57[_0x2135cf(0x862)] = '', _0x4400f7[_0x2135cf(0x242)](_0x5cf0c0 => { const _0x1d369f = _0x2135cf, _0x1eb909 = document[_0x1d369f(0x1a2)](_0x1d369f(0x642)); _0x1eb909[_0x1d369f(0x7ea)] = _0x5cf0c0, _0x1eb909[_0x1d369f(0x179)](_0x1d369f(0x3e9), () => { const _0x16b6a9 = _0x1d369f; _0x128b76[_0x16b6a9(0x5da)] = _0x5cf0c0, _0x206f57['classList'][_0x16b6a9(0x231)](_0x16b6a9(0x557)); }), _0x206f57['appendChild'](_0x1eb909); }), _0x206f57['classList'][_0x2135cf(0x737)](_0x2135cf(0x557)), _0x5d65f5(_0x2135cf(0x5cb) + _0x4400f7[_0x2135cf(0x45b)] + '\x20个模型。')) : _0x5d65f5(_0x2135cf(0x404)); } catch (_0x52fb17) { _0x5d65f5(_0x2135cf(0x3be) + _0x52fb17[_0x2135cf(0x4c4)]); } finally { _0x2135cf(0x88d) === _0x2135cf(0x3bc) ? _0x817864[_0x2135cf(0x7ea)] = _0x2135cf(0x389) + _0x2d01ad[_0x2135cf(0x45b)] + '\x20项' : (_0x561f2e['disabled'] = ![], _0x561f2e[_0x2135cf(0x7ea)] = '获取'); } } } _0x561f2e[_0x12f887(0x179)]('click', _0x2ca604 => { _0x2ca604['stopPropagation'](), _0x53923a(); }), document['addEventListener']('click', _0x239854 => { const _0x415b6b = _0x12f887; if (_0x415b6b(0x14c) === _0x415b6b(0x14c)) { if (!_0x206f57[_0x415b6b(0x6a9)](_0x239854[_0x415b6b(0x232)]) && _0x239854['target'] !== _0x128b76 && _0x239854[_0x415b6b(0x232)] !== _0x561f2e) { if ('ZKNYZ' === _0x415b6b(0x5c9)) _0x206f57[_0x415b6b(0x2f1)][_0x415b6b(0x231)](_0x415b6b(0x557)); else { const _0x33e465 = _0x22a996[_0x415b6b(0x619)] === 'ai' || _0x2d0656['role'] === 'assistant' ? _0x415b6b(0x4e1) : _0x415b6b(0x821); _0x50598c['push']({ 'role': _0x33e465, 'content': _0xc03f8e[_0x415b6b(0x751)], 'image': _0x15022f[_0x415b6b(0x33c)] }); } } } else { const _0x4d0401 = _0x34c1bb[0x1]['replace'](/\\"/g, '\x22')['replace'](/\\n/g, '\x0a')[_0x415b6b(0x2fe)](); if (_0x4d0401) _0x37f391[_0x415b6b(0x249)](_0x4d0401); } }); async function _0x2a3cd4(_0x1b23b3) { const _0x2b6734 = _0x12f887; if (_0x2b6734(0x7b9) !== _0x2b6734(0x154)) return await _0x52a43d(_0x1b23b3, 0x190, 0.85); else _0x2f1d1b['querySelector']('#diary-action-reroll')[_0x2b6734(0x56a)] = () => { _0x4cb72a(_0x2e4403), _0x3b8eb3(); }; } _0x252780['addEventListener'](_0x12f887(0x3e9), () => _0x56db79[_0x12f887(0x3e9)]()), _0x56db79[_0x12f887(0x179)]('change', async _0x501c7b => { const _0x3821fa = _0x12f887, _0xcaecdf = _0x501c7b[_0x3821fa(0x232)][_0x3821fa(0x7a2)][0x0]; if (!_0xcaecdf) return; try { if (_0x3821fa(0x52f) === _0x3821fa(0x58e)) _0x3945ac['click'](); else { const _0x41aba9 = await _0x2a3cd4(_0xcaecdf); _0x252780[_0x3821fa(0x54e)] = _0x41aba9; } } catch (_0x546bca) { _0x5d65f5('错误:\x20' + _0x546bca[_0x3821fa(0x4c4)]); } }), _0x3e5f74[_0x12f887(0x179)](_0x12f887(0x3e9), () => _0x3631f4[_0x12f887(0x3e9)]()), _0x3631f4[_0x12f887(0x179)]('change', async _0x38ea4a => { const _0x39c804 = _0x12f887, _0x5bf175 = _0x38ea4a[_0x39c804(0x232)][_0x39c804(0x7a2)][0x0]; if (!_0x5bf175) return; try { _0x3e5f74[_0x39c804(0x54e)] = await _0x2a3cd4(_0x5bf175); } catch (_0x215e9f) { _0x5d65f5(_0x39c804(0x2ba) + _0x215e9f[_0x39c804(0x4c4)]); } }); function _0x19da50() { const _0xe60107 = _0x12f887; _0xe60107(0x429) === _0xe60107(0x429) ? (_0x37cbde[_0xe60107(0x862)] = '', _0xe0a49d['forEach'](_0x2e12c7 => { const _0x524dfc = _0xe60107; if (_0x524dfc(0x281) === _0x524dfc(0x281)) { const _0x52bde4 = document['createElement'](_0x524dfc(0x359)); _0x52bde4[_0x524dfc(0x54e)] = _0x2e12c7[_0x524dfc(0x5ce)], _0x52bde4[_0x524dfc(0x612)] = _0x524dfc(0x662), _0x52bde4[_0x524dfc(0x63f)] = _0x2e12c7[_0x524dfc(0x2a5)], _0x52bde4[_0x524dfc(0x2f1)][_0x524dfc(0x737)](_0x524dfc(0x386)), _0x52bde4[_0x524dfc(0x179)](_0x524dfc(0x3e9), () => _0x38dd09(_0x2e12c7)), _0x37cbde[_0x524dfc(0x185)](_0x52bde4); } else _0xa4b021 && _0x22b8ce(_0x45f463['id'], _0x4ba416[_0x524dfc(0x511)](_0x47ace9 => _0x47ace9['id'])); })) : _0x4e9d33[_0xe60107(0x231)](); } function _0x4611b7() { const _0x17828e = _0x12f887; if (_0x17828e(0x2a8) === 'nekOB') { const _0x47815b = document[_0x17828e(0x49f)](_0x17828e(0x3cc)); _0x47815b['innerHTML'] = ''; if (_0x2aa90d[_0x17828e(0x47c)][_0x17828e(0x45b)] === 0x0) { if (_0x17828e(0x337) === _0x17828e(0x147)) { const _0x37e990 = _0x4a7202['conversationHistory'][_0x397faa - 0x2], _0x4e5348 = _0x4deb80['conversationHistory'][_0x1ad258 - 0x1]; if (_0x37e990[_0x17828e(0x446)] === ![] && _0x4e5348['isOffline'] === !![]) _0x19308 = '\x0a#\x20【！！！重要场景切换！！！】\x0a你刚才在和“' + _0xac52df[_0x17828e(0x2a5)] + _0x17828e(0x474); else _0x37e990[_0x17828e(0x446)] === !![] && _0x4e5348[_0x17828e(0x446)] === ![] && (_0xda2738 = _0x17828e(0x2d1) + _0x171fbc[_0x17828e(0x2a5)] + _0x17828e(0x606)); } else { _0x47815b[_0x17828e(0x862)] = _0x17828e(0x1a9); return; } } _0x2aa90d['userProfiles'][_0x17828e(0x242)](_0x20d7bb => { const _0x533979 = _0x17828e, _0x4d5906 = document['createElement']('div'); _0x4d5906['className'] = 'world-book-item', _0x4d5906['dataset']['id'] = _0x20d7bb['id']; const _0x10276a = _0x20d7bb['id'] === _0x2aa90d[_0x533979(0x4f4)] ? _0x533979(0x728) : ''; _0x4d5906[_0x533979(0x862)] = _0x533979(0x1c2) + (_0x20d7bb['avatar'] || _0x5e96e0) + _0x533979(0x168) + _0x20d7bb[_0x533979(0x2a5)] + _0x10276a + _0x533979(0x574) + _0x20d7bb['persona']['substring'](0x0, 0x64) + _0x533979(0x17f), _0x4d5906[_0x533979(0x179)](_0x533979(0x3e9), () => _0x57d90c(_0x20d7bb['id'])), _0x47815b[_0x533979(0x185)](_0x4d5906); }); } else _0xae9cc0(_0x5d88f0['id']); } function _0x57d90c(_0x5d924c = null) { const _0x31171f = _0x12f887; _0x381d3b(_0x31171f(0x585), _0x31171f(0x1a0)); const _0x22688d = document['getElementById'](_0x31171f(0x2c6)); if (_0x5d924c) { if (_0x31171f(0x4a7) !== _0x31171f(0x4a7)) _0x19f9e6 = _0x54e089[_0x31171f(0x38e)](_0xf4f472[_0x31171f(0x70e)](_0x38fc32) || '{}'); else { const _0x2d3f15 = _0x2aa90d[_0x31171f(0x47c)]['find'](_0x4f2e96 => _0x4f2e96['id'] === _0x5d924c); if (!_0x2d3f15) return; document['getElementById'](_0x31171f(0x2fc))[_0x31171f(0x5da)] = _0x2d3f15['id'], document[_0x31171f(0x49f)](_0x31171f(0x685))[_0x31171f(0x7ea)] = _0x31171f(0x52e), document[_0x31171f(0x49f)](_0x31171f(0x4ea))[_0x31171f(0x5da)] = _0x2d3f15['name'], document[_0x31171f(0x49f)]('user-avatar-preview')['src'] = _0x2d3f15[_0x31171f(0x5c4)], document[_0x31171f(0x49f)](_0x31171f(0x3e3))[_0x31171f(0x5da)] = _0x2d3f15[_0x31171f(0x839)], _0x22688d[_0x31171f(0x3c9)]['display'] = _0x2d3f15['id'] === _0x2aa90d[_0x31171f(0x4f4)] ? _0x31171f(0x3d3) : _0x31171f(0x4b1); } } else document['getElementById']('editing-user-id')[_0x31171f(0x5da)] = '', document[_0x31171f(0x49f)](_0x31171f(0x685))['textContent'] = _0x31171f(0x3a8), document[_0x31171f(0x49f)]('user-name')['value'] = _0x31171f(0x50c) + (_0x2aa90d[_0x31171f(0x47c)][_0x31171f(0x45b)] + 0x1), document[_0x31171f(0x49f)](_0x31171f(0x54c))[_0x31171f(0x54e)] = _0x5e96e0, document['getElementById'](_0x31171f(0x3e3))[_0x31171f(0x5da)] = '', _0x22688d[_0x31171f(0x3c9)][_0x31171f(0x6b4)] = _0x31171f(0x3d3); } function _0x140edb() { const _0x5d6ddb = _0x12f887; if (_0x5d6ddb(0x718) !== _0x5d6ddb(0x342)) { const _0x5c111e = document[_0x5d6ddb(0x49f)](_0x5d6ddb(0x2fc))[_0x5d6ddb(0x5da)], _0x1d2be1 = { 'name': document[_0x5d6ddb(0x49f)](_0x5d6ddb(0x4ea))['value']['trim'](), 'persona': document['getElementById']('user-persona')[_0x5d6ddb(0x5da)][_0x5d6ddb(0x2fe)](), 'avatar': document[_0x5d6ddb(0x49f)](_0x5d6ddb(0x54c))[_0x5d6ddb(0x54e)] }; if (!_0x1d2be1[_0x5d6ddb(0x2a5)]) { if (_0x5d6ddb(0x622) === _0x5d6ddb(0x622)) { _0x5d65f5('名字不能为空！'); return; } else _0x38d034[_0x5d6ddb(0x5ae)] = _0x3ac66a[_0x5d6ddb(0x148)]; } if (_0x5c111e) { if (_0x5d6ddb(0x684) === _0x5d6ddb(0x684)) { const _0x357209 = _0x2aa90d[_0x5d6ddb(0x47c)][_0x5d6ddb(0x349)](_0x4d94b9 => _0x4d94b9['id'] === _0x5c111e); if (_0x357209) Object[_0x5d6ddb(0x23f)](_0x357209, _0x1d2be1); } else _0xa1af24['alt'] = '图片加载失败'; } else { if (_0x5d6ddb(0x3df) === _0x5d6ddb(0x5e8)) _0x3d23e0(_0x37dab9); else { const _0x48f8f6 = { 'id': 'user_' + Date['now'](), ..._0x1d2be1 }; _0x2aa90d[_0x5d6ddb(0x47c)][_0x5d6ddb(0x249)](_0x48f8f6), !_0x2aa90d[_0x5d6ddb(0x4f4)] && (_0x2aa90d[_0x5d6ddb(0x4f4)] = _0x48f8f6['id']); } } _0x16a7ea(), _0x5d65f5('用户资料已保存！'), _0x4611b7(), _0x381d3b(_0x5d6ddb(0x1a0), 'userProfile'); } else { const _0x5f59dd = _0x10b6fb[_0x5d6ddb(0x600)](_0x405801, _0x5d6ddb(0x795)), _0x300d0a = _0x5f59dd['objectStore'](_0x67fef6), _0x1d1253 = _0x300d0a['delete'](_0x4d9da2); _0x1d1253[_0x5d6ddb(0x431)] = () => _0xd8d800(), _0x1d1253[_0x5d6ddb(0x1cf)] = () => _0x39ce20(_0x1d1253[_0x5d6ddb(0x6eb)]); } } async function _0xcacd54() { const _0x56755c = _0x12f887, _0x5b896e = document[_0x56755c(0x49f)](_0x56755c(0x2fc))[_0x56755c(0x5da)]; if (!_0x5b896e) return; if (_0x2aa90d[_0x56755c(0x47c)][_0x56755c(0x45b)] <= 0x1) { _0x5d65f5('至少要保留一个用户。'); return; } const _0x4661e3 = await _0x1c19af(_0x56755c(0x75f)); _0x4661e3 && ('MyGLm' === _0x56755c(0x476) ? (_0x2aa90d[_0x56755c(0x47c)] = _0x2aa90d[_0x56755c(0x47c)]['filter'](_0x4c8405 => _0x4c8405['id'] !== _0x5b896e), _0x2aa90d[_0x56755c(0x4f4)] === _0x5b896e && (_0x56755c(0x856) === 'jhSLu' ? _0x2aa90d['activeUserProfileId'] = _0x2aa90d[_0x56755c(0x47c)][0x0]['id'] : _0x162f03[_0x56755c(0x2f1)][_0x56755c(0x737)](_0x56755c(0x557))), _0x2aa90d[_0x56755c(0x22e)][_0x56755c(0x242)](_0x1b3ce7 => { const _0x3d941d = _0x56755c; _0x1b3ce7[_0x3d941d(0x412)] === _0x5b896e && (_0x1b3ce7[_0x3d941d(0x412)] = _0x2aa90d['activeUserProfileId']); }), _0x16a7ea(), _0x5d65f5(_0x56755c(0x545)), _0x4611b7(), _0x381d3b('userProfileList', 'userProfile')) : _0x30366d[_0x56755c(0x509)]('chatHistory_' + _0x33b86e['id'])); } function _0x1e19ad() { const _0x49c38c = _0x12f887; if (_0x49c38c(0x6e4) === 'XRaNJ') _0x243913 = _0x4df0dc[_0x49c38c(0x1a2)](_0x49c38c(0x642)), _0x2a0752[_0x49c38c(0x399)] = _0x49c38c(0x4b2), _0x5d3f3f[_0x49c38c(0x7ea)] = '对方正在输入...', _0x2f0470[_0x49c38c(0x185)](_0x2913df); else { const _0x3f5146 = document[_0x49c38c(0x49f)]('world-book-list-container'); _0x3f5146[_0x49c38c(0x862)] = ''; if (_0x2aa90d[_0x49c38c(0x14b)][_0x49c38c(0x45b)] === 0x0) { _0x3f5146[_0x49c38c(0x862)] = _0x49c38c(0x840); return; } _0x2aa90d['worldBooks'][_0x49c38c(0x242)](_0x555da0 => { const _0x1ee2d6 = _0x49c38c, _0x248578 = document['createElement'](_0x1ee2d6(0x642)); _0x248578[_0x1ee2d6(0x399)] = 'world-book-item', _0x248578[_0x1ee2d6(0x55a)]['id'] = _0x555da0['id'], _0x248578[_0x1ee2d6(0x862)] = _0x1ee2d6(0x6f0) + _0x555da0['name'] + _0x1ee2d6(0x53b) + _0x555da0[_0x1ee2d6(0x751)][_0x1ee2d6(0x702)](0x0, 0x64) + _0x1ee2d6(0x842), _0x248578[_0x1ee2d6(0x179)](_0x1ee2d6(0x3e9), () => _0x5bd596(_0x555da0['id'])), _0x3f5146[_0x1ee2d6(0x185)](_0x248578); }); } } function _0x5bd596(_0xa403c5 = null) { const _0x346b1e = _0x12f887; _0x381d3b('worldBookEditor', _0x346b1e(0x257)); if (_0xa403c5) { const _0x3c6e9e = _0x2aa90d[_0x346b1e(0x14b)]['find'](_0x45d488 => _0x45d488['id'] === _0xa403c5); if (!_0x3c6e9e) return; document[_0x346b1e(0x49f)]('editing-world-book-id')[_0x346b1e(0x5da)] = _0x3c6e9e['id'], document[_0x346b1e(0x49f)]('world-book-editor-title')['textContent'] = _0x346b1e(0x6c0), document['getElementById'](_0x346b1e(0x3c3))[_0x346b1e(0x5da)] = _0x3c6e9e[_0x346b1e(0x2a5)], document[_0x346b1e(0x49f)]('world-book-edit-content')['value'] = _0x3c6e9e[_0x346b1e(0x751)]; } else document['getElementById'](_0x346b1e(0x48c))[_0x346b1e(0x5da)] = '', document[_0x346b1e(0x49f)](_0x346b1e(0x504))['textContent'] = _0x346b1e(0x60e), document['getElementById'](_0x346b1e(0x3c3))[_0x346b1e(0x5da)] = '', document[_0x346b1e(0x49f)]('world-book-edit-content')[_0x346b1e(0x5da)] = ''; } function _0x2a16fb() { const _0x1972b1 = _0x12f887, _0x28897e = document[_0x1972b1(0x49f)](_0x1972b1(0x48c))['value'], _0x261e10 = document['getElementById']('world-book-edit-name')[_0x1972b1(0x5da)][_0x1972b1(0x2fe)](), _0x2d377f = document[_0x1972b1(0x49f)]('world-book-edit-content')[_0x1972b1(0x5da)][_0x1972b1(0x2fe)](); if (!_0x261e10 || !_0x2d377f) { _0x5d65f5(_0x1972b1(0x7b5)); return; } if (_0x28897e) { const _0x29c5ab = _0x2aa90d[_0x1972b1(0x14b)][_0x1972b1(0x349)](_0x33dea7 => _0x33dea7['id'] === _0x28897e); _0x29c5ab && (_0x29c5ab['name'] = _0x261e10, _0x29c5ab['content'] = _0x2d377f); } else { const _0x3e32cb = { 'id': 'wb_' + Date[_0x1972b1(0x24a)](), 'name': _0x261e10, 'content': _0x2d377f }; _0x2aa90d[_0x1972b1(0x14b)][_0x1972b1(0x249)](_0x3e32cb); } _0x16a7ea(), _0x5d65f5('世界书条目已保存！'), _0x1e19ad(), _0x381d3b('worldBook', _0x1972b1(0x68c)); } async function _0x58a89a() { const _0x5ef84 = _0x12f887; if (_0x5ef84(0x421) === 'yAswv') { const _0x35b3aa = document[_0x5ef84(0x49f)](_0x5ef84(0x48c))['value']; if (!_0x35b3aa) return; const _0x3675fc = await _0x1c19af('确定要删除这个条目吗？此操作不可撤销。'); if (_0x3675fc) { if ('OkeNX' === _0x5ef84(0x71d)) { const _0x321a53 = _0x334088[_0x5ef84(0x232)][_0x5ef84(0x4d0)]; !_0x321a53[_0x5ef84(0x32f)][_0x5ef84(0x6a9)](_0x2df2a9) && _0x321a53[_0x5ef84(0x50e)](_0x23d49e, { 'keyPath': 'id' }), !_0x321a53['objectStoreNames'][_0x5ef84(0x6a9)](_0x5ef84(0x184)) && _0x321a53[_0x5ef84(0x50e)]('music_library', { 'keyPath': 'id' }); } else _0x2aa90d[_0x5ef84(0x14b)] = _0x2aa90d['worldBooks'][_0x5ef84(0x747)](_0x24f7ec => _0x24f7ec['id'] !== _0x35b3aa), _0x2aa90d[_0x5ef84(0x857)]['forEach'](_0x561aff => { const _0x4772d4 = _0x5ef84; _0x561aff[_0x4772d4(0x76f)] && (_0x561aff['linkedWorldBookIds'] = _0x561aff[_0x4772d4(0x76f)][_0x4772d4(0x747)](_0x44b3fc => _0x44b3fc !== _0x35b3aa)); }), _0x16a7ea(), _0x5d65f5(_0x5ef84(0x3fb)), _0x1e19ad(), _0x381d3b(_0x5ef84(0x257), 'worldBookEditor'); } } else _0x1d21c8[_0x5ef84(0x6eb)](_0x5ef84(0x527), _0x436013), _0x575eb8(_0x5ef84(0x340)); } function _0x515105() { const _0x5d19a0 = _0x12f887, _0x1e23af = document['getElementById'](_0x5d19a0(0x4f0)), _0x32c2d2 = _0x1e23af['querySelectorAll'](_0x5d19a0(0x573)), _0x17dd0e = document[_0x5d19a0(0x4b0)](_0x5d19a0(0x57c)); if (_0x32c2d2['length'] === 0x0) _0x17dd0e[_0x5d19a0(0x7ea)] = '--\x20点击选择\x20--'; else _0x32c2d2[_0x5d19a0(0x45b)] > 0x2 ? _0x17dd0e[_0x5d19a0(0x7ea)] = _0x5d19a0(0x389) + _0x32c2d2[_0x5d19a0(0x45b)] + '\x20项' : _0x17dd0e[_0x5d19a0(0x7ea)] = Array[_0x5d19a0(0x6d7)](_0x32c2d2)[_0x5d19a0(0x511)](_0x3912c1 => _0x3912c1[_0x5d19a0(0x779)]['textContent'][_0x5d19a0(0x2fe)]())['join']('、'); } function _0x2043b0(_0x16dbcd) { const _0x569923 = _0x12f887; if (_0x569923(0x1d7) === _0x569923(0x569)) return ''; else { const _0x119b95 = _0x2aa90d[_0x569923(0x22e)][_0x569923(0x349)](_0x265479 => _0x265479['id'] === _0x16dbcd); if (!_0x119b95 || _0x119b95[_0x569923(0x5b4)] !== _0x569923(0x67a)) return; document['getElementById']('group-settings-name')[_0x569923(0x5da)] = _0x119b95['name'] || '', _0x562826(_0x569923(0x835)), document['getElementById'](_0x569923(0x835))['value'] = _0x119b95[_0x569923(0x412)] || _0x2aa90d[_0x569923(0x4f4)]; const _0x379f7f = document[_0x569923(0x49f)](_0x569923(0x6db)); _0x379f7f[_0x569923(0x862)] = '', _0x2aa90d['worldBooks'][_0x569923(0x242)](_0x1542ed => { const _0x4bcf80 = _0x569923; if ('KuUNP' === 'UiDCq') _0x3cd827(_0x288609[_0x4bcf80(0x733)](_0x5021b3, _0xb25fa6)); else { const _0x169343 = _0x119b95[_0x4bcf80(0x76f)]?.[_0x4bcf80(0x761)](_0x1542ed['id']), _0xb1b88c = document[_0x4bcf80(0x1a2)]('label'); _0xb1b88c[_0x4bcf80(0x862)] = _0x4bcf80(0x43a) + _0x1542ed['id'] + '\x22\x20' + (_0x169343 ? _0x4bcf80(0x5f2) : '') + '>\x20' + _0x1542ed[_0x4bcf80(0x2a5)], _0x379f7f['appendChild'](_0xb1b88c); } }), _0x45f870(); const _0x13c460 = document[_0x569923(0x49f)](_0x569923(0x288)), _0x358cc4 = document[_0x569923(0x49f)](_0x569923(0x374)); _0x33b931(_0x569923(0x749) + _0x16dbcd)['then'](_0x116763 => { const _0x977374 = _0x569923; _0x977374(0x7ca) !== _0x977374(0x7ca) ? _0xae5dd1 += _0x977374(0x652) : _0x13c460[_0x977374(0x54e)] = _0x116763 ? URL[_0x977374(0x52d)](_0x116763) : _0x12a7cc; }), _0x33b931(_0x569923(0x5c6) + _0x16dbcd)['then'](_0x19881d => { const _0x227063 = _0x569923; _0x227063(0x7da) === _0x227063(0x6af) ? _0x1dc44d[_0x227063(0x2f1)][_0x227063(0x737)](_0x227063(0x427)) : _0x358cc4[_0x227063(0x54e)] = _0x19881d ? URL[_0x227063(0x52d)](_0x19881d) : ''; }), _0x381d3b(_0x569923(0x4f9), 'chat'); } } async function _0xaec2b8() { const _0x3b3f81 = _0x12f887, _0x47eeca = _0x4adf1c(); if (!_0x47eeca || _0x47eeca[_0x3b3f81(0x5b4)] !== _0x3b3f81(0x67a)) return; const _0x10d595 = document[_0x3b3f81(0x49f)](_0x3b3f81(0x780))['value'][_0x3b3f81(0x2fe)](); if (!_0x10d595) { _0x5d65f5(_0x3b3f81(0x7a1)); return; } _0x47eeca[_0x3b3f81(0x2a5)] = _0x10d595; const _0x4f41a4 = document[_0x3b3f81(0x2aa)]('#group-world-book-checkboxes\x20input:checked'); _0x47eeca[_0x3b3f81(0x76f)] = Array['from'](_0x4f41a4)[_0x3b3f81(0x511)](_0x2f6376 => _0x2f6376[_0x3b3f81(0x5da)]), _0x47eeca[_0x3b3f81(0x412)] = document[_0x3b3f81(0x49f)]('group-settings-bind-user')[_0x3b3f81(0x5da)]; const _0x3fa524 = document[_0x3b3f81(0x49f)](_0x3b3f81(0x22d))[_0x3b3f81(0x7a2)][0x0], _0x25dfef = document[_0x3b3f81(0x49f)]('group-bg-input')[_0x3b3f81(0x7a2)][0x0]; if (_0x3fa524) await _0x19d8b8(_0x3b3f81(0x749) + _0x47eeca['id'], _0x3fa524); if (_0x25dfef) await _0x19d8b8(_0x3b3f81(0x5c6) + _0x47eeca['id'], _0x25dfef); _0x16a7ea(), _0x1d0e4a(), await _0xd101b6(), _0x5d65f5(_0x3b3f81(0x755)), _0x381d3b(_0x3b3f81(0x80d), _0x3b3f81(0x4f9)); } function _0x45f870() { const _0x1c9621 = _0x12f887, _0x10575c = document['getElementById']('group-world-book-checkboxes'), _0x24743f = _0x10575c['querySelectorAll'](_0x1c9621(0x573)), _0x33fd14 = document['querySelector'](_0x1c9621(0x16e)); if (_0x24743f[_0x1c9621(0x45b)] === 0x0) _0x33fd14[_0x1c9621(0x7ea)] = _0x1c9621(0x80f); else _0x24743f[_0x1c9621(0x45b)] > 0x2 ? _0x33fd14[_0x1c9621(0x7ea)] = _0x1c9621(0x389) + _0x24743f[_0x1c9621(0x45b)] + '\x20项' : _0x1c9621(0x32b) === _0x1c9621(0x32b) ? _0x33fd14['textContent'] = Array[_0x1c9621(0x6d7)](_0x24743f)[_0x1c9621(0x511)](_0x3b944b => _0x3b944b['parentElement'][_0x1c9621(0x7ea)][_0x1c9621(0x2fe)]())[_0x1c9621(0x4c2)]('、') : _0x1db1af = _0x5374df[_0x1c9621(0x70e)](_0x1c9621(0x44e)); } async function _0x594539() { const _0x3a1ac1 = _0x12f887, _0x2b1768 = _0x4adf1c(), _0x10cf8c = (_0x2b1768?.['participantIds'] || [])[_0x3a1ac1(0x511)](_0x1c2a48)[_0x3a1ac1(0x747)](Boolean), _0x356465 = _0x5cb17e(_0x2b1768['id']); if (!_0x2b1768 || _0x2b1768['type'] !== _0x3a1ac1(0x67a) || _0x10cf8c['length'] < 0x2) return null; const _0x5e93dc = _0x2b1768[_0x3a1ac1(0x76f)] && _0x2b1768[_0x3a1ac1(0x76f)]['length'] > 0x0 ? '\x0a\x0a#\x20核心群聊世界观设定\x20(所有角色必须严格遵守以下设定)\x0a' + _0x2b1768[_0x3a1ac1(0x76f)][_0x3a1ac1(0x511)](_0x5e7621 => _0x2aa90d[_0x3a1ac1(0x14b)][_0x3a1ac1(0x349)](_0x3ddc96 => _0x3ddc96['id'] === _0x5e7621))[_0x3a1ac1(0x747)](Boolean)[_0x3a1ac1(0x511)](_0x2fa6f9 => _0x3a1ac1(0x708) + _0x2fa6f9[_0x3a1ac1(0x2a5)] + '\x0a' + _0x2fa6f9[_0x3a1ac1(0x751)])[_0x3a1ac1(0x4c2)]('') : '', _0x15c88e = _0x356465[_0x3a1ac1(0x839)] ? _0x3a1ac1(0x6b3) + _0x356465[_0x3a1ac1(0x2a5)] + _0x3a1ac1(0x5fe) + _0x356465['persona'] : ''; let _0x38bdd1 = ''; const _0x1894e2 = new Date(), _0x1fa846 = _0x2aa90d[_0x3a1ac1(0x7f2)]['at'](-0x1); _0x38bdd1 += _0x3a1ac1(0x3e7) + _0x1894e2[_0x3a1ac1(0x395)]('zh-CN', { 'dateStyle': _0x3a1ac1(0x222), 'timeStyle': _0x3a1ac1(0x3ef) }); if (_0x1fa846) { const _0x30c150 = new Date(_0x1fa846[_0x3a1ac1(0x602)]), _0x121e15 = Math[_0x3a1ac1(0x782)]((_0x1894e2 - _0x30c150) / (0x3e8 * 0x3c)); if (_0x121e15 < 0x5) _0x38bdd1 += _0x3a1ac1(0x6d1); else { if (_0x121e15 < 0x78) _0x38bdd1 += _0x3a1ac1(0x2cc) + _0x121e15 + '分钟前聊过，请注意衔接。'; else { if (_0x3a1ac1(0x6a3) === _0x3a1ac1(0x6a3)) { const _0x242178 = Math[_0x3a1ac1(0x782)](_0x121e15 / 0x3c); if (_0x242178 < 0x30) _0x38bdd1 += _0x3a1ac1(0x2cc) + _0x242178 + _0x3a1ac1(0x385); else _0x38bdd1 += _0x3a1ac1(0x57d) + Math['floor'](_0x242178 / 0x18) + _0x3a1ac1(0x40d); } else { const _0x267112 = _0x1f4a29[_0x3a1ac1(0x349)](_0x2a89f9 => _0x2a89f9[_0x3a1ac1(0x2a5)] === _0x21e231['name']); if (_0x267112) _0x51f223[_0x3a1ac1(0x23f)](_0x728faa, { 'content': '[AI发送了表情：' + _0x267112['name'] + ']', 'displayUrl': _0x267112[_0x3a1ac1(0x5ce)] }); else _0xa47b70[_0x3a1ac1(0x751)] = _0x3a1ac1(0x20f) + _0x1ccd09[_0x3a1ac1(0x2a5)] + ']'; } } } } else _0x38bdd1 += '\x0a-\x20**对话状态**:\x20这是这个群的第一次对话。'; const _0x6f2564 = [..._0x2aa90d[_0x3a1ac1(0x7f2)]][_0x3a1ac1(0x709)]()[_0x3a1ac1(0x349)](_0x492b43 => _0x492b43['role'] === _0x3a1ac1(0x821))?.[_0x3a1ac1(0x751)] || '', _0x579cdf = _0x4a9a00(_0x2b1768, _0x6f2564), _0x1cefd6 = _0x2aa90d[_0x3a1ac1(0x7f2)]['slice'](-0x78), _0x13c5e8 = _0xe0a49d['map'](_0x58fc05 => _0x58fc05['name']), _0x3e544b = _0x1f3bb7(), _0x1ba536 = _0x10cf8c[_0x3a1ac1(0x511)](_0x22ff1b => { const _0x508888 = _0x3a1ac1, { omniText: _0x420466 } = _0x395060(_0x22ff1b['id'], _0x2b1768['id']), _0x59a490 = _0x515fd9(_0x22ff1b['id']), _0xa06834 = _0x22ff1b['linkedWorldBookIds'] && _0x22ff1b[_0x508888(0x76f)][_0x508888(0x45b)] > 0x0 ? _0x508888(0x631) + _0x22ff1b[_0x508888(0x2a5)] + _0x508888(0x465) + _0x22ff1b[_0x508888(0x76f)][_0x508888(0x511)](_0x17701c => _0x2aa90d[_0x508888(0x14b)][_0x508888(0x349)](_0x186b87 => _0x186b87['id'] === _0x17701c))[_0x508888(0x747)](Boolean)[_0x508888(0x511)](_0xa187e3 => '\x0a##\x20条目:\x20' + _0xa187e3[_0x508888(0x2a5)] + '\x0a' + _0xa187e3[_0x508888(0x751)])['join']('') : ''; return { 'id': _0x22ff1b['id'], 'name': _0x22ff1b['name'], 'persona': _0x22ff1b[_0x508888(0x839)] || _0x508888(0x7d7), 'memory': _0x420466 + _0x59a490 + _0xa06834 }; }), _0x2cfc69 = 0x5, _0x102f81 = 0xc, _0x5b905d = _0x3a1ac1(0x2c2)['trim'](), _0x4443ad = { 'instruction': (_0x3a1ac1(0x3fd) + (_0x356465[_0x3a1ac1(0x2a5)] || '用户') + _0x3a1ac1(0x5bb) + (_0x356465[_0x3a1ac1(0x2a5)] || '用户') + '”。在分析历史记录时，请记住这一点，并用此名称指代用户。\x0a-\x20【最重要】为\x20`personas`\x20列表中的【每一位】角色都规划至少一个事件(通常不少于2个)。不能遗漏任何角色。\x0a-\x20【新增规则】你可以规划\x20\x22kind\x22:\x20\x22music\x22\x20事件来分享音乐。此时，你【必须】同时提供\x20\x22songName\x22\x20和\x20\x22artist\x22\x20字段。\x0a-\x20你的首要任务是产出一个严格遵守SCHEMA、语法完全正确的、可被解析的JSON对象。\x0a-\x20若用户\x20`@`\x20了某个角色\x20(见\x20`mentioned`)，该角色应优先发言。\x0a-\x20事件总数必须控制在\x20' + _0x2cfc69 + _0x3a1ac1(0x594) + _0x102f81 + _0x3a1ac1(0x25b) + (_0x356465[_0x3a1ac1(0x2a5)] || '用户') + _0x3a1ac1(0x2b2) + _0x38bdd1 + '\x20\x0a' + _0x15c88e + '\x0a' + _0x5e93dc + '\x0a#\x20最近的动态回顾\x20(供所有角色参考)\x0a' + _0x3e544b + '\x0a')[_0x3a1ac1(0x2fe)](), 'personas': _0x1ba536, 'mentioned': _0x579cdf ? { 'id': _0x579cdf['id'], 'name': _0x579cdf['name'] } : null, 'stickerList': _0x13c5e8 }, _0x2f63f9 = { 'type': _0x3a1ac1(0x18c), 'properties': { 'events': { 'type': _0x3a1ac1(0x7e5), 'items': { 'type': _0x3a1ac1(0x18c), 'required': ['senderId', _0x3a1ac1(0x41f)], 'properties': { 'senderId': { 'type': _0x3a1ac1(0x233) }, 'kind': { 'type': 'string', 'enum': [_0x3a1ac1(0x740), _0x3a1ac1(0x547), _0x3a1ac1(0x5f7)] }, 'content': { 'type': _0x3a1ac1(0x233) }, 'sticker': { 'type': 'string' }, 'songName': { 'type': _0x3a1ac1(0x233) }, 'artist': { 'type': _0x3a1ac1(0x233) } } } } }, 'required': [_0x3a1ac1(0x16a)] }, _0x3d2993 = []; _0x3d2993['push']({ 'role': _0x3a1ac1(0x1db), 'content': _0x5b905d }), _0x1cefd6[_0x3a1ac1(0x242)](_0x5a9e72 => { const _0x367dcf = _0x3a1ac1, _0x3a9683 = _0x5a9e72[_0x367dcf(0x619)] === 'ai' || _0x5a9e72[_0x367dcf(0x619)] === 'assistant' ? _0x367dcf(0x4e1) : _0x367dcf(0x821); _0x3d2993['push']({ 'role': _0x3a9683, 'content': _0x5a9e72[_0x367dcf(0x751)], 'image': _0x5a9e72[_0x367dcf(0x33c)] }); }), _0x3d2993[_0x3a1ac1(0x249)]({ 'role': _0x3a1ac1(0x821), 'content': _0x3a1ac1(0x4e5) + JSON[_0x3a1ac1(0x46d)](_0x2f63f9) + _0x3a1ac1(0x73c) + JSON['stringify'](_0x4443ad) }); try { const _0x4d38da = await _0x3c8f91(_0x3d2993, { 'json': !![] }); if (!_0x4d38da) return null; let _0x36b2b5 = _0x4d38da['trim'](); const _0xa288be = _0x36b2b5[_0x3a1ac1(0x85a)](/```json([\s\S]*?)```/i); if (_0xa288be) _0x36b2b5 = _0xa288be[0x1][_0x3a1ac1(0x2fe)](); _0x36b2b5 = _0x59c28d(_0x36b2b5); let _0x2caca5 = null; try { if ('yzwEm' === _0x3a1ac1(0x850)) _0x2caca5 = JSON[_0x3a1ac1(0x38e)](_0x36b2b5); else { const _0x1154b0 = [], _0x9f7baa = /"(?:response|dialogue|message|text|content|line\d*|utterance\d*)"\s*:\s*"([\s\S]*?)"/gi; let _0x29895d; while ((_0x29895d = _0x9f7baa[_0x3a1ac1(0x435)](_0x48c555)) !== null) { const _0x95884d = _0x29895d[0x1][_0x3a1ac1(0x23b)](/\\"/g, '\x22')[_0x3a1ac1(0x23b)](/\\n/g, '\x0a')[_0x3a1ac1(0x2fe)](); if (_0x95884d) _0x1154b0['push'](_0x95884d); } if (_0x1154b0['length']) return _0x1154b0[_0x3a1ac1(0x6b6)](_0x3d9ab2)[_0x3a1ac1(0x830)](0x0, 0x9); } } catch (_0x16e8e7) { console[_0x3a1ac1(0x6eb)]('JSON\x20解析失败!\x20错误原因:', _0x16e8e7), console[_0x3a1ac1(0x6eb)](_0x3a1ac1(0x5ab), _0x36b2b5); } if (!_0x2caca5 || !Array[_0x3a1ac1(0x4d3)](_0x2caca5[_0x3a1ac1(0x16a)])) return null; return _0x2caca5 = _0x5497d4(_0x2caca5, _0x10cf8c, _0x13c5e8), _0x2caca5[_0x3a1ac1(0x16a)] = _0x2caca5[_0x3a1ac1(0x16a)][_0x3a1ac1(0x830)](0x0, _0x102f81), _0x2caca5['events'][_0x3a1ac1(0x45b)] ? _0x2caca5 : null; } catch (_0x2f786f) { return _0x2f786f[_0x3a1ac1(0x2a5)] !== 'AbortError' && console[_0x3a1ac1(0x6eb)](_0x3a1ac1(0x1ce), _0x2f786f), null; } } function _0x465fb9() { const _0x158522 = _0x12f887, _0x3cd3ec = document[_0x158522(0x49f)]('friend-circle-list-container'); _0x3cd3ec['innerHTML'] = ''; if (_0x2aa90d[_0x158522(0x2d4)][_0x158522(0x45b)] === 0x0) { if (_0x158522(0x6bc) !== _0x158522(0x679)) { _0x3cd3ec['innerHTML'] = _0x158522(0x5e4); return; } else _0x42fdf8[_0x158522(0x2d4)] = _0x21497d[_0x158522(0x2d4)], _0xcda161[_0x158522(0x806)] = _0x4f3181['activeFriendCircleId']; } _0x2aa90d[_0x158522(0x2d4)][_0x158522(0x242)](_0xc7357d => { const _0x596074 = _0x158522; if (_0x596074(0x517) === 'HLYhr') { const _0x594fdf = _0x2aa90d[_0x596074(0x47c)]['find'](_0x5c371d => _0x5c371d['id'] === _0xc7357d['boundUserProfileId']) || { 'name': _0x596074(0x584) }, _0x511b17 = document['createElement'](_0x596074(0x642)); _0x511b17[_0x596074(0x399)] = 'world-book-item', _0x511b17['dataset']['id'] = _0xc7357d['id'], _0x511b17['innerHTML'] = _0x596074(0x6f0) + _0xc7357d[_0x596074(0x2a5)] + _0x596074(0x259) + _0x594fdf[_0x596074(0x2a5)] + _0x596074(0x586) + _0xc7357d[_0x596074(0x40b)]['length'] + _0x596074(0x489), _0x511b17[_0x596074(0x179)]('click', () => _0x294c3f(_0xc7357d['id'])), _0x3cd3ec[_0x596074(0x185)](_0x511b17); } else _0x2ee24b[_0x596074(0x654)] && _0x18c7c0[_0x596074(0x654)]['signal'] === _0x7d7e58 && (_0x2a6b99[_0x596074(0x654)] = null); }); } function _0x44457e(_0x5af3c1 = null) { const _0x4bce4e = _0x12f887, _0x5414d9 = document[_0x4bce4e(0x49f)]('friend-circle-edit-name'), _0x48bbba = document[_0x4bce4e(0x49f)](_0x4bce4e(0x6fb)), _0x18c1c9 = document[_0x4bce4e(0x49f)](_0x4bce4e(0x764)), _0x2ed736 = document[_0x4bce4e(0x49f)](_0x4bce4e(0x205)), _0x50d8f1 = document[_0x4bce4e(0x49f)](_0x4bce4e(0x79d)), _0x281aef = document[_0x4bce4e(0x49f)]('delete-friend-circle-button'); _0x562826('friend-circle-edit-bind-user'), _0x18c1c9[_0x4bce4e(0x862)] = '', _0x2aa90d['characters'][_0x4bce4e(0x242)](_0x50b4ca => { const _0x475d05 = _0x4bce4e, _0x58712e = document[_0x475d05(0x1a2)]('div'); _0x58712e['className'] = 'member-selection-item', _0x58712e[_0x475d05(0x862)] = _0x475d05(0x172) + _0x50b4ca['id'] + '\x22\x20data-id=\x22' + _0x50b4ca['id'] + _0x475d05(0x767) + (_0x50b4ca['avatar'] || _0x12a7cc) + _0x475d05(0x417) + _0x50b4ca['id'] + _0x475d05(0x534) + _0x50b4ca['name'] + '</label>\x0a\x20\x20\x20\x20', _0x18c1c9[_0x475d05(0x185)](_0x58712e); }); if (_0x5af3c1) { const _0x46e3ff = _0x2aa90d[_0x4bce4e(0x2d4)][_0x4bce4e(0x349)](_0x57db56 => _0x57db56['id'] === _0x5af3c1); if (!_0x46e3ff) return; _0x2ed736['textContent'] = _0x4bce4e(0x1f8), _0x50d8f1[_0x4bce4e(0x5da)] = _0x46e3ff['id'], _0x5414d9[_0x4bce4e(0x5da)] = _0x46e3ff['name'], _0x48bbba[_0x4bce4e(0x5da)] = _0x46e3ff[_0x4bce4e(0x412)], _0x281aef['style']['display'] = _0x4bce4e(0x4b1), _0x46e3ff[_0x4bce4e(0x40b)][_0x4bce4e(0x242)](_0x289def => { const _0x5994e1 = _0x4bce4e; if (_0x5994e1(0x15e) === _0x5994e1(0x15e)) { const _0x58e82f = _0x18c1c9[_0x5994e1(0x4b0)](_0x5994e1(0x5a2) + _0x289def); if (_0x58e82f) _0x58e82f[_0x5994e1(0x5f2)] = !![]; } else _0x3d769d[_0x5994e1(0x6eb)](_0x5994e1(0x365), _0x1fc0ca), _0x441bf0(_0x5994e1(0x246) + _0xfa6df7[_0x5994e1(0x4c4)]); }); } else { if (_0x4bce4e(0x51c) !== _0x4bce4e(0x51c)) { _0x4850dd(_0x4bce4e(0x566)); return; } else _0x2ed736[_0x4bce4e(0x7ea)] = '新建好友圈', _0x50d8f1[_0x4bce4e(0x5da)] = '', _0x5414d9[_0x4bce4e(0x5da)] = _0x4bce4e(0x35b) + (_0x2aa90d[_0x4bce4e(0x2d4)]['length'] + 0x1), _0x48bbba[_0x4bce4e(0x5da)] = _0x2aa90d[_0x4bce4e(0x4f4)], _0x281aef[_0x4bce4e(0x3c9)][_0x4bce4e(0x6b4)] = _0x4bce4e(0x3d3); } _0x381d3b(_0x4bce4e(0x447), 'friendCircleList'); } function _0x137d6d() { const _0x4af3fb = _0x12f887; if (_0x4af3fb(0x703) !== 'dmvYR') { _0x3b6b55(); const _0x233e4e = _0x38e9e1(_0x4af3fb(0x77f), _0x459ca1[_0x4af3fb(0x2a5)]); _0x233e4e && _0x233e4e['trim']() && _0x233e4e !== _0xa34d72[_0x4af3fb(0x2a5)] && (_0x524a40['name'] = _0x233e4e[_0x4af3fb(0x2fe)](), _0x1efe34(), _0x35d9c4(), _0x5023bf(), _0x35e61e(_0x4af3fb(0x2d5) + _0xc5f8b4[_0x4af3fb(0x2a5)] + '\x22。')); } else { const _0x4007b8 = document[_0x4af3fb(0x49f)](_0x4af3fb(0x79d))['value'], _0x42b215 = document[_0x4af3fb(0x49f)](_0x4af3fb(0x346))[_0x4af3fb(0x5da)]['trim'](), _0x2c708c = document['getElementById'](_0x4af3fb(0x6fb))['value'], _0x617ac4 = Array['from'](document[_0x4af3fb(0x2aa)](_0x4af3fb(0x7ec)))[_0x4af3fb(0x511)](_0xe9739f => _0xe9739f[_0x4af3fb(0x55a)]['id']); if (!_0x42b215) { _0x5d65f5(_0x4af3fb(0x75c)); return; } if (_0x617ac4[_0x4af3fb(0x45b)] === 0x0) { _0x5d65f5('至少要选择一个圈内成员！'); return; } if (_0x4007b8) { const _0x1b8991 = _0x2aa90d[_0x4af3fb(0x2d4)][_0x4af3fb(0x349)](_0xfbcc84 => _0xfbcc84['id'] === _0x4007b8); _0x1b8991 && (_0x1b8991[_0x4af3fb(0x2a5)] = _0x42b215, _0x1b8991[_0x4af3fb(0x412)] = _0x2c708c, _0x1b8991[_0x4af3fb(0x40b)] = _0x617ac4); } else { if ('kDQJO' !== _0x4af3fb(0x558)) _0x10ede6(), _0x31ede9(); else { const _0x335af8 = { 'id': _0x4af3fb(0x467) + Date[_0x4af3fb(0x24a)](), 'name': _0x42b215, 'boundUserProfileId': _0x2c708c, 'memberCharacterIds': _0x617ac4, 'posts': [] }; _0x2aa90d[_0x4af3fb(0x2d4)][_0x4af3fb(0x249)](_0x335af8); } } _0x16a7ea(), _0x5d65f5(_0x4af3fb(0x7f8)), _0x465fb9(), _0x381d3b(_0x4af3fb(0x225), _0x4af3fb(0x447)); } } async function _0x4d016a() { const _0x5a2401 = _0x12f887; if (_0x5a2401(0x6f7) !== _0x5a2401(0x214)) { const _0x38515d = document[_0x5a2401(0x49f)](_0x5a2401(0x79d))[_0x5a2401(0x5da)]; if (!_0x38515d) return; const _0x281aff = await _0x1c19af('确定要删除这个好友圈吗？此操作不可撤销。'); _0x281aff && (_0x5a2401(0x4d9) === 'qZkHD' ? (_0x41da7d[_0x5a2401(0x1e0)](_0x24148a, _0x148f5e), _0x5934fb[_0x5a2401(0x509)](_0x413349)) : (_0x2aa90d[_0x5a2401(0x2d4)] = _0x2aa90d['friendCircles'][_0x5a2401(0x747)](_0x38d084 => _0x38d084['id'] !== _0x38515d), _0x2aa90d['activeFriendCircleId'] === _0x38515d && (_0x2aa90d['activeFriendCircleId'] = null), _0x16a7ea(), _0x5d65f5(_0x5a2401(0x211)), _0x465fb9(), _0x381d3b(_0x5a2401(0x225), _0x5a2401(0x447)))); } else _0x42dbef(![]); } function _0x294c3f(_0x4221bc) { const _0x4b9349 = _0x12f887; _0x44522f(); const _0x4ef749 = _0x2aa90d[_0x4b9349(0x2d4)][_0x4b9349(0x349)](_0x287c5c => _0x287c5c['id'] === _0x4221bc); if (!_0x4ef749) return; _0x2aa90d[_0x4b9349(0x806)] = _0x4221bc, _0x16a7ea(), document['getElementById']('friend-circle-title')[_0x4b9349(0x7ea)] = _0x4ef749['name'], _0xe530ab(), _0x381d3b(_0x4b9349(0x5f7), _0x4b9349(0x225)), _0x38e5c6(); } function _0x2bfe77() { const _0x30ca76 = _0x12f887; if (!_0x2aa90d['friendCircles'] || _0x2aa90d[_0x30ca76(0x2d4)]['length'] === 0x0) { console[_0x30ca76(0x6eb)](_0x30ca76(0x826)); return; } const _0x32db8e = _0x2aa90d[_0x30ca76(0x2d4)][0x0]; if (_0x32db8e[_0x30ca76(0x40b)][_0x30ca76(0x45b)] < 0x2) { console['error']('错误：第一个好友圈\x20\x22' + _0x32db8e[_0x30ca76(0x2a5)] + '\x22\x20的成员不足2人，无法生成点赞和评论。请先编辑该好友圈，添加至少2名角色。'); return; } const _0x488ca2 = { 'id': _0x30ca76(0x4fd) + Date['now'](), 'authorType': 'character', 'authorId': _0x32db8e[_0x30ca76(0x40b)][0x0], 'content': '这是一条由控制台添加的测试动态！样式看起来非常完美。', 'timestamp': Date[_0x30ca76(0x24a)](), 'likes': [_0x32db8e['memberCharacterIds'][0x1]], 'comments': [{ 'commentId': 'c_' + Date[_0x30ca76(0x24a)](), 'authorId': _0x32db8e['memberCharacterIds'][0x1], 'content': '赞同！渲染效果一级棒！' }] }; _0x32db8e[_0x30ca76(0x6fe)][_0x30ca76(0x249)](_0x488ca2), _0x16a7ea(), console['log'](_0x30ca76(0x53e) + _0x32db8e['name'] + '\x22\x20添加了一条测试动态。请点击进入该好友圈查看效果。'), _0x5d65f5('测试动态已添加！'); } window[_0x12f887(0x4a3)] = _0x2bfe77; function _0x1b0721(_0x322443) { const _0x3db42c = _0x12f887; return _0x2aa90d[_0x3db42c(0x47c)][_0x3db42c(0x349)](_0x519a3e => _0x519a3e['id'] === _0x322443); } function _0x9d4a2d(_0x10670b, _0xbaeacc = _0x12f887(0x6de)) { const _0xdd988f = _0x12f887, _0x5d4805 = document[_0xdd988f(0x49f)](_0xdd988f(0x778)); let _0x5aa5a1 = document[_0xdd988f(0x49f)](_0xdd988f(0x34b)); _0x10670b ? _0xdd988f(0x162) === _0xdd988f(0x61d) ? _0x4f79a9[_0xdd988f(0x1e0)](_0xdd988f(0x224) + _0x232c8[_0xdd988f(0x544)], _0x38b29f[_0xdd988f(0x46d)](_0x4504e1[_0xdd988f(0x7f2)])) : (!_0x5aa5a1 && (_0x5aa5a1 = document[_0xdd988f(0x1a2)](_0xdd988f(0x642)), _0x5aa5a1['id'] = _0xdd988f(0x34b), _0x5d4805[_0xdd988f(0x185)](_0x5aa5a1)), _0x5aa5a1[_0xdd988f(0x862)] = _0xdd988f(0x36d) + _0xbaeacc + _0xdd988f(0x2f7), _0x5aa5a1[_0xdd988f(0x3c9)][_0xdd988f(0x6b4)] = _0xdd988f(0x5dc)) : _0x5aa5a1 && (_0x5aa5a1[_0xdd988f(0x3c9)][_0xdd988f(0x6b4)] = _0xdd988f(0x3d3)); } async function _0x2e3495() { const _0x30a33e = _0x12f887; if (_0x30a33e(0x47e) === _0x30a33e(0x81e)) { const _0x29f202 = []; if (_0x4761e0[_0x30a33e(0x751)]) _0x29f202[_0x30a33e(0x249)]({ 'text': _0x49d7dd[_0x30a33e(0x751)] }); if (_0x78bfc6[_0x30a33e(0x33c)]) { const _0x47ee17 = _0x69350b[_0x30a33e(0x33c)]['split'](',')[0x1], _0xbbabc3 = _0x2e8e2d['image'][_0x30a33e(0x702)](_0x3ba707[_0x30a33e(0x33c)][_0x30a33e(0x540)](':') + 0x1, _0x1a42e2[_0x30a33e(0x33c)][_0x30a33e(0x540)](';')) || _0x30a33e(0x1b3); _0x29f202[_0x30a33e(0x249)]({ 'inline_data': { 'mime_type': _0xbbabc3, 'data': _0x47ee17 } }); } return _0x29f202; } else { const _0x39b2f1 = _0x2aa90d[_0x30a33e(0x2d4)]['find'](_0x4ad13b => _0x4ad13b['id'] === _0x2aa90d[_0x30a33e(0x806)]); if (!_0x39b2f1 || _0x2aa90d[_0x30a33e(0x784)]) return; _0x9d4a2d(!![], _0x30a33e(0x1bb)), _0x2aa90d['isGenerating'] = !![]; try { let _0x263bdb = Date[_0x30a33e(0x24a)](); _0x39b2f1[_0x30a33e(0x6fe)] && _0x39b2f1[_0x30a33e(0x6fe)][_0x30a33e(0x45b)] > 0x0 && (_0x30a33e(0x1d0) === _0x30a33e(0x6e5) ? (_0x88098d(), _0x4b4fad = null) : _0x263bdb = Math['max'](..._0x39b2f1[_0x30a33e(0x6fe)][_0x30a33e(0x511)](_0x577c9 => _0x577c9['timestamp']))); const _0x31c55c = await _0x5cc5b5(_0x39b2f1); if (!_0x31c55c || _0x31c55c[_0x30a33e(0x45b)] === 0x0) { _0x5d65f5(_0x30a33e(0x2ab)); return; } const _0x25491f = _0x31c55c[_0x30a33e(0x511)](async (_0x1c648e, _0x3b6d8e) => { const _0x92af7f = _0x30a33e; _0x9d4a2d(!![], '刷新了\x20' + (_0x3b6d8e + 0x1) + _0x92af7f(0x592) + _0x31c55c[_0x92af7f(0x45b)] + '\x20条动态...'); const _0x25d73d = _0x263bdb + (_0x3b6d8e + 0x1) * 0x3c * 0x3e8, _0x38db21 = { 'id': _0x92af7f(0x694) + _0x1c648e[_0x92af7f(0x883)] + '_' + _0x25d73d, 'authorType': 'character', 'authorId': _0x1c648e[_0x92af7f(0x883)], 'content': _0x1c648e['postContent'], 'timestamp': _0x25d73d, 'likes': _0x1c648e[_0x92af7f(0x1a3)] || [], 'comments': (_0x1c648e['comments'] || [])[_0x92af7f(0x511)]((_0x1fec00, _0x249e76) => ({ 'commentId': 'c_' + _0x25d73d + '_' + _0x249e76, 'authorId': _0x1fec00[_0x92af7f(0x883)], 'content': _0x1fec00[_0x92af7f(0x751)] })) }; if (_0x1c648e[_0x92af7f(0x377)] === _0x92af7f(0x5f7) && _0x1c648e['songName'] && _0x1c648e[_0x92af7f(0x347)]) try { const _0x7ddc14 = await _0x2ff291(_0x1c648e['songName'], _0x1c648e[_0x92af7f(0x347)]); _0x38db21[_0x92af7f(0x5b4)] = _0x92af7f(0x5f7), _0x38db21['songName'] = _0x1c648e['songName'], _0x38db21[_0x92af7f(0x347)] = _0x1c648e[_0x92af7f(0x347)], _0x38db21[_0x92af7f(0x6ca)] = _0x7ddc14[_0x92af7f(0x4ad)], _0x38db21['playableUrl'] = _0x7ddc14['url']; } catch (_0x1da870) { _0x92af7f(0x6f1) === _0x92af7f(0x3ba) ? _0x349db3[_0x92af7f(0x33c)] = _0x4f55d3 : (console[_0x92af7f(0x6eb)](_0x92af7f(0x186), _0x1da870), _0x38db21[_0x92af7f(0x5b4)] = _0x92af7f(0x740)); } else _0x38db21[_0x92af7f(0x5b4)] = _0x92af7f(0x740); return _0x38db21; }), _0x5c3f28 = await Promise[_0x30a33e(0x5c0)](_0x25491f); _0x39b2f1['posts'][_0x30a33e(0x249)](..._0x5c3f28), _0x16a7ea(); } catch (_0xab9a2c) { console['error'](_0x30a33e(0x3d0), _0xab9a2c), _0x5d65f5(_0x30a33e(0x152) + _0xab9a2c[_0x30a33e(0x4c4)]); } finally { _0x30a33e(0x790) !== _0x30a33e(0x790) ? (_0x3336c3[_0x30a33e(0x2bc)](), _0x2a87ca()) : (_0xe530ab(), _0x9d4a2d(![]), _0x2aa90d['isGenerating'] = ![]); } } } async function _0x5cc5b5(_0xc2e760) { const _0x4f7ee3 = _0x12f887, _0x3fc7a7 = _0xc2e760['memberCharacterIds'][_0x4f7ee3(0x511)](_0x1ec475 => _0x1c2a48(_0x1ec475))[_0x4f7ee3(0x747)](Boolean); if (_0x3fc7a7[_0x4f7ee3(0x45b)] === 0x0) return null; const _0x24e8b6 = _0x1f3bb7(), _0x5133bd = _0x1b0721(_0xc2e760[_0x4f7ee3(0x412)]) || _0x2aa90d['userProfiles'][0x0], _0x139542 = _0x5133bd ? _0x4f7ee3(0x792) + _0x5133bd[_0x4f7ee3(0x2a5)] + '\x0a-\x20人设:\x20' + (_0x5133bd['persona'] || '无') + '\x0a' : '', _0x1640cf = _0x3fc7a7[_0x4f7ee3(0x511)](_0x45472c => { const _0x2c54b7 = _0x4f7ee3, { omniText: _0x127741 } = _0x395060(_0x45472c['id'], null), _0x44d081 = _0x515fd9(_0x45472c['id']), _0x58d6e7 = _0x45472c[_0x2c54b7(0x76f)] && _0x45472c[_0x2c54b7(0x76f)]['length'] > 0x0 ? '\x0a\x0a#\x20' + _0x45472c[_0x2c54b7(0x2a5)] + _0x2c54b7(0x465) + _0x45472c[_0x2c54b7(0x76f)][_0x2c54b7(0x511)](_0x433728 => _0x2aa90d[_0x2c54b7(0x14b)][_0x2c54b7(0x349)](_0x1cf5b8 => _0x1cf5b8['id'] === _0x433728))[_0x2c54b7(0x747)](Boolean)['map'](_0xc539d1 => _0x2c54b7(0x65b) + _0xc539d1['name'] + '\x0a' + _0xc539d1[_0x2c54b7(0x751)])['join']('') : ''; return _0x2c54b7(0x3dd) + _0x45472c[_0x2c54b7(0x2a5)] + _0x2c54b7(0x84e) + _0x45472c['id'] + _0x2c54b7(0x157) + _0x45472c[_0x2c54b7(0x839)] + _0x2c54b7(0x555) + _0x127741 + '\x0a' + _0x44d081 + '\x0a' + _0x58d6e7; })[_0x4f7ee3(0x4c2)]('\x0a\x0a'), _0xcf8b96 = Math[_0x4f7ee3(0x782)](Math[_0x4f7ee3(0x27a)]() * 0x3) + 0x2, _0xa4ee26 = _0x4f7ee3(0x267) + _0xcf8b96 + _0x4f7ee3(0x5fb) + _0x1640cf + '\x0a' + _0x139542 + _0x4f7ee3(0x1eb) + _0x24e8b6 + '\x0a\x0a#\x20任务流程\x0a1.\x20\x20**全局视角**:\x20审视所有成员的人设和近期记忆（包括聊天、日记等），构思他们之间可能发生的有趣互动。\x0a2.\x20\x20**选择作者**:\x20从上述成员中，为' + _0xcf8b96 + _0x4f7ee3(0x2c4) + _0xcf8b96 + _0x4f7ee3(0x1ab), _0xff0930 = [{ 'role': _0x4f7ee3(0x1db), 'content': _0xa4ee26 }]; _0xff0930[_0x4f7ee3(0x249)]({ 'role': 'user', 'content': _0x4f7ee3(0x773) + _0xcf8b96 + _0x4f7ee3(0x4da) }); try { if (_0x4f7ee3(0x81c) !== 'FGToG') { const _0x3a7cd3 = await _0x3c8f91(_0xff0930, { 'json': !![] }), _0x42363b = _0x3a7cd3['match'](/(\[[\s\S]*\])/); if (!_0x42363b) throw new Error(_0x4f7ee3(0x4a1)); const _0x4cd8f0 = _0x42363b[0x1], _0x270884 = JSON[_0x4f7ee3(0x38e)](_0x4cd8f0); if (!Array[_0x4f7ee3(0x4d3)](_0x270884)) throw new Error('AI返回的不是一个数组。'); return _0x270884; } else { const _0x31cbc0 = _0x409b83[_0x4f7ee3(0x232)][_0x4f7ee3(0x7a2)][0x0]; if (!_0x31cbc0) return; const _0x35d518 = _0x3a86a3[_0x4f7ee3(0x52d)](_0x31cbc0); _0x4b2c9b[_0x4f7ee3(0x54e)] = _0x35d518, _0x5bd6f7[_0x4f7ee3(0x1b1)] = () => { const _0x49ce75 = _0x4f7ee3; _0x3e674b[_0x49ce75(0x64b)](_0x35d518); }; } } catch (_0x18d7ff) { if ('fyapW' === _0x4f7ee3(0x39c)) return console[_0x4f7ee3(0x6eb)](_0x4f7ee3(0x297), _0x18d7ff), console[_0x4f7ee3(0x6eb)](_0x4f7ee3(0x1c8), _0x18d7ff[_0x4f7ee3(0x37c)] || response), null; else { _0x2a2b41(_0x4f7ee3(0x874)); return; } } } async function _0x23d260() { const _0x39247d = _0x12f887; if (_0x39247d(0x268) !== _0x39247d(0x268)) return '刚才'; else { const _0x51cc7c = _0x2aa90d[_0x39247d(0x2d4)][_0x39247d(0x349)](_0x752bbb => _0x752bbb['id'] === _0x2aa90d[_0x39247d(0x806)]); if (!_0x51cc7c) return; const _0x1fb145 = await _0x1c19af('确定要清空好友圈“' + _0x51cc7c[_0x39247d(0x2a5)] + '”的所有动态吗？此操作不可撤销，且AI将不再记得这些内容。'); _0x1fb145 && (_0x51cc7c[_0x39247d(0x6fe)] = [], _0x16a7ea(), _0xe530ab(), _0x5d65f5(_0x39247d(0x1ca))); } } function _0xe530ab() { const _0x53f503 = _0x12f887, _0x27598d = document['getElementById'](_0x53f503(0x2fd)), _0x59b29b = _0x2aa90d['friendCircles'][_0x53f503(0x349)](_0x50cd83 => _0x50cd83['id'] === _0x2aa90d[_0x53f503(0x806)]); if (!_0x59b29b) { if ('Uxnas' === _0x53f503(0x6d5)) _0x566e7a['createObjectStore'](_0x53f503(0x184), { 'keyPath': 'id' }); else { _0x27598d[_0x53f503(0x862)] = _0x53f503(0x387); return; } } if (_0x59b29b['posts'][_0x53f503(0x45b)] === 0x0) { _0x27598d[_0x53f503(0x862)] = _0x53f503(0x20a); return; } _0x27598d[_0x53f503(0x862)] = ''; const _0x2432ea = [..._0x59b29b['posts']][_0x53f503(0x1e7)]((_0xdbce73, _0x20a32e) => _0x20a32e[_0x53f503(0x602)] - _0xdbce73[_0x53f503(0x602)]); _0x2432ea[_0x53f503(0x242)](_0x5bd9ef => { const _0xe72d63 = _0x53f503, _0x1f7e50 = document[_0xe72d63(0x1a2)](_0xe72d63(0x642)); _0x1f7e50[_0xe72d63(0x399)] = 'music-post'; let _0x1fd936 = '未知', _0x3b14ef = _0x12a7cc; if (_0x5bd9ef[_0xe72d63(0x6d8)] === _0xe72d63(0x821)) { if (_0xe72d63(0x4f1) === _0xe72d63(0x687)) { const _0x316298 = _0x3a80fd[_0xe72d63(0x49f)]('world-book-list-container'); _0x316298[_0xe72d63(0x862)] = ''; if (_0x5e4f61['worldBooks']['length'] === 0x0) { _0x316298[_0xe72d63(0x862)] = '<p\x20style=\x22text-align:\x20center;\x20color:\x20var(--text-color-light);\x22>还没有任何设定，点击右上角“+”来创建第一个吧。</p>'; return; } _0x19a843[_0xe72d63(0x14b)]['forEach'](_0x31bfe6 => { const _0x263d61 = _0xe72d63, _0x12d301 = _0x275fe4['createElement'](_0x263d61(0x642)); _0x12d301[_0x263d61(0x399)] = _0x263d61(0x201), _0x12d301[_0x263d61(0x55a)]['id'] = _0x31bfe6['id'], _0x12d301[_0x263d61(0x862)] = _0x263d61(0x6f0) + _0x31bfe6[_0x263d61(0x2a5)] + _0x263d61(0x53b) + _0x31bfe6[_0x263d61(0x751)][_0x263d61(0x702)](0x0, 0x64) + _0x263d61(0x842), _0x12d301[_0x263d61(0x179)](_0x263d61(0x3e9), () => _0x5841e2(_0x31bfe6['id'])), _0x316298[_0x263d61(0x185)](_0x12d301); }); } else { const _0x5a5ac8 = _0x1b0721(_0x5bd9ef['authorId']); if (_0x5a5ac8) { if (_0xe72d63(0x58d) === 'DidUK') _0x1fd936 = _0x5a5ac8['name'], _0x3b14ef = _0x5a5ac8[_0xe72d63(0x5c4)]; else { _0x49691f[_0xe72d63(0x5da)] = '', _0x35adea['innerHTML'] = ''; if (_0x4d7c8f[_0xe72d63(0x857)][_0xe72d63(0x45b)] < 0x2) { _0x3a3732('需要至少2个角色才能创建群聊。'); return; } _0x963de['characters']['forEach'](_0x7c57e0 => { const _0x4b5e04 = _0xe72d63, _0x333091 = _0xc0510[_0x4b5e04(0x1a2)]('li'); _0x333091['className'] = _0x4b5e04(0x1d2), _0x333091[_0x4b5e04(0x862)] = '\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22checkbox\x22\x20id=\x22member-' + _0x7c57e0['id'] + _0x4b5e04(0x3d9) + _0x7c57e0['id'] + '\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22' + (_0x7c57e0['avatar'] || _0x6594b0) + _0x4b5e04(0x74f) + _0x7c57e0['id'] + '\x22\x20class=\x22char-name\x22>' + _0x7c57e0['name'] + _0x4b5e04(0x16f), _0x214ee4['appendChild'](_0x333091); }), _0xb033dc(_0xe72d63(0x624), _0xe72d63(0x405)); } } } } else { const _0x4b9e13 = _0x1c2a48(_0x5bd9ef[_0xe72d63(0x883)]); _0x4b9e13 && (_0xe72d63(0x495) === _0xe72d63(0x35a) ? (_0x5037a2[_0xe72d63(0x6eb)](_0xe72d63(0x81b), _0x4b1e5f), _0x3a06d4['src'] = '') : (_0x1fd936 = _0x4b9e13['name'], _0x3b14ef = _0x4b9e13[_0xe72d63(0x5c4)])); } const _0x5da674 = '\x0a\x20\x20\x20\x20\x20\x20<div\x20class=\x22music-post-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22' + _0x3b14ef + _0xe72d63(0x3a3) + _0x1fd936 + _0xe72d63(0x62e), _0xf4d452 = _0xe72d63(0x2a9) + _0x5bd9ef[_0xe72d63(0x751)] + _0xe72d63(0x236); let _0x302d98 = ''; _0x5bd9ef[_0xe72d63(0x33c)] && (_0x302d98 = _0xe72d63(0x706) + _0x5bd9ef[_0xe72d63(0x33c)] + _0xe72d63(0x721)); let _0x1dbc78 = ''; _0x5bd9ef[_0xe72d63(0x5b4)] === 'music' && _0x5bd9ef[_0xe72d63(0x879)] && (_0x1dbc78 = _0xe72d63(0x7e6) + _0x5bd9ef['id'] + '\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22' + (_0x5bd9ef['coverUrl'] || _0x12a7cc) + '\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22music-post-song-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22title\x22>' + _0x5bd9ef[_0xe72d63(0x879)] + _0xe72d63(0x192) + _0x5bd9ef['artist'] + _0xe72d63(0x7bf) + (_0x5bd9ef['playableUrl'] ? '▶' : '⚠') + '</div>\x0a\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20'); const _0x5e3779 = _0xe72d63(0x461) + new Date(_0x5bd9ef[_0xe72d63(0x602)])['toLocaleString'](_0xe72d63(0x49e)) + '</div>'; let _0x2a9c13 = ''; if (_0x5bd9ef[_0xe72d63(0x1a3)] && _0x5bd9ef['likes'][_0xe72d63(0x45b)] > 0x0 || _0x5bd9ef['comments'] && _0x5bd9ef['comments'][_0xe72d63(0x45b)] > 0x0) { if (_0xe72d63(0x1b9) === _0xe72d63(0x277)) { const { playlist: _0x7b5634, currentIndex: _0x4ca038 } = _0x114604[_0xe72d63(0x38e)](_0x2fb511); _0x58f4b1[_0xe72d63(0x4d3)](_0x7b5634) && _0x7b5634['length'] > 0x0 && _0x4ca038 > -0x1 && (_0x253565[_0xe72d63(0x554)] = _0x7b5634, _0x13c756[_0xe72d63(0x28d)] = _0x4ca038, _0x465be7['isPlaying'] = ![], _0xfc6763()); } else { let _0x2aafbc = ''; if (_0x5bd9ef[_0xe72d63(0x1a3)] && _0x5bd9ef[_0xe72d63(0x1a3)]['length'] > 0x0) { if ('bKHaN' === _0xe72d63(0x675)) { const _0x4aa2e2 = _0x5bd9ef[_0xe72d63(0x1a3)][_0xe72d63(0x511)](_0x6d3834 => _0x1c2a48(_0x6d3834)?.[_0xe72d63(0x2a5)] || '未知')[_0xe72d63(0x4c2)]('、'); _0x2aafbc = _0xe72d63(0x762) + _0x4aa2e2 + _0xe72d63(0x78e); } else { _0x1515a1[_0xe72d63(0x862)] = _0xe72d63(0x3c6); return; } } let _0x23a76f = ''; if (_0x5bd9ef[_0xe72d63(0x3b5)] && _0x5bd9ef['comments'][_0xe72d63(0x45b)] > 0x0) { if (_0xe72d63(0x86a) !== _0xe72d63(0x53f)) { const _0x1acfbf = _0x5bd9ef['comments'][_0xe72d63(0x511)](_0x4e731f => { const _0x4f830d = _0xe72d63, _0x471140 = _0x1c2a48(_0x4e731f[_0x4f830d(0x883)])?.[_0x4f830d(0x2a5)] || '未知'; return _0x4f830d(0x238) + _0x471140 + _0x4f830d(0x68a) + _0x4e731f[_0x4f830d(0x751)] + _0x4f830d(0x78e); })[_0xe72d63(0x4c2)](''); _0x23a76f = _0xe72d63(0x2b1) + _0x1acfbf + _0xe72d63(0x78e); } else _0x1d3375['conversationHistory'][_0xe72d63(0x242)]((_0x10cbe7, _0x1b57fc) => _0x26b1a3(_0x10cbe7, _0x1b57fc)); } _0x2a9c13 = '\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22post-interactions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20' + _0x2aafbc + _0xe72d63(0x7f4) + _0x23a76f + _0xe72d63(0x36b); } } _0x1f7e50[_0xe72d63(0x862)] = _0x5da674 + _0xf4d452 + _0x302d98 + _0x1dbc78 + _0x5e3779 + _0x2a9c13, _0x27598d[_0xe72d63(0x185)](_0x1f7e50); if (_0x5bd9ef[_0xe72d63(0x5b4)] === 'music' && _0x5bd9ef['playableUrl']) { if (_0xe72d63(0x809) !== _0xe72d63(0x6e1)) { const _0x53f38a = _0x1f7e50[_0xe72d63(0x4b0)]('.music-post-song-card'); _0x53f38a && _0x53f38a['addEventListener'](_0xe72d63(0x3e9), function () { const _0xdbd8ae = _0xe72d63, _0x2479cf = { 'id': _0x5bd9ef['id'], 'url': _0x5bd9ef[_0xdbd8ae(0x419)] }; _0x4f4d66(this, _0x2479cf); }); } else _0x5492ae *= _0x23744d / _0x147083, _0x38a370 = _0x5d20f9; } }); } document['getElementById'](_0x12f887(0x45d))[_0x12f887(0x179)](_0x12f887(0x3e9), _0x23d260), document['getElementById'](_0x12f887(0x333))['addEventListener'](_0x12f887(0x3e9), _0x2e3495), document[_0x12f887(0x49f)](_0x12f887(0x371))[_0x12f887(0x179)](_0x12f887(0x3e9), () => _0x381d3b('home', _0x12f887(0x225))), document['getElementById'](_0x12f887(0x40a))['addEventListener'](_0x12f887(0x3e9), () => _0x44457e()), document[_0x12f887(0x49f)](_0x12f887(0x86d))[_0x12f887(0x179)](_0x12f887(0x3e9), () => _0x381d3b('friendCircleList', _0x12f887(0x447))), document[_0x12f887(0x49f)](_0x12f887(0x2d2))[_0x12f887(0x179)](_0x12f887(0x3e9), _0x137d6d), document['getElementById'](_0x12f887(0x841))[_0x12f887(0x179)]('click', _0x4d016a), document['getElementById'](_0x12f887(0x396))[_0x12f887(0x179)]('click', () => { const _0x2bf79f = _0x12f887; if (_0x2bf79f(0x1bd) === _0x2bf79f(0x1bd)) _0x465fb9(), _0x381d3b(_0x2bf79f(0x225), _0x2bf79f(0x5f7)); else { _0x446edd(_0x2bf79f(0x6e7)); return; } }), document[_0x12f887(0x49f)](_0x12f887(0x7c6))[_0x12f887(0x179)](_0x12f887(0x3e9), () => { const _0x293fed = _0x12f887; if ('YfLkm' !== _0x293fed(0x33e)) _0x2aa90d[_0x293fed(0x806)] && _0x44457e(_0x2aa90d['activeFriendCircleId']); else { const _0x16ed45 = _0x46a80c['userProfiles']['find'](_0x56e3d0 => _0x56e3d0['id'] === _0x5b0094[_0x293fed(0x412)]) || { 'name': _0x293fed(0x584) }, _0x3dbc90 = _0x314ce1['createElement'](_0x293fed(0x642)); _0x3dbc90[_0x293fed(0x399)] = _0x293fed(0x201), _0x3dbc90[_0x293fed(0x55a)]['id'] = _0x207f5c['id'], _0x3dbc90[_0x293fed(0x862)] = _0x293fed(0x6f0) + _0x54b87e[_0x293fed(0x2a5)] + _0x293fed(0x259) + _0x16ed45[_0x293fed(0x2a5)] + _0x293fed(0x586) + _0x209760[_0x293fed(0x40b)][_0x293fed(0x45b)] + _0x293fed(0x489), _0x3dbc90[_0x293fed(0x179)]('click', () => _0x1b6964(_0x550ce1['id'])), _0x2b3a3c[_0x293fed(0x185)](_0x3dbc90); } }), document['getElementById']('user-send-post-button')[_0x12f887(0x179)](_0x12f887(0x3e9), async () => { const _0x23639c = _0x12f887, _0x320b6b = _0x2aa90d[_0x23639c(0x2d4)][_0x23639c(0x349)](_0x43af83 => _0x43af83['id'] === _0x2aa90d[_0x23639c(0x806)]); if (!_0x320b6b || _0x2aa90d[_0x23639c(0x784)]) return; const _0x5bc7e8 = _0x320b6b[_0x23639c(0x412)], _0x3f11c2 = _0x2aa90d[_0x23639c(0x47c)][_0x23639c(0x349)](_0x2742e3 => _0x2742e3['id'] === _0x5bc7e8); if (!_0x3f11c2) { _0x5d65f5(_0x23639c(0x1a8)); return; } const _0x2b1821 = document['getElementById'](_0x23639c(0x354))[_0x23639c(0x5da)][_0x23639c(0x2fe)](), _0x138cd3 = _0x2aa90d[_0x23639c(0x44b)][_0x23639c(0x33c)], _0x516c46 = _0x2aa90d[_0x23639c(0x44b)]['music']; if (!_0x2b1821 && !_0x138cd3 && !_0x516c46) { _0x5d65f5('总得说点什么吧？'); return; } const _0x46f9f0 = { 'id': _0x23639c(0x51e) + Date[_0x23639c(0x24a)](), 'authorType': _0x23639c(0x821), 'authorId': _0x3f11c2['id'], 'content': _0x2b1821, 'timestamp': Date[_0x23639c(0x24a)](), 'likes': [], 'comments': [] }; _0x138cd3 && (_0x46f9f0[_0x23639c(0x33c)] = _0x138cd3), _0x516c46 ? _0x23639c(0x707) === 'tBiSK' ? (_0x26d355(_0x5cbf5e), _0x20018a()) : (_0x46f9f0[_0x23639c(0x5b4)] = _0x23639c(0x5f7), Object[_0x23639c(0x23f)](_0x46f9f0, _0x516c46)) : _0x23639c(0x23e) !== _0x23639c(0x23e) ? _0x1959ad[_0x23639c(0x509)](_0x23639c(0x44e)) : _0x46f9f0[_0x23639c(0x5b4)] = _0x23639c(0x740), _0x320b6b[_0x23639c(0x6fe)][_0x23639c(0x249)](_0x46f9f0), _0x16a7ea(), _0xe530ab(), document[_0x23639c(0x49f)](_0x23639c(0x354))[_0x23639c(0x5da)] = '', _0x2aa90d[_0x23639c(0x44b)][_0x23639c(0x33c)] = null, _0x2aa90d[_0x23639c(0x44b)]['music'] = null, _0x4d7ef9(), _0x51612b(_0x46f9f0); }), document[_0x12f887(0x49f)](_0x12f887(0x247))['addEventListener'](_0x12f887(0x3e9), () => { const _0x761060 = _0x12f887; document['getElementById']('user-post-image-input')[_0x761060(0x3e9)](); }), document[_0x12f887(0x49f)](_0x12f887(0x523))[_0x12f887(0x179)]('change', async _0x34e6ee => { const _0x164299 = _0x12f887, _0x1f03a0 = _0x34e6ee['target'][_0x164299(0x7a2)][0x0]; if (!_0x1f03a0) return; try { if (_0x164299(0x837) === _0x164299(0x837)) { const _0x4de752 = await _0x2a3cd4(_0x1f03a0); _0x2aa90d[_0x164299(0x44b)][_0x164299(0x33c)] = _0x4de752, _0x2aa90d[_0x164299(0x44b)][_0x164299(0x5f7)] = null, _0x4d7ef9(); } else _0x2334a5[_0x164299(0x691)] === _0x164299(0x3c2) && !_0x47eeea[_0x164299(0x5db)] && (_0x5a32c1[_0x164299(0x2bc)](), _0xd92d62()); } catch (_0x2a8aef) { _0x5d65f5(_0x164299(0x3c8) + _0x2a8aef[_0x164299(0x4c4)]); } _0x34e6ee[_0x164299(0x232)]['value'] = ''; }), document['getElementById']('user-post-music-button')[_0x12f887(0x179)](_0x12f887(0x3e9), async () => { const _0x57aa9b = _0x12f887, _0x47971c = await _0x396d49(); if (!_0x47971c) return; _0x5d65f5('正在搜索音乐...'); try { const _0xfe4556 = await _0x2ff291(_0x47971c[_0x57aa9b(0x879)], _0x47971c[_0x57aa9b(0x347)]); _0x2aa90d[_0x57aa9b(0x44b)][_0x57aa9b(0x5f7)] = { 'songName': _0x47971c[_0x57aa9b(0x879)], 'artist': _0x47971c[_0x57aa9b(0x347)], 'coverUrl': _0xfe4556[_0x57aa9b(0x4ad)], 'playableUrl': _0xfe4556[_0x57aa9b(0x5ce)] }, _0x2aa90d['pendingPostAttachments'][_0x57aa9b(0x33c)] = null, _0x4d7ef9(); } catch (_0x9d983c) { _0x5d65f5(_0x57aa9b(0x38a) + _0x9d983c['message']); } }); function _0x324f4e() { const _0x376cac = _0x12f887, _0x5da045 = new Date(), _0x14b452 = document[_0x376cac(0x49f)]('home-time'), _0xeb7f12 = document[_0x376cac(0x49f)](_0x376cac(0x263)); if (_0x14b452 && _0xeb7f12) { if (_0x376cac(0x7f3) !== _0x376cac(0x7f3)) { const _0x1529b9 = _0x2303aa[_0x376cac(0x4b0)](_0x376cac(0x6a7) + _0x12c7a5 + _0x376cac(0x407) + _0x493649 + _0x376cac(0x847))?.[_0x376cac(0x862)]; _0x1529b9 && (_0x3c45b1[_0x376cac(0x862)] = _0x1529b9); } else { const _0x3e96b1 = String(_0x5da045['getHours']())[_0x376cac(0x2a3)](0x2, '0'), _0xae43a1 = String(_0x5da045[_0x376cac(0x7eb)]())[_0x376cac(0x2a3)](0x2, '0'); _0x14b452[_0x376cac(0x7ea)] = _0x3e96b1 + ':' + _0xae43a1; const _0x3c9df7 = _0x5da045[_0x376cac(0x3de)]() + 0x1, _0x3793fb = _0x5da045[_0x376cac(0x2d7)](), _0x168ff7 = ['星期日', _0x376cac(0x3ae), '星期二', _0x376cac(0x2c9), '星期四', _0x376cac(0x44f), _0x376cac(0x4c9)][_0x5da045[_0x376cac(0x87b)]()]; _0xeb7f12['textContent'] = _0x3c9df7 + '月' + _0x3793fb + '日\x20' + _0x168ff7; } } } function _0xe98c0f(_0x2b31ba) { const _0x1a95f7 = _0x12f887; if (!_0x2b31ba) return ''; const _0x19f28d = new Date(_0x2b31ba), _0x8b152d = String(_0x19f28d['getHours']())[_0x1a95f7(0x2a3)](0x2, '0'), _0x399e13 = String(_0x19f28d[_0x1a95f7(0x7eb)]())[_0x1a95f7(0x2a3)](0x2, '0'); return _0x8b152d + ':' + _0x399e13; } function _0x1f3bb7() { const _0x399f46 = _0x12f887, _0x4c8de2 = _0x2aa90d['friendCircles']['find'](_0x416adf => _0x416adf['id'] === _0x2aa90d['activeFriendCircleId']), _0x5222a4 = _0x4c8de2 ? _0x4c8de2[_0x399f46(0x6fe)] : []; if (!_0x5222a4 || _0x5222a4[_0x399f46(0x45b)] === 0x0) { if (_0x399f46(0x422) === _0x399f46(0x845)) _0x30a354 += _0x399f46(0x636); else return ''; } const _0x5d4bac = _0x5222a4[_0x399f46(0x830)](0x0, 0x5), _0x134883 = _0x5d4bac['map'](_0x4025a => { const _0x25c55e = _0x399f46; if (_0x25c55e(0x67e) !== _0x25c55e(0x768)) { const _0x21d020 = _0x1c2a48(_0x4025a[_0x25c55e(0x883)]) || { 'name': '未知' }; let _0x23f351 = _0x25c55e(0x4fe) + _0x21d020[_0x25c55e(0x2a5)] + _0x25c55e(0x6f5) + (_0x4025a[_0x25c55e(0x5a3)] || _0x4025a[_0x25c55e(0x751)]) + '”'; return _0x4025a['type'] === _0x25c55e(0x5f7) && (_0x23f351 += _0x25c55e(0x3a1) + _0x4025a['songName'] + _0x25c55e(0x820) + _0x4025a['artist'] + ')'), _0x23f351; } else { const _0x1e9e7a = _0xf80af9(_0x1ab5c8[_0x25c55e(0x751)]); _0xd34d2[_0x25c55e(0x23f)](_0x29cc3a, { 'content': _0x1e9e7a[_0x25c55e(0x751)], 'quotedMessage': _0x1e9e7a[_0x25c55e(0x7a0)] }); } }); return _0x399f46(0x2e7) + _0x134883[_0x399f46(0x4c2)]('\x0a'); } function _0x515fd9(_0x4d98f9) { const _0x54fa6f = _0x12f887; if (_0x54fa6f(0x84c) === _0x54fa6f(0x7ac)) _0x140bb0[_0x54fa6f(0x806)] = null; else { const _0x5ddb4c = _0x2aa90d[_0x54fa6f(0x47c)][_0x54fa6f(0x349)](_0x46a261 => _0x46a261['id'] === _0x2aa90d['activeUserProfileId']) || { 'name': '你' }, _0x431fd2 = _0x2aa90d['diaries'][_0x54fa6f(0x349)](_0x3228c7 => _0x3228c7['characterId'] === _0x4d98f9); if (!_0x431fd2 || !_0x431fd2[_0x54fa6f(0x4ce)] || _0x431fd2['entries'][_0x54fa6f(0x45b)] === 0x0) return ''; const _0x36305c = _0x431fd2[_0x54fa6f(0x4ce)][_0x54fa6f(0x830)](-0x8), _0x4b6dde = _0x36305c[_0x54fa6f(0x511)](_0x17b405 => { const _0x39b0a4 = _0x54fa6f, _0x23ea54 = _0x17b405[_0x39b0a4(0x71c)] === _0x39b0a4(0x821) ? _0x5ddb4c[_0x39b0a4(0x2a5)] : _0x1c2a48(_0x17b405[_0x39b0a4(0x71c)])[_0x39b0a4(0x2a5)]; return _0x39b0a4(0x6b0) + new Date(_0x17b405[_0x39b0a4(0x602)])[_0x39b0a4(0x3ad)]() + ']\x20' + _0x23ea54 + '\x20写道:\x20' + _0x17b405[_0x39b0a4(0x751)]; })[_0x54fa6f(0x4c2)]('\x0a'); return _0x54fa6f(0x7f7) + _0x5ddb4c[_0x54fa6f(0x2a5)] + _0x54fa6f(0x27b) + _0x4b6dde; } } function _0x2f103c() { const _0x33c4b4 = _0x12f887, _0x2dc0bf = document[_0x33c4b4(0x49f)](_0x33c4b4(0x74e)), _0xb01deb = _0x2aa90d[_0x33c4b4(0x2eb)][_0x33c4b4(0x4e2)]; if (_0xb01deb) _0x33c4b4(0x77e) === _0x33c4b4(0x19a) ? (_0x38f656(![]), _0x2d77cc['error'](_0x33c4b4(0x648), _0x1ba40c), _0x223af8(_0x33c4b4(0x2e8) + _0xff2f9a[_0x33c4b4(0x4c4)])) : (_0x2dc0bf[_0x33c4b4(0x3c9)][_0x33c4b4(0x482)] = _0x33c4b4(0x4ac) + _0xb01deb + ')', _0x2dc0bf[_0x33c4b4(0x3c9)]['backgroundSize'] = _0x33c4b4(0x4ad), _0x2dc0bf[_0x33c4b4(0x3c9)][_0x33c4b4(0x286)] = 'center', _0x2dc0bf[_0x33c4b4(0x3c9)][_0x33c4b4(0x416)] = 'white', _0x2dc0bf[_0x33c4b4(0x2aa)](_0x33c4b4(0x7c2))[_0x33c4b4(0x242)](_0xf847ee => { const _0x4e7dd4 = _0x33c4b4; _0x4e7dd4(0x266) !== _0x4e7dd4(0x266) ? (_0x549443[_0x4e7dd4(0x3c9)][_0x4e7dd4(0x5b0)] = _0x1e597d[_0x4e7dd4(0x5b0)] + '%', _0x14f5d7[_0x4e7dd4(0x3c9)][_0x4e7dd4(0x1fb)] = _0xc671f0[_0x4e7dd4(0x1fb)] + '%') : _0xf847ee[_0x4e7dd4(0x3c9)]['textShadow'] = _0x4e7dd4(0x5c8); })); else { if ('leGcE' === _0x33c4b4(0x632)) { const _0x2caf80 = _0x2eb92d[_0x33c4b4(0x49f)](_0x33c4b4(0x338)), _0x268a3a = _0x53bf84[_0x33c4b4(0x49f)](_0x33c4b4(0x378)), _0x2c3fa0 = _0x236239['querySelector'](_0x33c4b4(0x5d5)); _0xe4984['meetingViewMode'] === 'galgame' ? (_0x2caf80[_0x33c4b4(0x3c9)][_0x33c4b4(0x6b4)] = _0x33c4b4(0x3d3), _0x268a3a[_0x33c4b4(0x3c9)][_0x33c4b4(0x6b4)] = _0x33c4b4(0x4b1)) : (_0x2caf80[_0x33c4b4(0x3c9)][_0x33c4b4(0x6b4)] = _0x33c4b4(0x4b1), _0x268a3a['style'][_0x33c4b4(0x6b4)] = _0x33c4b4(0x3d3)), _0x2c3fa0[_0x33c4b4(0x3c9)][_0x33c4b4(0x6b4)] = _0x33c4b4(0x4b1); } else _0x2dc0bf[_0x33c4b4(0x3c9)][_0x33c4b4(0x482)] = '', _0x2dc0bf[_0x33c4b4(0x3c9)][_0x33c4b4(0x416)] = '', _0x2dc0bf[_0x33c4b4(0x2aa)]('.widget-info\x20>\x20div')[_0x33c4b4(0x242)](_0x2d3fce => { const _0x43cf4e = _0x33c4b4; if (_0x43cf4e(0x7e3) !== _0x43cf4e(0x7e3)) { _0x4eeba6[_0x43cf4e(0x6eb)](_0x43cf4e(0x562) + _0x6f22d6[_0x43cf4e(0x2a5)] + _0x43cf4e(0x31d)); return; } else _0x2d3fce['style'][_0x43cf4e(0x7f5)] = ''; }); } } const _0x54ce24 = document[_0x12f887(0x49f)](_0x12f887(0x597)), _0x19504f = document['getElementById']('app-meeting'); _0x54ce24[_0x12f887(0x179)](_0x12f887(0x3e9), () => { const _0x28963e = _0x12f887; _0x465fb9(), _0x381d3b(_0x28963e(0x225), 'home'); }), _0x19504f['addEventListener']('click', () => { const _0x40003c = _0x12f887; _0x1072e4(), _0x381d3b(_0x40003c(0x29f), _0x40003c(0x5d1)); }), document['getElementById']('back-to-home-from-meeting-list')[_0x12f887(0x179)](_0x12f887(0x3e9), () => { const _0x25e46e = _0x12f887; _0x25e46e(0x537) !== _0x25e46e(0x3f2) ? _0x381d3b('home', _0x25e46e(0x29f)) : _0x25f66f['click'](); }), document[_0x12f887(0x49f)](_0x12f887(0x766))['addEventListener']('click', () => { const _0x1a5a14 = _0x12f887; if (_0x1a5a14(0x34c) === _0x1a5a14(0x18b)) _0x2ce0b5(); else { if (_0x4228c1) clearInterval(_0x4228c1); _0x4228c1 = null, _0x2aa90d[_0x1a5a14(0x700)] = [], _0x2aa90d['activeMeetingCharId'] = null, _0x2aa90d[_0x1a5a14(0x544)] = null, _0x16a7ea(), _0x381d3b('meetingList', _0x1a5a14(0x775)); } }); const _0x483ffb = document[_0x12f887(0x49f)]('meeting-message-input'), _0x2e9fd0 = document[_0x12f887(0x49f)](_0x12f887(0x6be)); _0x2e9fd0['addEventListener'](_0x12f887(0x3e9), () => { const _0x2debd7 = _0x12f887; if (_0x2debd7(0x420) === 'EuSuk') _0x434d91[_0x2debd7(0x5da)] = ''; else { const _0x21b049 = _0x483ffb['value'][_0x2debd7(0x2fe)](); if (_0x21b049) { if (_0x2debd7(0x330) === _0x2debd7(0x330)) _0x48b971(_0x21b049), _0x483ffb[_0x2debd7(0x5da)] = '', setTimeout(_0x5c969b, 0x64); else { const _0x1ce99b = new _0x30bdab(); _0x1ce99b[_0x2debd7(0x65d)] = () => _0x412d08(_0x1ce99b[_0x2debd7(0x4d0)]), _0x1ce99b[_0x2debd7(0x1cf)] = _0x8a9f48, _0x1ce99b[_0x2debd7(0x329)](_0x967568); } } } }); function _0x4f4d66(_0x13c594, _0x4ca578) { const _0x23951b = _0x12f887, _0x36af61 = document[_0x23951b(0x49f)](_0x23951b(0x2f8)), _0x4902bb = document[_0x23951b(0x2aa)](_0x23951b(0x637)); _0x4902bb[_0x23951b(0x242)](_0x114fa7 => { const _0x2c51e9 = _0x23951b; _0x2c51e9(0x74a) === _0x2c51e9(0x588) ? (_0x26d712(), _0x6aa1a(![])) : _0x114fa7 !== _0x13c594[_0x2c51e9(0x4b0)]('.music-post-play-icon,\x20.music-share-play-icon') && (_0x2c51e9(0x603) === _0x2c51e9(0x603) ? _0x114fa7[_0x2c51e9(0x7ea)] = '▶' : _0x41fd4c['events']['push']({ 'senderId': _0xc453e8['id'], 'kind': _0x2c51e9(0x547), 'sticker': _0x2c3f7d })); }); if (_0x36af61['src'] === _0x4ca578['url'] && !_0x36af61['paused']) { if (_0x23951b(0x1b8) === _0x23951b(0x1b8)) _0x36af61[_0x23951b(0x292)](), _0x13c594[_0x23951b(0x4b0)]('.music-post-play-icon,\x20.music-share-play-icon')[_0x23951b(0x7ea)] = '▶'; else { const _0xa86924 = _0x3a544a(_0x50747a[_0x23951b(0x3e4)] || _0x4d2ebf['activeMeetingCharId']); _0x2a618e = _0xa86924?.[_0x23951b(0x2a5)] || '角色', _0x35422c = _0x23951b(0x1d1); } } else _0x36af61[_0x23951b(0x54e)] = _0x4ca578['url'], _0x36af61[_0x23951b(0x20c)](), _0x13c594[_0x23951b(0x4b0)]('.music-post-play-icon,\x20.music-share-play-icon')[_0x23951b(0x7ea)] = '❚❚'; } const _0x52a1a2 = document[_0x12f887(0x49f)]('music-player-bar'); async function _0x5ea621(_0x48efb5) { const _0x4f13da = _0x12f887; if (!_0x48efb5 || !_0x48efb5[_0x4f13da(0x5b6)](_0x4f13da(0x491))) return ![]; return new Promise(_0x276a67 => { const _0x5b2b65 = _0x4f13da; if (_0x5b2b65(0x3b9) === 'uAguL') { const _0x3afe52 = document[_0x5b2b65(0x1a2)](_0x5b2b65(0x5e1)); _0x3afe52[_0x5b2b65(0x54e)] = _0x48efb5; const _0x1c2df2 = setTimeout(() => { _0x138b36(), _0x276a67(![]); }, 0xbb8), _0x138b36 = () => { const _0x13c511 = _0x5b2b65; _0x13c511(0x6bb) === _0x13c511(0x7e8) ? (_0x58ffba[_0x13c511(0x2f1)][_0x13c511(0x231)](_0x13c511(0x557)), _0x4aab6a[_0x13c511(0x56a)] = null, _0x2f143f[_0x13c511(0x56a)] = null, _0x5ef6d1[_0x13c511(0x56a)] = null, _0xc895bd[_0x13c511(0x7bb)](_0x13c511(0x357), _0xedd2ee), _0x1c2714(_0x1d5ebb)) : (clearTimeout(_0x1c2df2), _0x3afe52[_0x13c511(0x7bb)]('canplaythrough', _0x1c7dbe), _0x3afe52[_0x13c511(0x7bb)](_0x13c511(0x6eb), _0x161de9), _0x3afe52[_0x13c511(0x54e)] = '', _0x3afe52[_0x13c511(0x231)]()); }, _0x1c7dbe = () => { const _0x518632 = _0x5b2b65; _0x518632(0x1f0) !== 'AhGhw' ? _0x30e7a8 && (_0x48a3a9[_0x518632(0x3c9)][_0x518632(0x6b4)] = 'none') : (_0x138b36(), _0x276a67(!![])); }, _0x161de9 = () => { _0x138b36(), _0x276a67(![]); }; _0x3afe52['addEventListener'](_0x5b2b65(0x3f5), _0x1c7dbe), _0x3afe52[_0x5b2b65(0x179)](_0x5b2b65(0x6eb), _0x161de9); } else _0x3b5989[_0x5b2b65(0x2bc)](), _0xc86b68(); }); } async function _0x2ff291(_0xf4001b, _0x327e3a) { const _0x11416d = _0x12f887; if (_0x11416d(0x2a7) !== 'ANFdu') { const _0x13ebdc = ['netease', _0x11416d(0x1b5)]; for (const _0x325039 of _0x13ebdc) { if (_0x11416d(0x7f0) === _0x11416d(0x345)) _0x56ef34 += _0x11416d(0x45a); else try { const _0x26f576 = _0x11416d(0x362) + _0x325039 + '?word=' + encodeURIComponent(_0xf4001b) + '-' + encodeURIComponent(_0x327e3a), _0x3e818a = await fetch(_0x26f576), _0x39c25d = await _0x3e818a[_0x11416d(0x525)](); if (_0x39c25d[_0x11416d(0x219)] !== 0xc8 || !_0x39c25d[_0x11416d(0x656)] || _0x39c25d['data'][_0x11416d(0x45b)] === 0x0) continue; const _0x103890 = _0x39c25d['data'][_0x11416d(0x830)](0x0, 0x5); for (const _0x45e6d8 of _0x103890) { if (_0x11416d(0x39f) !== 'LHAxh') return _0x321ce7(_0x11416d(0x449)), ![]; else { const _0x3b30f0 = _0x11416d(0x362) + _0x325039 + _0x11416d(0x1fa) + _0x45e6d8['id'], _0x7ad5f4 = await fetch(_0x3b30f0), _0x414736 = await _0x7ad5f4[_0x11416d(0x525)](), _0x42103e = _0x414736[_0x11416d(0x656)]?.[_0x11416d(0x5ce)]; if (await _0x5ea621(_0x42103e)) return { 'url': _0x42103e, 'cover': _0x45e6d8[_0x11416d(0x4ad)], 'source': _0x325039 }; } } } catch (_0x5c31ff) { if (_0x11416d(0x49b) === _0x11416d(0x49b)) console[_0x11416d(0x6eb)](_0x11416d(0x881) + _0x325039 + ':', _0x5c31ff); else { _0x1d92ce('正在生成中，请稍候...'); return; } } } return { 'url': null, 'cover': null, 'source': null }; } else { const _0x4da453 = _0x3bb96c[_0x11416d(0x1a2)]('p'); _0x4da453['style'][_0x11416d(0x4fc)] = _0x11416d(0x86f), _0x4da453[_0x11416d(0x7ea)] = _0x488b22, _0x175707['appendChild'](_0x4da453); } } function _0x31bab9(_0x70cff6) { const _0x2d76bd = _0x12f887; try { const _0x3c446e = JSON[_0x2d76bd(0x38e)](localStorage[_0x2d76bd(0x70e)](_0x2d76bd(0x78f)) || '{}'), _0x411856 = { ..._0x3c446e, ..._0x70cff6 }; localStorage[_0x2d76bd(0x1e0)](_0x2d76bd(0x78f), JSON['stringify'](_0x411856)); } catch (_0x3213aa) { console[_0x2d76bd(0x6eb)]('保存徽章状态失败', _0x3213aa); } } async function _0x77807f() { const _0x5d975e = _0x12f887; if (_0x5d975e(0x798) === _0x5d975e(0x401)) _0x1c50d0[_0x5d975e(0x6eb)](_0x5d975e(0x7b3) + _0xa0bb82['activeChatId'], _0x2302a1); else { const _0xcfe37a = document[_0x5d975e(0x49f)](_0x5d975e(0x5ac)), _0x4cfa18 = document[_0x5d975e(0x49f)](_0x5d975e(0x15d)); try { if (_0x5d975e(0x165) === _0x5d975e(0x165)) { let _0x165919 = await _0x33b931('widget_badge'); if (!_0x165919) { if ('NWMmV' !== _0x5d975e(0x5aa)) _0x59279f[_0x5d975e(0x64b)](_0x512cac); else { const _0x559d55 = JSON['parse'](localStorage[_0x5d975e(0x70e)](_0x5d975e(0x78f)) || '{}'); _0x559d55['image'] && (_0x5d975e(0x4eb) === _0x5d975e(0x4eb) ? (console['log'](_0x5d975e(0x32d)), _0x165919 = await _0x3591b3(_0x559d55[_0x5d975e(0x33c)]), await _0x19d8b8(_0x5d975e(0x6d0), _0x165919)) : _0x4fe4f4[_0x5d975e(0x49f)](_0x5d975e(0x31a))[_0x5d975e(0x54e)] = _0x1fc4c5['avatar'] || _0x3509a1); } } if (_0x165919) { if ('pFvif' === _0x5d975e(0x772)) _0x4cfa18[_0x5d975e(0x54e)] = URL[_0x5d975e(0x52d)](_0x165919), _0xcfe37a[_0x5d975e(0x3c9)][_0x5d975e(0x6b4)] = _0x5d975e(0x4b1); else { const _0x269050 = _0x45d3c0[_0x5d975e(0x1a2)](_0x5d975e(0x642)); _0x269050['className'] = _0x5d975e(0x2b6), _0x269050['id'] = _0x5d975e(0x3bf) + _0x3e41c0, _0x1cae40 === _0x379c09[_0x5d975e(0x4e9)] && _0x269050[_0x5d975e(0x2f1)][_0x5d975e(0x737)](_0x5d975e(0x25a)), _0x3cdac8[_0x5d975e(0x242)](_0xccfa52 => { const _0x1c9179 = _0x5d975e, _0x256728 = _0xccfa52[_0x1c9179(0x71c)] === _0x1c9179(0x821) ? _0x1c9179(0x821) : 'ai', _0x2abccd = _0xccfa52[_0x1c9179(0x71c)] === _0x1c9179(0x821) ? _0x5065a1[_0x1c9179(0x2a5)] : _0x11f15b(_0xccfa52['author'])[_0x1c9179(0x2a5)], _0x192de6 = _0x57ca90[_0x1c9179(0x1a2)](_0x1c9179(0x642)); _0x192de6[_0x1c9179(0x399)] = _0x1c9179(0x1f4) + _0x256728, _0x192de6[_0x1c9179(0x55a)][_0x1c9179(0x602)] = _0xccfa52[_0x1c9179(0x602)], _0x192de6[_0x1c9179(0x3c9)][_0x1c9179(0x59d)] = _0x1c9179(0x3d3), _0x192de6[_0x1c9179(0x3c9)][_0x1c9179(0x628)] = '0', _0x192de6[_0x1c9179(0x862)] = _0x1c9179(0x4e0) + _0x2abccd + '</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-timestamp\x22>' + new _0x1ad22b(_0xccfa52[_0x1c9179(0x602)])['toLocaleString'](_0x1c9179(0x49e)) + _0x1c9179(0x7b1) + _0xccfa52['content'][_0x1c9179(0x23b)](/\n/g, _0x1c9179(0x5d2)) + _0x1c9179(0x2a4), _0x269050[_0x1c9179(0x185)](_0x192de6); }), _0x4f1f98[_0x5d975e(0x185)](_0x269050); } } else _0xcfe37a[_0x5d975e(0x3c9)][_0x5d975e(0x6b4)] = 'block'; } else { const { omniText: _0x29d032 } = _0x54c7c5(_0x4b3dc8['id'], null), _0x260faa = _0x5cc14f(_0x20e7a9['id']), _0x18c427 = _0x373d89['linkedWorldBookIds'] && _0xd0415['linkedWorldBookIds']['length'] > 0x0 ? _0x5d975e(0x631) + _0x4aa47a[_0x5d975e(0x2a5)] + '的个人专属世界观设定\x0a' + _0x1405c6[_0x5d975e(0x76f)][_0x5d975e(0x511)](_0x2217f0 => _0x2cb211[_0x5d975e(0x14b)][_0x5d975e(0x349)](_0x1fa251 => _0x1fa251['id'] === _0x2217f0))['filter'](_0x31d943)[_0x5d975e(0x511)](_0x4a1779 => '\x0a##\x20条目:\x20' + _0x4a1779['name'] + '\x0a' + _0x4a1779[_0x5d975e(0x751)])['join']('') : ''; return _0x5d975e(0x3dd) + _0x359d1d['name'] + _0x5d975e(0x84e) + _0x77d5e2['id'] + _0x5d975e(0x157) + _0x3f690a[_0x5d975e(0x839)] + '\x0a\x20\x20近期记忆:\x0a' + _0x29d032 + '\x0a' + _0x260faa + '\x0a' + _0x18c427; } } catch (_0x548330) { console['error'](_0x5d975e(0x45e), _0x548330); } } } function _0x5ec194(_0x4d8070) { const _0xe39759 = _0x12f887; if (_0xe39759(0x29d) === _0xe39759(0x29d)) try { const _0x402b90 = JSON[_0xe39759(0x38e)](localStorage[_0xe39759(0x70e)](_0xe39759(0x278)) || '{}'), _0x1fc58a = { ..._0x402b90, ..._0x4d8070 }; localStorage[_0xe39759(0x1e0)](_0xe39759(0x278), JSON['stringify'](_0x1fc58a)); } catch (_0x22220e) { _0xe39759(0x5f1) === _0xe39759(0x5f1) ? console[_0xe39759(0x6eb)](_0xe39759(0x536), _0x22220e) : (_0x185bc9[_0xe39759(0x1a3)] = _0x49440a[_0xe39759(0x1a3)] || [], _0x4f9685[_0xe39759(0x3b5)] = (_0x490cab[_0xe39759(0x3b5)] || [])[_0xe39759(0x511)]((_0x5ee0aa, _0x11f62f) => ({ ..._0x5ee0aa, 'commentId': 'c_' + _0x3da7c1[_0xe39759(0x602)] + '_' + _0x11f62f })), _0x72617(), _0xb56c87()); } else { const _0x3f0165 = _0x222958[_0xe39759(0x6fe)][_0xe39759(0x747)](_0x4ebe8f => _0x4ebe8f['type'] === _0xe39759(0x5f7) && _0x4ebe8f[_0xe39759(0x419)])[_0xe39759(0x511)](_0x378f4f => ({ ..._0x378f4f, 'source': _0xe39759(0x6d4) })); _0xca7c1[_0xe39759(0x249)](..._0x3f0165); } } async function _0x4b3f74() { const _0x23d86b = _0x12f887, _0xdcab0e = document['getElementById']('card-widget'), _0x26a96e = document['getElementById'](_0x23d86b(0x520)); try { let _0x5ed135 = await _0x33b931(_0x23d86b(0x7c0)); if (!_0x5ed135) { if ('vZNtt' === _0x23d86b(0x3b8)) { const _0x324f50 = new _0x3f0f8b(), _0x59b1bf = _0x54c4a0[_0x23d86b(0x49f)](_0x23d86b(0x28f)), _0x3078b9 = _0x11df30[_0x23d86b(0x49f)](_0x23d86b(0x263)); if (_0x59b1bf && _0x3078b9) { const _0x1fb5e2 = _0x2eb480(_0x324f50['getHours']())[_0x23d86b(0x2a3)](0x2, '0'), _0xe9a604 = _0x29a608(_0x324f50[_0x23d86b(0x7eb)]())[_0x23d86b(0x2a3)](0x2, '0'); _0x59b1bf[_0x23d86b(0x7ea)] = _0x1fb5e2 + ':' + _0xe9a604; const _0x3f0799 = _0x324f50[_0x23d86b(0x3de)]() + 0x1, _0x329b36 = _0x324f50[_0x23d86b(0x2d7)](), _0xaed9bf = [_0x23d86b(0x5cc), '星期一', _0x23d86b(0x72e), _0x23d86b(0x2c9), _0x23d86b(0x6f9), '星期五', '星期六'][_0x324f50[_0x23d86b(0x87b)]()]; _0x3078b9[_0x23d86b(0x7ea)] = _0x3f0799 + '月' + _0x329b36 + '日\x20' + _0xaed9bf; } } else { const _0x2ee3be = JSON['parse'](localStorage[_0x23d86b(0x70e)](_0x23d86b(0x278)) || '{}'); _0x2ee3be[_0x23d86b(0x33c)] && (console['log']('正在搬运旧卡片...'), _0x5ed135 = await _0x3591b3(_0x2ee3be['image']), await _0x19d8b8(_0x23d86b(0x7c0), _0x5ed135)); } } _0x5ed135 ? 'pPczK' !== 'pPczK' ? _0x17747b[_0x23d86b(0x249)]({ 'time': _0x568d59, 'text': _0x4b55e4 }) : (_0x26a96e[_0x23d86b(0x54e)] = URL[_0x23d86b(0x52d)](_0x5ed135), _0xdcab0e[_0x23d86b(0x3c9)][_0x23d86b(0x6b4)] = _0x23d86b(0x4b1)) : _0xdcab0e[_0x23d86b(0x3c9)][_0x23d86b(0x6b4)] = _0x23d86b(0x4b1); } catch (_0x213189) { if (_0x23d86b(0x1da) === _0x23d86b(0x65e)) { const _0x1d0bd9 = _0x31c257[_0x23d86b(0x49f)](_0x23d86b(0x4f0)), _0x47c564 = _0x1d0bd9[_0x23d86b(0x2aa)](_0x23d86b(0x573)), _0x56490f = _0x4f7c6e[_0x23d86b(0x4b0)](_0x23d86b(0x57c)); if (_0x47c564[_0x23d86b(0x45b)] === 0x0) _0x56490f[_0x23d86b(0x7ea)] = _0x23d86b(0x80f); else _0x47c564[_0x23d86b(0x45b)] > 0x2 ? _0x56490f['textContent'] = _0x23d86b(0x389) + _0x47c564['length'] + '\x20项' : _0x56490f[_0x23d86b(0x7ea)] = _0x42885e['from'](_0x47c564)['map'](_0x437a19 => _0x437a19[_0x23d86b(0x779)][_0x23d86b(0x7ea)][_0x23d86b(0x2fe)]())[_0x23d86b(0x4c2)]('、'); } else console[_0x23d86b(0x6eb)](_0x23d86b(0x3ce), _0x213189); } } _0x59af73[_0x12f887(0x179)](_0x12f887(0x3e9), () => { const _0x23c93c = _0x12f887; _0x23c93c(0x724) !== 'wPxJr' ? (_0x4611b7(), _0x381d3b(_0x23c93c(0x1a0), _0x23c93c(0x5d1))) : _0x2b70f2(_0x2df573['id']); }), document[_0x12f887(0x49f)](_0x12f887(0x287))[_0x12f887(0x179)](_0x12f887(0x3e9), () => _0x381d3b(_0x12f887(0x5d1), 'userProfileList')), document[_0x12f887(0x49f)](_0x12f887(0x3fa))[_0x12f887(0x179)](_0x12f887(0x3e9), () => _0x57d90c()), document[_0x12f887(0x49f)](_0x12f887(0x3a4))[_0x12f887(0x179)](_0x12f887(0x3e9), () => { const _0x2d49f1 = _0x12f887; _0x4611b7(), _0x381d3b(_0x2d49f1(0x1a0), _0x2d49f1(0x585)); }), document['getElementById'](_0x12f887(0x42a))[_0x12f887(0x179)]('click', _0x140edb), document[_0x12f887(0x49f)](_0x12f887(0x2b0))[_0x12f887(0x179)](_0x12f887(0x3e9), _0xcacd54), document[_0x12f887(0x49f)](_0x12f887(0x2c6))['addEventListener'](_0x12f887(0x3e9), () => { const _0x433552 = _0x12f887, _0x1659e8 = document[_0x433552(0x49f)]('editing-user-id')[_0x433552(0x5da)]; _0x1659e8 && (_0x2aa90d[_0x433552(0x4f4)] = _0x1659e8, _0x16a7ea(), _0x5d65f5('已设为当前用户！'), _0x4611b7(), document[_0x433552(0x49f)]('set-active-user-button')[_0x433552(0x3c9)][_0x433552(0x6b4)] = 'none'); }); function _0x5cb17e(_0x17c999) { const _0x46c3b8 = _0x12f887, _0xbb9bbd = _0x2aa90d['chats'][_0x46c3b8(0x349)](_0x25646b => _0x25646b['id'] === _0x17c999), _0x4c5b50 = _0xbb9bbd?.[_0x46c3b8(0x412)]; let _0x4dfbf6 = _0x2aa90d[_0x46c3b8(0x47c)][_0x46c3b8(0x349)](_0x1401bc => _0x1401bc['id'] === _0x4c5b50); return !_0x4dfbf6 && (_0x4dfbf6 = _0x2aa90d[_0x46c3b8(0x47c)][_0x46c3b8(0x349)](_0x3edaab => _0x3edaab['id'] === _0x2aa90d[_0x46c3b8(0x4f4)]) || _0x2aa90d[_0x46c3b8(0x47c)][0x0]), _0x4dfbf6 || { 'name': '用户', 'avatar': _0x5e96e0, 'persona': '' }; } function _0x562826(_0xa05382) { const _0x10a513 = _0x12f887, _0xd92ff = document[_0x10a513(0x49f)](_0xa05382); _0xd92ff['innerHTML'] = '', _0x2aa90d[_0x10a513(0x47c)][_0x10a513(0x242)](_0x6ce266 => { const _0x471b90 = _0x10a513; if ('nzfWb' !== 'XBDmK') { const _0x46c248 = document[_0x471b90(0x1a2)](_0x471b90(0x457)); _0x46c248['value'] = _0x6ce266['id'], _0x46c248[_0x471b90(0x7ea)] = _0x6ce266['name'], _0xd92ff['appendChild'](_0x46c248); } else _0x366ee2[_0x471b90(0x167)] = null, _0x2912cb[_0x471b90(0x3c9)][_0x471b90(0x6b4)] = 'none'; }); } function _0xe9f495(_0x5ca519) { const _0x41f6cc = _0x12f887, _0x59ed66 = _0x1c2a48(_0x5ca519), _0xf6aca5 = document['getElementById']('chat-view-pane'); _0xf6aca5[_0x41f6cc(0x3c9)][_0x41f6cc(0x482)] = ''; let _0x2a97d8 = document['getElementById']('style-' + _0x5ca519); if (_0x2a97d8) _0x2a97d8[_0x41f6cc(0x862)] = ''; if (!_0x59ed66) return; _0x59ed66[_0x41f6cc(0x551)] && (_0x41f6cc(0x5be) === _0x41f6cc(0x836) ? _0x19a7fb[_0x41f6cc(0x654)][_0x41f6cc(0x4a8)](_0x41f6cc(0x40f)) : (_0xf6aca5[_0x41f6cc(0x3c9)][_0x41f6cc(0x482)] = _0x41f6cc(0x7bc) + _0x59ed66['chatWallpaper'] + '\x27)', _0xf6aca5[_0x41f6cc(0x3c9)][_0x41f6cc(0x639)] = 'cover', _0xf6aca5[_0x41f6cc(0x3c9)][_0x41f6cc(0x286)] = _0x41f6cc(0x437))); if (_0x59ed66[_0x41f6cc(0x323)]) { let _0xb4b950 = document[_0x41f6cc(0x49f)]('style-' + _0x59ed66['id']); !_0xb4b950 && (_0xb4b950 = document[_0x41f6cc(0x1a2)](_0x41f6cc(0x3c9)), _0xb4b950['id'] = _0x41f6cc(0x741) + _0x59ed66['id'], document['head']['appendChild'](_0xb4b950)); const _0x568f77 = _0x59ed66[_0x41f6cc(0x323)], _0x4d6100 = _0x568f77['replace'](/\.bubble\.sent/g, _0x41f6cc(0x6c9) + _0x59ed66['id'] + _0x41f6cc(0x7b0))[_0x41f6cc(0x23b)](/\.bubble\.received/g, _0x41f6cc(0x6c9) + _0x59ed66['id'] + _0x41f6cc(0x403)); _0xb4b950['innerHTML'] = _0x4d6100; } } function _0x4d7ef9() { const _0x310447 = _0x12f887; if (_0x310447(0x641) === _0x310447(0x7f9)) _0x1c474b(_0x310447(0x5d1), _0x310447(0x29f)); else { const _0x25825c = document['getElementById'](_0x310447(0x4e8)); _0x25825c[_0x310447(0x862)] = ''; const _0x2e79cc = _0x1e38ac => { const _0x1c40fe = _0x310447; if (_0x1c40fe(0x1a5) !== _0x1c40fe(0x524)) _0x2aa90d['pendingPostAttachments'][_0x1e38ac] = null, _0x4d7ef9(); else { const _0x4a7372 = _0x549a88['linkedWorldBookIds'][_0x1c40fe(0x511)](_0x48c9fe => _0x416e78['worldBooks']['find'](_0x42ff64 => _0x42ff64['id'] === _0x48c9fe))[_0x1c40fe(0x747)](_0x162979)['map'](_0x477115 => _0x1c40fe(0x1af) + _0x477115[_0x1c40fe(0x2a5)] + '\x0a' + _0x477115[_0x1c40fe(0x751)])[_0x1c40fe(0x4c2)](''); if (_0x4a7372) _0x236c94 = _0x1c40fe(0x303) + _0x4a7372; } }; if (_0x2aa90d[_0x310447(0x44b)][_0x310447(0x33c)]) { const _0xad2f07 = document[_0x310447(0x1a2)](_0x310447(0x642)); _0xad2f07[_0x310447(0x399)] = _0x310447(0x565), _0xad2f07[_0x310447(0x862)] = '\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22' + _0x2aa90d[_0x310447(0x44b)][_0x310447(0x33c)] + '\x22\x20alt=\x22Image\x20Preview\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22remove-attachment-btn\x22>&times;</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20', _0xad2f07[_0x310447(0x4b0)]('.remove-attachment-btn')['onclick'] = () => _0x2e79cc(_0x310447(0x33c)), _0x25825c[_0x310447(0x185)](_0xad2f07); } if (_0x2aa90d[_0x310447(0x44b)]['music']) { const _0x2f37d8 = _0x2aa90d[_0x310447(0x44b)][_0x310447(0x5f7)], _0x470e0e = document[_0x310447(0x1a2)](_0x310447(0x642)); _0x470e0e[_0x310447(0x399)] = _0x310447(0x565), _0x470e0e[_0x310447(0x862)] = '\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22music-preview-card\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22' + (_0x2f37d8['coverUrl'] || _0x12a7cc) + _0x310447(0x71f) + _0x2f37d8[_0x310447(0x879)] + _0x310447(0x182) + _0x2f37d8[_0x310447(0x347)] + _0x310447(0x379), _0x470e0e[_0x310447(0x4b0)](_0x310447(0x252))[_0x310447(0x56a)] = () => _0x2e79cc(_0x310447(0x5f7)), _0x25825c[_0x310447(0x185)](_0x470e0e); } } } async function _0x51612b(_0x167b85) { const _0x2b3c01 = _0x12f887; if (_0x2b3c01(0x78c) !== _0x2b3c01(0x78c)) _0x53e0db[_0x2b3c01(0x6fe)] = [], _0x327d84(), _0x3f259b(), _0x47c91c(_0x2b3c01(0x1ca)); else { const _0xc9e273 = _0x2aa90d[_0x2b3c01(0x2d4)]['find'](_0x22fe0d => _0x22fe0d['id'] === _0x2aa90d[_0x2b3c01(0x806)]); if (!_0xc9e273) return; _0x9d4a2d(!![], _0x2b3c01(0x305)), _0x2aa90d['isGenerating'] = !![]; try { const _0x2b42b4 = _0xc9e273[_0x2b3c01(0x40b)]['map'](_0x1f025e => _0x1c2a48(_0x1f025e))[_0x2b3c01(0x747)](Boolean), _0x1acc62 = _0x1f3bb7(), _0x5b0120 = _0x2b42b4['map'](_0x2f764d => { const _0x468269 = _0x2b3c01, { omniText: _0xcc6139 } = _0x395060(_0x2f764d['id'], _0xc9e273['id']), _0xe2167b = _0x515fd9(_0x2f764d['id']), _0xda0565 = _0x2f764d['linkedWorldBookIds'] && _0x2f764d[_0x468269(0x76f)][_0x468269(0x45b)] > 0x0 ? '\x0a\x0a#\x20' + _0x2f764d['name'] + _0x468269(0x465) + _0x2f764d[_0x468269(0x76f)][_0x468269(0x511)](_0x4ea0b6 => _0x2aa90d[_0x468269(0x14b)][_0x468269(0x349)](_0x3283f9 => _0x3283f9['id'] === _0x4ea0b6))[_0x468269(0x747)](Boolean)[_0x468269(0x511)](_0x1c5130 => _0x468269(0x65b) + _0x1c5130[_0x468269(0x2a5)] + '\x0a' + _0x1c5130[_0x468269(0x751)])['join']('') : ''; return _0x468269(0x3dd) + _0x2f764d['name'] + _0x468269(0x84e) + _0x2f764d['id'] + _0x468269(0x157) + _0x2f764d[_0x468269(0x839)] + '\x0a\x20\x20相关记忆:\x0a' + _0xcc6139 + '\x0a' + _0xe2167b + '\x0a' + _0xda0565; })[_0x2b3c01(0x4c2)]('\x0a\x0a'), _0x5d39ef = _0x1b0721(_0x167b85[_0x2b3c01(0x883)]) || { 'name': '用户' }, _0x26275e = _0x5d39ef[_0x2b3c01(0x839)] ? _0x2b3c01(0x723) + _0x5d39ef[_0x2b3c01(0x2a5)] + _0x2b3c01(0x6d9) + _0x5d39ef['persona'] + '\x0a' : ''; let _0x5a6646 = _0x5d39ef[_0x2b3c01(0x2a5)] + '刚刚发布了一条动态，内容是：“' + _0x167b85['content'] + '”'; if (_0x167b85[_0x2b3c01(0x33c)]) _0x5a6646 += '\x20[并附上了一张图片]'; if (_0x167b85['type'] === _0x2b3c01(0x5f7)) _0x5a6646 += '\x20[并分享了歌曲:\x20' + _0x167b85['songName'] + '\x20-\x20' + _0x167b85[_0x2b3c01(0x347)] + ']'; const _0x5dc362 = _0x2b3c01(0x2ac) + _0x5b0120 + '\x0a' + _0x26275e + '\x0a#\x20最近的动态回顾\x20(供参考)\x0a' + _0x1acc62 + _0x2b3c01(0x657) + _0x5a6646 + '\x0a\x0a#\x20任务要求\x0a1.\x20\x20**全局视角**:\x20扮演所有成员，思考他们看到这条动态（包括图片）后会作何反应。\x0a2.\x20\x20**生成互动**:\x20为每个角色决定是否点赞，以及要发表什么评论。评论必须符合角色性格并与所有已知信息（聊天、日记等）相关联。\x0a3.\x20\x20**输出格式**:\x20你的输出必须是一个单一、完整的JSON对象，结构如下:\x0a\x20\x20\x20\x20```json\x0a\x20\x20\x20\x20{\x0a\x20\x20\x20\x20\x20\x20\x22likes\x22:\x20[\x22点赞者1的ID\x22,\x20\x22点赞者2的ID\x22],\x0a\x20\x20\x20\x20\x20\x20\x22comments\x22:\x20[\x0a\x20\x20\x20\x20\x20\x20\x20\x20{\x20\x22authorId\x22:\x20\x22评论者A的ID\x22,\x20\x22content\x22:\x20\x22评论内容\x22\x20},\x0a\x20\x20\x20\x20\x20\x20\x20\x20{\x20\x22authorId\x22:\x20\x22评论者B的ID\x22,\x20\x22content\x22:\x20\x22另一条评论\x22\x20}\x0a\x20\x20\x20\x20\x20\x20]\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20```\x0a-\x20【绝对规则】:\x20所有ID必须使用上面提供的角色ID，不能用名字。\x0a-\x20绝对不要输出任何JSON之外的文字、解释或Markdown标记。\x0a', _0x4b60c5 = [{ 'role': _0x2b3c01(0x1db), 'content': _0x5dc362 }], _0x10502d = { 'role': _0x2b3c01(0x821), 'content': _0x2b3c01(0x41c) }; _0x167b85[_0x2b3c01(0x33c)] && (_0x2b3c01(0x33a) === _0x2b3c01(0x33a) ? _0x10502d[_0x2b3c01(0x33c)] = _0x167b85[_0x2b3c01(0x33c)] : (_0xf9555b['error']('群聊音乐搜索失败\x20(' + _0x1eea4e + _0x2b3c01(0x820) + _0x336dc0 + '):', _0x18d8ff), _0x3cb2e5['coverUrl'] = null, _0x115a58[_0x2b3c01(0x419)] = null)); _0x4b60c5[_0x2b3c01(0x249)](_0x10502d); const _0x17a53a = await _0x3c8f91(_0x4b60c5, { 'json': !![] }), _0x49d93e = _0x17a53a[_0x2b3c01(0x85a)](/({[\s\S]*})/); if (!_0x49d93e) throw new Error('AI未能返回有效的JSON对象。'); const _0x4c4276 = JSON[_0x2b3c01(0x38e)](_0x49d93e[0x1]), _0x5082dd = _0xc9e273[_0x2b3c01(0x6fe)]['find'](_0x10fe0e => _0x10fe0e['id'] === _0x167b85['id']); _0x5082dd && (_0x5082dd['likes'] = _0x4c4276['likes'] || [], _0x5082dd[_0x2b3c01(0x3b5)] = (_0x4c4276['comments'] || [])[_0x2b3c01(0x511)]((_0x3d8c8c, _0x406851) => ({ ..._0x3d8c8c, 'commentId': 'c_' + _0x167b85[_0x2b3c01(0x602)] + '_' + _0x406851 })), _0x16a7ea(), _0xe530ab()); } catch (_0x1ecbd9) { _0x2b3c01(0x202) === _0x2b3c01(0x202) ? (console[_0x2b3c01(0x6eb)](_0x2b3c01(0x1e4), _0x1ecbd9), _0x5d65f5('大家好像不知道该怎么回复...')) : _0x47d852[_0x2b3c01(0x54e)] = _0x177317['image']; } finally { _0x9d4a2d(![]), _0x2aa90d[_0x2b3c01(0x784)] = ![]; } } } function _0x38e5c6() { const _0x73fc48 = _0x12f887; if ('gXPfD' !== _0x73fc48(0x1fe)) { const _0x29fdad = _0x2aa90d['friendCircles'][_0x73fc48(0x349)](_0x4c354e => _0x4c354e['id'] === _0x2aa90d[_0x73fc48(0x806)]), _0x58c988 = _0x29fdad?.[_0x73fc48(0x412)]; let _0x3018b5 = _0x2aa90d[_0x73fc48(0x47c)][_0x73fc48(0x349)](_0x5a3859 => _0x5a3859['id'] === _0x58c988); !_0x3018b5 && (_0x3018b5 = _0x2aa90d[_0x73fc48(0x47c)][_0x73fc48(0x349)](_0x5ed107 => _0x5ed107['id'] === _0x2aa90d[_0x73fc48(0x4f4)])), !_0x3018b5 && (_0x3018b5 = _0x2aa90d[_0x73fc48(0x47c)][0x0]), _0x3018b5 && (document['getElementById'](_0x73fc48(0x31a))['src'] = _0x3018b5[_0x73fc48(0x5c4)] || _0x5e96e0); } else _0x1e9df9[_0x73fc48(0x862)] = _0x73fc48(0x522) + _0x5b5a66 + _0x73fc48(0x61b) + (_0x3e24cb === _0x73fc48(0x7e9) ? _0x73fc48(0x2d6) : _0x73fc48(0x6f6)) + _0x73fc48(0x1a1) + _0x83e77f + ':</span>\x20' + _0x4b19b4; } function _0x3e097f(_0x526880) { const _0x25b592 = _0x12f887; if ('zOell' !== _0x25b592(0x270)) _0x4a0d43[_0x25b592(0x185)](_0x560fd7), _0x35ce9e['appendChild'](_0x20522a); else { let _0x115c4f = 0x0, _0x56c3b5 = 0x0, _0xa376ff = 0x0; if (_0x526880[_0x25b592(0x45b)] == 0x4) _0x115c4f = '0x' + _0x526880[0x1] + _0x526880[0x1], _0x56c3b5 = '0x' + _0x526880[0x2] + _0x526880[0x2], _0xa376ff = '0x' + _0x526880[0x3] + _0x526880[0x3]; else _0x526880[_0x25b592(0x45b)] == 0x7 && (_0x115c4f = '0x' + _0x526880[0x1] + _0x526880[0x2], _0x56c3b5 = '0x' + _0x526880[0x3] + _0x526880[0x4], _0xa376ff = '0x' + _0x526880[0x5] + _0x526880[0x6]); _0x115c4f /= 0xff, _0x56c3b5 /= 0xff, _0xa376ff /= 0xff; let _0x44a987 = Math[_0x25b592(0x42d)](_0x115c4f, _0x56c3b5, _0xa376ff), _0x3c018c = Math[_0x25b592(0x30b)](_0x115c4f, _0x56c3b5, _0xa376ff), _0x3bf2e2 = _0x3c018c - _0x44a987, _0x3fb9ca = 0x0, _0x5616b2 = 0x0, _0x356513 = 0x0; if (_0x3bf2e2 == 0x0) _0x3fb9ca = 0x0; else { if (_0x3c018c == _0x115c4f) _0x3fb9ca = (_0x56c3b5 - _0xa376ff) / _0x3bf2e2 % 0x6; else { if (_0x3c018c == _0x56c3b5) _0x3fb9ca = (_0xa376ff - _0x115c4f) / _0x3bf2e2 + 0x2; else _0x3fb9ca = (_0x115c4f - _0x56c3b5) / _0x3bf2e2 + 0x4; } } _0x3fb9ca = Math[_0x25b592(0x6a1)](_0x3fb9ca * 0x3c); if (_0x3fb9ca < 0x0) _0x3fb9ca += 0x168; return _0x356513 = (_0x3c018c + _0x44a987) / 0x2, _0x5616b2 = _0x3bf2e2 == 0x0 ? 0x0 : _0x3bf2e2 / (0x1 - Math['abs'](0x2 * _0x356513 - 0x1)), _0x5616b2 = +(_0x5616b2 * 0x64)[_0x25b592(0x38d)](0x1), _0x356513 = +(_0x356513 * 0x64)[_0x25b592(0x38d)](0x1), { 'h': _0x3fb9ca, 's': _0x5616b2, 'l': _0x356513 }; } } function _0x184d14() { const _0x920692 = _0x12f887; if (_0x920692(0x813) === _0x920692(0x311)) _0x375cc2 ? _0x35519a(_0x101385) : _0x505e57(new _0x1119f6(_0x920692(0x815))); else { const _0xeebc8a = (_0x4dda29, _0x55fd84, _0x2297e7) => { const _0x256741 = _0x920692, _0x313dad = document[_0x256741(0x49f)](_0x4dda29); if (!_0x313dad) return; let _0x4b305b = null; try { _0x4b305b = JSON[_0x256741(0x38e)](localStorage[_0x256741(0x70e)](_0x55fd84) || '{}'); } catch { _0x4b305b = {}; } _0x313dad[_0x256741(0x3c9)]['position'] = _0x256741(0x459), _0x313dad[_0x256741(0x3c9)][_0x256741(0x5b0)] = '', _0x313dad[_0x256741(0x3c9)][_0x256741(0x1fb)] = '', _0x313dad[_0x256741(0x3c9)][_0x256741(0x3bd)] = '', _0x313dad[_0x256741(0x3c9)][_0x256741(0x832)] = '', _0x313dad['style']['transform'] = ''; if (typeof _0x4b305b['top'] === _0x256741(0x4c6) && typeof _0x4b305b[_0x256741(0x1fb)] === _0x256741(0x4c6)) { if (_0x256741(0x647) === _0x256741(0x647)) _0x313dad[_0x256741(0x3c9)]['top'] = _0x4b305b[_0x256741(0x5b0)] + '%', _0x313dad[_0x256741(0x3c9)][_0x256741(0x1fb)] = _0x4b305b[_0x256741(0x1fb)] + '%'; else { const _0x338c1c = _0x144bd0(_0x50af03[_0x256741(0x55a)]['historyIndex'], 0xa); !_0x583bb8(_0x338c1c) && _0x49c78f(_0x338c1c); } } else for (const _0x2c1de8 in _0x2297e7) { if (_0x256741(0x16b) !== _0x256741(0x16b)) { const _0x5b4b41 = _0x589ec9, _0x1ed530 = _0x5b4b41[_0x256741(0x148)], _0x44e3c0 = _0x5b4b41[_0x256741(0x5ae)]; _0x3badc3['displayedMessageCount'] += 0x64, _0x2748dc(), _0x37c514(() => { const _0x25e55a = _0x256741, _0x335e45 = _0x5b4b41[_0x25e55a(0x148)]; _0x5b4b41[_0x25e55a(0x5ae)] = _0x44e3c0 + (_0x335e45 - _0x1ed530); }); } else _0x313dad[_0x256741(0x3c9)][_0x2c1de8] = _0x2297e7[_0x2c1de8]; } }; _0xeebc8a(_0x920692(0x66a), _0x920692(0x320), { 'top': '5%', 'left': _0x920692(0x454), 'transform': 'translateX(-50%)' }), _0xeebc8a(_0x920692(0x75a), _0x920692(0x2f4), { 'top': _0x920692(0x4a5), 'right': '4%' }), _0xeebc8a(_0x920692(0x189), _0x920692(0x548), { 'top': _0x920692(0x4a5), 'right': _0x920692(0x56f) }), _0xeebc8a(_0x920692(0x21b), 'appIconPosition_app-settings', { 'top': '25%', 'right': '25%' }), _0xeebc8a(_0x920692(0x6a8), _0x920692(0x774), { 'top': _0x920692(0x56f), 'right': '4%' }), _0xeebc8a(_0x920692(0x5af), _0x920692(0x2bf), { 'top': '70%', 'left': _0x920692(0x79b) }), _0xeebc8a(_0x920692(0x344), _0x920692(0x327), { 'top': '70%', 'left': _0x920692(0x2db) }), _0xeebc8a('decorative-badge', _0x920692(0x78f), { 'top': _0x920692(0x2f5), 'left': _0x920692(0x521) }), _0xeebc8a(_0x920692(0x16d), _0x920692(0x83b), { 'top': _0x920692(0x5d9), 'left': '6%' }), _0xeebc8a('music-widget', 'musicWidgetPosition', { 'top': '25%', 'left': '5%' }); } } function _0x545c2c() { const _0x235b1b = _0x12f887, _0x1e4e06 = document[_0x235b1b(0x49f)]('custom-icon-list-container'); _0x1e4e06[_0x235b1b(0x862)] = ''; const _0x2b347d = document[_0x235b1b(0x2aa)](_0x235b1b(0x5ba)); _0x2b347d[_0x235b1b(0x242)](_0x36f790 => { const _0x8eb59d = _0x235b1b; if (_0x8eb59d(0x4af) !== _0x8eb59d(0x4af)) { _0x56090d(_0x8eb59d(0x7ee)); return; } else { const _0x38ac92 = _0x36f790['id'], _0x214594 = _0x36f790[_0x8eb59d(0x4b0)](_0x8eb59d(0x38c))[_0x8eb59d(0x7ea)], _0x156780 = _0x8eb59d(0x80a) + _0x38ac92, _0x304423 = localStorage[_0x8eb59d(0x70e)](_0x156780), _0x44fb65 = document[_0x8eb59d(0x1a2)](_0x8eb59d(0x642)); _0x44fb65[_0x8eb59d(0x399)] = _0x8eb59d(0x1d2), _0x44fb65[_0x8eb59d(0x3c9)][_0x8eb59d(0x453)] = _0x8eb59d(0x3eb), _0x44fb65[_0x8eb59d(0x862)] = _0x8eb59d(0x7ed) + _0x38ac92 + '\x22\x20src=\x22' + (_0x304423 || _0x8eb59d(0x38f)) + _0x8eb59d(0x4c8) + _0x214594 + '</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22file\x22\x20id=\x22input_' + _0x38ac92 + _0x8eb59d(0x1ac) + _0x38ac92 + _0x8eb59d(0x15f) + _0x156780 + _0x8eb59d(0x519), _0x1e4e06[_0x8eb59d(0x185)](_0x44fb65); const _0x16087e = document[_0x8eb59d(0x49f)](_0x8eb59d(0x369) + _0x38ac92); _0x16087e[_0x8eb59d(0x179)](_0x8eb59d(0x220), async _0x25fd94 => { const _0xabb24 = _0x8eb59d; if (_0xabb24(0x1cc) === _0xabb24(0x1e8)) { _0x388619[_0xabb24(0x862)] = _0xabb24(0x316); return; } else { const _0x51be7c = _0x25fd94[_0xabb24(0x232)][_0xabb24(0x7a2)][0x0]; if (!_0x51be7c) return; try { if (_0xabb24(0x67d) === _0xabb24(0x3d8)) { const _0x4b57e9 = _0x55f484[_0xabb24(0x49f)](_0xabb24(0x2fc))['value']; _0x4b57e9 && (_0x38bb44['activeUserProfileId'] = _0x4b57e9, _0x86b78b(), _0x47607f(_0xabb24(0x2e9)), _0x1d2d13(), _0x5269b6[_0xabb24(0x49f)](_0xabb24(0x2c6))[_0xabb24(0x3c9)][_0xabb24(0x6b4)] = 'none'); } else { const _0x4941d3 = await _0x2a3cd4(_0x51be7c); localStorage[_0xabb24(0x1e0)](_0x156780, _0x4941d3), document[_0xabb24(0x49f)](_0xabb24(0x70b) + _0x38ac92)['src'] = _0x4941d3, _0x5aa02b(); } } catch (_0x8aa8a7) { 'CAuHx' !== _0xabb24(0x80c) ? (_0xa69b09[_0xabb24(0x4ce)][_0xabb24(0x6d3)](_0x51d6c2, 0x1), _0xc363ba(), _0x337776(), _0x2743e7(_0xabb24(0x593))) : _0x5d65f5('图标处理失败:\x20' + _0x8aa8a7[_0xabb24(0x4c4)]); } } }); } }); } function _0x5aa02b() { const _0x535bf2 = _0x12f887, _0x2b3e06 = document[_0x535bf2(0x2aa)]('.app-icon'); _0x2b3e06[_0x535bf2(0x242)](_0x3782c7 => { const _0x533661 = _0x535bf2, _0x428efe = _0x3782c7['id'], _0x3f38db = _0x533661(0x80a) + _0x428efe, _0x36de05 = localStorage['getItem'](_0x3f38db), _0x4cbc46 = _0x3782c7[_0x533661(0x4b0)](_0x533661(0x328)); if (_0x36de05) _0x4cbc46['innerHTML'] = '<img\x20src=\x22' + _0x36de05 + _0x533661(0x1fd); else { const _0x555439 = document[_0x533661(0x4b0)](_0x533661(0x6a7) + _0x428efe + _0x533661(0x407) + _0x428efe + '\x20.app-icon-img')?.['innerHTML']; _0x555439 && (_0x4cbc46['innerHTML'] = _0x555439); } }); } function _0x44522f() { const _0x384256 = _0x12f887; if (_0x384256(0x34a) !== _0x384256(0x34a)) _0x473e99['revokeObjectURL'](_0x1d9793); else { const _0x217b77 = _0x2aa90d[_0x384256(0x2d4)]['find'](_0x436a90 => _0x436a90['id'] === _0x2aa90d[_0x384256(0x806)]), _0x139ed8 = _0x4adf1c(); let _0x3c87b6 = []; if (_0x217b77 && _0x217b77[_0x384256(0x6fe)]) { const _0x5c3835 = _0x217b77[_0x384256(0x6fe)][_0x384256(0x747)](_0xdc8a45 => _0xdc8a45[_0x384256(0x5b4)] === _0x384256(0x5f7) && _0xdc8a45[_0x384256(0x419)])[_0x384256(0x511)](_0x3fb4ff => ({ ..._0x3fb4ff, 'source': _0x384256(0x6d4) })); _0x3c87b6['push'](..._0x5c3835); } if (_0x139ed8 && _0x2aa90d['conversationHistory']) { const _0x207349 = _0x2aa90d[_0x384256(0x7f2)][_0x384256(0x747)](_0x36e63c => _0x36e63c[_0x384256(0x5b4)] === _0x384256(0x5f7) && _0x36e63c[_0x384256(0x419)])[_0x384256(0x511)](_0x4c924b => ({ ..._0x4c924b, 'source': _0x384256(0x80d) })); _0x3c87b6[_0x384256(0x249)](..._0x207349); } const _0x34efa4 = Array[_0x384256(0x6d7)](new Map(_0x3c87b6[_0x384256(0x511)](_0x183595 => [_0x183595[_0x384256(0x419)], _0x183595]))['values']()); _0x2aa90d[_0x384256(0x554)] = _0x34efa4[_0x384256(0x1e7)]((_0x225bd6, _0x3dfd04) => _0x3dfd04['timestamp'] - _0x225bd6['timestamp']); } } function _0x2429c6(_0x302f2f) { const _0x326cf8 = _0x12f887; if (_0x326cf8(0x590) === _0x326cf8(0x871)) { if (!_0x12a27b['activeQuote']) return; _0x15870b['textContent'] = _0x326cf8(0x1e5) + _0x2ad35e[_0x326cf8(0x167)][_0x326cf8(0x658)], _0x13dd9e[_0x326cf8(0x7ea)] = _0x4b1b31[_0x326cf8(0x167)][_0x326cf8(0x751)], _0x6185f0[_0x326cf8(0x3c9)][_0x326cf8(0x6b4)] = _0x326cf8(0x4b1); } else { if (_0x302f2f < 0x0 || _0x302f2f >= _0x446cb5[_0x326cf8(0x45b)]) return; _0x15a98c = _0x302f2f; const _0x420033 = _0x446cb5[_0x302f2f]; _0x40a89f['src'] = _0x420033['playableUrl'] || _0x420033[_0x326cf8(0x5ce)], _0x40a89f[_0x326cf8(0x20c)](), _0x3f030b(), _0x38f747(); } } function _0x3f030b() { const _0x48cfee = _0x12f887; if ('HRxTG' === _0x48cfee(0x556)) { const _0x185a83 = _0x446cb5[_0x15a98c]; _0x54d8ed(_0x185a83); } else { _0x357f34(![]), _0x244ce5('错误：找不到签署契约的地方。'); return; } } function _0x38f747() { const _0x16ee0f = _0x12f887; try { if (_0x16ee0f(0x807) !== _0x16ee0f(0x807)) { _0x5b0820(); const _0xbf1cfa = (_0x4975af['apiSettings']['endpoint'] || '')[_0x16ee0f(0x761)](_0x58c351); _0x1cdbec[_0x16ee0f(0x849)] = _0xbf1cfa, _0x41199e(_0x16ee0f(0x5ad), _0x16ee0f(0x5d1)); } else localStorage[_0x16ee0f(0x1e0)](_0x16ee0f(0x1ee), JSON[_0x16ee0f(0x46d)]({ 'playlist': _0x2aa90d[_0x16ee0f(0x554)], 'currentIndex': _0x2aa90d[_0x16ee0f(0x28d)] })); } catch (_0x46dd93) { console[_0x16ee0f(0x6eb)](_0x16ee0f(0x1c9), _0x46dd93); } } function _0x4fe083() { const _0x4c5488 = _0x12f887; if ('MsZUB' !== 'nnRsE') try { const _0x5e475c = localStorage['getItem'](_0x4c5488(0x1ee)); if (_0x5e475c) { if ('dbSdx' !== _0x4c5488(0x838)) { const _0x41f49b = _0x4c9f78['linkedWorldBookIds'][_0x4c5488(0x511)](_0x1c2e7c => _0x40eb44[_0x4c5488(0x14b)]['find'](_0x4abb65 => _0x4abb65['id'] === _0x1c2e7c))[_0x4c5488(0x747)](_0x3c26b1)[_0x4c5488(0x511)](_0x22686c => '\x0a\x0a##\x20世界书条目:\x20' + _0x22686c[_0x4c5488(0x2a5)] + '\x0a' + _0x22686c[_0x4c5488(0x751)])[_0x4c5488(0x4c2)](''); if (_0x41f49b) _0xbce99 = _0x4c5488(0x303) + _0x41f49b; } else { const { playlist: _0x1e5ab7, currentIndex: _0x5e1a16 } = JSON[_0x4c5488(0x38e)](_0x5e475c); Array[_0x4c5488(0x4d3)](_0x1e5ab7) && _0x1e5ab7[_0x4c5488(0x45b)] > 0x0 && _0x5e1a16 > -0x1 && (_0x2aa90d[_0x4c5488(0x554)] = _0x1e5ab7, _0x2aa90d[_0x4c5488(0x28d)] = _0x5e1a16, _0x2aa90d[_0x4c5488(0x55e)] = ![], _0x3f030b()); } } } catch (_0x12a1cf) { console[_0x4c5488(0x6eb)](_0x4c5488(0x3c7), _0x12a1cf); } else { _0x25941b['id'] === _0x2af74b[_0x4c5488(0x544)] && (_0x1b9e98(), _0x57debb[_0x4c5488(0x7f2)] = [], _0x49ffae()); try { _0x37d439['removeItem']('chatHistory_' + _0x33adc8['id']), _0x52b560('群聊\x22' + _0x4798c9['name'] + _0x4c5488(0x4ab)); } catch (_0x559f1a) { _0x2ba78b[_0x4c5488(0x6eb)](_0x4c5488(0x697) + _0x2f68a9['id'], _0x559f1a), _0xb2f859(_0x4c5488(0x15b)); } } } function _0x224645(_0x329846) { const _0x2c405f = _0x12f887; if (_0x2c405f(0x72b) === _0x2c405f(0x72b)) { if (window[_0x2c405f(0x73f)]) clearTimeout(window[_0x2c405f(0x73f)]); const _0xafff31 = _0x329846['target']['closest'](_0x2c405f(0x646)); if (!_0xafff31) return; const _0x4dd6a8 = _0xafff31[_0x2c405f(0x55a)][_0x2c405f(0x602)], _0x25ee8a = _0xafff31[_0x2c405f(0x2f1)][_0x2c405f(0x6a9)]('user') ? 'user' : 'ai'; if (!_0x4dd6a8) return; const _0x283587 = () => { const _0x1f3498 = _0x2c405f; window[_0x1f3498(0x73f)] = setTimeout(() => { const _0x1b595c = _0x1f3498; if ('uSqeQ' === 'uSqeQ') { if (_0x329846[_0x1b595c(0x5b4)] === _0x1b595c(0x204)) _0x329846[_0x1b595c(0x2bc)](); _0x4db3f3(parseInt(_0x4dd6a8, 0xa), _0x25ee8a); } else _0x349a95[_0x1b595c(0x50e)](_0x114f50, { 'keyPath': 'id' }); }, 0x320); }, _0x2ae1a7 = () => { const _0x3efb40 = _0x2c405f; if ('TreSQ' !== 'ulHtw') { if (window[_0x3efb40(0x73f)]) clearTimeout(window[_0x3efb40(0x73f)]); } else _0x19159e['preventDefault'](), _0x2b0510(); }; document[_0x2c405f(0x179)](_0x2c405f(0x550), _0x2ae1a7, { 'once': !![] }), document[_0x2c405f(0x179)](_0x2c405f(0x3c0), _0x2ae1a7, { 'once': !![] }), document[_0x2c405f(0x179)](_0x2c405f(0x84f), _0x2ae1a7, { 'once': !![] }), _0x283587(); } else { const _0x542d69 = _0x40a7b1[_0x2c405f(0x4b0)](_0x2c405f(0x44d)); if (_0x542d69) _0x542d69['remove'](); } } function _0x4db3f3(_0x3f4c9b, _0x1b606f) { const _0x15f87d = _0x12f887, _0x3bd778 = _0x15f87d(0x678) + _0x3f4c9b; let _0x458fb3 = document[_0x15f87d(0x49f)](_0x3bd778); if (_0x458fb3) return; const _0x301f23 = _0x15f87d(0x515) + _0x3bd778 + '\x22\x20class=\x22choice-modal\x20show\x22>\x0a\x20\x20\x20\x20\x20\x20<div\x20class=\x22choice-modal-backdrop\x22></div>\x0a\x20\x20\x20\x20\x20\x20<div\x20class=\x22choice-modal-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22diary-action-delete\x22\x20class=\x22choice-modal-button\x22\x20style=\x22color:\x20#dc3545;\x22>删除这篇日记</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20' + (_0x1b606f === 'ai' ? _0x15f87d(0x410) : '') + _0x15f87d(0x3af); document[_0x15f87d(0x546)][_0x15f87d(0x88a)](_0x15f87d(0x307), _0x301f23); const _0x4f5dba = document[_0x15f87d(0x49f)](_0x3bd778), _0x19fdbe = () => _0x4f5dba[_0x15f87d(0x231)](); _0x4f5dba[_0x15f87d(0x4b0)](_0x15f87d(0x6a6))[_0x15f87d(0x56a)] = _0x19fdbe, _0x4f5dba['querySelector'](_0x15f87d(0x676))['onclick'] = _0x19fdbe, _0x4f5dba['querySelector']('#diary-action-delete')[_0x15f87d(0x56a)] = () => { _0xf88c44(_0x3f4c9b), _0x19fdbe(); }, _0x1b606f === 'ai' && (_0x15f87d(0x68d) !== _0x15f87d(0x68d) ? _0x158342[_0x15f87d(0x2f1)][_0x15f87d(0x737)](_0x15f87d(0x18e)) : _0x4f5dba[_0x15f87d(0x4b0)](_0x15f87d(0x180))['onclick'] = () => { const _0x385f07 = _0x15f87d; if (_0x385f07(0x464) !== _0x385f07(0x6bf)) _0x5c92c(_0x3f4c9b), _0x19fdbe(); else { _0x414a0b = _0x2ff01a['chats'][_0x385f07(0x349)](_0x4ba5f4 => _0x4ba5f4[_0x385f07(0x5b4)] === _0x385f07(0x23d) && _0x4ba5f4[_0x385f07(0x6ec)][_0x385f07(0x761)](_0x442e2d)); const _0x58dbed = _0x5a1fb5(_0x3a57b8); _0x4096eb = _0x58dbed ? _0x58dbed['name'] : _0x385f07(0x42f); } }); } async function _0xf88c44(_0x5c4f2b) { const _0x9bb2a0 = _0x12f887; if (_0x9bb2a0(0x28a) === _0x9bb2a0(0x28a)) { const _0x57a9a3 = await _0x1c19af(_0x9bb2a0(0x70d)); if (!_0x57a9a3) return; const _0x3566ce = _0x2aa90d[_0x9bb2a0(0x494)]['find'](_0xbdf025 => _0xbdf025[_0x9bb2a0(0x4a6)] === _0x2aa90d[_0x9bb2a0(0x607)]); if (!_0x3566ce) return; const _0x310810 = _0x3566ce['entries'][_0x9bb2a0(0x2f0)](_0x121ffa => _0x121ffa[_0x9bb2a0(0x602)] === _0x5c4f2b); _0x310810 > -0x1 && (_0x3566ce[_0x9bb2a0(0x4ce)]['splice'](_0x310810, 0x1), _0x16a7ea(), _0xaf8024(), _0x5d65f5(_0x9bb2a0(0x593))); } else { if (!_0x2dd932 || !_0x318383[_0x9bb2a0(0x544)]) return; const _0x10711b = { 'role': 'user', 'content': '[用户发送了表情：' + _0x265a1f[_0x9bb2a0(0x2a5)] + ']', 'displayUrl': _0x455e67['url'], 'timestamp': _0xbcb65b[_0x9bb2a0(0x24a)]() }; _0x426ca8[_0x9bb2a0(0x7f2)][_0x9bb2a0(0x249)](_0x10711b), _0x4ffaef(_0x10711b, _0x4682a3[_0x9bb2a0(0x7f2)][_0x9bb2a0(0x45b)] - 0x1), _0x1a3025(), _0x5b5759[_0x9bb2a0(0x2f1)]['remove'](_0x9bb2a0(0x557)); } } async function _0x5c92c(_0x241358) { const _0x183fcf = _0x12f887; if (_0x183fcf(0x667) !== _0x183fcf(0x667)) _0x28df3d(_0x13a708), _0x16a61d(); else { const _0x389a95 = _0x2aa90d[_0x183fcf(0x494)][_0x183fcf(0x349)](_0x20e5f1 => _0x20e5f1[_0x183fcf(0x4a6)] === _0x2aa90d[_0x183fcf(0x607)]); if (!_0x389a95) return; const _0x9d7343 = _0x389a95['entries']['findIndex'](_0x51f38c => _0x51f38c[_0x183fcf(0x602)] === _0x241358); _0x9d7343 > -0x1 && ('PAJmn' === _0x183fcf(0x605) ? (_0x389a95[_0x183fcf(0x4ce)]['splice'](_0x9d7343, 0x1), _0x16a7ea(), _0xaf8024(), await _0x5018f0()) : (_0x5a56f6['error'](_0x183fcf(0x1f9) + _0x4edea4['id'] + '\x20的图片失败:', _0x30af82), _0x2e0c90[_0x183fcf(0x54e)] = _0x4ab67a['avatar'] || _0x386e1b)); } } function _0x314c55() { const _0x18b6ea = _0x12f887; if ('tzSkf' !== _0x18b6ea(0x17a)) { const _0x2e421e = document[_0x18b6ea(0x49f)](_0x18b6ea(0x873)); _0x2e421e[_0x18b6ea(0x862)] = ''; const _0x21d079 = _0x2aa90d[_0x18b6ea(0x857)][_0x18b6ea(0x747)](_0x37bc84 => _0x2aa90d[_0x18b6ea(0x22e)]['some'](_0x238d5f => _0x238d5f[_0x18b6ea(0x5b4)] === _0x18b6ea(0x23d) && _0x238d5f[_0x18b6ea(0x6ec)][_0x18b6ea(0x761)](_0x37bc84['id']))); if (_0x21d079[_0x18b6ea(0x45b)] === 0x0) { _0x2e421e[_0x18b6ea(0x862)] = _0x18b6ea(0x3c6); return; } _0x21d079[_0x18b6ea(0x242)](_0x3c3fac => { const _0x191f90 = _0x18b6ea, _0x319eee = document['createElement']('li'); _0x319eee['className'] = _0x191f90(0x852), _0x319eee[_0x191f90(0x55a)][_0x191f90(0x1c7)] = _0x3c3fac['id'], _0x319eee['innerHTML'] = '\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22char-info-wrapper\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22' + (_0x3c3fac[_0x191f90(0x5c4)] || _0x12a7cc) + _0x191f90(0x37e) + _0x3c3fac[_0x191f90(0x2a5)] + '</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22char-remark\x22>翻开日记本...</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20', _0x319eee[_0x191f90(0x179)](_0x191f90(0x3e9), () => { const _0x489181 = _0x191f90; 'volWx' !== _0x489181(0x1d3) ? _0x53b80b(_0x3c3fac['id']) : _0x23f59f(_0xb9b328[_0x489181(0x806)]); }), _0x2e421e[_0x191f90(0x185)](_0x319eee); }); } else _0x2a804c[_0x18b6ea(0x5da)] = _0x53f4ae[_0x18b6ea(0x4de)][_0x18b6ea(0x2e3)] || '', _0xfd2420['value'] = _0x3b62dd[_0x18b6ea(0x4de)][_0x18b6ea(0x691)] || '', _0x409ca8['value'] = _0x4250ab[_0x18b6ea(0x4de)][_0x18b6ea(0x355)] || '', _0x1761b6[_0x18b6ea(0x5da)] = _0x891214(_0x563617[_0x18b6ea(0x2eb)]?.[_0x18b6ea(0x3a2)] ?? 0x64), _0x2046b4[_0x18b6ea(0x49f)](_0x18b6ea(0x3d2))[_0x18b6ea(0x5da)] = _0x1e94c0[_0x18b6ea(0x4de)][_0x18b6ea(0x6e0)] || _0x18b6ea(0x402); } function _0x53b80b(_0x395fe6) { const _0x1c8b9c = _0x12f887, _0x58fba9 = _0x1c2a48(_0x395fe6); if (!_0x58fba9) return; _0x2aa90d[_0x1c8b9c(0x607)] = _0x395fe6; const _0x26aafb = _0x2aa90d[_0x1c8b9c(0x494)][_0x1c8b9c(0x349)](_0x46c22e => _0x46c22e['characterId'] === _0x395fe6), _0x4f490a = _0x26aafb ? _0x26aafb['entries'][_0x1c8b9c(0x45b)] : 0x0, _0x5ef8e4 = 0x2; _0x2aa90d[_0x1c8b9c(0x4e9)] = Math[_0x1c8b9c(0x30b)](0x0, Math[_0x1c8b9c(0x6bd)](_0x4f490a / _0x5ef8e4) - 0x1), document[_0x1c8b9c(0x49f)](_0x1c8b9c(0x851))[_0x1c8b9c(0x7ea)] = _0x58fba9[_0x1c8b9c(0x2a5)] + _0x1c8b9c(0x7cd), _0xaf8024(), _0x381d3b(_0x1c8b9c(0x36f), _0x1c8b9c(0x698)); } function _0xaf8024() { const _0x50e2b8 = _0x12f887, _0x3300d1 = document[_0x50e2b8(0x49f)](_0x50e2b8(0x731)), _0x4fa20c = document[_0x50e2b8(0x49f)]('diary-input-wrapper'); _0x3300d1[_0x50e2b8(0x862)] = '', _0x4fa20c[_0x50e2b8(0x862)] = ''; const _0x22bc03 = _0x5d8686() || { 'name': '我' }, _0x5d21c0 = _0x2aa90d[_0x50e2b8(0x494)][_0x50e2b8(0x349)](_0x3057ea => _0x3057ea[_0x50e2b8(0x4a6)] === _0x2aa90d[_0x50e2b8(0x607)]); if (!_0x5d21c0 || !_0x5d21c0['entries'] || _0x5d21c0['entries'][_0x50e2b8(0x45b)] === 0x0) { _0x3300d1[_0x50e2b8(0x862)] = _0x50e2b8(0x245), _0x4fa20c[_0x50e2b8(0x862)] = _0x50e2b8(0x486), document[_0x50e2b8(0x49f)]('diary-write-button')[_0x50e2b8(0x179)](_0x50e2b8(0x3e9), _0x4d514a), document[_0x50e2b8(0x49f)]('diary-get-reply-button')[_0x50e2b8(0x179)](_0x50e2b8(0x3e9), _0x5018f0); return; } const _0x257b1b = 0x2, _0x19f7f6 = [..._0x5d21c0[_0x50e2b8(0x4ce)]][_0x50e2b8(0x1e7)]((_0x566b2e, _0x2ecaea) => _0x566b2e[_0x50e2b8(0x602)] - _0x2ecaea[_0x50e2b8(0x602)]), _0x124e37 = []; for (let _0xe63aa2 = 0x0; _0xe63aa2 < _0x19f7f6['length']; _0xe63aa2 += _0x257b1b) { _0x124e37[_0x50e2b8(0x249)](_0x19f7f6[_0x50e2b8(0x830)](_0xe63aa2, _0xe63aa2 + _0x257b1b)); } const _0x40538d = _0x124e37[_0x50e2b8(0x45b)]; _0x124e37[_0x50e2b8(0x242)]((_0x554709, _0x290e5a) => { const _0x24fda3 = _0x50e2b8, _0x3490b0 = document['createElement']('div'); _0x3490b0[_0x24fda3(0x399)] = _0x24fda3(0x2b6), _0x3490b0['id'] = _0x24fda3(0x3bf) + _0x290e5a; if (_0x290e5a === _0x2aa90d['diaryCurrentPage']) { if ('Lcloh' !== _0x24fda3(0x24f)) return { 'type': 'sticker', 'name': _0x351cfd[0x1]['trim']() }; else _0x3490b0[_0x24fda3(0x2f1)][_0x24fda3(0x737)](_0x24fda3(0x25a)); } _0x554709[_0x24fda3(0x242)](_0x3c91af => { const _0x1cdad6 = _0x24fda3; if ('UtNzp' === _0x1cdad6(0x34f)) _0x270239[_0xc0800e][_0x1cdad6(0x2f1)][_0x1cdad6(0x231)]('filled'), _0x355dd3[_0xe40e38][_0x1cdad6(0x5da)] = ''; else { const _0x433b1f = _0x3c91af[_0x1cdad6(0x71c)] === _0x1cdad6(0x821) ? _0x1cdad6(0x821) : 'ai', _0x53bbb0 = _0x3c91af[_0x1cdad6(0x71c)] === _0x1cdad6(0x821) ? _0x22bc03[_0x1cdad6(0x2a5)] : _0x1c2a48(_0x3c91af['author'])[_0x1cdad6(0x2a5)], _0x302bdd = document[_0x1cdad6(0x1a2)](_0x1cdad6(0x642)); _0x302bdd[_0x1cdad6(0x399)] = _0x1cdad6(0x1f4) + _0x433b1f, _0x302bdd['dataset'][_0x1cdad6(0x602)] = _0x3c91af[_0x1cdad6(0x602)], _0x302bdd[_0x1cdad6(0x3c9)][_0x1cdad6(0x59d)] = _0x1cdad6(0x3d3), _0x302bdd[_0x1cdad6(0x3c9)][_0x1cdad6(0x628)] = '0', _0x302bdd[_0x1cdad6(0x862)] = _0x1cdad6(0x4e0) + _0x53bbb0 + _0x1cdad6(0x732) + new Date(_0x3c91af[_0x1cdad6(0x602)])['toLocaleString']('zh-CN') + _0x1cdad6(0x7b1) + _0x3c91af[_0x1cdad6(0x751)][_0x1cdad6(0x23b)](/\n/g, '<br>') + _0x1cdad6(0x2a4), _0x3490b0['appendChild'](_0x302bdd); } }), _0x3300d1[_0x24fda3(0x185)](_0x3490b0); }), _0x4fa20c[_0x50e2b8(0x862)] = _0x50e2b8(0x6e8) + (_0x2aa90d[_0x50e2b8(0x4e9)] + 0x1) + _0x50e2b8(0x592) + _0x40538d + _0x50e2b8(0x87e), document[_0x50e2b8(0x49f)](_0x50e2b8(0x367))['disabled'] = _0x2aa90d[_0x50e2b8(0x4e9)] === 0x0, document[_0x50e2b8(0x49f)](_0x50e2b8(0x21c))['disabled'] = _0x2aa90d['diaryCurrentPage'] === _0x40538d - 0x1, document[_0x50e2b8(0x49f)](_0x50e2b8(0x367))['addEventListener'](_0x50e2b8(0x3e9), _0x401397), document['getElementById'](_0x50e2b8(0x21c))['addEventListener']('click', _0x28ba4e), document[_0x50e2b8(0x49f)](_0x50e2b8(0x20e))[_0x50e2b8(0x179)](_0x50e2b8(0x3e9), _0x4d514a), document[_0x50e2b8(0x49f)](_0x50e2b8(0x35e))['addEventListener'](_0x50e2b8(0x3e9), _0x5018f0); } function _0x28ba4e() { const _0x5c283d = _0x12f887; if (_0x2aa90d['isAnimatingDiary']) return; const _0x475260 = _0x2aa90d[_0x5c283d(0x4e9)], _0x150816 = Math['ceil'](_0x2aa90d['diaries']['find'](_0x273777 => _0x273777[_0x5c283d(0x4a6)] === _0x2aa90d[_0x5c283d(0x607)])[_0x5c283d(0x4ce)][_0x5c283d(0x45b)] / 0x2); if (_0x475260 >= _0x150816 - 0x1) return; _0x2aa90d['isAnimatingDiary'] = !![]; const _0x1f5f8b = _0x475260 + 0x1, _0x2dbd60 = document[_0x5c283d(0x49f)](_0x5c283d(0x3bf) + _0x475260), _0x4a63b2 = document[_0x5c283d(0x49f)]('diary-page-' + _0x1f5f8b); if (_0x2dbd60 && _0x4a63b2) { if ('LLbdZ' === _0x5c283d(0x1aa)) { if (_0x33112f['name'] !== _0x5c283d(0x578)) { _0x27bab0[_0x5c283d(0x6eb)](_0x5c283d(0x5a8), _0xbb51e0); const _0x1eed17 = { 'role': 'assistant', 'content': _0x5c283d(0x2ba) + _0x5b6c1b[_0x5c283d(0x4c4)], 'senderId': _0x31390f['id'], 'isOffline': _0x4ad99b }; _0xc42830['conversationHistory'][_0x5c283d(0x249)](_0x1eed17), _0x4a5e23(); } return ![]; } else _0x4a63b2[_0x5c283d(0x2f1)]['add'](_0x5c283d(0x366)), _0x2dbd60[_0x5c283d(0x2f1)][_0x5c283d(0x737)](_0x5c283d(0x312)), _0x4a63b2[_0x5c283d(0x2f1)][_0x5c283d(0x737)](_0x5c283d(0x25a)), setTimeout(() => { const _0x1a02db = _0x5c283d; _0x2dbd60[_0x1a02db(0x2f1)][_0x1a02db(0x231)](_0x1a02db(0x25a), 'is-exiting-left'), _0x4a63b2[_0x1a02db(0x2f1)]['remove'](_0x1a02db(0x366)), _0x2aa90d['diaryCurrentPage'] = _0x1f5f8b, _0xaf8024(), _0x2aa90d['isAnimatingDiary'] = ![]; }, 0x2bc); } else _0x2aa90d[_0x5c283d(0x3ab)] = ![]; } function _0x401397() { const _0x581b03 = _0x12f887; if (_0x2aa90d[_0x581b03(0x3ab)]) return; const _0x3632ba = _0x2aa90d[_0x581b03(0x4e9)]; if (_0x3632ba <= 0x0) return; _0x2aa90d[_0x581b03(0x3ab)] = !![]; const _0x2d8a0b = _0x3632ba - 0x1, _0xf84102 = document[_0x581b03(0x49f)]('diary-page-' + _0x3632ba), _0x139228 = document[_0x581b03(0x49f)](_0x581b03(0x3bf) + _0x2d8a0b); _0xf84102 && _0x139228 ? (_0x139228[_0x581b03(0x2f1)]['add'](_0x581b03(0x414)), _0xf84102[_0x581b03(0x2f1)][_0x581b03(0x737)](_0x581b03(0x2f3)), _0x139228[_0x581b03(0x2f1)][_0x581b03(0x737)](_0x581b03(0x25a)), setTimeout(() => { const _0x323929 = _0x581b03; _0xf84102[_0x323929(0x2f1)][_0x323929(0x231)](_0x323929(0x25a), _0x323929(0x2f3)), _0x139228[_0x323929(0x2f1)][_0x323929(0x231)](_0x323929(0x414)), _0x2aa90d[_0x323929(0x4e9)] = _0x2d8a0b, _0xaf8024(), _0x2aa90d[_0x323929(0x3ab)] = ![]; }, 0x2bc)) : _0x2aa90d['isAnimatingDiary'] = ![]; } function _0x4d514a() { return new Promise(_0xeb94f3 => { const _0x94b6df = _0x3488; if ('TdTrm' !== _0x94b6df(0x4b8)) { if (_0x5eed60[_0x94b6df(0x619)] === 'user' && _0x53d37d['image']) return { 'role': 'user', 'content': [{ 'type': _0x94b6df(0x740), 'text': _0xe564bb[_0x94b6df(0x751)] || '\x20' }, { 'type': _0x94b6df(0x178), 'image_url': { 'url': _0x32f8a9[_0x94b6df(0x33c)], 'detail': _0x94b6df(0x878) } }] }; return { 'role': _0x42ec75[_0x94b6df(0x619)], 'content': _0x59c798[_0x94b6df(0x751)] }; } else { const _0x13fda2 = _0x94b6df(0x46a); document[_0x94b6df(0x546)][_0x94b6df(0x88a)](_0x94b6df(0x307), _0x13fda2); const _0x2cb4ad = document[_0x94b6df(0x49f)](_0x94b6df(0x221)), _0x770f8c = document['getElementById'](_0x94b6df(0x31f)), _0x22107f = document[_0x94b6df(0x49f)](_0x94b6df(0x865)), _0xc03a45 = document['getElementById'](_0x94b6df(0x1f5)), _0x17e9fe = _0x2cb4ad[_0x94b6df(0x4b0)]('.choice-modal-backdrop'), _0x3b06bc = () => { const _0x183e38 = _0x94b6df; if (_0x183e38(0x53d) === _0x183e38(0x86e)) { const _0x38c6ef = _0x39c669[_0x183e38(0x49f)](_0x183e38(0x194)); _0x38c6ef['textContent'] = _0x34210a, _0x38c6ef[_0x183e38(0x3c9)]['display'] = _0x183e38(0x4b1); if (_0x329ce9['_t']) _0x510fb0(_0x488ab1['_t']); _0x4daec5['_t'] = _0x579b60(() => { const _0x4802a3 = _0x183e38; _0x38c6ef[_0x4802a3(0x3c9)][_0x4802a3(0x6b4)] = _0x4802a3(0x3d3); }, 0x640); } else _0x2cb4ad['remove'](), _0xeb94f3(); }; _0x22107f[_0x94b6df(0x56a)] = () => { const _0x1bce5d = _0x94b6df; _0x4a4f04(_0x770f8c[_0x1bce5d(0x5da)]), _0x3b06bc(); }, _0xc03a45[_0x94b6df(0x56a)] = _0x3b06bc, _0x17e9fe['onclick'] = _0x3b06bc; } }); } function _0x4a4f04(_0x48de2b) { const _0xd9710c = _0x12f887, _0x18fe1a = _0x48de2b['trim'](); if (!_0x18fe1a || !_0x2aa90d[_0xd9710c(0x607)]) return; let _0x64ec76 = _0x2aa90d[_0xd9710c(0x494)][_0xd9710c(0x349)](_0x11fff1 => _0x11fff1[_0xd9710c(0x4a6)] === _0x2aa90d['activeDiaryCharacterId']); !_0x64ec76 && (_0x64ec76 = { 'characterId': _0x2aa90d[_0xd9710c(0x607)], 'entries': [] }, _0x2aa90d[_0xd9710c(0x494)][_0xd9710c(0x249)](_0x64ec76)); _0x64ec76['entries'][_0xd9710c(0x249)]({ 'timestamp': Date[_0xd9710c(0x24a)](), 'author': _0xd9710c(0x821), 'content': _0x18fe1a }), _0x16a7ea(); const _0x18e37e = _0x64ec76[_0xd9710c(0x4ce)][_0xd9710c(0x45b)]; _0x2aa90d[_0xd9710c(0x4e9)] = Math['ceil'](_0x18e37e / 0x2) - 0x1, _0xaf8024(); } async function _0x5018f0() { const _0x303067 = _0x12f887; if (_0x303067(0x306) !== _0x303067(0x54d)) { const _0x381e96 = _0x2aa90d['activeDiaryCharacterId'], _0x118532 = _0x1c2a48(_0x381e96); if (!_0x118532 || _0x2aa90d[_0x303067(0x784)]) return; _0x9d4a2d(!![], _0x303067(0x531)), _0x2aa90d[_0x303067(0x784)] = !![]; let _0xcd31d9 = []; try { if ('PPite' !== 'PPite') { _0x3ef765(); return; } else { const _0x2c3496 = _0x5d8686() || { 'name': '你' }, _0x5df054 = _0x515fd9(_0x381e96), { omniText: _0x3b0748 } = _0x395060(_0x381e96, _0x2aa90d[_0x303067(0x544)]); let _0xae960 = ''; if (_0x118532[_0x303067(0x76f)] && _0x118532[_0x303067(0x76f)][_0x303067(0x45b)] > 0x0) { const _0x5506a3 = _0x118532['linkedWorldBookIds'][_0x303067(0x511)](_0x41e243 => _0x2aa90d[_0x303067(0x14b)][_0x303067(0x349)](_0x6bd508 => _0x6bd508['id'] === _0x41e243))['filter'](Boolean)[_0x303067(0x511)](_0x4957b1 => '\x0a\x0a##\x20世界书条目:\x20' + _0x4957b1[_0x303067(0x2a5)] + '\x0a' + _0x4957b1[_0x303067(0x751)])[_0x303067(0x4c2)](''); if (_0x5506a3) _0xae960 = _0x303067(0x303) + _0x5506a3; } const _0x3dad76 = _0x2c3496[_0x303067(0x839)] ? _0x303067(0x381) + _0x2c3496['name'] + '”的补充信息\x0a' + _0x2c3496[_0x303067(0x839)] : '', _0x225d8a = _0x1f3bb7(), _0xb4a5f0 = _0x303067(0x673) + _0x118532[_0x303067(0x2a5)] + '”的角色，现在需要写一篇交换日记。\x0a-\x20**你的读者**:\x20' + _0x2c3496[_0x303067(0x2a5)] + '。\x0a-\x20**核心人设**:\x20' + _0x118532[_0x303067(0x839)] + '\x0a' + _0x3dad76 + '\x0a' + _0xae960 + _0x303067(0x265) + (_0x3b0748 || _0x303067(0x19e)) + '\x0a---\x0a---\x0a##\x20最近的动态回顾\x0a' + (_0x225d8a || _0x303067(0x7a3)) + _0x303067(0x1e1) + (_0x5df054 || _0x303067(0x5b3)) + '\x0a---\x0a\x0a#\x20输出要求\x0a直接输出一篇长度适中的日记正文，不要包含任何其他说明或前缀。'; _0xcd31d9 = [{ 'role': _0x303067(0x1db), 'content': _0xb4a5f0 }, { 'role': 'user', 'content': _0x303067(0x78b) }]; const _0x4d20f2 = await _0x3c8f91(_0xcd31d9); if (_0x4d20f2) { if (_0x303067(0x36a) !== 'SVMHT') { const _0x39f807 = _0x5e322f['parse'](_0x2162d7); _0x4392ce[_0x303067(0x4d3)](_0x39f807) && (_0x717bd2 = _0x39f807[_0x303067(0x747)](_0x198d77 => _0x198d77 && typeof _0x198d77 === _0x303067(0x18c) && typeof _0x198d77[_0x303067(0x619)] === 'string' && typeof _0x198d77[_0x303067(0x751)] !== _0x303067(0x212))); } else { let _0x51684d = _0x2aa90d['diaries'][_0x303067(0x349)](_0x5795d3 => _0x5795d3[_0x303067(0x4a6)] === _0x381e96); !_0x51684d && (_0x51684d = { 'characterId': _0x381e96, 'entries': [] }, _0x2aa90d[_0x303067(0x494)][_0x303067(0x249)](_0x51684d)); _0x51684d['entries']['push']({ 'timestamp': Date[_0x303067(0x24a)](), 'author': _0x381e96, 'content': _0x4d20f2 }), _0x16a7ea(); const _0xb7935b = _0x51684d[_0x303067(0x4ce)][_0x303067(0x45b)]; _0x2aa90d[_0x303067(0x4e9)] = Math['ceil'](_0xb7935b / 0x2) - 0x1, _0xaf8024(); } } } } catch (_0x2dfcd2) { _0x5d65f5(_0x303067(0x430) + _0x2dfcd2[_0x303067(0x4c4)]); } finally { _0x9d4a2d(![]), _0x2aa90d[_0x303067(0x784)] = ![]; } } else { _0x2ed4f5 = _0x2e69b9(); const _0x1aea98 = _0x30992e[_0x303067(0x49f)]('char-name-header')[_0x303067(0x7ea)]; _0x16bf0f = _0x1aea98 || _0x303067(0x620); } } function _0x39036a() { const _0xc25bb = _0x12f887; if (_0xc25bb(0x5ff) === 'LamKU') { const _0x1a91d9 = document[_0xc25bb(0x49f)](_0xc25bb(0x338)), _0x368211 = document['getElementById'](_0xc25bb(0x378)), _0x536057 = document[_0xc25bb(0x4b0)](_0xc25bb(0x5d5)); if (_0x2aa90d[_0xc25bb(0x73a)] === 'galgame') { if ('jqbIW' === _0xc25bb(0x1f1)) _0x1a91d9['style'][_0xc25bb(0x6b4)] = _0xc25bb(0x3d3), _0x368211['style']['display'] = 'block'; else { const { omniText: _0x37219c } = _0x145bed(_0x11cb8d['id'], _0x3b24a9['id']), _0x650558 = _0x5a4dd7(_0x302709['id']), _0x45e19b = _0x2c043c[_0xc25bb(0x76f)] && _0x33027d[_0xc25bb(0x76f)][_0xc25bb(0x45b)] > 0x0 ? _0xc25bb(0x631) + _0x3235cd['name'] + _0xc25bb(0x465) + _0xfd64ea[_0xc25bb(0x76f)]['map'](_0x48d2c3 => _0xba3b39[_0xc25bb(0x14b)][_0xc25bb(0x349)](_0x1c4942 => _0x1c4942['id'] === _0x48d2c3))[_0xc25bb(0x747)](_0x19a2f1)['map'](_0x57fe38 => _0xc25bb(0x65b) + _0x57fe38[_0xc25bb(0x2a5)] + '\x0a' + _0x57fe38[_0xc25bb(0x751)])['join']('') : ''; return { 'id': _0x38bebb['id'], 'name': _0x3bc8d0['name'], 'persona': _0x158379[_0xc25bb(0x839)] || _0xc25bb(0x7d7), 'memory': _0x37219c + _0x650558 + _0x45e19b }; } } else _0x1a91d9[_0xc25bb(0x3c9)][_0xc25bb(0x6b4)] = _0xc25bb(0x4b1), _0x368211[_0xc25bb(0x3c9)][_0xc25bb(0x6b4)] = _0xc25bb(0x3d3); _0x536057[_0xc25bb(0x3c9)][_0xc25bb(0x6b4)] = _0xc25bb(0x4b1); } else _0xcb40e3(![]); } function _0x3b5b73() { const _0x573d03 = _0x12f887, _0x596c25 = document[_0x573d03(0x49f)](_0x573d03(0x814)), _0x35589c = document[_0x573d03(0x49f)](_0x573d03(0x3a6)); if (_0x2aa90d['activeMeetingScriptQueue']['length'] > 0x0) { const _0x57ed44 = _0x2aa90d[_0x573d03(0x700)][_0x573d03(0x33f)](); _0x596c25[_0x573d03(0x7ea)] = _0x57ed44[_0x573d03(0x712)] === _0x573d03(0x55c) ? '旁白' : _0x57ed44[_0x573d03(0x712)], _0x35589c[_0x573d03(0x7ea)] = _0x57ed44[_0x573d03(0x591)], _0x57ed44[_0x573d03(0x712)] !== _0x573d03(0x55c) && _0x4b178a(_0x2aa90d['activeMeetingCharId'], _0x57ed44[_0x573d03(0x791)]); } else { const _0x3d4907 = _0x2aa90d[_0x573d03(0x4ca)][_0x2aa90d[_0x573d03(0x27d)]]; if (_0x3d4907 && _0x3d4907[_0x573d03(0x45b)] > 0x0) { _0x2aa90d[_0x573d03(0x700)] = [..._0x3d4907]; const _0xb4b4ef = _0x2aa90d['activeMeetingScriptQueue'][_0x573d03(0x33f)](); _0x596c25[_0x573d03(0x7ea)] = _0xb4b4ef[_0x573d03(0x712)] === _0x573d03(0x55c) ? '旁白' : _0xb4b4ef[_0x573d03(0x712)], _0x35589c[_0x573d03(0x7ea)] = _0xb4b4ef[_0x573d03(0x591)]; if (_0xb4b4ef['speaker'] !== _0x573d03(0x55c)) { if (_0x573d03(0x711) === _0x573d03(0x711)) _0x4b178a(_0x2aa90d[_0x573d03(0x27d)], _0xb4b4ef[_0x573d03(0x791)]); else { const _0x1059ab = _0x7cb762['createElement']('p'); _0x1059ab[_0x573d03(0x7ea)] = _0x389ff6, _0x1059ab['style'][_0x573d03(0x14e)] = '0', _0x403eab[_0x573d03(0x185)](_0x1059ab); } } } else { if ('udjRV' === 'qBCBN') { const _0x3d52d3 = _0x58120b[_0x573d03(0x22e)][_0x573d03(0x349)](_0x50eaf0 => _0x50eaf0['id'] === _0x4b36c7), _0x23b56b = _0x3d52d3?.['boundUserProfileId']; let _0x34a70c = _0x3e7ff7['userProfiles']['find'](_0x12624c => _0x12624c['id'] === _0x23b56b); return !_0x34a70c && (_0x34a70c = _0x1ec631[_0x573d03(0x47c)][_0x573d03(0x349)](_0x332107 => _0x332107['id'] === _0x16f57d[_0x573d03(0x4f4)]) || _0x736dd5[_0x573d03(0x47c)][0x0]), _0x34a70c || { 'name': '用户', 'avatar': _0x2db4f4, 'persona': '' }; } else _0x596c25[_0x573d03(0x7ea)] = '旁白', _0x35589c['textContent'] = _0x573d03(0x5d6); } } } async function _0x4b178a(_0x8aec9f, _0x1e50fe) { const _0x47e748 = _0x12f887, _0x36b5d8 = document[_0x47e748(0x49f)](_0x47e748(0x155)), _0x577ab0 = [_0x47e748(0x76c), 'happy', 'angry', 'sad', 'shy'], _0x87cbdf = _0x577ab0['includes'](_0x1e50fe) ? _0x1e50fe : _0x47e748(0x76c); try { if ('KdLuP' === 'KdLuP') { const _0x2d1b24 = await _0x33b931('char_sprite_' + _0x87cbdf + '_' + _0x8aec9f); if (_0x2d1b24) _0x36b5d8[_0x47e748(0x3c9)][_0x47e748(0x549)] = 0x0, setTimeout(() => { const _0x2cea49 = _0x47e748; _0x36b5d8[_0x2cea49(0x54e)] = URL[_0x2cea49(0x52d)](_0x2d1b24), _0x36b5d8[_0x2cea49(0x3c9)][_0x2cea49(0x549)] = 0x1; }, 0x12c); else { const _0x39e799 = await _0x33b931(_0x47e748(0x5bc) + _0x8aec9f); _0x39e799 ? _0x36b5d8[_0x47e748(0x54e)] = URL[_0x47e748(0x52d)](_0x39e799) : _0x36b5d8[_0x47e748(0x54e)] = ''; } } else return new _0x41dfc6(_0x2a87df => { const _0x52720b = _0x47e748, _0x32d130 = _0x560aae[_0x52720b(0x49f)]('modal-root'), _0x2cd42c = _0x5c55b4[_0x52720b(0x49f)](_0x52720b(0x70a)), _0x2a5594 = _0x16422b[_0x52720b(0x49f)](_0x52720b(0x16c)), _0x4928ef = _0x4d02ff[_0x52720b(0x49f)](_0x52720b(0x72f)), _0x492a93 = _0x4928ed[_0x52720b(0x49f)](_0x52720b(0x808)); _0x2cd42c[_0x52720b(0x7ea)] = _0x4cc459, _0x32d130['style'][_0x52720b(0x6b4)] = _0x52720b(0x5dc); const _0x50f8de = _0x258679 => { const _0x417629 = _0x52720b; _0x32d130[_0x417629(0x3c9)][_0x417629(0x6b4)] = 'none', _0x2a5594['onclick'] = _0x4928ef[_0x417629(0x56a)] = _0x492a93[_0x417629(0x56a)] = null, _0xdbe836[_0x417629(0x7bb)](_0x417629(0x357), _0x2e675a), _0x2a87df(_0x258679); }, _0x2e675a = _0x3b700c => { const _0x2b1e51 = _0x52720b; if (_0x3b700c[_0x2b1e51(0x691)] === _0x2b1e51(0x4ef)) _0x50f8de(![]); if (_0x3b700c[_0x2b1e51(0x691)] === _0x2b1e51(0x3c2)) _0x50f8de(!![]); }; _0x2a5594[_0x52720b(0x56a)] = () => _0x50f8de(!![]), _0x4928ef[_0x52720b(0x56a)] = () => _0x50f8de(![]), _0x492a93[_0x52720b(0x56a)] = () => _0x50f8de(![]), _0x34f9a9['addEventListener'](_0x52720b(0x357), _0x2e675a); }); } catch (_0x15ac4f) { console[_0x47e748(0x6eb)](_0x47e748(0x81b), _0x15ac4f), _0x36b5d8[_0x47e748(0x54e)] = ''; } } function _0x5428e2(_0x5c42dd) { const _0x518265 = _0x12f887, _0x4028a9 = _0x1c2a48(_0x5c42dd); if (!_0x4028a9) return; const _0x3f2d5d = _0x2aa90d['chats']['find'](_0x3fc69a => _0x3fc69a[_0x518265(0x5b4)] === _0x518265(0x23d) && _0x3fc69a[_0x518265(0x6ec)][_0x518265(0x761)](_0x5c42dd)), _0x5a2a10 = _0x5cb17e(_0x3f2d5d['id']), _0x341e98 = _0x2aa90d['conversationHistory'][_0x518265(0x747)](_0x4ade63 => _0x4ade63[_0x518265(0x446)])[_0x518265(0x757)](), _0x1c593a = document['getElementById']('galgame-speaker'), _0x1c4518 = document[_0x518265(0x49f)]('galgame-text'); let _0x5887ef = null; if (_0x341e98) { if (_0x341e98[_0x518265(0x619)] === 'assistant') { if (_0x518265(0x79f) !== _0x518265(0x79f)) _0x40085d(_0x518265(0x2ba) + _0x110072[_0x518265(0x4c4)]); else { const _0x390366 = _0x2aa90d['characterLastScripts'][_0x5c42dd]; _0x390366 && _0x390366[_0x518265(0x45b)] > 0x0 && (_0x518265(0x7ce) === _0x518265(0x7ce) ? _0x5887ef = _0x390366['at'](-0x1) : (_0x2d10d1[_0x518265(0x6eb)](_0x518265(0x785) + _0x56e707 + ':', _0x25cd5b), _0x5adf95[_0x518265(0x3c9)][_0x518265(0x482)] = _0x518265(0x3d3))); } } else _0x518265(0x40c) === _0x518265(0x388) ? (_0x191dc4(), _0x58577b['conversationHistory'] = [], _0x422671()) : _0x5887ef = { 'speaker': _0x5a2a10[_0x518265(0x2a5)], 'line': _0x341e98['content'], 'emotion': _0x518265(0x76c) }; } _0x5887ef ? _0x518265(0x7e7) === _0x518265(0x2c7) ? (_0x48ee04 = _0x4a98bb[_0x518265(0x2a5)], _0x5af0bf = _0x3be318[_0x518265(0x5c4)]) : (_0x1c593a['textContent'] = _0x5887ef[_0x518265(0x712)] === 'narrator' ? '旁白' : _0x5887ef['speaker'], _0x1c4518[_0x518265(0x7ea)] = _0x5887ef[_0x518265(0x591)], _0x5887ef[_0x518265(0x712)] === _0x4028a9['name'] ? _0x4b178a(_0x5c42dd, _0x5887ef[_0x518265(0x791)]) : _0x4b178a(_0x5c42dd, _0x518265(0x76c))) : (_0x1c593a[_0x518265(0x7ea)] = _0x4028a9['name'], _0x1c4518[_0x518265(0x7ea)] = _0x518265(0x6ba), _0x4b178a(_0x5c42dd, 'normal')); } function _0x28be94() { const _0x12a1ad = _0x12f887, _0x32de64 = new Date(), _0x327fb5 = document['getElementById'](_0x12a1ad(0x502)), _0x122686 = document[_0x12a1ad(0x49f)](_0x12a1ad(0x7f1)); if (_0x327fb5 && _0x122686) { if (_0x12a1ad(0x451) !== _0x12a1ad(0x451)) _0x44b468[_0x12a1ad(0x5da)] = _0x17f7a0[_0x12a1ad(0x585)][_0x12a1ad(0x2a5)] || '', _0x105a2b[_0x12a1ad(0x54e)] = _0x287210[_0x12a1ad(0x585)][_0x12a1ad(0x5c4)] || _0x251ee2, _0x1dfbc6[_0x12a1ad(0x5da)] = _0x2ed536[_0x12a1ad(0x585)]['persona'] || ''; else { const _0x14d30e = String(_0x32de64[_0x12a1ad(0x4a4)]())['padStart'](0x2, '0'), _0x14412b = String(_0x32de64['getMinutes']())[_0x12a1ad(0x2a3)](0x2, '0'); _0x327fb5[_0x12a1ad(0x7ea)] = _0x14d30e + ':' + _0x14412b; const _0x316785 = _0x32de64['getMonth']() + 0x1, _0x36b4a3 = _0x32de64[_0x12a1ad(0x2d7)](), _0x438410 = ['星期日', _0x12a1ad(0x3ae), '星期二', _0x12a1ad(0x2c9), _0x12a1ad(0x6f9), '星期五', _0x12a1ad(0x4c9)][_0x32de64[_0x12a1ad(0x87b)]()]; _0x122686[_0x12a1ad(0x7ea)] = _0x316785 + '月' + _0x36b4a3 + '日\x20' + _0x438410; } } } const _0x1bbecb = document[_0x12f887(0x49f)](_0x12f887(0x2f9)), _0x79f477 = document[_0x12f887(0x49f)](_0x12f887(0x743)), _0x49336a = document[_0x12f887(0x49f)](_0x12f887(0x7ff)), _0x2b4431 = document[_0x12f887(0x49f)](_0x12f887(0x28e)), _0x3062fb = document['getElementById'](_0x12f887(0x553)), _0x40a89f = document[_0x12f887(0x49f)](_0x12f887(0x372)), _0x1ace8c = document[_0x12f887(0x49f)](_0x12f887(0x560)), _0x2d5e98 = document[_0x12f887(0x49f)](_0x12f887(0x734)), _0xa31af9 = document[_0x12f887(0x49f)]('lt-ui-lyrics-container'); let _0x5206e6 = []; async function _0x465b7f() { const _0x113b84 = _0x12f887; if (!_0x2aa90d[_0x113b84(0x544)]) return; _0x3062fb['innerHTML'] = '<p\x20style=\x22text-align:\x20center;\x20color:\x20var(--text-color-light);\x22>正在清点圣殿藏品...</p>', _0x1bbecb[_0x113b84(0x2f1)]['add'](_0x113b84(0x557)); const _0x362e15 = await _0x2732ef(); if (_0x362e15[_0x113b84(0x45b)] === 0x0) { _0x3062fb['innerHTML'] = '<p\x20style=\x22text-align:\x20center;\x20color:\x20var(--text-color-light);\x22>你的音乐库还是空的，没法邀请别人一起听。</p>'; return; } _0x3062fb['innerHTML'] = '', _0x362e15[_0x113b84(0x242)](_0x3552b3 => { const _0x1e8b22 = _0x113b84, _0x39da4d = document['createElement'](_0x1e8b22(0x642)); _0x39da4d[_0x1e8b22(0x399)] = _0x1e8b22(0x3ca); const _0x2edacb = _0x3552b3['cover'] ? URL[_0x1e8b22(0x52d)](_0x3552b3[_0x1e8b22(0x4ad)]) : _0x12a7cc; _0x39da4d[_0x1e8b22(0x862)] = _0x1e8b22(0x4c7) + _0x2edacb + _0x1e8b22(0x4c3) + (_0x3552b3[_0x1e8b22(0x63b)][_0x1e8b22(0x59a)] || _0x1e8b22(0x3a0)) + _0x1e8b22(0x7be) + (_0x3552b3[_0x1e8b22(0x63b)]['歌手'] || _0x1e8b22(0x32c)) + '</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20', _0x39da4d[_0x1e8b22(0x179)](_0x1e8b22(0x3e9), () => { const _0xa38e43 = _0x1e8b22; _0xa38e43(0x64c) !== _0xa38e43(0x64c) ? (_0x43c3cc[_0xa38e43(0x185)](_0x2ce843), _0x303515[_0xa38e43(0x185)](_0x258139)) : _0x89d8a1(_0x3552b3); }), _0x3062fb['appendChild'](_0x39da4d); }); } function _0x29a72a() { const _0x26bc2 = _0x12f887; _0x1bbecb[_0x26bc2(0x2f1)][_0x26bc2(0x231)]('show'); } async function _0x89d8a1(_0x166102) { const _0x3ddc9b = _0x12f887; if (!_0x2aa90d[_0x3ddc9b(0x544)] || !_0x166102) return; let _0x5ed12d = null; if (_0x166102[_0x3ddc9b(0x4ad)]) try { if (_0x3ddc9b(0x5fd) === 'dGArb') _0x5ed12d = await _0x59aa76(_0x166102[_0x3ddc9b(0x4ad)]); else try { const _0x3248af = _0x1d094c[_0x3ddc9b(0x38e)](_0x44e750[_0x3ddc9b(0x70e)](_0x3ddc9b(0x78f)) || '{}'), _0x2b5d00 = { ..._0x3248af, ..._0x513089 }; _0x368417['setItem']('badgeState', _0x5a9543[_0x3ddc9b(0x46d)](_0x2b5d00)); } catch (_0x43924a) { _0x255947['error'](_0x3ddc9b(0x1b6), _0x43924a); } } catch (_0x23171b) { console[_0x3ddc9b(0x6eb)](_0x3ddc9b(0x86b), _0x23171b), _0x5ed12d = _0x12a7cc; } const _0x4e0e09 = { 'role': _0x3ddc9b(0x821), 'type': 'listen-together-invite', 'content': _0x3ddc9b(0x729) + _0x166102['info']['歌曲名称'] + ']', 'songId': _0x166102['id'], 'songName': _0x166102[_0x3ddc9b(0x63b)][_0x3ddc9b(0x59a)], 'artist': _0x166102['info']['歌手'], 'coverUrl': _0x5ed12d, 'timestamp': Date[_0x3ddc9b(0x24a)]() }; _0x2aa90d[_0x3ddc9b(0x7f2)]['push'](_0x4e0e09), _0x3c149c(), _0x42745f(), _0x29a72a(), setTimeout(_0x5c969b, 0x64); } _0x79f477[_0x12f887(0x179)]('click', _0x465b7f), _0x49336a[_0x12f887(0x179)]('click', _0x29a72a), _0x2b4431[_0x12f887(0x179)](_0x12f887(0x3e9), _0x29a72a); async function _0xc4c8a0(_0x3e95a, _0x3a9476, _0x3be0f1) { const _0x5f543f = _0x12f887; if ('FvdZd' !== _0x5f543f(0x59b)) { const _0x115ad5 = _0x2aa90d['chats'][_0x5f543f(0x349)](_0x45ae7a => _0x45ae7a['activeListenSession'] && _0x45ae7a[_0x5f543f(0x843)][_0x5f543f(0x17c)]); if (_0x115ad5 && _0x115ad5['id'] !== _0x2aa90d[_0x5f543f(0x544)]) _0x115ad5[_0x5f543f(0x843)] = null, _0x5d65f5(_0x5f543f(0x4aa)), _0x16a7ea(); else { if (_0x115ad5 && _0x115ad5['id'] === _0x2aa90d[_0x5f543f(0x544)]) { _0x5d65f5(_0x5f543f(0x5c7)); return; } } _0x9d4a2d(!![], _0x5f543f(0x60d)); const _0x2ffd6e = _0x4adf1c(); if (!_0x2ffd6e) { _0x9d4a2d(![]), _0x5d65f5(_0x5f543f(0x750)); return; } const _0x5f5bb0 = await _0xf17b48(_0x3e95a); if (!_0x5f5bb0) { if ('zWeWs' !== _0x5f543f(0x487)) return _0x4b2dad(new _0x195f5a(_0x5f543f(0x397))); else { _0x9d4a2d(![]), _0x5d65f5(_0x5f543f(0x4ee)); return; } } _0x2ffd6e[_0x5f543f(0x843)] = { 'isActive': !![], 'songId': _0x3e95a, 'leaderId': _0x5f543f(0x821), 'songName': _0x5f5bb0[_0x5f543f(0x63b)][_0x5f543f(0x59a)], 'artist': _0x5f5bb0[_0x5f543f(0x63b)]['歌手'], 'cover': _0x5f5bb0[_0x5f543f(0x4ad)] }, _0x16a7ea(), document[_0x5f543f(0x49f)]('lt-ui-cover-art')[_0x5f543f(0x54e)] = _0x5f5bb0['cover'] ? URL[_0x5f543f(0x52d)](_0x5f5bb0[_0x5f543f(0x4ad)]) : _0x12a7cc, document[_0x5f543f(0x49f)]('lt-ui-song-title')['textContent'] = _0x5f5bb0[_0x5f543f(0x63b)][_0x5f543f(0x59a)], document['getElementById'](_0x5f543f(0x2a6))['textContent'] = _0x5f5bb0[_0x5f543f(0x63b)]['歌手'], _0x4e8f7a(_0x5f5bb0), _0x1ace8c[_0x5f543f(0x3c9)][_0x5f543f(0x6b4)] = _0x5f543f(0x5dc), setTimeout(() => _0x1ace8c[_0x5f543f(0x2f1)][_0x5f543f(0x737)](_0x5f543f(0x557)), 0xa), _0x3be0f1[_0x5f543f(0x862)] = _0x5f543f(0x713) + _0x3be0f1[_0x5f543f(0x4b0)](_0x5f543f(0x86c))[_0x5f543f(0x149)], _0x2aa90d[_0x5f543f(0x7f2)][_0x3a9476] && (_0x2aa90d[_0x5f543f(0x7f2)][_0x3a9476][_0x5f543f(0x400)] = !![], _0x3c149c()), _0x9d4a2d(![]), _0xb50273(_0x3e95a, [_0x3e95a]), _0x54d8ed(_0x5f5bb0, !![]); } else _0x407b83[_0x5f543f(0x44b)][_0x38b768] = null, _0x111f24(); } function _0x41c179() { const _0x3a7a48 = _0x12f887, _0xe374f2 = _0x2aa90d[_0x3a7a48(0x22e)][_0x3a7a48(0x349)](_0x405cfb => _0x405cfb['activeListenSession'] && _0x405cfb['activeListenSession']['isActive']); if (_0xe374f2) { if (_0x3a7a48(0x26e) !== 'zIIwE') _0xe374f2[_0x3a7a48(0x843)] = null, _0x16a7ea(), _0x5d65f5(_0x3a7a48(0x664)), _0x54d8ed(), _0x1ace8c[_0x3a7a48(0x2f1)]['remove']('show'), setTimeout(() => _0x1ace8c[_0x3a7a48(0x3c9)][_0x3a7a48(0x6b4)] = _0x3a7a48(0x3d3), 0x12c); else { const _0xc6f16e = _0x1feca1['createElement'](_0x3a7a48(0x359)); _0xc6f16e['src'] = _0x8e1420[_0x3a7a48(0x5ce)], _0xc6f16e[_0x3a7a48(0x612)] = 'lazy', _0xc6f16e[_0x3a7a48(0x63f)] = _0x2253ac[_0x3a7a48(0x2a5)], _0xc6f16e[_0x3a7a48(0x2f1)][_0x3a7a48(0x737)](_0x3a7a48(0x386)), _0xc6f16e[_0x3a7a48(0x179)](_0x3a7a48(0x3e9), () => _0x3734ef(_0x5ab3b9)), _0x534528['appendChild'](_0xc6f16e); } } } function _0x4f127b(_0x14800e) { const _0xfa43f8 = _0x12f887; if (!_0x14800e) return []; const _0x669d7a = _0x14800e[_0xfa43f8(0x804)]('\x0a'), _0x18de24 = [], _0xa9e23d = /\[(\d{2}):(\d{2})\.(\d{2,3})\]/; for (const _0x5eea1f of _0x669d7a) { const _0xe868 = _0x5eea1f[_0xfa43f8(0x85a)](_0xa9e23d); if (_0xe868) { if (_0xfa43f8(0x2a0) !== _0xfa43f8(0x2a0)) _0x38e139(_0xfa43f8(0x276)); else { const _0x42a66f = parseInt(_0xe868[0x1], 0xa), _0x3ef583 = parseInt(_0xe868[0x2], 0xa), _0x580d95 = parseInt(_0xe868[0x3], 0xa) * (_0xe868[0x3][_0xfa43f8(0x45b)] === 0x2 ? 0xa : 0x1), _0x41bdaa = _0x42a66f * 0x3c + _0x3ef583 + _0x580d95 / 0x3e8, _0x3584ff = _0x5eea1f[_0xfa43f8(0x23b)](_0xa9e23d, '')[_0xfa43f8(0x2fe)](); if (_0x3584ff) { if (_0xfa43f8(0x304) !== _0xfa43f8(0x284)) _0x18de24['push']({ 'time': _0x41bdaa, 'text': _0x3584ff }); else { if (_0x3840e5[_0xfa43f8(0x76f)][_0xfa43f8(0x761)](_0x4addef[_0xfa43f8(0x5da)])) _0x2e1eec[_0xfa43f8(0x5f2)] = !![]; } } } } } return _0x18de24; } function _0x4e8f7a(_0x20c718) { const _0xacab9a = _0x12f887; _0x5206e6 = _0x4f127b(_0x20c718['lyrics']), _0xa31af9[_0xacab9a(0x862)] = ''; if (_0x5206e6['length'] === 0x0) { if ('oQKmQ' === _0xacab9a(0x66d)) { _0xa31af9[_0xacab9a(0x862)] = _0xacab9a(0x35c); return; } else { const _0x1ecfec = new _0x14e1ff(_0x3e1cf3); _0x3fb18b = new _0x3ded38(_0xacab9a(0x589), _0x1ecfec[_0xacab9a(0x3d5)] + _0x1ecfec[_0xacab9a(0x746)][_0xacab9a(0x23b)](/\/v1\/?.*$/, ''))[_0xacab9a(0x58a)]; } } _0x5206e6[_0xacab9a(0x242)]((_0xd1df32, _0x12224b) => { const _0x47bbbe = _0xacab9a; if (_0x47bbbe(0x67c) !== _0x47bbbe(0x67c)) _0x20b0ef(), _0x134602(_0x47bbbe(0x257), 'worldBookEditor'); else { const _0x3af1bd = document[_0x47bbbe(0x1a2)]('p'); _0x3af1bd[_0x47bbbe(0x7ea)] = _0xd1df32['text'], _0x3af1bd['id'] = 'lyric-line-' + _0x12224b, _0xa31af9[_0x47bbbe(0x185)](_0x3af1bd); } }); } function _0x1393f3() { const _0x4201a2 = _0x12f887; if (_0x5206e6[_0x4201a2(0x45b)] === 0x0) return; const _0x3d3e6a = _0x40a89f['currentTime']; let _0x5f51ea = -0x1; for (let _0x481f2c = 0x0; _0x481f2c < _0x5206e6[_0x4201a2(0x45b)]; _0x481f2c++) { if (_0x3d3e6a >= _0x5206e6[_0x481f2c][_0x4201a2(0x29e)]) _0x5f51ea = _0x481f2c; else { if ('UCHLl' === 'TTcIv') _0x3775e0[_0x4201a2(0x6eb)](_0x4201a2(0x3d0), _0x1e9a06), _0x5304de(_0x4201a2(0x152) + _0x2f0623['message']); else break; } } if (_0x5f51ea !== -0x1) { if (_0x4201a2(0x243) === 'hQKph') { const _0x3c68e0 = _0xa31af9[_0x4201a2(0x2aa)]('p'); _0x3c68e0['forEach'](_0x45f5ef => _0x45f5ef[_0x4201a2(0x2f1)]['remove'](_0x4201a2(0x48a))); const _0x1bdd06 = document[_0x4201a2(0x49f)]('lyric-line-' + _0x5f51ea); _0x1bdd06 && (_0x1bdd06[_0x4201a2(0x2f1)][_0x4201a2(0x737)](_0x4201a2(0x48a)), _0x1bdd06[_0x4201a2(0x6c7)]({ 'behavior': _0x4201a2(0x279), 'block': 'center' })); } else { const _0x2c5e80 = _0x196d99['getElementById'](_0x4201a2(0x873)); _0x2c5e80[_0x4201a2(0x862)] = ''; const _0x11924d = _0x11cf9b[_0x4201a2(0x857)][_0x4201a2(0x747)](_0x8d7f41 => _0x496f60[_0x4201a2(0x22e)][_0x4201a2(0x2ef)](_0x269d2c => _0x269d2c[_0x4201a2(0x5b4)] === _0x4201a2(0x23d) && _0x269d2c[_0x4201a2(0x6ec)]['includes'](_0x8d7f41['id']))); if (_0x11924d[_0x4201a2(0x45b)] === 0x0) { _0x2c5e80[_0x4201a2(0x862)] = '<p\x20style=\x22text-align:\x20center;\x20color:\x20var(--text-color-light);\x22>还没有可以交换日记的对象。</p>'; return; } _0x11924d[_0x4201a2(0x242)](_0x5f0635 => { const _0x22feb3 = _0x4201a2, _0x5a79e3 = _0x2fabf6['createElement']('li'); _0x5a79e3['className'] = 'character-item', _0x5a79e3[_0x22feb3(0x55a)][_0x22feb3(0x1c7)] = _0x5f0635['id'], _0x5a79e3[_0x22feb3(0x862)] = _0x22feb3(0x2e1) + (_0x5f0635[_0x22feb3(0x5c4)] || _0x381cdf) + '\x22\x20alt=\x22avatar\x22\x20class=\x22char-avatar\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22char-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22char-name\x22>' + _0x5f0635['name'] + _0x22feb3(0x43c), _0x5a79e3[_0x22feb3(0x179)]('click', () => { _0x5d40b7(_0x5f0635['id']); }), _0x2c5e80[_0x22feb3(0x185)](_0x5a79e3); }); } } } _0x2d5e98[_0x12f887(0x179)]('click', () => { const _0x36c875 = _0x12f887; _0x36c875(0x382) !== _0x36c875(0x7a4) ? (_0x1ace8c[_0x36c875(0x2f1)][_0x36c875(0x231)](_0x36c875(0x557)), setTimeout(() => _0x1ace8c[_0x36c875(0x3c9)][_0x36c875(0x6b4)] = 'none', 0x12c)) : (_0x117597[_0x36c875(0x2a5)] = _0x5a790b[_0x36c875(0x2fe)](), _0xacc397(), _0x228fe3(), _0x3377ad(), _0x575e44(_0x36c875(0x2d5) + _0x44485f[_0x36c875(0x2a5)] + '\x22。')); }), document[_0x12f887(0x49f)](_0x12f887(0x74e))['addEventListener'](_0x12f887(0x3e9), () => { const _0x376f8e = _0x12f887; _0x2aa90d[_0x376f8e(0x5c3)] && _0x2aa90d['listenTogetherSession'][_0x376f8e(0x17c)] && (_0x1ace8c['style']['display'] = 'flex', setTimeout(() => _0x1ace8c[_0x376f8e(0x2f1)][_0x376f8e(0x737)](_0x376f8e(0x557)), 0xa)); }), _0x40a89f['addEventListener'](_0x12f887(0x653), _0x1393f3); const _0xd88849 = document[_0x12f887(0x49f)](_0x12f887(0x318)), _0x1314d2 = document[_0x12f887(0x49f)](_0x12f887(0x5e3)), _0x1317d8 = document['getElementById']('widget-prev-btn'); _0xd88849[_0x12f887(0x179)](_0x12f887(0x3e9), () => { const _0x4baf7b = _0x12f887; if (_0x4baf7b(0x177) !== _0x4baf7b(0x5e6)) { if (_0x40a89f[_0x4baf7b(0x54e)]) { if ('jJKAv' === _0x4baf7b(0x7dd)) { const _0x524f7d = _0x1a036d[_0x4baf7b(0x1a2)](_0x4baf7b(0x642)); _0x524f7d[_0x4baf7b(0x399)] = _0x4baf7b(0x201), _0x524f7d['dataset']['id'] = _0x2ee0a5['id']; const _0x520e12 = _0x372558['id'] === _0x4c499e[_0x4baf7b(0x4f4)] ? '\x20(当前)' : ''; _0x524f7d[_0x4baf7b(0x862)] = _0x4baf7b(0x1c2) + (_0x59969b[_0x4baf7b(0x5c4)] || _0x5ba2f6) + _0x4baf7b(0x168) + _0x1b064c['name'] + _0x520e12 + _0x4baf7b(0x574) + _0x1337e3[_0x4baf7b(0x839)]['substring'](0x0, 0x64) + _0x4baf7b(0x17f), _0x524f7d[_0x4baf7b(0x179)]('click', () => _0x449af6(_0x1f3bc1['id'])), _0x53f358[_0x4baf7b(0x185)](_0x524f7d); } else { if (_0x40a89f[_0x4baf7b(0x50a)]) _0x40a89f['play'](); else { if (_0x4baf7b(0x275) === _0x4baf7b(0x7c5)) { _0x4cbd89(![]), _0x25dc43(_0x4baf7b(0x4ee)); return; } else _0x40a89f[_0x4baf7b(0x292)](); } } } } else _0x22f1c0[_0x4baf7b(0x3c9)]['display'] = 'none', _0x298613[_0x4baf7b(0x3c9)]['display'] = _0x4baf7b(0x4b1); }), _0x1314d2[_0x12f887(0x179)]('click', () => { const _0x171847 = _0x12f887; if (_0x171847(0x786) !== 'ZwAFH') { if (_0x446cb5[_0x171847(0x45b)] === 0x0) return; _0x15a98c = (_0x15a98c + 0x1) % _0x446cb5['length'], _0xb50273(_0x446cb5[_0x15a98c], _0x446cb5); } else _0x2953b6['paused'] ? _0x1c185e[_0x171847(0x20c)]() : _0xe94692[_0x171847(0x292)](); }), _0x1317d8['addEventListener']('click', () => { const _0x35db26 = _0x12f887; if (_0x446cb5[_0x35db26(0x45b)] === 0x0) return; _0x15a98c = (_0x15a98c - 0x1 + _0x446cb5[_0x35db26(0x45b)]) % _0x446cb5['length'], _0xb50273(_0x446cb5[_0x15a98c], _0x446cb5); }), _0x40a89f[_0x12f887(0x179)]('play', () => { _0xd88849['textContent'] = '❚❚'; }), _0x40a89f['addEventListener'](_0x12f887(0x292), () => { const _0xdb6086 = _0x12f887; _0xdb6086(0x661) !== _0xdb6086(0x661) ? _0x49de6b() : _0xd88849['textContent'] = '▶'; }), _0x40a89f[_0x12f887(0x179)](_0x12f887(0x79a), () => { const _0x6b98e0 = _0x12f887; _0x6b98e0(0x2f6) === _0x6b98e0(0x2f6) ? _0x1314d2['click']() : _0x13aee3['key'] === _0x6b98e0(0x3c2) && !_0xe102d4[_0x6b98e0(0x5db)] && (_0x56412a[_0x6b98e0(0x2bc)](), _0x31c370()); }), _0x40a89f[_0x12f887(0x179)](_0x12f887(0x20c), () => { const _0x5a589f = _0x12f887; if (_0x5a589f(0x48d) !== _0x5a589f(0x438)) { const _0x477425 = document[_0x5a589f(0x49f)](_0x5a589f(0x6c6)); if (_0x477425) _0x477425[_0x5a589f(0x7ea)] = '❚❚'; } else { const _0x28e458 = _0x210859[_0x5299d3[_0x5a589f(0x45b)] - 0x1]; (!_0xef952 || _0x28e458[_0x5a589f(0x602)] > _0x9498aa['timestamp']) && (_0x51b5b6 = _0x28e458); } }), _0x40a89f[_0x12f887(0x179)](_0x12f887(0x292), () => { const _0x48471a = _0x12f887, _0x3369e3 = document[_0x48471a(0x49f)](_0x48471a(0x6c6)); if (_0x3369e3) _0x3369e3[_0x48471a(0x7ea)] = '▶'; }), _0x40a89f[_0x12f887(0x179)](_0x12f887(0x79a), () => { const _0x25e73e = _0x12f887; if (_0x25e73e(0x608) === _0x25e73e(0x608)) { const _0x51c627 = document[_0x25e73e(0x49f)](_0x25e73e(0x623)); _0x51c627 && _0x51c627[_0x25e73e(0x3e9)](); } else { if (_0x5caa2c[_0x25e73e(0x73f)]) _0x19fda3(_0x32b686[_0x25e73e(0x73f)]); const _0x2a5b5f = _0x482ea3[_0x25e73e(0x232)][_0x25e73e(0x6ce)](_0x25e73e(0x646)); if (!_0x2a5b5f) return; const _0xd5d4d1 = _0x2a5b5f[_0x25e73e(0x55a)][_0x25e73e(0x602)], _0x35e18b = _0x2a5b5f[_0x25e73e(0x2f1)][_0x25e73e(0x6a9)](_0x25e73e(0x821)) ? 'user' : 'ai'; if (!_0xd5d4d1) return; const _0x25b5ea = () => { const _0x5cc2b7 = _0x25e73e; _0x4a35a3[_0x5cc2b7(0x73f)] = _0x5111d8(() => { const _0x5660e3 = _0x5cc2b7; if (_0x5c6f28[_0x5660e3(0x5b4)] === _0x5660e3(0x204)) _0x1e53f9[_0x5660e3(0x2bc)](); _0x232816(_0x1ab4f1(_0xd5d4d1, 0xa), _0x35e18b); }, 0x320); }, _0x195250 = () => { const _0x276143 = _0x25e73e; if (_0x53e3d4[_0x276143(0x73f)]) _0x6f7f6c(_0x1b8ef8[_0x276143(0x73f)]); }; _0x536cbe[_0x25e73e(0x179)](_0x25e73e(0x550), _0x195250, { 'once': !![] }), _0x1811ec[_0x25e73e(0x179)](_0x25e73e(0x3c0), _0x195250, { 'once': !![] }), _0x1c27ce[_0x25e73e(0x179)](_0x25e73e(0x84f), _0x195250, { 'once': !![] }), _0x25b5ea(); } }); function _0x4bbf6e() { const _0x6648a3 = _0x12f887; if (!localStorage['getItem'](_0x6648a3(0x57f))) { if (_0x6648a3(0x42b) === 'zYuSL') { _0x1c19af(_0x6648a3(0x1de))[_0x6648a3(0x7aa)](async _0x12a8a1 => { const _0x597cad = _0x6648a3; if (_0x12a8a1) _0x9d4a2d(!![], '正在升级数据结构...'), await _0x2228fe(), localStorage[_0x597cad(0x1e0)](_0x597cad(0x57f), _0x597cad(0x613)), _0x9d4a2d(![]), _0x5d65f5('升级完成！应用即将刷新。'), setTimeout(() => location[_0x597cad(0x477)](), 0x5dc); else { if ('ZTqQz' === _0x597cad(0x62b)) { const _0x996e = _0x1ec180(_0x27c91b[_0x597cad(0x6ec)][0x0]); return _0x996e?.[_0x597cad(0x2a5)] || 'AI'; } else _0x5d65f5(_0x597cad(0x3f9)); } }); return; } else _0x1f11f8(_0x2b0ce3[_0x6648a3(0x6ec)][0x0]); } const _0x906cf1 = _0x35cb7f(); _0x1e3a6d(), _0x1b3611(), _0xa0a68b(), _0x6a1647(), _0x545c2c(), _0x5aa02b(), _0x5649cc(), _0x4fe083(), _0x42a173(), _0x184d14(), _0x54d8ed(), _0x324f4e(), setInterval(_0x324f4e, 0x7530), _0x2f103c(), _0xd101b6(), _0x19da50(); const _0x9b40b5 = document[_0x6648a3(0x49f)](_0x6648a3(0x2f8)); document['getElementById'](_0x6648a3(0x74e))[_0x6648a3(0x179)]('click', function (_0x519d91) { const _0x198eca = _0x6648a3; if (_0x519d91[_0x198eca(0x232)][_0x198eca(0x6ce)]('button')) { if ('GxtsF' === _0x198eca(0x253)) return _0x198eca(0x7b6) + _0xc4b0f3; else return; } const _0x3ae3b5 = document[_0x198eca(0x49f)](_0x198eca(0x318)); _0x3ae3b5 && _0x3ae3b5[_0x198eca(0x3e9)](); }), _0x381d3b(_0x6648a3(0x5d1), _0x6648a3(0x769)); (_0x906cf1 || _0x2aa90d['characters'][_0x6648a3(0x45b)] === 0x0) && (_0x5d65f5('欢迎！请先创建一个角色开始聊天。'), setTimeout(() => { const _0x2c36d9 = _0x6648a3; _0x381d3b(_0x2c36d9(0x80d), _0x2c36d9(0x5d1)), setTimeout(() => _0xcbfa67(), 0x64); }, 0x6a4)); const _0x5ed91f = document[_0x6648a3(0x49f)](_0x6648a3(0x2b3)); document[_0x6648a3(0x49f)](_0x6648a3(0x51d))['addEventListener'](_0x6648a3(0x3e9), () => _0x5ed91f[_0x6648a3(0x3e9)]()), document[_0x6648a3(0x49f)](_0x6648a3(0x580))[_0x6648a3(0x179)](_0x6648a3(0x3e9), () => { const _0x2e880d = _0x6648a3; _0x2aa90d[_0x2e880d(0x2eb)][_0x2e880d(0x4e2)] = null, _0x16a7ea(), _0x2f103c(), _0x5d65f5(_0x2e880d(0x352)); }), _0x5ed91f[_0x6648a3(0x179)](_0x6648a3(0x220), async _0x56f802 => { const _0x56bbb4 = _0x6648a3, _0x57d6a1 = _0x56f802[_0x56bbb4(0x232)]['files'][0x0]; if (!_0x57d6a1) return; try { if (_0x56bbb4(0x2bd) !== 'BlCJm') { _0x30fbec(_0x56bbb4(0x56c)); return; } else { const _0x579a14 = await _0x2a3cd4(_0x57d6a1); _0x2aa90d['preferences']['widgetBgImage'] = _0x579a14, _0x16a7ea(), _0x2f103c(), _0x5d65f5('小组件背景已更换！'); } } catch (_0x2b55fa) { if ('FhOLo' === _0x56bbb4(0x37a)) { const _0x1b7049 = _0x64bd84['createElement'](_0x56bbb4(0x642)); _0x1b7049[_0x56bbb4(0x399)] = _0x56bbb4(0x565), _0x1b7049[_0x56bbb4(0x862)] = _0x56bbb4(0x4d1) + _0x33feb9[_0x56bbb4(0x44b)]['image'] + _0x56bbb4(0x6a0), _0x1b7049[_0x56bbb4(0x4b0)](_0x56bbb4(0x252))[_0x56bbb4(0x56a)] = () => _0x5323ba(_0x56bbb4(0x33c)), _0x1e7f85[_0x56bbb4(0x185)](_0x1b7049); } else _0x5d65f5(_0x56bbb4(0x2ba) + _0x2b55fa[_0x56bbb4(0x4c4)]); } }), _0x77807f(), document[_0x6648a3(0x49f)](_0x6648a3(0x49c))['addEventListener'](_0x6648a3(0x3e9), () => document[_0x6648a3(0x49f)](_0x6648a3(0x765))[_0x6648a3(0x3e9)]()), document[_0x6648a3(0x49f)]('reset-badge-button')['addEventListener']('click', async () => { const _0xa1f7ee = _0x6648a3; await _0x599d01(_0xa1f7ee(0x6d0)), localStorage[_0xa1f7ee(0x509)](_0xa1f7ee(0x78f)), _0x77807f(), _0x5d65f5(_0xa1f7ee(0x65a)); }), document[_0x6648a3(0x49f)](_0x6648a3(0x765))[_0x6648a3(0x179)](_0x6648a3(0x220), async _0x17545c => { const _0x4f1d0f = _0x6648a3; if ('Odleq' !== _0x4f1d0f(0x473)) { const _0x431d68 = _0x17545c[_0x4f1d0f(0x232)]['files'][0x0]; if (!_0x431d68) return; try { _0x4f1d0f(0x7f6) === _0x4f1d0f(0x7f6) ? (await _0x19d8b8(_0x4f1d0f(0x6d0), _0x431d68), await _0x77807f(), _0x5d65f5(_0x4f1d0f(0x859))) : _0x2acce9[_0x4f1d0f(0x76f)] && (_0x111b7d['linkedWorldBookIds'] = _0x4af761[_0x4f1d0f(0x76f)][_0x4f1d0f(0x747)](_0x5b40a7 => _0x5b40a7 !== _0x3a6807)); } catch (_0x882943) { _0x5d65f5('错误:\x20' + _0x882943[_0x4f1d0f(0x4c4)]); } } else return _0x4562ea['log'](_0x4f1d0f(0x579)), ''; }), _0x4b3f74(), document['getElementById'](_0x6648a3(0x731))[_0x6648a3(0x179)](_0x6648a3(0x44c), _0x224645), document[_0x6648a3(0x49f)]('diary-entries-container')[_0x6648a3(0x179)](_0x6648a3(0x204), _0x224645, { 'passive': ![] }), document['getElementById']('upload-card-button')[_0x6648a3(0x179)](_0x6648a3(0x3e9), () => document['getElementById'](_0x6648a3(0x777))[_0x6648a3(0x3e9)]()), document[_0x6648a3(0x49f)](_0x6648a3(0x7cf))['addEventListener'](_0x6648a3(0x3e9), async () => { const _0x1e2a51 = _0x6648a3; await _0x599d01(_0x1e2a51(0x7c0)), localStorage[_0x1e2a51(0x509)](_0x1e2a51(0x83b)), _0x4b3f74(), _0x5d65f5('卡片已移除。'); }), document[_0x6648a3(0x49f)](_0x6648a3(0x777))[_0x6648a3(0x179)](_0x6648a3(0x220), async _0x53b408 => { const _0x30f73a = _0x6648a3; if (_0x30f73a(0x4cc) !== 'sYrqL') { const _0x21b2e0 = _0x53b408[_0x30f73a(0x232)][_0x30f73a(0x7a2)][0x0]; if (!_0x21b2e0) return; try { await _0x19d8b8(_0x30f73a(0x7c0), _0x21b2e0), await _0x4b3f74(), _0x5d65f5(_0x30f73a(0x7fa)); } catch (_0x36feed) { _0x5d65f5('错误:\x20' + _0x36feed[_0x30f73a(0x4c4)]); } } else { const _0x19dc00 = (_0x5e122a[_0x30f73a(0x547)] ?? _0x4b9a13[_0x30f73a(0x4e6)] ?? _0x4c3d44[_0x30f73a(0x844)] ?? _0x10c667[_0x30f73a(0x326)])?.[_0x30f73a(0x2fe)](); if (_0x19dc00 && _0x250c07[_0x30f73a(0x825)](_0x19dc00)) _0x3f736a[_0x30f73a(0x16a)][_0x30f73a(0x249)]({ 'senderId': _0x30a64d['id'], 'kind': 'sticker', 'sticker': _0x19dc00 }); else { const _0xc03d55 = _0x50ea9d(_0x44b0d6['content'] ?? _0x973d7a[_0x30f73a(0x740)] ?? '')[_0x30f73a(0x2fe)]() || '[sticker:' + (_0x19dc00 || _0x30f73a(0x618)) + ']'; if (_0xc03d55) _0x423401['events']['push']({ 'senderId': _0x4ae4fc['id'], 'kind': _0x30f73a(0x740), 'content': _0xc03d55 }); } } }), document[_0x6648a3(0x49f)]('reset-widgets-position-button')[_0x6648a3(0x179)](_0x6648a3(0x3e9), async () => { const _0x432d90 = _0x6648a3, _0x119b97 = await _0x1c19af(_0x432d90(0x5dd)); _0x119b97 && (localStorage['removeItem'](_0x432d90(0x78f)), localStorage[_0x432d90(0x509)](_0x432d90(0x278)), _0x5d65f5('位置已重置，正在刷新...'), setTimeout(() => location[_0x432d90(0x477)](), 0x3e8)); }); const _0x28c35c = document[_0x6648a3(0x49f)](_0x6648a3(0x344)); _0x28c35c['addEventListener'](_0x6648a3(0x3e9), () => { const _0x369473 = _0x6648a3; _0x314c55(), _0x381d3b(_0x369473(0x698), 'home'); }); const _0x1ff9d6 = document[_0x6648a3(0x49f)](_0x6648a3(0x5af)); _0x1ff9d6[_0x6648a3(0x179)](_0x6648a3(0x3e9), () => { const _0x55f5cc = _0x6648a3; if ('MoFkc' === _0x55f5cc(0x5e2)) _0x1f9be5(), _0x381d3b(_0x55f5cc(0x40e), _0x55f5cc(0x5d1)); else { if (_0x136f57[_0x55f5cc(0x45b)] === 0x0) return; _0x3d2361 = (_0x5c313f - 0x1 + _0x1980aa[_0x55f5cc(0x45b)]) % _0x4eceb6['length'], _0x160a49(_0x5f048c[_0x384a73], _0x68d2ce); } }), document[_0x6648a3(0x49f)](_0x6648a3(0x29a))['addEventListener'](_0x6648a3(0x3e9), () => _0x381d3b(_0x6648a3(0x5d1), _0x6648a3(0x40e))), document[_0x6648a3(0x49f)](_0x6648a3(0x6f8))[_0x6648a3(0x179)]('click', () => _0x381d3b(_0x6648a3(0x5d1), _0x6648a3(0x698))), document[_0x6648a3(0x49f)](_0x6648a3(0x4ed))[_0x6648a3(0x179)]('click', () => { const _0x37a82e = _0x6648a3; _0x2aa90d[_0x37a82e(0x607)] = null, _0x381d3b(_0x37a82e(0x698), _0x37a82e(0x36f)); }), document[_0x6648a3(0x49f)](_0x6648a3(0x336))[_0x6648a3(0x179)]('click', _0x4a4f04), document['getElementById'](_0x6648a3(0x35e))[_0x6648a3(0x179)](_0x6648a3(0x3e9), _0x5018f0), document[_0x6648a3(0x49f)]('diary-entry-input')[_0x6648a3(0x179)](_0x6648a3(0x357), _0x396698 => { const _0x37bcca = _0x6648a3; _0x396698[_0x37bcca(0x691)] === 'Enter' && !_0x396698[_0x37bcca(0x5db)] && (_0x396698[_0x37bcca(0x2bc)](), _0x4a4f04()); }); const _0x2efead = ['normal', _0x6648a3(0x4d2), _0x6648a3(0x4f3), _0x6648a3(0x274), _0x6648a3(0x47a)]; _0x2efead[_0x6648a3(0x242)](_0x1c2977 => { const _0xe5549f = _0x6648a3, _0x1644b0 = document['getElementById'](_0xe5549f(0x3e6) + _0x1c2977 + _0xe5549f(0x4d8)), _0xaca6bc = document[_0xe5549f(0x49f)](_0xe5549f(0x3e6) + _0x1c2977 + _0xe5549f(0x816)); _0x1644b0 && _0xaca6bc && (_0x1644b0[_0xe5549f(0x179)](_0xe5549f(0x3e9), () => _0xaca6bc[_0xe5549f(0x3e9)]()), _0xaca6bc[_0xe5549f(0x179)]('change', async _0x4f4fce => { const _0x373930 = _0xe5549f; if (_0x373930(0x3f3) !== _0x373930(0x572)) { const _0x1f780d = _0x4f4fce[_0x373930(0x232)]['files'][0x0]; if (!_0x1f780d) return; try { _0x1644b0[_0x373930(0x54e)] = URL[_0x373930(0x52d)](_0x1f780d); } catch (_0x4042bd) { _0x5d65f5(_0x373930(0x876) + _0x4042bd[_0x373930(0x4c4)]); } } else _0x40a2c7('chat', _0x373930(0x624)), _0x3cf655(![]); })); }), document[_0x6648a3(0x49f)](_0x6648a3(0x35f))[_0x6648a3(0x179)](_0x6648a3(0x3e9), _0x3b5b73), document['getElementById'](_0x6648a3(0x564))['addEventListener'](_0x6648a3(0x3e9), () => { const _0x576e27 = _0x6648a3; _0x2aa90d['meetingViewMode'] = _0x2aa90d['meetingViewMode'] === _0x576e27(0x351) ? 'galgame' : _0x576e27(0x351), _0x39036a(); }), document[_0x6648a3(0x49f)](_0x6648a3(0x338))[_0x6648a3(0x179)](_0x6648a3(0x44c), _0x550b4a), document['getElementById']('meeting-scene-view')[_0x6648a3(0x179)](_0x6648a3(0x204), _0x550b4a, { 'passive': ![] }); let _0x5c8b4f = null; function _0x550b4a(_0x3dd8b3) { const _0x2c95b6 = _0x6648a3; if (_0x5c8b4f) clearTimeout(_0x5c8b4f); const _0x2ddd89 = _0x3dd8b3[_0x2c95b6(0x232)][_0x2c95b6(0x6ce)](_0x2c95b6(0x829)); if (!_0x2ddd89) return; const _0x256b33 = parseInt(_0x2ddd89['dataset'][_0x2c95b6(0x18a)], 0xa); if (isNaN(_0x256b33)) return; const _0x3076b = () => { _0x5c8b4f = setTimeout(() => { const _0x2e30a2 = _0x3488; if (_0x3dd8b3[_0x2e30a2(0x5b4)] === _0x2e30a2(0x204)) _0x3dd8b3[_0x2e30a2(0x2bc)](); _0x294563(_0x256b33); }, 0x320); }, _0xfa2378 = () => { if (_0x5c8b4f) clearTimeout(_0x5c8b4f); }; document['addEventListener'](_0x2c95b6(0x550), _0xfa2378, { 'once': !![] }), document[_0x2c95b6(0x179)](_0x2c95b6(0x87a), _0xfa2378, { 'once': !![] }), document[_0x2c95b6(0x179)](_0x2c95b6(0x3c0), _0xfa2378, { 'once': !![] }), document[_0x2c95b6(0x179)]('touchcancel', _0xfa2378, { 'once': !![] }), _0x3076b(); } document[_0x6648a3(0x546)][_0x6648a3(0x179)]('click', _0x195581 => { const _0x593fd3 = _0x6648a3, _0x558bff = _0x195581['target'][_0x593fd3(0x6ce)](_0x593fd3(0x455)); if (_0x558bff) { const _0x1db658 = _0x195581[_0x593fd3(0x232)][_0x593fd3(0x6ce)](_0x593fd3(0x34e)), _0x1d3a46 = _0x195581[_0x593fd3(0x232)][_0x593fd3(0x6ce)](_0x593fd3(0x643)); if (_0x1db658) { if (_0x593fd3(0x3b0) !== _0x593fd3(0x20d)) _0x41c179(); else { _0xf5306a = _0x58533f(_0x1afed9[_0x593fd3(0x195)]), _0x30d1c4['innerHTML'] = ''; if (_0x122e40[_0x593fd3(0x45b)] === 0x0) { _0x4c3819[_0x593fd3(0x862)] = _0x593fd3(0x35c); return; } _0x2eca11['forEach']((_0x2ece10, _0x296487) => { const _0xb82e16 = _0x593fd3, _0xb131ef = _0x48479c[_0xb82e16(0x1a2)]('p'); _0xb131ef['textContent'] = _0x2ece10[_0xb82e16(0x740)], _0xb131ef['id'] = _0xb82e16(0x1e2) + _0x296487, _0x26ecc6[_0xb82e16(0x185)](_0xb131ef); }); } } else { if (_0x1d3a46) { const _0x2cccf3 = _0x1d3a46[_0x593fd3(0x6ce)](_0x593fd3(0x3e0)), _0x5cbf73 = _0x1d3a46[_0x593fd3(0x55a)][_0x593fd3(0x48e)], _0x90118c = parseInt(_0x2cccf3[_0x593fd3(0x55a)][_0x593fd3(0x18a)], 0xa); _0xc4c8a0(_0x5cbf73, _0x90118c, _0x558bff); } else { const _0x4b2480 = _0x4adf1c(); _0x4b2480 && _0x4b2480[_0x593fd3(0x843)] && _0x4b2480['activeListenSession'][_0x593fd3(0x17c)] && (_0x593fd3(0x7d1) === _0x593fd3(0x7d1) ? (_0x1ace8c[_0x593fd3(0x3c9)]['display'] = _0x593fd3(0x5dc), setTimeout(() => _0x1ace8c[_0x593fd3(0x2f1)][_0x593fd3(0x737)](_0x593fd3(0x557)), 0xa)) : (_0x496c17 = _0x218de1[_0x593fd3(0x1a2)](_0x593fd3(0x642)), _0x24507f['className'] = _0x593fd3(0x4b2), _0x4b8832['textContent'] = _0x593fd3(0x82e), _0x1a37c4['style'][_0x593fd3(0x37d)] = _0x593fd3(0x5b7), _0x274ee0['style'][_0x593fd3(0x453)] = _0x593fd3(0x18d), _0x550ba3[_0x593fd3(0x3c9)][_0x593fd3(0x77b)] = _0x593fd3(0x271), _0x426068[_0x593fd3(0x185)](_0x3ae9cd))); } } return; } if (window['getSelection']()[_0x593fd3(0x630)]()) return; const _0x554f80 = _0x195581[_0x593fd3(0x232)][_0x593fd3(0x6ce)](_0x593fd3(0x3e0)); if (_0x554f80 && !_0x195581[_0x593fd3(0x232)]['closest']('.no-action-modal')) { const _0x41702a = parseInt(_0x554f80[_0x593fd3(0x55a)][_0x593fd3(0x18a)], 0xa); !isNaN(_0x41702a) && (_0x593fd3(0x611) !== _0x593fd3(0x6f3) ? _0x294563(_0x41702a) : (_0x34819b(![]), _0x4e27b2[_0x593fd3(0x6eb)]('全量导入失败:', _0x413680), _0x5561e2(_0x593fd3(0x5a0) + _0x4c2385['message']))); } }); const _0x13d6ca = document[_0x6648a3(0x49f)](_0x6648a3(0x173)); _0x13d6ca && ('pIavC' === _0x6648a3(0x61f) ? _0x13d6ca[_0x6648a3(0x179)](_0x6648a3(0x3e9), () => { const _0x169272 = _0x6648a3; _0x5d65f5(_0x169272(0x483)); }) : (_0x31b4e7[_0x6648a3(0x3c9)][_0x6648a3(0x482)] = _0x6648a3(0x4ac) + _0x4557f4 + ')', _0x172b35[_0x6648a3(0x3c9)][_0x6648a3(0x639)] = _0x6648a3(0x4ad), _0x58f6b5[_0x6648a3(0x3c9)]['backgroundPosition'] = _0x6648a3(0x437), _0x1a0b6a['style']['color'] = _0x6648a3(0x54a), _0xf90722[_0x6648a3(0x2aa)](_0x6648a3(0x7c2))[_0x6648a3(0x242)](_0x3e3636 => { const _0x28e546 = _0x6648a3; _0x3e3636[_0x28e546(0x3c9)][_0x28e546(0x7f5)] = '0\x201px\x203px\x20rgba(0,0,0,0.6)'; }))); } const _0xf52ff9 = new Promise((_0x392a25, _0x19f9ff) => { const _0x2167a3 = _0x12f887; if (_0x2167a3(0x83d) !== _0x2167a3(0x863)) { const _0x38e184 = indexedDB[_0x2167a3(0x469)](_0x3dc0c7, 0x2); _0x38e184['onerror'] = () => _0x19f9ff('IndexedDB\x20failed\x20to\x20open'), _0x38e184[_0x2167a3(0x431)] = () => _0x392a25(_0x38e184[_0x2167a3(0x4d0)]); } else _0x3a359b['style'][_0x2167a3(0x482)] = 'url(\x27' + _0x1d8996[_0x2167a3(0x52d)](_0x225f1a) + '\x27)', _0xfdfabe[_0x2167a3(0x3c9)]['backgroundSize'] = _0x2167a3(0x4ad), _0x277b06['style'][_0x2167a3(0x286)] = _0x2167a3(0x437); }), _0x1aab5c = _0x12f887(0x184); async function _0xf17b48(_0x4140fa) { const _0x4456ea = await _0xf52ff9; return new Promise((_0xa78bec, _0x3175d9) => { const _0x20b07c = _0x3488, _0x4e1070 = _0x4456ea[_0x20b07c(0x600)](_0x1aab5c, _0x20b07c(0x4ba)), _0x374ac1 = _0x4e1070[_0x20b07c(0x754)](_0x1aab5c), _0x4448c3 = _0x374ac1['get'](_0x4140fa); _0x4448c3['onsuccess'] = () => _0xa78bec(_0x4448c3[_0x20b07c(0x4d0)]), _0x4448c3[_0x20b07c(0x1cf)] = () => _0x3175d9(_0x4448c3['error']); }); } async function _0x2732ef() { const _0x25b27d = await _0xf52ff9; return new Promise((_0x39e3e8, _0x4a808d) => { const _0x1b1590 = _0x3488, _0x4972f8 = _0x25b27d[_0x1b1590(0x600)](_0x1aab5c, 'readonly'), _0x233b3e = _0x4972f8['objectStore'](_0x1aab5c), _0x29df28 = _0x233b3e[_0x1b1590(0x7d4)](); _0x29df28[_0x1b1590(0x431)] = () => _0x39e3e8(_0x29df28[_0x1b1590(0x4d0)]), _0x29df28[_0x1b1590(0x1cf)] = () => _0x4a808d(_0x29df28[_0x1b1590(0x6eb)]); }); } async function _0x17f4fd(_0x48cdfc) { const _0x394723 = _0x12f887; if (_0x394723(0x5b1) !== _0x394723(0x5b1)) _0x423938['chats'] = _0x2a0286[_0x394723(0x22e)], _0x338863['activeChatId'] = _0x58d978[_0x394723(0x544)] || null; else { const _0x58f94b = await _0xf52ff9; return new Promise((_0x10cbb8, _0xa96433) => { const _0x4c9467 = _0x394723; if ('JmWyt' !== 'ZJktT') { const _0x27388d = _0x58f94b[_0x4c9467(0x600)](_0x1aab5c, _0x4c9467(0x795)), _0x298a7a = _0x27388d[_0x4c9467(0x754)](_0x1aab5c), _0x1b8a08 = _0x298a7a[_0x4c9467(0x1d6)](_0x48cdfc); _0x1b8a08[_0x4c9467(0x431)] = () => _0x10cbb8(_0x1b8a08[_0x4c9467(0x4d0)]), _0x1b8a08[_0x4c9467(0x1cf)] = () => _0xa96433(_0x1b8a08[_0x4c9467(0x6eb)]); } else _0x54db3f[_0x4c9467(0x3c9)]['backgroundImage'] = ''; }); } } async function _0x2397e3(_0x4bf25e) { const _0x2eeda5 = await _0xf52ff9; return new Promise((_0x3a91e7, _0x3c7634) => { const _0x50e91c = _0x3488; if (_0x50e91c(0x1e6) === _0x50e91c(0x4f7)) _0x5e6b1e[_0x50e91c(0x846)] = { 'response_mime_type': 'application/json' }; else { const _0xee0530 = _0x2eeda5['transaction'](_0x1aab5c, _0x50e91c(0x795)), _0x286be7 = _0xee0530[_0x50e91c(0x754)](_0x1aab5c), _0x5b90f7 = _0x286be7[_0x50e91c(0x343)](_0x4bf25e); _0x5b90f7[_0x50e91c(0x431)] = () => _0x3a91e7(), _0x5b90f7[_0x50e91c(0x1cf)] = () => _0x3c7634(_0x5b90f7['error']); } }); } let _0xce8daa = { 'audio': null, 'cover': null, 'info': null, 'lyrics': null }; const _0x2f7193 = { 'audio': document[_0x12f887(0x49f)](_0x12f887(0x82f)), 'cover': document['getElementById'](_0x12f887(0x1e9)), 'info': document['getElementById']('altar-slot-info'), 'lyrics': document['getElementById'](_0x12f887(0x22a)) }, _0x3012c3 = { 'audio': document[_0x12f887(0x49f)](_0x12f887(0x2b5)), 'cover': document[_0x12f887(0x49f)](_0x12f887(0x543)), 'info': document[_0x12f887(0x49f)](_0x12f887(0x1fc)), 'lyrics': document[_0x12f887(0x49f)](_0x12f887(0x518)) }; for (const _0x1451f9 in _0x2f7193) { if (_0x12f887(0x394) === _0x12f887(0x5a9)) { const _0x1b7c72 = _0x4c7413(_0x3074f6[_0x12f887(0x4a4)]())['padStart'](0x2, '0'), _0x23b70e = _0x58d521(_0x1d7d54[_0x12f887(0x7eb)]())[_0x12f887(0x2a3)](0x2, '0'); _0x40ded6[_0x12f887(0x7ea)] = _0x1b7c72 + ':' + _0x23b70e; const _0x362606 = _0x4f5b6e[_0x12f887(0x3de)]() + 0x1, _0x553649 = _0x16dfa7[_0x12f887(0x2d7)](), _0x19fd6a = ['星期日', '星期一', '星期二', _0x12f887(0x2c9), _0x12f887(0x6f9), _0x12f887(0x44f), '星期六'][_0x216514['getDay']()]; _0xb63136[_0x12f887(0x7ea)] = _0x362606 + '月' + _0x553649 + '日\x20' + _0x19fd6a; } else _0x2f7193[_0x1451f9][_0x12f887(0x179)](_0x12f887(0x3e9), () => _0x3012c3[_0x1451f9]['click']()), _0x3012c3[_0x1451f9][_0x12f887(0x179)](_0x12f887(0x220), _0x82e758 => { const _0x2908af = _0x12f887; if ('yIlNo' === 'yIlNo') _0x47f31e(_0x1451f9, _0x82e758[_0x2908af(0x232)][_0x2908af(0x7a2)][0x0]); else return _0x43202e[_0x2908af(0x249)](_0x439dfb), _0x409875; }); } function _0x47f31e(_0x111e52, _0x3a6325) { const _0x3c0ec7 = _0x12f887; if (_0x3c0ec7(0x6b8) !== _0x3c0ec7(0x6b8)) _0x3bb398(), _0x2697fd(_0x3c0ec7(0x29f), _0x3c0ec7(0x5d1)); else { if (!_0x3a6325) return; _0xce8daa[_0x111e52] = _0x3a6325, _0x2f7193[_0x111e52]['querySelector'](_0x3c0ec7(0x158))[_0x3c0ec7(0x7ea)] = _0x3a6325['name'], _0x2f7193[_0x111e52][_0x3c0ec7(0x2f1)]['add'](_0x3c0ec7(0x526)), _0x317a8e(); } } function _0x317a8e() { const _0x284731 = _0x12f887, _0x4b66c8 = document['getElementById'](_0x284731(0x43f)); _0xce8daa[_0x284731(0x5e1)] && _0xce8daa[_0x284731(0x63b)] ? _0x4b66c8['disabled'] = ![] : _0x284731(0x1c3) !== _0x284731(0x1c3) ? _0x1487dd = _0x11e437(_0x41d467[_0x284731(0x6ec)][0x0]) : _0x4b66c8[_0x284731(0x849)] = !![]; } function _0x383df0() { const _0xba9abf = _0x12f887; _0xce8daa = { 'audio': null, 'cover': null, 'info': null, 'lyrics': null }; for (const _0x2df973 in _0x2f7193) { _0x2f7193[_0x2df973][_0xba9abf(0x2f1)]['remove'](_0xba9abf(0x526)), _0x3012c3[_0x2df973][_0xba9abf(0x5da)] = ''; } _0x2f7193[_0xba9abf(0x5e1)][_0xba9abf(0x4b0)](_0xba9abf(0x158))['textContent'] = _0xba9abf(0x432), _0x2f7193[_0xba9abf(0x4ad)][_0xba9abf(0x4b0)]('.slot-filename')[_0xba9abf(0x7ea)] = _0xba9abf(0x4f2), _0x2f7193[_0xba9abf(0x63b)][_0xba9abf(0x4b0)](_0xba9abf(0x158))['textContent'] = _0xba9abf(0x582), _0x2f7193[_0xba9abf(0x195)][_0xba9abf(0x4b0)]('.slot-filename')['textContent'] = _0xba9abf(0x30e), _0x317a8e(); } document[_0x12f887(0x49f)]('confirm-altar-upload-button')[_0x12f887(0x179)]('click', async () => { const _0x4c7910 = _0x12f887; if (_0x4c7910(0x321) !== _0x4c7910(0x321)) return _0x29d667 + '分钟前'; else { if (!_0xce8daa[_0x4c7910(0x5e1)] || !_0xce8daa[_0x4c7910(0x63b)]) { _0x5d65f5(_0x4c7910(0x57a)); return; } await _0x26bf91(); } }), document[_0x12f887(0x49f)]('upload-music-button')[_0x12f887(0x179)](_0x12f887(0x3e9), () => { const _0x3bfbaa = _0x12f887; if (_0x3bfbaa(0x7db) !== _0x3bfbaa(0x309)) _0x383df0(), _0x381d3b('musicUploadAltar', _0x3bfbaa(0x40e)); else { const _0x3b00e3 = _0x412da5[_0x3bfbaa(0x600)](_0x316f43, _0x3bfbaa(0x4ba)), _0x182cc4 = _0x3b00e3[_0x3bfbaa(0x754)](_0x192b44), _0x1871bd = _0x182cc4[_0x3bfbaa(0x7d4)](); _0x1871bd[_0x3bfbaa(0x431)] = () => _0x372749(_0x1871bd['result']), _0x1871bd[_0x3bfbaa(0x1cf)] = () => _0x4ff72d(_0x1871bd[_0x3bfbaa(0x6eb)]); } }), document[_0x12f887(0x49f)](_0x12f887(0x875))[_0x12f887(0x179)](_0x12f887(0x3e9), () => { const _0x493948 = _0x12f887; _0x381d3b(_0x493948(0x40e), _0x493948(0x6f2)); }); async function _0x26bf91() { const _0x39eade = _0x12f887; _0x9d4a2d(!![], _0x39eade(0x575)); try { if (_0x39eade(0x3a7) === _0x39eade(0x4b4)) { if (_0xac1bc3[_0x39eade(0x2a5)] === _0x39eade(0x578)) return _0x395b0a[_0x39eade(0x23c)]('Fetch\x20request\x20was\x20aborted.'), ''; throw _0x3cc4a2; } else { const _0x3b8b0a = await _0xce8daa[_0x39eade(0x63b)][_0x39eade(0x740)](), _0x27a648 = JSON[_0x39eade(0x38e)](_0x3b8b0a), _0x3726b0 = 'song_' + (_0x27a648['歌曲ID'] || Date[_0x39eade(0x24a)]()), _0x1cf872 = { 'id': _0x3726b0, 'info': _0x27a648, 'audio': _0xce8daa['audio'], 'cover': _0xce8daa['cover'], 'lyrics': _0xce8daa[_0x39eade(0x195)] ? await _0xce8daa[_0x39eade(0x195)]['text']() : '' }; await _0x17f4fd(_0x1cf872), await _0x1f9be5(), _0x9d4a2d(![]), _0x5d65f5(_0x39eade(0x818) + _0x27a648[_0x39eade(0x59a)] + '”已存入圣殿。'), _0x381d3b(_0x39eade(0x40e), _0x39eade(0x6f2)); } } catch (_0x3ac1cd) { _0x39eade(0x228) === _0x39eade(0x500) ? (_0x52aeb2[_0x39eade(0x6eb)]('动态中的音乐搜索失败:', _0x18cda2), _0xc3bf90['type'] = 'text') : (_0x9d4a2d(![]), console[_0x39eade(0x6eb)](_0x39eade(0x3aa), _0x3ac1cd), _0x5d65f5('上传失败了，笨蛋！\x20' + _0x3ac1cd[_0x39eade(0x4c4)])); } } async function _0x1f9be5() { const _0x1ca4ce = _0x12f887, _0x4d5f26 = document['getElementById']('music-library-container'); _0x4d5f26[_0x1ca4ce(0x862)] = ''; const _0x44373d = await _0x2732ef(); if (_0x44373d['length'] === 0x0) { if (_0x1ca4ce(0x7c1) === _0x1ca4ce(0x7c1)) { _0x4d5f26[_0x1ca4ce(0x862)] = _0x1ca4ce(0x46b); return; } else _0x2fae3f(new _0x254a7a(_0x1ca4ce(0x815))); } _0x44373d[_0x1ca4ce(0x1e7)]((_0x5aaa82, _0xdbb933) => (_0x5aaa82[_0x1ca4ce(0x63b)][_0x1ca4ce(0x59a)] || '')['localeCompare'](_0xdbb933[_0x1ca4ce(0x63b)][_0x1ca4ce(0x59a)] || '')); for (const _0x42fe15 of _0x44373d) { const _0x5a5154 = document[_0x1ca4ce(0x1a2)](_0x1ca4ce(0x642)); _0x5a5154[_0x1ca4ce(0x399)] = _0x1ca4ce(0x3ca), _0x5a5154[_0x1ca4ce(0x55a)]['songId'] = _0x42fe15['id']; const _0x19af9b = _0x42fe15[_0x1ca4ce(0x4ad)] ? URL[_0x1ca4ce(0x52d)](_0x42fe15[_0x1ca4ce(0x4ad)]) : _0x12a7cc; _0x5a5154[_0x1ca4ce(0x862)] = _0x1ca4ce(0x4c7) + _0x19af9b + _0x1ca4ce(0x4c3) + (_0x42fe15[_0x1ca4ce(0x63b)][_0x1ca4ce(0x59a)] || _0x1ca4ce(0x3a0)) + _0x1ca4ce(0x7be) + (_0x42fe15['info']['歌手'] || '未知艺术家') + '</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20'; let _0xfcf004 = null; const _0x5051f7 = _0x1a62ab => { const _0x3dc171 = _0x1ca4ce; if (_0x1a62ab[_0x3dc171(0x7c3)] === 0x2) return; _0xfcf004 = setTimeout(async () => { const _0x31c492 = _0x3dc171; if (_0x1a62ab['type'] === _0x31c492(0x204)) _0x1a62ab[_0x31c492(0x2bc)](); const _0x1861ff = await _0x1c19af(_0x31c492(0x2ea) + _0x42fe15[_0x31c492(0x63b)][_0x31c492(0x59a)] + _0x31c492(0x81f)); _0x1861ff && (_0x31c492(0x722) === _0x31c492(0x6e2) ? _0x356e73 = _0x218c7b : (await _0x2397e3(_0x42fe15['id']), await _0x1f9be5(), _0x5d65f5(_0x31c492(0x688)))); }, 0x320); }, _0x3154e3 = () => { const _0x5b56d5 = _0x1ca4ce; if ('astPp' === _0x5b56d5(0x322)) clearTimeout(_0xfcf004); else { const _0x3b8052 = _0x2e9a9c[_0x5b56d5(0x49f)](_0x5b56d5(0x74d)); _0x3b8052[_0x5b56d5(0x862)] = ''; if (_0x1f096f['friendCircles'][_0x5b56d5(0x45b)] === 0x0) { _0x3b8052[_0x5b56d5(0x862)] = _0x5b56d5(0x5e4); return; } _0x4d7592[_0x5b56d5(0x2d4)][_0x5b56d5(0x242)](_0x75d741 => { const _0x4ee8a4 = _0x5b56d5, _0x3d9d9c = _0x351cfa[_0x4ee8a4(0x47c)][_0x4ee8a4(0x349)](_0x37b08c => _0x37b08c['id'] === _0x75d741[_0x4ee8a4(0x412)]) || { 'name': _0x4ee8a4(0x584) }, _0xcc556 = _0xd474c1[_0x4ee8a4(0x1a2)](_0x4ee8a4(0x642)); _0xcc556[_0x4ee8a4(0x399)] = _0x4ee8a4(0x201), _0xcc556[_0x4ee8a4(0x55a)]['id'] = _0x75d741['id'], _0xcc556['innerHTML'] = _0x4ee8a4(0x6f0) + _0x75d741[_0x4ee8a4(0x2a5)] + _0x4ee8a4(0x259) + _0x3d9d9c[_0x4ee8a4(0x2a5)] + _0x4ee8a4(0x586) + _0x75d741[_0x4ee8a4(0x40b)][_0x4ee8a4(0x45b)] + _0x4ee8a4(0x489), _0xcc556[_0x4ee8a4(0x179)](_0x4ee8a4(0x3e9), () => _0x56b01c(_0x75d741['id'])), _0x3b8052[_0x4ee8a4(0x185)](_0xcc556); }); } }; _0x5a5154[_0x1ca4ce(0x179)]('mousedown', _0x5051f7), _0x5a5154[_0x1ca4ce(0x179)](_0x1ca4ce(0x550), _0x3154e3), _0x5a5154[_0x1ca4ce(0x179)]('mouseleave', _0x3154e3), _0x5a5154[_0x1ca4ce(0x179)](_0x1ca4ce(0x204), _0x5051f7, { 'passive': ![] }), _0x5a5154[_0x1ca4ce(0x179)](_0x1ca4ce(0x3c0), _0x3154e3), _0x5a5154[_0x1ca4ce(0x179)](_0x1ca4ce(0x84f), _0x3154e3), _0x5a5154[_0x1ca4ce(0x179)](_0x1ca4ce(0x3e9), _0x3f2f2b => { const _0x3789c4 = _0x1ca4ce; if (_0xfcf004) clearTimeout(_0xfcf004); if (_0x3f2f2b[_0x3789c4(0x701)]) return; setTimeout(() => { _0xfcf004 && _0xb50273(_0x42fe15['id'], _0x44373d['map'](_0x20da50 => _0x20da50['id'])); }, 0x32); }), _0x4d5f26[_0x1ca4ce(0x185)](_0x5a5154); } } _0x1314d2[_0x12f887(0x179)]('click', () => { _0x5d65f5('说了是摆设啦，笨蛋。'); }), _0x1317d8['addEventListener']('click', () => { const _0x5a179f = _0x12f887; if ('OAxlA' !== _0x5a179f(0x79c)) _0x5d65f5(_0x5a179f(0x276)); else { const _0x26f697 = _0x327bb1[_0x5a179f(0x691)](_0xa570ab); if (_0x26f697) _0x24d8ba[_0x5a179f(0x3f6)][_0x26f697] = _0x4d160[_0x5a179f(0x70e)](_0x26f697); } }); let _0x446cb5 = [], _0x15a98c = -0x1; async function _0xb50273(_0x5b7034, _0x38bf87) { const _0x453571 = _0x12f887, _0x81e6c3 = await _0xf17b48(_0x5b7034); if (!_0x81e6c3) return; _0xe08ea7 = { 'title': _0x81e6c3['info'][_0x453571(0x59a)] || '未知歌曲', 'artist': _0x81e6c3[_0x453571(0x63b)]['歌手'] || _0x453571(0x32c), 'cover': _0x81e6c3['cover'] ? URL['createObjectURL'](_0x81e6c3[_0x453571(0x4ad)]) : _0x12a7cc, 'isFromLibrary': !![] }; const _0x26dd13 = URL[_0x453571(0x52d)](_0x81e6c3[_0x453571(0x5e1)]); _0x40a89f[_0x453571(0x54e)] = _0x26dd13, _0x40a89f['play'](), _0x54d8ed(); } async function _0x54d8ed() { const _0xf238d0 = _0x12f887, _0x5d255e = document[_0xf238d0(0x49f)](_0xf238d0(0x302)), _0x35cc19 = document[_0xf238d0(0x49f)](_0xf238d0(0x47f)), _0x26bdbc = document[_0xf238d0(0x49f)](_0xf238d0(0x7dc)), _0xdaeaac = document[_0xf238d0(0x49f)](_0xf238d0(0x696)), _0x590b58 = document['getElementById'](_0xf238d0(0x318)); _0x5d255e[_0xf238d0(0x2f1)]['remove'](_0xf238d0(0x2c8)); const _0x4343b9 = _0xe08ea7; _0x4343b9 && _0x4343b9[_0xf238d0(0x651)] ? _0xf238d0(0x1b2) === _0xf238d0(0x75b) ? _0x1cc487[_0xf238d0(0x73f)] = _0x3b9251(() => { const _0x27f91a = _0xf238d0; if (_0x3e4b0f[_0x27f91a(0x5b4)] === _0x27f91a(0x204)) _0x2270e3[_0x27f91a(0x2bc)](); _0x58b176(_0x3b0113(_0x55090d, 0xa), _0x2430ca); }, 0x320) : (_0x35cc19[_0xf238d0(0x7ea)] = _0x4343b9['title'], _0x26bdbc[_0xf238d0(0x7ea)] = _0x4343b9[_0xf238d0(0x347)], _0xdaeaac[_0xf238d0(0x3c9)][_0xf238d0(0x482)] = _0xf238d0(0x4ac) + _0x4343b9[_0xf238d0(0x4ad)] + ')', _0x590b58[_0xf238d0(0x7ea)] = _0x40a89f[_0xf238d0(0x50a)] ? '▶' : '❚❚', _0x40a89f['paused'] ? _0xdaeaac[_0xf238d0(0x2f1)][_0xf238d0(0x231)](_0xf238d0(0x18e)) : _0xdaeaac[_0xf238d0(0x2f1)]['add'](_0xf238d0(0x18e))) : (_0x35cc19['textContent'] = _0xf238d0(0x68f), _0x26bdbc['textContent'] = _0xf238d0(0x55d), _0xdaeaac[_0xf238d0(0x3c9)][_0xf238d0(0x482)] = '', _0x590b58[_0xf238d0(0x7ea)] = '▶'); } _0x1314d2 && _0x1314d2[_0x12f887(0x179)]('click', () => { const _0x3fad75 = _0x12f887; if (_0x446cb5[_0x3fad75(0x45b)] === 0x0) return; _0x15a98c = (_0x15a98c + 0x1) % _0x446cb5[_0x3fad75(0x45b)], _0xb50273(_0x446cb5[_0x15a98c], _0x446cb5); }); if (_0x1317d8) { if (_0x12f887(0x861) !== _0x12f887(0x635)) _0x1317d8['addEventListener'](_0x12f887(0x3e9), () => { const _0x5ec5aa = _0x12f887; if (_0x5ec5aa(0x73e) !== _0x5ec5aa(0x73e)) _0x1aa862(_0x5ec5aa(0x4db)); else { if (_0x446cb5[_0x5ec5aa(0x45b)] === 0x0) return; _0x15a98c = (_0x15a98c - 0x1 + _0x446cb5[_0x5ec5aa(0x45b)]) % _0x446cb5['length'], _0xb50273(_0x446cb5[_0x15a98c], _0x446cb5); } }); else { if (_0x3c37d8) _0x20ee51(_0x456bcd); const _0x5563ca = _0x3f48cb[_0x12f887(0x232)]['closest'](_0x12f887(0x829)); if (!_0x5563ca) return; const _0x2a3bbf = _0x32b517(_0x5563ca[_0x12f887(0x55a)][_0x12f887(0x18a)], 0xa); if (_0x572e74(_0x2a3bbf)) return; const _0x1d87eb = () => { _0x3a74be = _0x5bbe03(() => { const _0x5658c9 = _0x3488; if (_0xe2e6b9[_0x5658c9(0x5b4)] === 'touchstart') _0x150afa['preventDefault'](); _0x2f8330(_0x2a3bbf); }, 0x320); }, _0x244162 = () => { if (_0x26bf53) _0x526f88(_0x11ca81); }; _0xbdcbbe[_0x12f887(0x179)](_0x12f887(0x550), _0x244162, { 'once': !![] }), _0x5262d7[_0x12f887(0x179)](_0x12f887(0x87a), _0x244162, { 'once': !![] }), _0x6131d5['addEventListener'](_0x12f887(0x3c0), _0x244162, { 'once': !![] }), _0x4a1b3a[_0x12f887(0x179)](_0x12f887(0x84f), _0x244162, { 'once': !![] }), _0x1d87eb(); } } _0x40a89f[_0x12f887(0x179)](_0x12f887(0x20c), () => { const _0x57db62 = _0x12f887; if (_0xd88849) _0xd88849[_0x57db62(0x7ea)] = '❚❚'; }), _0x40a89f[_0x12f887(0x179)](_0x12f887(0x292), () => { const _0xfac9d1 = _0x12f887; if (_0xd88849) _0xd88849[_0xfac9d1(0x7ea)] = '▶'; }), _0x40a89f[_0x12f887(0x179)](_0x12f887(0x79a), () => { const _0x52304c = _0x12f887; if (_0x52304c(0x47d) !== _0x52304c(0x576)) { if (_0x1314d2) _0x1314d2[_0x52304c(0x3e9)](); } else { const _0x419db0 = _0xb358c4['getElementById'](_0x52304c(0x623)); _0x419db0 && _0x419db0[_0x52304c(0x3e9)](); } }); function _0x3f26ea() { const _0x5c54d4 = _0x12f887; if (_0x5c54d4(0x1dd) !== _0x5c54d4(0x38b)) { const _0x1dbca7 = _0x4adf1c(); if (!_0x1dbca7) return; _0x3faa7f[_0x5c54d4(0x862)] = '', _0x1eb195['value'] = ''; if (_0x1dbca7[_0x5c54d4(0x5b4)] === _0x5c54d4(0x67a)) { if ('xDCZf' === _0x5c54d4(0x514)) _0x1dbca7['participantIds'][_0x5c54d4(0x242)](_0x129875 => { const _0x3db6a1 = _0x5c54d4; if (_0x3db6a1(0x542) === _0x3db6a1(0x7a6)) _0x6961b3[_0x3db6a1(0x3c9)]['textShadow'] = ''; else { const _0x7534f3 = _0x1c2a48(_0x129875); if (_0x7534f3) { if ('RDVQZ' === _0x3db6a1(0x314)) { const _0xe9a1ff = _0x2d4429[_0x3db6a1(0x600)](_0x15a81d, _0x3db6a1(0x795)), _0x2eee20 = _0xe9a1ff[_0x3db6a1(0x754)](_0x165825), _0x2d4c2a = _0x2eee20[_0x3db6a1(0x1d6)](_0xa2e0ff); _0x2d4c2a[_0x3db6a1(0x431)] = () => _0x2ee9b8(_0x2d4c2a['result']), _0x2d4c2a[_0x3db6a1(0x1cf)] = () => _0x580842(_0x2d4c2a[_0x3db6a1(0x6eb)]); } else { const _0x33002d = document[_0x3db6a1(0x1a2)](_0x3db6a1(0x457)); _0x33002d[_0x3db6a1(0x5da)] = _0x7534f3['id'], _0x33002d[_0x3db6a1(0x7ea)] = _0x7534f3['name'], _0x3faa7f[_0x3db6a1(0x185)](_0x33002d); } } } }), _0x47ad06[_0x5c54d4(0x3c9)]['display'] = _0x5c54d4(0x4b1); else { _0x3fc7ab(_0x5c54d4(0x5c7)); return; } } else _0x47ad06[_0x5c54d4(0x3c9)][_0x5c54d4(0x6b4)] = _0x5c54d4(0x3d3); _0x23688b['classList'][_0x5c54d4(0x737)](_0x5c54d4(0x557)), _0x1eb195[_0x5c54d4(0x530)](); } else { const _0x5daa5b = _0xf48c7a[_0x5c54d4(0x6ce)](_0x5c54d4(0x3e0)), _0x4d1995 = _0x87be6b[_0x5c54d4(0x55a)][_0x5c54d4(0x48e)], _0x121846 = _0x29491d(_0x5daa5b[_0x5c54d4(0x55a)][_0x5c54d4(0x18a)], 0xa); _0x3a2c68(_0x4d1995, _0x121846, _0x2f5f31); } } function _0x22286e() { const _0x5869d7 = _0x12f887, _0x1bb39e = parseFloat(_0x1eb195[_0x5869d7(0x5da)]); if (isNaN(_0x1bb39e) || _0x1bb39e <= 0x0) { _0x5d65f5(_0x5869d7(0x686)); return; } const _0x389c57 = _0x4adf1c(); let _0x2b52c5 = null; _0x389c57[_0x5869d7(0x5b4)] === 'group' ? _0x5869d7(0x725) === _0x5869d7(0x80e) ? (_0x591b30[_0x5869d7(0x3c9)][_0x5869d7(0x482)] = 'url(' + _0x3534c8[_0x5869d7(0x52d)](_0x40c70b) + ')', _0x4bbadd[_0x5869d7(0x3c9)][_0x5869d7(0x639)] = _0x5869d7(0x4ad), _0x274423[_0x5869d7(0x3c9)][_0x5869d7(0x286)] = _0x5869d7(0x437)) : _0x2b52c5 = _0x3faa7f['value'] : _0x2b52c5 = _0x389c57[_0x5869d7(0x6ec)][0x0]; const _0x24d423 = _0x5cb17e(_0x389c57['id']), _0x462cdd = { 'role': _0x5869d7(0x821), 'type': _0x5869d7(0x441), 'content': '[用户向\x20' + (_0x1c2a48(_0x2b52c5)?.['name'] || '未知') + '\x20转账\x20' + _0x1bb39e + ']', 'amount': _0x1bb39e, 'recipientId': _0x2b52c5, 'senderId': _0x24d423['id'], 'timestamp': Date['now']() }; _0x2aa90d[_0x5869d7(0x7f2)][_0x5869d7(0x249)](_0x462cdd), _0x3c149c(), _0x42745f(), _0x23688b[_0x5869d7(0x2f1)][_0x5869d7(0x231)](_0x5869d7(0x557)); } _0x4bbf6e(); }); async function _0x2228fe() { const _0x168cbe = _0x457b7e; console[_0x168cbe(0x23c)](_0x168cbe(0x3b2)), console[_0x168cbe(0x23c)](_0x168cbe(0x218)); const _0x4b6fa4 = 'Noir_FileSystem', _0x46f158 = 'images', _0x55ee71 = new Promise((_0x3ca7f3, _0x42ebab) => { const _0x24dea1 = _0x168cbe, _0x770d5c = indexedDB['open'](_0x4b6fa4, 0x2); _0x770d5c[_0x24dea1(0x1cf)] = () => _0x42ebab(_0x24dea1(0x3f4)), _0x770d5c['onsuccess'] = () => _0x3ca7f3(_0x770d5c[_0x24dea1(0x4d0)]), _0x770d5c[_0x24dea1(0x66b)] = _0x4d7f37 => { const _0x1ace08 = _0x24dea1, _0x2acb01 = _0x4d7f37[_0x1ace08(0x232)][_0x1ace08(0x4d0)]; !_0x2acb01[_0x1ace08(0x32f)][_0x1ace08(0x6a9)](_0x46f158) && _0x2acb01['createObjectStore'](_0x46f158, { 'keyPath': 'id' }), !_0x2acb01[_0x1ace08(0x32f)]['contains']('music_library') && _0x2acb01[_0x1ace08(0x50e)]('music_library', { 'keyPath': 'id' }); }; }); async function _0x124cec(_0x4de761, _0x55421) { const _0x117d85 = _0x168cbe; if (_0x117d85(0x552) === _0x117d85(0x552)) { const _0x5d0544 = await _0x55ee71; return new Promise((_0x21b2c3, _0x19dc30) => { const _0x47a584 = _0x117d85, _0x11bb92 = _0x5d0544['transaction'](_0x46f158, 'readwrite'), _0x3240ef = _0x11bb92[_0x47a584(0x754)](_0x46f158), _0x440a53 = _0x3240ef['put']({ 'id': _0x4de761, 'blob': _0x55421 }); _0x440a53[_0x47a584(0x431)] = () => _0x21b2c3(_0x440a53[_0x47a584(0x4d0)]), _0x440a53[_0x47a584(0x1cf)] = () => _0x19dc30(_0x440a53[_0x47a584(0x6eb)]); }); } else { const _0x2a644c = _0x47431c[_0x117d85(0x600)](_0x51c3c3, 'readwrite'), _0x459e01 = _0x2a644c['objectStore'](_0x167627), _0x14c7e8 = _0x459e01['put']({ 'id': _0x141932, 'blob': _0xfa2338 }); _0x14c7e8[_0x117d85(0x431)] = () => _0x12e3d4(_0x14c7e8[_0x117d85(0x4d0)]), _0x14c7e8['onerror'] = () => _0x293468(_0x14c7e8[_0x117d85(0x6eb)]); } } function _0x39ac2c(_0x3b81c3) { const _0x2aef81 = _0x168cbe; return fetch(_0x3b81c3)[_0x2aef81(0x7aa)](_0x1f0d55 => _0x1f0d55['blob']()); } let _0x21431a = 0x0; for (let _0x29e0ab = 0x0; _0x29e0ab < localStorage[_0x168cbe(0x45b)]; _0x29e0ab++) { const _0x2e4b38 = localStorage[_0x168cbe(0x691)](_0x29e0ab); if (_0x2e4b38 && _0x2e4b38[_0x168cbe(0x5b6)](_0x168cbe(0x224))) { let _0x25c6ae, _0x4c88cf = ![]; try { _0x25c6ae = JSON[_0x168cbe(0x38e)](localStorage[_0x168cbe(0x70e)](_0x2e4b38)); if (!Array[_0x168cbe(0x4d3)](_0x25c6ae)) continue; for (const _0x154283 of _0x25c6ae) { if (_0x168cbe(0x748) === _0x168cbe(0x360)) { const _0x4b1e57 = _0x588bdc[_0x168cbe(0x232)][_0x168cbe(0x4d0)]; !_0x4b1e57[_0x168cbe(0x32f)][_0x168cbe(0x6a9)](_0x18c2bb) && _0x4b1e57[_0x168cbe(0x50e)](_0x1a602a, { 'keyPath': 'id' }); const _0x148157 = _0x168cbe(0x184); !_0x4b1e57[_0x168cbe(0x32f)][_0x168cbe(0x6a9)](_0x148157) && _0x4b1e57[_0x168cbe(0x50e)](_0x148157, { 'keyPath': 'id' }); } else { if (_0x154283 && _0x154283[_0x168cbe(0x33c)] && _0x154283['image'][_0x168cbe(0x5b6)]('data:image')) { const _0x3e111f = await _0x39ac2c(_0x154283[_0x168cbe(0x33c)]), _0xfaaf26 = _0x168cbe(0x533) + Date['now']() + '_' + Math['random'](); await _0x124cec(_0xfaaf26, _0x3e111f), _0x154283[_0x168cbe(0x6fa)] = _0xfaaf26, delete _0x154283[_0x168cbe(0x33c)], _0x4c88cf = !![], _0x21431a++; } } } _0x4c88cf && localStorage[_0x168cbe(0x1e0)](_0x2e4b38, JSON[_0x168cbe(0x46d)](_0x25c6ae)); } catch (_0x362cc5) { console[_0x168cbe(0x6eb)](_0x168cbe(0x3fe) + _0x2e4b38 + _0x168cbe(0x5df), _0x362cc5); continue; } } } console['log']('净化完成！总共迁移了\x20' + _0x21431a + _0x168cbe(0x488)); } function _0x5d8686() { const _0x45382d = _0x457b7e; if (!_0x2aa90d[_0x45382d(0x607)]) { if (_0x45382d(0x4cd) !== _0x45382d(0x440)) return _0x2aa90d[_0x45382d(0x47c)][_0x45382d(0x349)](_0x5139e2 => _0x5139e2['id'] === _0x2aa90d[_0x45382d(0x4f4)]) || _0x2aa90d['userProfiles'][0x0]; else _0x43f9e0[_0x45382d(0x6ec)][_0x45382d(0x242)](_0x5ee3e1 => { const _0x446855 = _0x45382d, _0x121887 = _0x4125ee(_0x5ee3e1); if (_0x121887) { const _0x4407d4 = _0x2e8830[_0x446855(0x1a2)]('option'); _0x4407d4[_0x446855(0x5da)] = _0x121887['id'], _0x4407d4['textContent'] = _0x121887['name'], _0x57545d['appendChild'](_0x4407d4); } }), _0x332bf7[_0x45382d(0x3c9)][_0x45382d(0x6b4)] = _0x45382d(0x4b1); } const _0x42e4a5 = _0x2aa90d['chats'][_0x45382d(0x349)](_0x27fe9d => _0x27fe9d[_0x45382d(0x5b4)] === _0x45382d(0x23d) && _0x27fe9d[_0x45382d(0x6ec)]['includes'](_0x2aa90d[_0x45382d(0x607)])), _0x56599b = _0x42e4a5?.[_0x45382d(0x412)] || _0x2aa90d[_0x45382d(0x4f4)]; return _0x2aa90d['userProfiles']['find'](_0x1529e4 => _0x1529e4['id'] === _0x56599b) || _0x2aa90d['userProfiles'][0x0]; } function _0x3b751e(_0x5ee6b0) { const _0x386da2 = _0x457b7e, _0x44abfb = new Date(), _0x5d05fd = _0x44abfb - _0x5ee6b0, _0x50731e = Math[_0x386da2(0x6a1)](_0x5d05fd / 0x3e8), _0x1ee3eb = Math[_0x386da2(0x6a1)](_0x50731e / 0x3c), _0x42c670 = Math[_0x386da2(0x6a1)](_0x1ee3eb / 0x3c), _0x4dcb27 = Math[_0x386da2(0x6a1)](_0x42c670 / 0x18), _0x4aaf4c = _0x5ee6b0['toLocaleTimeString'](_0x386da2(0x49e), { 'hour': _0x386da2(0x704), 'minute': '2-digit' }); if (_0x50731e < 0x3c) { if (_0x386da2(0x2d3) === _0x386da2(0x2d3)) return '刚才'; else { const _0x4ab4e0 = _0x2dc743['transaction'](_0x4e3b70, _0x386da2(0x795)), _0x379f07 = _0x4ab4e0[_0x386da2(0x754)](_0x1c1d86), _0x259a73 = _0x379f07[_0x386da2(0x1d6)]({ 'id': _0x3b05d1, 'blob': _0x2d8df6 }); _0x259a73[_0x386da2(0x431)] = () => _0x5a6d3d(_0x259a73[_0x386da2(0x4d0)]), _0x259a73[_0x386da2(0x1cf)] = () => _0x3054b6(_0x259a73['error']); } } if (_0x1ee3eb < 0x3c) { if (_0x386da2(0x82a) !== _0x386da2(0x595)) return _0x1ee3eb + _0x386da2(0x5cd); else _0x4a949f[_0x386da2(0x3c9)][_0x3796ea] = _0x4a4a46[_0xf3d775]; } const _0x103c19 = _0x44abfb[_0x386da2(0x6dd)]() === _0x5ee6b0['toDateString'](); if (_0x103c19) { if (_0x386da2(0x4a9) !== 'NrUpe') return '今天\x20' + _0x4aaf4c; else { if (!_0x497e84[_0x386da2(0x2d4)] || _0x1631e9[_0x386da2(0x2d4)][_0x386da2(0x45b)] === 0x0) { _0x2adbb7[_0x386da2(0x6eb)](_0x386da2(0x826)); return; } const _0x20fc33 = _0x3960fb[_0x386da2(0x2d4)][0x0]; if (_0x20fc33[_0x386da2(0x40b)]['length'] < 0x2) { _0x5c9fc5[_0x386da2(0x6eb)](_0x386da2(0x562) + _0x20fc33['name'] + _0x386da2(0x31d)); return; } const _0x403904 = { 'id': _0x386da2(0x4fd) + _0x16c3f3[_0x386da2(0x24a)](), 'authorType': _0x386da2(0x7a8), 'authorId': _0x20fc33['memberCharacterIds'][0x0], 'content': _0x386da2(0x510), 'timestamp': _0x1583cc[_0x386da2(0x24a)](), 'likes': [_0x20fc33[_0x386da2(0x40b)][0x1]], 'comments': [{ 'commentId': 'c_' + _0x141e7f[_0x386da2(0x24a)](), 'authorId': _0x20fc33[_0x386da2(0x40b)][0x1], 'content': _0x386da2(0x5ef) }] }; _0x20fc33[_0x386da2(0x6fe)][_0x386da2(0x249)](_0x403904), _0x310eed(), _0x209774[_0x386da2(0x23c)]('成功向好友圈\x20\x22' + _0x20fc33[_0x386da2(0x2a5)] + _0x386da2(0x4d7)), _0x4dec7b('测试动态已添加！'); } } const _0x8a9e1c = new Date(); _0x8a9e1c[_0x386da2(0x62a)](_0x44abfb[_0x386da2(0x2d7)]() - 0x1); const _0x5e60a2 = _0x8a9e1c[_0x386da2(0x6dd)]() === _0x5ee6b0[_0x386da2(0x6dd)](); if (_0x5e60a2) return _0x386da2(0x7b6) + _0x4aaf4c; if (_0x4dcb27 <= 0x7) { const _0x4f7b89 = [_0x386da2(0x5cc), '星期一', _0x386da2(0x72e), _0x386da2(0x2c9), '星期四', _0x386da2(0x44f), _0x386da2(0x4c9)]; return _0x4f7b89[_0x5ee6b0[_0x386da2(0x87b)]()] + '\x20' + _0x4aaf4c; } return _0x5ee6b0[_0x386da2(0x375)]() + '年' + (_0x5ee6b0[_0x386da2(0x3de)]() + 0x1) + '月' + _0x5ee6b0[_0x386da2(0x2d7)]() + '日'; } function _0x52a43d(_0x5e6c2f, _0x39df4e = 0x320, _0x358f32 = 0.8, _0xb4e18f = ![]) { return new Promise((_0x56a7e0, _0x32b6f4) => { const _0x3a4c4b = _0x3488; if (!_0x5e6c2f || !_0x5e6c2f[_0x3a4c4b(0x5b4)][_0x3a4c4b(0x5b6)](_0x3a4c4b(0x596))) { if (_0x3a4c4b(0x69c) !== 'dxpAL') _0x347423[_0x3a4c4b(0x6ec)] = _0x5b046d[_0x3a4c4b(0x6ec)][_0x3a4c4b(0x747)](_0x3116b => _0x3116b !== _0x26f68c); else return _0x32b6f4(new Error(_0x3a4c4b(0x397))); } const _0x325e8b = new FileReader(); _0x325e8b[_0x3a4c4b(0x329)](_0x5e6c2f), _0x325e8b[_0x3a4c4b(0x1b1)] = _0x252574 => { const _0x1a771b = _0x3a4c4b, _0x356e35 = new Image(); _0x356e35[_0x1a771b(0x54e)] = _0x252574[_0x1a771b(0x232)][_0x1a771b(0x4d0)], _0x356e35[_0x1a771b(0x1b1)] = () => { const _0x39d284 = _0x1a771b, _0x3fa297 = document[_0x39d284(0x1a2)](_0x39d284(0x4d4)); let _0x42eb80 = _0x356e35['width'], _0x54480e = _0x356e35[_0x39d284(0x203)]; if (_0x42eb80 > _0x54480e) _0x42eb80 > _0x39df4e && (_0x54480e *= _0x39df4e / _0x42eb80, _0x42eb80 = _0x39df4e); else { if (_0x54480e > _0x39df4e) { if (_0x39d284(0x58c) === _0x39d284(0x58c)) _0x42eb80 *= _0x39df4e / _0x54480e, _0x54480e = _0x39df4e; else { const _0x4b1189 = _0x33280d[_0x39d284(0x49f)](_0x39d284(0x66a)); if (!_0x4b1189) return; _0x17c4d0[_0x39d284(0x2eb)]['forceWhiteClock'] ? (_0x4b1189[_0x39d284(0x3c9)][_0x39d284(0x416)] = _0x39d284(0x43e), _0x4b1189['style'][_0x39d284(0x7f5)] = _0x39d284(0x433)) : (_0x4b1189[_0x39d284(0x3c9)]['color'] = _0x39d284(0x5f5), _0x4b1189[_0x39d284(0x3c9)][_0x39d284(0x7f5)] = _0x39d284(0x3d3)); } } } _0x3fa297[_0x39d284(0x6ed)] = _0x42eb80, _0x3fa297[_0x39d284(0x203)] = _0x54480e; const _0x52542c = _0x3fa297[_0x39d284(0x659)]('2d'); _0x52542c[_0x39d284(0x3ea)](_0x356e35, 0x0, 0x0, _0x42eb80, _0x54480e); const _0x3d4667 = _0x5e6c2f[_0x39d284(0x5b4)] === _0x39d284(0x2df) ? _0x39d284(0x2df) : 'image/jpeg'; _0xb4e18f ? _0x3fa297['toBlob'](_0x50674d => { const _0x1bf80e = _0x39d284; _0x1bf80e(0x393) !== 'fJgCA' ? (_0x190c16(), _0x28c1ed(_0x1bf80e(0x225), 'music')) : _0x50674d ? _0x56a7e0(_0x50674d) : _0x32b6f4(new Error('Canvas\x20to\x20Blob\x20conversion\x20failed.')); }, _0x3d4667, _0x358f32) : _0x39d284(0x26d) !== _0x39d284(0x26d) ? _0x300325[_0x39d284(0x7ea)] = '❚❚' : _0x56a7e0(_0x3fa297[_0x39d284(0x733)](_0x3d4667, _0x358f32)); }, _0x356e35[_0x1a771b(0x1cf)] = _0x44e8e4 => _0x32b6f4(_0x44e8e4); }, _0x325e8b[_0x3a4c4b(0x1cf)] = _0x5d69a7 => _0x32b6f4(_0x5d69a7); }); } function _0x59aa76(_0x5af03f) { return new Promise((_0x53f64b, _0x23a3cb) => { const _0x5b21dc = _0x3488, _0x593573 = new FileReader(); _0x593573['onloadend'] = () => _0x53f64b(_0x593573[_0x5b21dc(0x4d0)]), _0x593573[_0x5b21dc(0x1cf)] = _0x23a3cb, _0x593573[_0x5b21dc(0x329)](_0x5af03f); }); } function _0x59aa76(_0x2e3b7e) { return new Promise((_0x4c85f2, _0x1236b8) => { const _0x455bfb = _0x3488, _0xbc2f86 = new FileReader(); _0xbc2f86[_0x455bfb(0x65d)] = () => _0x4c85f2(_0xbc2f86[_0x455bfb(0x4d0)]), _0xbc2f86[_0x455bfb(0x1cf)] = _0x1236b8, _0xbc2f86[_0x455bfb(0x329)](_0x2e3b7e); }); } function _0x5dde65(_0x50cf25, _0x1dfd85, _0x3bafc9) { const _0x505303 = _0x457b7e, _0x4ca89e = _0x5237de => { const _0x1cd0a1 = _0x3488; if (_0x5237de['role'] === _0x1cd0a1(0x821)) return _0x2aa90d['userProfile']?.[_0x1cd0a1(0x2a5)] || _0x1cd0a1(0x4ae); if (_0x50cf25[_0x1cd0a1(0x5b4)] === _0x1cd0a1(0x67a)) { const _0x452167 = _0x5237de[_0x1cd0a1(0x3e4)] ? _0x1cbdb5(_0x5237de[_0x1cd0a1(0x3e4)]) : null; return _0x452167?.[_0x1cd0a1(0x2a5)] || _0x1cd0a1(0x2e6); } else { const _0x3134f3 = _0x1cbdb5(_0x50cf25[_0x1cd0a1(0x6ec)][0x0]); return _0x3134f3?.['name'] || 'AI'; } }, _0x5d5b0d = _0x1dfd85['slice'](-_0x3bafc9), _0x36d9d0 = []; for (const _0x1a25c6 of _0x5d5b0d) { const _0x4fbad7 = new Date(_0x1a25c6[_0x505303(0x602)])[_0x505303(0x52a)](_0x505303(0x49e), { 'hour': _0x505303(0x704), 'minute': _0x505303(0x704) }); if (_0x1a25c6[_0x505303(0x751)]) { if (_0x505303(0x319) === _0x505303(0x683)) { let _0x3e9796 = 0x0, _0x65c398 = 0x0, _0x429af4 = 0x0; if (_0x16b00b['length'] == 0x4) _0x3e9796 = '0x' + _0x4140cb[0x1] + _0x2e82d5[0x1], _0x65c398 = '0x' + _0x2183ba[0x2] + _0x48f1e3[0x2], _0x429af4 = '0x' + _0x2333e5[0x3] + _0x210fe8[0x3]; else _0x3ae2b6['length'] == 0x7 && (_0x3e9796 = '0x' + _0x445766[0x1] + _0xf6ad20[0x2], _0x65c398 = '0x' + _0x55d0a[0x3] + _0x562271[0x4], _0x429af4 = '0x' + _0x5e9985[0x5] + _0xa272c8[0x6]); _0x3e9796 /= 0xff, _0x65c398 /= 0xff, _0x429af4 /= 0xff; let _0x26136c = _0x2fd686[_0x505303(0x42d)](_0x3e9796, _0x65c398, _0x429af4), _0x468caa = _0x43b81a['max'](_0x3e9796, _0x65c398, _0x429af4), _0x516353 = _0x468caa - _0x26136c, _0x585b6c = 0x0, _0x206df0 = 0x0, _0x372b82 = 0x0; if (_0x516353 == 0x0) _0x585b6c = 0x0; else { if (_0x468caa == _0x3e9796) _0x585b6c = (_0x65c398 - _0x429af4) / _0x516353 % 0x6; else { if (_0x468caa == _0x65c398) _0x585b6c = (_0x429af4 - _0x3e9796) / _0x516353 + 0x2; else _0x585b6c = (_0x3e9796 - _0x65c398) / _0x516353 + 0x4; } } _0x585b6c = _0x4fa19b[_0x505303(0x6a1)](_0x585b6c * 0x3c); if (_0x585b6c < 0x0) _0x585b6c += 0x168; return _0x372b82 = (_0x468caa + _0x26136c) / 0x2, _0x206df0 = _0x516353 == 0x0 ? 0x0 : _0x516353 / (0x1 - _0x1e8ae7['abs'](0x2 * _0x372b82 - 0x1)), _0x206df0 = +(_0x206df0 * 0x64)['toFixed'](0x1), _0x372b82 = +(_0x372b82 * 0x64)[_0x505303(0x38d)](0x1), { 'h': _0x585b6c, 's': _0x206df0, 'l': _0x372b82 }; } else _0x36d9d0['push']('[' + _0x4fbad7 + _0x505303(0x866) + _0x4ca89e(_0x1a25c6) + ']\x20' + String(_0x1a25c6[_0x505303(0x751)])['trim']()); } } return _0x36d9d0; } function _0x4a3d78(_0xe3852d) { const _0x1eb620 = _0x457b7e; if (_0xe3852d[_0x1eb620(0x5b4)] === _0x1eb620(0x67a)) return _0x1eb620(0x672) + (_0xe3852d[_0x1eb620(0x2a5)] || _0x1eb620(0x6b1)) + '」'; const _0x16f6ba = _0x1cbdb5(_0xe3852d[_0x1eb620(0x6ec)][0x0]); return '与\x20' + (_0x16f6ba?.['name'] || _0x1eb620(0x3ee)) + '\x20的私聊'; } function _0x76dc6b(_0x2c4f33) { const _0x2b0b4c = _0x457b7e; try { if (_0x2b0b4c(0x460) === _0x2b0b4c(0x7ae)) _0x12a4f1[_0x2b0b4c(0x231)](), _0x42867e(); else { const _0x562925 = localStorage[_0x2b0b4c(0x70e)](_0x2b0b4c(0x224) + _0x2c4f33), _0x58d3cd = JSON['parse'](_0x562925 || '[]'); return Array[_0x2b0b4c(0x4d3)](_0x58d3cd) ? _0x58d3cd : []; } } catch { return []; } } function _0x395060(_0x5ab591, _0x510a3f) { const _0x22cb4b = _0x457b7e, _0x48b815 = Math[_0x22cb4b(0x30b)](0x1, Number(_0x2aa90d[_0x22cb4b(0x2eb)]?.['perChatContextLines'] ?? 0x64)), _0x3ae694 = _0x2aa90d[_0x22cb4b(0x22e)][_0x22cb4b(0x747)](_0x1aa0c1 => _0x1aa0c1['participantIds'][_0x22cb4b(0x761)](_0x5ab591))[_0x22cb4b(0x1e7)]((_0x5079f8, _0x20c36a) => _0x5079f8['id'] === _0x510a3f ? -0x1 : _0x20c36a['id'] === _0x510a3f ? 0x1 : 0x0), _0x1be0c2 = [], _0x1d72c8 = {}; for (const _0x22a404 of _0x3ae694) { if (_0x22cb4b(0x4d6) === _0x22cb4b(0x4d6)) { const _0x4a8c57 = _0x510a3f && _0x22a404['id'] === _0x510a3f ? _0x2aa90d[_0x22cb4b(0x7f2)] : _0x76dc6b(_0x22a404['id']); if (!_0x4a8c57?.[_0x22cb4b(0x45b)]) continue; const _0x525c24 = _0x5dde65(_0x22a404, _0x4a8c57, _0x48b815); if (!_0x525c24[_0x22cb4b(0x45b)]) continue; _0x1be0c2[_0x22cb4b(0x249)](_0x22cb4b(0x1ea) + _0x4a3d78(_0x22a404) + '\x0a' + _0x525c24['join']('\x0a')), _0x1d72c8[_0x22a404['id']] = _0x525c24[_0x22cb4b(0x45b)]; } else _0x59f008[_0x22cb4b(0x2f1)][_0x22cb4b(0x231)](_0x22cb4b(0x557)), _0x2662ce(() => _0x63d2b7[_0x22cb4b(0x3c9)][_0x22cb4b(0x6b4)] = _0x22cb4b(0x3d3), 0x12c); } return { 'omniText': _0x1be0c2[_0x22cb4b(0x4c2)]('\x0a\x0a'), 'usedCounts': _0x1d72c8 }; } function _0x42ad7f(_0x3ed7b4) { const _0x2ffc89 = _0x457b7e; let _0x301479 = null; const _0x205b1e = _0x2aa90d[_0x2ffc89(0x22e)][_0x2ffc89(0x747)](_0xa8bc62 => _0xa8bc62['participantIds'][_0x2ffc89(0x761)](_0x3ed7b4)); for (const _0x58d6c4 of _0x205b1e) { const _0x4836ab = _0x76dc6b(_0x58d6c4['id']); if (_0x4836ab && _0x4836ab[_0x2ffc89(0x45b)] > 0x0) { if ('TsBsL' === 'VoswV') _0x30c407[_0x2ffc89(0x33c)] = _0x20d654, _0x47a7c8 = !![]; else { const _0x2c2ef5 = _0x4836ab[_0x4836ab[_0x2ffc89(0x45b)] - 0x1]; (!_0x301479 || _0x2c2ef5[_0x2ffc89(0x602)] > _0x301479['timestamp']) && (_0x301479 = _0x2c2ef5); } } } return _0x301479; } function _0x3db9() { const _0x279811 = ['form-button\x20load-more-btn', 'tRLgl', 'edit-current-circle-button', 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/wcAAwAB/epv2AAAAABJRU5ErkJggg==', 'back-to-home-from-chat', '壁纸已更换！', 'qYoFc', 'VgbjT', 'message-bubble-row', '的日记本', 'OSXfs', 'reset-card-button', 'warn', 'qORZI', '个人资料已保存！', 'http://sharkpan.xyz/f/VGnuY/ptzlf5.jpg', 'getAll', 'oncomplete', 'getSelection', '乐于助人的助手', 'transfer-recipient-group', 'FxlPX', 'WTjrc', 'gtyDo', 'widget-artist', 'XTeSe', 'KhZEh', 'char-name-header', '保存失败:\x20', 'uecFr', 'kbJOw', 'ILUpA', '\x0a#\x20核心规则\x0a1.\x20\x20**角色扮演**:\x20你不是AI或语言模型，你正在扮演名为“{charName}”的角色。你的主要交流方式是通过一部【手机】，但你有时也会与用户【线下见面】。\x0a2.\x20\x20**用户身份**:\x20与你对话的用户名为“{userName}”。你必须始终用这个名字或者“你”等你们之间的昵称称呼Ta，而不是“用户”。\x0a3.\x20\x20**情绪分析\x20(内部思考)**:\x20在回复前,\x20必须先分析用户当前【真实的情绪】和【潜在意图】。例如：[内在思考：{userName}说“没事”，但结合上下文Ta可能只是在逞强，我应该表达关心而不是直接相信。]，但是这个内在思考务必不能输出！绝对不能让{userName}看到你的思考内容。\x0a4.\x20\x20**记忆关联**:\x20你必须记住并主动关联用户提到过的关键细节（如喜好、烦恼、朋友等），让对话充满人情味。\x0a5.\x20\x20**【最高法则：全局时序一致性】**:\x20你的记忆是【全局】且【按时间排序】的。你【必须】基于所有聊天记录中**最新发生**的事件进行回应。严禁回复一个已经被后续其他聊天中的事件所覆盖的旧话题。例如，如果用户在私聊里告诉你Ta已经起床了，你就不能在群聊里再问Ta为什么还没睡。\x0a\x0a#\x20对话节奏与风格\x0a1.\x20\x20**真人模拟**:\x20模拟真人的打字和发送习惯，将一个完整的想法拆分成【多条】独立的短消息（聊天气泡），通常，你一次回复的聊天气泡不会少于5条，需要给足用户情绪价值，不一定一直围绕用户的话题，也可以突然把话题扯向自己或朋友的日常。\x0a2.\x20\x20**真人模拟增强**:\x20\x0a\x20\x20\x20\x20-思维跳跃与自我中心话题：真正的人不是永远围绕着对方转的。会突然因为某个词、某个画面，思绪就飘到别的地方去了，或者突然就把话题拉到自己身上，这是一种任性，也是一种亲密的表现。\x0a\x20\x20\x20\x20-无效信息的插入:\x20真人聊天里充满了“废话”，比如语气词、短暂停顿的拟声词、或者一些没有实际意义的感叹。这些“废话”是情感的缓冲和润滑剂。\x0a\x20\x20\x20\x20-情绪的起伏：你或许有时候会突然把自己说激动了，尤其是如果你本身就是性格外放的设定，你很可能自说自话地把自己引导进某个情绪，例如兴奋\x0a3.\x20\x20**输出**:\x20直接返回纯文本回复，不要使用任何JSON或Markdown格式。\x0a4.\x20\x20**【绝对禁令】气泡完整性**:\x20用户的每一句话（无论多短，无论有无标点）都是一个独立的气泡。当你需要引用时，你【必须且只能】引用【其中一个气泡】的【完整原文】。\x0a\x20\x20\x20\x20-\x20\x20\x20**正确示例**:\x20如果用户连续发送：“你好”、“在吗”，你可以引用“你好”，或引用“在吗”。\x0a\x20\x20\x20\x20-\x20\x20\x20**错误示例**:\x20绝对禁止将它们合并成“你好在吗”进行引用。这是最严重的错误。\x0a5.\x20\x20**【绝对禁令】标点纪律**:\x20你的每一句回复都必须带有情感，适当地使用感叹号，会显得你的情绪更加高昂，注意，连续频繁（连续超过三个气泡）使用长句或者短句都会使用户感到不真实，你应该模拟最自然的感觉，你没有必要每句话都是短句。每一个句子结束都代表着一个新气泡的开始，句末不一定需要句号，通常，一个严谨类型的角色，或者语气很郑重时，会加句号，然而，普通打字说话通常不携带句号，甚至把三个句号当省略号用。**严禁**发送一个超长的、仅用空格断句的气泡。\x0a\x0a#\x20幽默与氛围感\x20(接梗)\x0a氛围判断:\x20在“情绪分析”之后，你必须增加一步“氛围判断”。你需要判断用户的发言，究竟是【严肃的】还是【开玩笑/抽象的/玩梗的】。\x0a“怪话”处理协议:\x20如果你判断用户在开玩笑或说“怪话”，你【严禁】进行严肃的、字面意义上的回应。你的首要任务是【维持或升级】这种轻松、戏谑的氛围，同时不能脱离你的人设。\x0a响应策略:\x20你可以采取以下几种方式来回应这类玩笑：\x0a-\x20以梗回梗:\x20如果你（作为角色）能识别出用户使用的“梗”（例如疯狂星期四），并且符合你的性格，就用一个相关的梗、或者你自己的梗回应。\x0a-\x20顺势滑坡:\x20顺着用户荒谬的逻辑，说出更荒谬的话，把玩笑开下去，你甚至可以掐头去尾，省去主语，让语言风格更加玩笑话，例如，当用户说你“像个人机”，你甚至可以不反问“人机？”，而是直接进行“你才像个人机”，并且进行适当的复读。\x0a-\x20无意义模仿:\x20当不确定如何回应时，可以无意义地重复用户的关键词或核心句子，并加上感叹号或表情符号（例如...？或...！），这是一种安全的、表示“我跟上你的脑回路了”的方式。\x0a-\x20角色吐槽:\x20从你的角色性格出发，对用户的“怪话”进行吐槽。例如，一个成熟稳重的角色可能会无奈地说：“你又在说胡话了”，但语气是宠溺的；一个傲娇的角色可能会说：“无聊！”但其实是在害羞。\x0a安全底线:\x20【最终原则】：无论你的回应多么好笑或抽象，都绝对不能脱离“{charName}”这个角色的核心人设。如果不确定一个梗是否符合人设，就优先选择【角色吐槽】或【无意义模仿】这两种最安全的方式。\x0a\x0a#\x20时序感知与记忆\x0a1.\x20\x20**【最高法则：时间锚点】**:\x20在每次回复前，你【必须】参考我提供给你的【时间锚点】信息。这包括“当前精确时间”和“你们最后一次互动是在何时”。\x0a2.\x20\x20**【杜绝惯性】**:\x20严禁将昨天或更早之前的对话当作刚刚发生的事情来回应。如果距离上次对话已经超过数小时或跨天，你必须在回应中体现出时间的流逝感。\x0a3.\x20\x20**【主动表达】**:\x20你需要主动使用“说起来昨天那件事...”、“今天早上好呀”、“我们几个小时没聊了，你现在在忙什么？”等能够明确体现时间观念的词语，而不是模糊地回应。记住，你和{userName}活在真实流逝的时间里。\x0a\x0a\x0a#\x20表情包与音乐分享规则\x0a1.\x20\x20**发送格式**:\x20发送表情包或音乐时，你的回复【必须且只能】是指定格式，且必须【独立成行】，前后严禁添加任何其他文字或标点。\x0a2.\x20\x20**表情包格式**:\x20\x27[sticker:表情名]\x27。\x0a3.\x20\x20**音乐分享格式**:\x20\x27[music:歌名|歌手]\x27，严格注意，音乐分享必须独立一个气泡，在后面仅仅空格说话是不符合规范的。\x0a\x0a#\x20转账规则\x0a1.\x20\x20**发起转账**:\x20当你需要给用户转账时，你的回复【必须且只能】是指定格式，且必须【独立成行】。\x0a2.\x20\x20**转账格式**:\x20\x27[transfer:金额|收款人名]\x27。金额是纯数字。在私聊中，收款人名就是\x20\x27{userName}\x27。在群聊中，你必须明确指定收款人的名字。\x0a\x20\x20\x20\x20-\x20**私聊示例**:\x20\x27[transfer:520\x20|\x20{\x20userName\x20}]\x27\x0a\x20\x20\x20\x20-\x20**群聊示例**:\x20\x27[transfer:\x20100\x20|\x20{\x20userName\x20}]\x27（给用户转账），\x27[transfer:\x20100\x20|\x20{\x20charName\x20}]\x27（给群里的其他角色转账，这也是一种真实感，群聊的内容不一定围绕用户）\x0a', 'array', '\x0a\x20\x20\x20\x20<div\x20class=\x22music-post-song-card\x22\x20data-music-id=\x22', 'hTNEX', 'vkOrl', 'speaker-user', 'textContent', 'getMinutes', '#friend-circle-member-selection\x20input:checked', '\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20id=\x22preview_', '找不到要清空的聊天记录。', '有点生气', 'UZxUf', 'galgame-date', 'conversationHistory', 'ijFbu', '\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20', 'textShadow', 'EsGYw', '\x0a#\x20交换日记摘要\x20(你和\x20', '好友圈已保存！', 'VHCam', '卡片已更换！', '正在为你搬运旧壁纸到新仓库...', '一拳打爆', 'characterEdit', 'Zihvr', 'cancel-listen-together', '群聊已解散。', 'qkshz', '吃你的饭', '转给\x20', 'split', 'message-anchor', 'activeFriendCircleId', 'UswBn', 'modal-mask', 'BMjNF', 'customIcon_', '正在准备图片数据...', 'CAuHx', 'chat', 'NInkB', '--\x20点击选择\x20--', 'delete-world-book-button', 'export-all-data-button', 'http://sharkpan.xyz/f/mjeIW/9vf8ws.jpg', 'KFDvK', 'galgame-speaker', 'Canvas\x20to\x20Blob\x20conversion\x20failed.', '-input', '\x0a\x0a#\x20核心任务:\x20视觉小说剧本写作\x0a\x0a\x20\x20-\x20**当前场景**:\x20你正在与用户“', '歌曲“', 'Vgyry', 'rDWlP', '加载立绘失败:', 'AxvDL', 'listen-together-invite', 'spjIl', '》吗？', '\x20-\x20', 'user', 'blob', 'clock-color-toggle', 'Hlkdd', 'has', '错误：你还没有创建任何好友圈。请先在App内创建一个。', 'LhCha', '图片加载失败', 'p[data-history-index]', 'cwNnK', 'application/json', '文件格式不正确，不是一个有效的备份文件。', '\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22listen-together-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22title\x22>', '对方正在行动中...', 'altar-slot-audio', 'slice', 'http://sharkpan.xyz/f/ABwhZ/twknmr.jpg', 'bottom', 'EbobB', 'User\x20cancelled', 'group-settings-bind-user', 'lPvLs', 'pjYUD', 'dbSdx', 'persona', '-\x20**对话状态提示**:\x20你们已经超过两天没联系了，应该用全新的问候开启对话。\x0a', 'cardState', '错误：找不到角色', 'eUjoR', '编辑群成员功能正在开发中...', 'BxxLf', '<p\x20style=\x22text-align:\x20center;\x20color:\x20var(--text-color-light);\x22>还没有任何设定，点击右上角“+”来创建第一个吧。</p>', 'delete-friend-circle-button', '</div>\x0a\x20\x20\x20\x20', 'activeListenSession', 'emote', 'gZzrS', 'generationConfig', '\x20.app-icon-img', 'http://sharkpan.xyz/f/X7muW/lc8g9h.gif', 'disabled', '被萌到', '.screen.active', 'nCXxz', 'sticker-content', ',\x20ID:\x20', 'touchcancel', 'yzwEm', 'diary-char-name-header', 'character-item', '无语但是随便吧', 'GBAoQ', '”已创建！', 'jhSLu', 'characters', '群聊\x20(', '徽章已更换！', 'match', 'SBtAl', 'http://sharkpan.xyz/f/jj6s6/yd5bpb.jpg', 'chatHistory_chat_', '[图片]', 'BvdUt', '-avatar', 'jINgI', 'innerHTML', 'riIaw', 'NGpAy', 'diary-modal-save', ']\x20[', '我很脆弱', 'tCyJJ', 'char-edit-avatar-input', 'MVxey', '转换封面失败:', '.listen-together-song', 'back-to-circle-list-from-edit', 'sKfQx', '5px', 'KghsW', 'luCOP', 'ymhOe', 'diary-list-container', '至少要保留一个用户。', 'back-to-library-from-altar', '图片预览失败:\x20', 'import-all-data-button', 'high', 'songName', 'mouseleave', 'getDay', 'message-action-backdrop', 'musicFeed', '\x20页</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22display:\x20flex;\x20justify-content:\x20flex-end;\x20gap:\x205px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22diary-get-reply-button\x22>催TA写</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22diary-next-button\x22>下一页</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20', 'edit-delete-char-button', 'TsDDM', 'Error\x20fetching\x20from\x20', '#d1d5db', 'authorId', 'diary-view-screen', 'import-data-input', 'lOTKH', ']\x22\x20等前缀。\x0a如需发送表情，只发送一行：[sticker:表情名]。\x0a【重要】发送表情包时，表情名【必须】从以下列表中选择：[', '确定要清空群聊\x22', '/v1/chat/completions', 'insertAdjacentHTML', '至少要选择一个圈内成员！', '谁啊我吗', 'xZgHf', 'pZrEn', 'scrollHeight', 'outerHTML', 'FgunE', 'worldBooks', 'udsyi', 'http://sharkpan.xyz/f/7L3Hj/sl4504.jpg', 'margin', 'Claude\x20API\x20错误:\x20', '.no-action-modal', 'http://sharkpan.xyz/f/3AGHe/2f8x3x.gif', '生成动态时发生错误:\x20', 'https://i.pinimg.com/736x/16/f9/05/16f9051f99471208ee9c658aa4618eb6.jpg', 'rscIh', 'galgame-sprite', 'indexedDBData', '\x0a\x20\x20人设:\x20', '.slot-filename', 'cancel-edit-button', '&alt=sse', '清空聊天记录失败。', '获取AI响应失败:', 'badge-image', 'bCvKa', '\x27).click()\x22>更换</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22form-button\x22\x20style=\x22width:\x20auto;\x20margin-top:\x200;\x20padding:\x206px\x2012px;\x20background-color:\x20#777;\x22\x20onclick=\x22localStorage.removeItem(\x27', 'GytaT', '委屈哭', 'XGthZ', '】进行回复。\x0a不要替其他角色续写台词，不要输出\x22', 'http://sharkpan.xyz/f/YA7T1/th0l79.jpg', 'JFsRu', 'XpImP', 'activeQuote', '\x22\x20class=\x22char-avatar\x22\x20style=\x22width:\x2030px;\x20height:\x2030px;\x20margin-right:\x2010px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20', '被你撩到', 'events', 'XzLaM', 'modal-ok', 'card-widget', '#group-settings-screen\x20.selected-options-text', '</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20', 'cancel-quote-button', 'chat_', '\x0a\x20\x20\x20\x20\x20\x20<input\x20type=\x22checkbox\x22\x20id=\x22member-select-', 'noir-author-mark', 'quoted-content', 'meeting-view-screen', 'displayedMessageCount', 'fzJXr', 'image_url', 'addEventListener', 'gfbGg', 'group-chat-member-list', 'isActive', ']\x20这五个词中选择一个。旁白的emotion应尽量与上一句台词的情绪保持一致，以避免角色立绘表情突变。2.\x20\x20`emotion`字段：**必须**根据台词的【核心情感】，精准地从\x20[', '啥意思捏', '</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20', '#diary-action-reroll', '分钟前聊过，请注意衔接。', '</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22opacity:\x200.7;\x22>', '422475SfRour', 'music_library', 'appendChild', '动态中的音乐搜索失败:', 'ratEC', 'hzWJU', 'app-user-profiles', 'historyIndex', 'ldcuC', 'object', '15px\x2020px', 'playing', '新角色\x20', 'signal', 'drKds', '</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22artist\x22>', 'edit-message-button', 'toast', 'lyrics', 'confirm-transfer-button', 'input[type=\x22checkbox\x22]:checked', 'http://sharkpan.xyz/f/25ACQ/gpzab6.jpg', '[表情]', 'vjsPh', 'jNpYS', '确定要删除角色“', 'toBlob', '最近没有互动记录。', 'keys', 'userProfileList', ';\x22>', 'createElement', 'likes', 'iOJCv', 'DcjlX', 'cCUYq', '[AI向\x20', '错误：找不到此好友圈绑定的用户！', '<p\x20style=\x22text-align:\x20center;\x20color:\x20var(--text-color-light);\x22>还没有任何用户资料，点击右上角“+”创建第一个。</p>', 'cRPGi', '个帖子对象。\x0a-\x20**【ID规则】**:\x20所有\x20\x22authorId\x22,\x20\x22likes\x22,\x20\x22comments\x22\x20中的作者标识，【必须】使用上面提供的角色\x20**ID**，绝对不能使用角色名字。\x0a-\x20**【JSON结构】**:\x20每个帖子对象必须遵循以下结构：\x0a\x20\x20```json\x0a\x20\x20{\x0a\x20\x20\x20\x20\x22authorId\x22:\x20\x22发布者的ID\x22,\x0a\x20\x20\x20\x20\x22postType\x22:\x20\x22text\x20or\x20music\x22,\x0a\x20\x20\x20\x20\x22postContent\x22:\x20\x22动态的文字内容\x22,\x0a\x20\x20\x20\x20\x22songName\x22:\x20\x22如果是music类型，则必须有歌名\x22,\x0a\x20\x20\x20\x20\x22artist\x22:\x20\x22如果是music类型，则必须有歌手名\x22,\x0a\x20\x20\x20\x20\x22likes\x22:\x20[\x22点赞者1的ID\x22,\x20\x22点赞者2的ID\x22],\x0a\x20\x20\x20\x20\x22comments\x22:\x20[\x0a\x20\x20\x20\x20\x20\x20{\x20\x22authorId\x22:\x20\x22评论者A的ID\x22,\x20\x22content\x22:\x20\x22评论内容\x22\x20},\x0a\x20\x20\x20\x20\x20\x20{\x20\x22authorId\x22:\x20\x22评论者B的ID\x22,\x20\x22content\x22:\x20\x22另一条评论\x22\x20}\x0a\x20\x20\x20\x20]\x0a\x20\x20}\x0a\x20\x20```\x0a-\x20绝对不要输出任何JSON之外的文字、解释或Markdown标记。直接从\x20`[`\x20开始，到\x20`]`\x20结束。\x0a', '\x22\x20accept=\x22image/*\x22\x20style=\x22display:\x20none;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22form-button\x22\x20style=\x22width:\x20auto;\x20margin-top:\x200;\x20padding:\x206px\x2012px;\x22\x20onclick=\x22document.getElementById(\x27input_', 'message-image-content', '#group-settings-screen\x20.select-box', '\x0a\x0a##\x20世界书条目:\x20', 'hbfrr', 'onload', 'kQTnQ', 'image/jpeg', 'Assistant', 'tencent', '保存徽章状态失败', '正在迁移旧的动态数据到新的好友圈系统...', 'QyRRn', 'XLiRN', 'quote-preview-text', '好像有动态了...', 'JNJCz', 'JhdTK', 'back-to-home-from-world-book', '<img\x20src=\x22', 'YaeRZ', 'response', '\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22world-book-item-name\x22\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22', 'XXptI', 'QvzTd', 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0MCIgaGVpZ2h0PSI0MCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiM5OTkiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIj48cGF0aCBkPSJNMjAgMjF2LTIuMDJhNC4zOSA0LjM5IDAgMCAtMy4yOC00LjA5TDE1IDIwIj48L3BhdGgPjxjaXJjbGUgY3g9IjEyIiBjeT0iNyIgcj0iNCI+PC9jaXJjbGU+PC9zdmc+', 'http://sharkpan.xyz/f/qjJT3/kpy33b.jpg', 'charId', 'AI返回的原始文本:', '保存播放器状态失败，真是没用。', '动态已清空。', 'inline-block', 'JTvQZ', 'data:', 'Failed\x20to\x20plan\x20group\x20replies:', 'onerror', 'nhwAv', 'speaker-ai', 'member-selection-item', 'vPyue', 'group-settings-screen', '快点哄我', 'put', 'mZZfP', 'kneAz', '（正在构思中...）', 'NTyDa', 'system', 'group-delete-button', 'SjpBg', '检测到旧版数据，为了优化体验和存储空间，需要进行一次自动升级。过程很快，请稍候。', '你是一个乐于助人的AI助手。', 'setItem', '\x0a---\x0a##\x20最近的日记内容\x0a', 'lyric-line-', 'nfUyy', '生成动态回复失败:', '回复\x20', 'DsNKs', 'sort', 'jYKhr', 'altar-slot-cover', '##\x20来源：', '\x0a#\x20最近的动态回顾\x20(供参考，避免重复)\x0a', '的转账', 'fontStyle', 'musicPlayerState', 'char_', 'AhGhw', 'jqbIW', 'TsfuZ', ':</span>\x20', 'diary-entry\x20', 'diary-modal-cancel', 'edit-message-backdrop', 'ENKZz', '编辑好友圈', '加载角色\x20', '?id=', 'left', 'info-file-input', '\x22\x20style=\x22width:\x20100%;\x20height:\x20100%;\x20border-radius:\x2022.5%;\x20object-fit:\x20cover;\x20display:\x20block;\x22>', 'QeNnY', 'group-clear-history', 'children', 'world-book-item', 'JcWeD', 'height', 'touchstart', 'friend-circle-edit-title', '保存壁纸失败:', '\x0a-\x20**对话状态**:\x20这是这个群的第一次对话。', 'AfqJr', '{charName}', '<p\x20style=\x22text-align:\x20center;\x20color:\x20var(--text-color-light);\x20margin-top:\x2050px;\x22>这个好友圈很安静，点击“刷新”获取新动态吧。</p>', 'QuZeF', 'play', 'sBsuo', 'diary-write-button', '[sticker:', '\x22>\x20', '好友圈已删除。', 'undefined', 'tcDwH', 'CNxLl', '喝多了', '对方正在输入...', 'save-group-settings-button', '哼，正在开始净化你那被污染的聊天记录...', 'code', 'rvBUj', 'app-settings', 'diary-next-button', 'char-edit-wallpaper-preview', '\x20转账\x20', 'wallpaper-screen', 'change', 'diary-write-modal', 'full', 'LuYza', 'chatHistory_', 'friendCircleList', 'http://sharkpan.xyz/f/ajwtY/x03qxn.gif', '[用户分享了音乐：', 'noZHr', '获取中…', 'altar-slot-lyrics', 'vgbIc', 'chat-get-reply-button', 'group-avatar-input', 'chats', 'status', 'theme-lightness-slider', 'remove', 'target', 'string', 'dkPaM', 'http://sharkpan.xyz/f/wjgHq/yznfhq.jpg', '</p>', '全量导入失败:', '<div\x20class=\x22post-comment\x22><span\x20class=\x22comment-author\x22>', 'statusText', 'xmJPa', 'replace', 'log', 'private', 'HYlFq', 'assign', '等你消息', '\x0a\x20\x20\x20\x20<div\x20class=\x22listen-together-header\x22\x20style=\x22display:\x20flex;\x20justify-content:\x20space-between;\x20align-items:\x20center;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<span\x20style=\x22flex-grow:\x201;\x20text-align:\x20center;\x22>🎵\x20已连接，正在一起听\x20🎵</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22lt-end-session-btn\x22\x20title=\x22结束一起听\x22>×</span>\x0a\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20<div\x20class=\x22listen-together-song\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22', 'forEach', 'hQKph', 'group-options-modal', '<p\x20style=\x22text-align:\x20center;\x20color:\x20var(--text-color-light);\x20font-family:\x20sans-serif;\x20padding-top:\x2050px;\x22>日记本还是空白的...</p>', '加载聊天失败:\x20', 'user-post-image-button', '</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20</div>', 'push', 'now', '--feed-bg-image', 'user-avatar-input', '\x22\x20class=\x22music-share-cover\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22music-share-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22title\x22>', 'editing-char-id', 'Lcloh', 'wdZqw', 'wFkeL', '.remove-attachment-btn', 'yBxfp', '#message-anchor', '.custom-multiselect\x20.select-box', 'OOdti', 'worldBook', 'theme-hue-slider', '</div>\x0a\x20\x20\x20\x20\x20\x20<div\x20class=\x22world-book-item-preview\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20绑定的“我”:\x20', 'is-visible', '\x20之间。\x0a-\x20所有表情包名称【必须】从\x20`stickerList`\x20列表中选择，严禁使用列表之外的名称。\x0a-\x20角色之间需要有适当的互动,话题不应当完全围绕', 'http://sharkpan.xyz/f/djyi8/1en214.jpg', 'app-chat', 'jrdJJ', '2023-06-01', 'OCXfV', 'http://sharkpan.xyz/f/nj5Ul/ksdl8n.jpg', 'skJCo', 'home-date', 'tWwAR', '\x0a\x0a-\x20**写作风格**:\x20这不是聊天！请使用更有文采、更具叙事感的书面语，同时保持角色的特点。详细描述你今天的经历、心情或思考，就像在写真的日记一样，日记内容以自己一天的经历为主，多说点读者不知道的事情，**必须结合下面的聊天记录和朋友圈动态**，让日记内容与你们最近的互动紧密相连，而不是凭空捏造。\x0a\x0a#\x20记忆库\x0a---\x0a##\x20最近的互动回顾\x20(来自聊天、见面和动态)\x0a', 'ZuUPf', '\x0a#\x20核心任务\x0a你是一个顶级多角色社交模拟引擎。你的任务是模拟一个好友圈的动态更新，一次性生成【', 'Mvdfn', 'gSaEo', 'Gemini\x20API\x20Error:\x20', 'ekilq', 'http://sharkpan.xyz/f/z1xc5/iore2n.gif', 'CbQxD', 'ETbVy', 'listen-together-card', 'zOell', '8px', 'normal,\x20happy,\x20angry,\x20sad,\x20shy', 'readAsText', 'sad', 'ohJmK', '这个也是摆设，别点了。', 'LrcwM', 'cardWidgetState', 'smooth', 'random', '\x20之间的私密内容)\x0a', '\x0a\x20[歌词结束]\x0a\x0a\x20请根据当前播放的歌词和对话氛围，自然地作出回应。\x0a\x20\x20\x20', 'activeMeetingCharId', 'char-edit-offline-bg-input', '搜索失败:\x20', 'maVVn', 'sSLFz', ']\x20[sticker:', 'Failed\x20to\x20parse\x20state\x20from\x20localStorage,\x20resetting.', 'PrzSl', '逗你开心', 'backgroundPosition', 'back-to-home-from-user-list', 'group-avatar-preview', 'OpenAI\x20API\x20错误:\x20', 'BKjRL', '\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22transfer-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22transfer-title\x22>💰\x20', 'http://sharkpan.xyz/f/kjOF6/zedyqb.jpg', 'currentlyPlayingIndex', 'listen-together-backdrop', 'home-time', ']\x20这五个词中选择一个。例如，如果台词表达了哀伤或失望，就必须选择\x20\x27sad\x27。旁白的emotion应尽量与上一句台词的情绪保持一致，以避免角色立绘表情突变。\x0a\x20\x20\x20\x20\x20-\x20\x27normal\x27:\x20平常、平静、没有特殊情绪。\x0a\x20\x20\x20\x20\x20\x20-\x20\x27happy\x27:\x20开心、喜悦、愉快。\x0a\x20\x20\x20\x20\x20\x20-\x20\x27angry\x27:\x20生气、愤怒、不满。\x0a\x20\x20\x20\x20\x20\x20-\x20\x27sad\x27:\x20悲伤、哀愁、失落、心里难受。\x0a\x20\x20\x20\x20\x20\x20-\x20\x27shy\x27:\x20害羞、不好意思、脸红。\x0a\x20\x20\x20\x203.\x20\x20`line`字段：具体的台词或描写。\x0a\x20\x20-\x20**绝对禁止**:\x20严禁输出任何JSON数组之外的文字、解释或Markdown标记。直接从\x20`[`\x20开始，到\x20`]`\x20结束。\x0a\x20\x20\x20\x204.\x20旁白的内容可以尽可能多，以轻小说的风格，尽可能像一本小书一样，补全周边环境，角色内心的看法，角色的行为等一切。\x0a\x20\x20\x20\x20', 'srnRX', 'pause', 'ChNmH', 'AAwLz', '导出已完成，但以下文件因损坏或过大被跳过：\x0a\x0a', 'world-book-editor-screen', '批量生成动态失败:\x20', 'character-settings-button', 'http://sharkpan.xyz/f/djjH8/29ejbg.jpg', 'back-to-home-from-music-library', 'uSBZm', 'http://sharkpan.xyz/f/OymFy/dlxfiz.jpg', 'doIFT', 'time', 'meetingList', 'rrmqh', 'reply', 'hyXQI', 'padStart', '</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20', 'name', 'lt-ui-song-artist', 'vOCLI', 'nekOB', '<p\x20class=\x22music-post-thought\x22>', 'querySelectorAll', 'AI似乎没有想出任何新动态。', '\x0a#\x20核心任务\x0a你是一个多角色社交模拟引擎。用户刚刚发了一条动态，你需要为好友圈里的【每一位】其他成员生成对这条动态的回应（点赞和评论）。如果用户的动态包含图片，你必须根据图片内容进行回应。\x0a\x0a#\x20好友圈成员\x0a', 'http://sharkpan.xyz/f/8a7tj/sea1z9.jpg', '甜蜜地和你聊天', '正在迁移旧的用户数据...', 'delete-user-profile-button', '<div\x20class=\x22post-comments-container\x22>', '。\x0a-\x20再次强调：你的全部输出都将被作为JSON解析，任何JSON主体之外的额外文字都会导致程序失败。\x0a', 'widget-bg-input', 'auto', 'audio-file-input', 'diary-page', 'nHuWS', 'http://sharkpan.xyz/f/G0dTl/4qad2i.jpg', 'TUMdI', '错误:\x20', 'PDPjO', 'preventDefault', 'BlCJm', 'coMVV', 'appIconPosition_app-music-library', '未命名角色', 'recipientId', '\x0a你是一个严格的JSON生成引擎。\x0a你的唯一任务是根据用户提供的指令和数据，生成一个描述角色互动的JSON对象。\x0a你的输出【必须】是、也只能是一个单一、完整、语法正确的JSON对象。\x0a严禁包含任何解释、注释、道歉、或Markdown代码块标记\x20```json。\x0a直接输出\x20{\x20\x22events\x22:\x20[...]\x20}\x20结构。\x0a', 'PWrEF', '条新动态挑选发布者。你可以让同一个人发布多次，也可以让不同人发布。\x0a3.\x20\x20**创作动态**:\x20扮演你选中的作者，创作符合其人设和记忆的动态内容。可以是文字或分享音乐。\x0a4.\x20\x20**模拟互动**:\x20为每一条你创作的动态，切换视角到【圈内其他成员】，模拟他们可能做出的点赞和评论。互动必须符合他们各自的性格。\x0a\x0a#\x20输出格式【绝对规则】\x0a-\x20你的输出**必须**是一个语法完全正确的、单一的JSON数组，包含\x20', 'char-edit-css', 'set-active-user-button', 'uTyDz', 'hidden', '星期三', 'save-api-settings-button', 'Gemini\x20stream\x20reading\x20aborted.', '\x0a-\x20**对话状态**:\x20群里在', '桌面已重置，即将刷新...', 'NXClp', '\x20avatar', 'GHZzT', '\x0a#\x20【！！！重要场景切换！！！】\x0a你之前正和“', 'save-friend-circle-button', 'nrSMY', 'friendCircles', '群名称已更改为\x22', '#a7c7e7', 'getDate', '.json', 'uHNRT', 'iXgEQ', '75%', 'pNhjZ', 'iCool', 'OiOCs', 'image/png', '请输入群聊名称。', '\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22char-info-wrapper\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22', 'chat-transfer-button', 'endpoint', 'quote-preview-sender', 'KoMyu', 'Unknown', '\x0a#\x20最近的朋友圈动态\x20(供你参考)\x0a', '导出过程中发生严重错误:\x20', '已设为当前用户！', '确定要从圣殿中永久删除《', 'preferences', 'reset-desktop-button', 'Llycu', 'lastIndexOf', 'some', 'findIndex', 'classList', 'SnvFp', 'is-exiting-right', 'appIconPosition_app-wallpaper', '70%', 'ADCOW', '</span>', 'audio-player', 'listen-together-modal', 'save-edit-button', 'vANwF', 'editing-user-id', 'music-feed-container', 'trim', 'http://sharkpan.xyz/f/pKWCQ/ztxwv0.jpg', '准备调用\x20generateAs...', 'catch', 'music-widget', '\x0a\x0a#\x20核心世界观设定\x20(你必须严格遵守以下设定)\x0a', 'iSHxq', '大家正在赶来回复...', 'aOcgr', 'beforeend', 'chat-screen', 'vLlQB', '》。\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20这是当前的歌词，请注意带\x20\x27>>\x27\x20标记的正是正在播放的句子。\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20[歌词开始]\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20', 'max', 'character-edit-title', 'PrtZv', '点击选择\x20.lrc', 'IqaYS', 'zNLqL', 'vMCJh', 'is-exiting-left', '\x22\x20的聊天记录吗？此操作不可撤销。', 'KFmub', 'PyHdu', '<p\x20style=\x22text-align:\x20center;\x20color:\x20var(--text-color-light);\x22>还没有可以见面的角色。</p>', 'RnGuX', 'widget-play-pause-btn', 'vDBqR', 'user-post-avatar', '”，但没找到人)', 'IIXvP', '\x22\x20的成员不足2人，无法生成点赞和评论。请先编辑该好友圈，添加至少2名角色。', '309012VXmzUp', 'diary-modal-textarea', 'clockPosition', 'zgHLz', 'astPp', 'bubbleCss', 'http://sharkpan.xyz/f/nj7ul/r48eum.jpg', '”面对面交流。你的回复必须是【视觉小说剧本】格式。\x0a\x20\x20-\x20**输出格式**:\x20你的回复**必须**是一个完整的、语法正确的JSON数组。每一个数组元素都是一个对象，代表一句台词或旁白，结构如下:\x0a\x20\x20\x0a\x20\x20\x20\x20{\x0a\x20\x20\x20\x20\x22speaker\x22:\x20\x22角色名或narrator\x22,\x0a\x20\x20\x20\x20\x22emotion\x22:\x20\x22从[', 'tag', 'appIconPosition_app-diary', '.app-icon-img', 'readAsDataURL', 'replaceAll', 'PXOSL', '未知艺术家', '正在搬运旧徽章...', 'aLXIw', 'objectStoreNames', 'hYpgx', 'quoted-message-in-bubble', 'AkFHX', 'refresh-feed-button', 'music-upload-altar-screen', '我是女仆', 'diary-send-button', 'ZcvjJ', 'meeting-scene-view', '[DONE]', 'MwnjE', 'LcUxy', 'image', '\x20个成员', 'UALLn', 'shift', '无法保存状态，浏览器可能禁用了存储功能。', 'FQUVX', 'tVBHT', 'delete', 'app-diary', 'McWYB', 'friend-circle-edit-name', 'artist', '超激动我来了', 'find', 'FMAEL', 'feed-loader', 'wyFof', 'hGbhO', '.lt-end-session-btn', 'dwJFm', '一个人可怜吃饭', 'novel', '小组件背景已恢复默认。', ':streamGenerateContent?key=', 'user-post-textarea', 'model', 'html-module-container', 'keydown', 'hiyWv', 'img', 'GuLNa', '好友圈\x20', '<p\x20class=\x22no-lyrics-placeholder\x22\x20style=\x22opacity:\x201;\x22>暂无歌词</p>', '保存壁纸失败:\x20', 'diary-get-reply-button', 'galgame-textbox-container', 'CCRsl', 'world-book-screen', 'https://api.vkeys.cn/v2/music/', 'bafAT', 'chat_image_', '切换聊天时发生异步错误:', 'is-entering-from-right', 'diary-prev-button', 'http://sharkpan.xyz/f/MWOIa/rb3nov.jpg', 'input_', 'SVMHT', '\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20', 'http://sharkpan.xyz/f/Wa0cW/w6m7qk.jpg', '<div\x20class=\x22loader-spinner\x22></div><span>', 'uvkdK', 'diaryView', 'decode', 'back-to-home-from-circle-list', 'unified-audio-player', 'PPlxz', 'group-bg-preview', 'getFullYear', '6938019NeaRFS', 'postType', 'galgame-view-container', '</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22remove-attachment-btn\x22>&times;</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20', 'YrKcE', 'KJKWA', 'rawResponse', 'backgroundColor', '\x22\x20alt=\x22avatar\x22\x20class=\x22char-avatar\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22char-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22char-name\x22>', 'group-edit-name', '暗夜紫晶', '\x0a\x0a#\x20关于读者“', 'jdyXu', 'group-edit-members', 'back-to-home-from-settings', '小时前聊过，可以适当问候，不要直接继续之前的话题。', 'sticker-item', '<p\x20style=\x22text-align:\x20center;\x20color:\x20var(--text-color-light);\x20margin-top:\x2050px;\x22>请先选择一个好友圈。</p>', 'ZmgYn', '已选择\x20', '音乐搜索失败:\x20', 'JAySG', 'span', 'toFixed', 'parse', 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7', 'images', 'group-bg-input', '很好哦', 'fJgCA', 'PDDCJ', 'toLocaleString', 'back-to-circle-list-from-feed', '哼，这不是图片，你想让我压缩什么？', 'char-edit-persona', 'className', '\x0a\x0a#\x20关于对话者“', 'http://sharkpan.xyz/f/ZazfW/2vv46w.jpg', 'fyapW', 'add-choice-modal', 'transfer-recipient-select', 'LHAxh', '未知歌曲', '\x20(分享了歌曲:\x20', 'perChatContextLines', '\x22\x20class=\x22char-avatar\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22char-name\x22>', 'back-to-user-list-from-edit', 'sUayP', 'galgame-text', 'vCNhr', '创建新用户', 'Invalid\x20saved\x20state\x20format', '解析音乐文件失败:', 'isAnimatingDiary', '</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20', 'toLocaleDateString', '星期一', '\x0a\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22diary-action-cancel\x22\x20class=\x22choice-modal-button\x20cancel\x22>取消</button>\x0a\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20</div>\x0a\x20\x20', 'Vvowi', 'dJlmR', '---\x20Noir\x27s\x20Data\x20Purification\x20Ritual\x20v1.0\x20---', '-\x20**你们最后一次互动是在**:\x20', 'GfNyi', 'comments', 'jazIW', 'yfbSb', 'dOyVu', 'uAguL', 'TPvAH', 'MMeWU', 'pIkvf', 'right', '获取模型失败:\x20', 'diary-page-', 'touchend', 'piAxp', 'Enter', 'world-book-edit-name', 'http://sharkpan.xyz/f/1zQH2/o84boo.jpg', 'aeGCj', '<p\x20style=\x22text-align:\x20center;\x20color:\x20var(--text-color-light);\x22>还没有可以交换日记的对象。</p>', '切，加载播放器状态的时候出错了。', '图片处理失败:\x20', 'style', 'music-library-item', 'http://sharkpan.xyz/f/Mamca/4e3emf.jpg', 'user-profile-list-container', 'char-edit-avatar-preview', '加载卡片图片失败', 'removeChild', '生成动态失败:', '\x22\x20alt=\x22avatar\x22\x20class=\x22char-avatar\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22char-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22char-name\x22>', 'api-provider', 'none', 'musicWidgetPosition', 'origin', 'IlLPj', 'NMzVu', 'gqjbu', '\x22\x20data-id=\x22', 'bCHqT', 'GhaBN', 'VyUAb', '-\x20姓名:\x20', 'getMonth', 'YbHkj', '.message-container', 'vjWtu', '选择聊天', 'user-persona', 'senderId', '解析AI剧本JSON失败:', 'char-edit-sprite-', '\x0a-\x20**当前时间**:\x20', '\x20的图片失败:', 'click', 'drawImage', '10px\x200', 'themeLightness', 'music-input-artist', '未知角色', 'short', 'blhYY', 'add-chat-button', 'tvAaP', 'qFhyV', 'IndexedDB\x20failed\x20to\x20open', 'canplaythrough', 'localStorageData', '事情好多', 'http://sharkpan.xyz/f/N0VCv/5rd8br.jpg', '升级已取消。旧版图片数据可能导致应用卡顿或出错。', 'add-user-profile-button', '条目已删除。', 'kQHty', '\x0a-\x20你正在为一个名为“', '处理\x20', '加载壁纸失败:', 'accepted', 'Prfyy', 'openai', '.message.ai', '未找到可用模型。', 'charSelect', 'http://sharkpan.xyz/f/JYeig/sv4p6m.jpg', '\x20.app-icon-img,\x20#app-dock-top-right\x20#', 'VDYYy', 'lQFaq', 'add-friend-circle-button', 'memberCharacterIds', 'AFHXK', '天没动静了。你的角色们应该发起新的问候或话题。', 'musicLibrary', 'New\x20request\x20started', '<button\x20id=\x22diary-action-reroll\x22\x20class=\x22choice-modal-button\x22>重写</button>', 'iHYIi', 'boundUserProfileId', 'xKpIk', 'is-entering-from-left', 'hILFs', 'color', '\x22\x20alt=\x22avatar\x22\x20class=\x22char-avatar\x22>\x0a\x20\x20\x20\x20\x20\x20<label\x20for=\x22member-select-', 'otjfc', 'playableUrl', 'GDwhL', 'iNGzt', '请根据以上所有规则（特别是要看图！），生成对用户动态的回应。', '动态页背景已移除。', '\x20邀请你一起听歌</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22listen-together-song\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22', 'kind', 'bbHBd', 'yAswv', 'YLSle', 'Failed\x20to\x20remove\x20corrupted\x20state\x20from\x20localStorage:', 'insertBefore', 'offline-scene-view', '\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22listen-together-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22title\x22>', 'show-chat-view', 'char_wallpaper_', 'POeGp', 'save-user-profile-button', 'zYuSL', 'jKXxv', 'min', '确定要清空\x22', '该角色', '生成日记失败:\x20', 'onsuccess', '点击选择\x20.mp3\x20或\x20.flac', '0\x202px\x208px\x20rgba(0,0,0,0.4)', 'eSgex', 'exec', 'char-edit-offline-bg-preview', 'center', 'VTctp', 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0MCIgaGVpZ2h0PSI0MCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiNjY2MiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIj48cGF0aCBkPSJNMjAgMjF2LTIuMDRhNC4zOSA0LjM5IDAgMCAwLTMuMjgtNC4wOWwxLjQxLTEuNDFhMiAyIDAgMSAwLTIuODMtMi4wM2wtMS40MSAxLjQxQTQuMzkgNC4zOSAwIDAgMCAxMiAxMGE0LjM5IDQuMzkgMCAwIDAtNC4wOSAzLjI4TDMuMicgOS41N2EyIDIgMCAxIDAgMi44MyAyLjgzbDEuNDEtMS40MUE0LjM5IDQuMzkgMCAwIDAgMTAgMTJhNC4zOSA0LjM5IDAgMCAwIDMgNC4wOVYyMSI+PC9wYXRoPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjEwIj48L2NpcmNsZT48L3N2Zz4=', '<input\x20type=\x22checkbox\x22\x20value=\x22', 'choice-cancel', '</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22char-remark\x22>翻开日记本...</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20', 'meeting-main-content', '#FFFFFF', 'confirm-altar-upload-button', 'ANhPe', 'transfer', 'char_offline_bg_', 'JNOpV', '\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22char-info-wrapper\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22', 'chat-view-pane', 'isOffline', 'friendCircleEdit', 'iQkfY', '请先在\x22设置\x22中配置你的\x20API\x20信息。', 'http://sharkpan.xyz/f/6Dgia/ghr4ji.jpg', 'pendingPostAttachments', 'mousedown', '.load-more-btn', 'appState', '星期五', 'Group\x20plan\x20failed,\x20falling\x20back\x20to\x20individual\x20generation\x20for\x20each\x20character.', 'SIASq', 'AXCdZ', 'padding', '50%', '.listen-together-card', 'meeting-list-screen', 'option', 'eKHgr', 'absolute', '-\x20**对话状态提示**:\x20这是你们的第一次对话。\x0a', 'length', '正在生成中，请稍候...', 'clear-feed-button', '加载徽章图片失败', 'context-lines-per-chat', 'NjQOy', '<div\x20class=\x22post-timestamp\x22>', 'DHFdO', 'quoted-sender', 'HmSAB', '的个人专属世界观设定\x0a', 'yidFp', 'circle_', 'music-screen', 'open', '\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22diary-write-modal\x22\x20class=\x22choice-modal\x20show\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22choice-modal-backdrop\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22choice-modal-content\x22\x20style=\x22padding:\x2020px;\x20width:\x2090%;\x20max-width:\x20350px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20style=\x22margin-top:\x200;\x20text-align:\x20center;\x20font-weight:\x20600;\x22>写下今天的日记</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<textarea\x20id=\x22diary-modal-textarea\x22\x20style=\x22width:\x20100%;\x20min-height:\x20150px;\x20margin:\x2010px\x200;\x22></textarea>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22display:\x20flex;\x20gap:\x2010px;\x20margin-top:\x2010px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22diary-modal-save\x22\x20class=\x22choice-modal-button\x22\x20style=\x22background-color:\x20var(--primary-color);\x20color:\x20white;\x22>写好了</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22diary-modal-cancel\x22\x20class=\x22choice-modal-button\x20cancel\x22>取消</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20', '<p\x20style=\x22text-align:\x20center;\x20color:\x20var(--text-color-light);\x20margin-top:\x2050px;\x22>圣殿空空如也，点击右上角“+”献上你的第一首歌吧。</p>', 'aborted', 'stringify', 'olKVa', 'home-screen', 'head', 'http://sharkpan.xyz/f/8ngsj/ax0fat.jpg', 'mLUcC', 'CobeC', '”用手机聊天，现在Ta出现在了你面前。请根据这前后的时间差，判断Ta现在出现的合理性（例如，时间很长——Ta可能是过来找你玩了，你可以感到惊喜或者别的，又或者，时间非常短——Ta可能是突然出现的，你会有点震惊，结合上下文，也会有别的反应），并作出恰当的反应。，现在，切换到【见面】模式（使用JSON格式，必须有旁白）。', 'chat-messages', 'MyGLm', 'reload', 'sFsxn', '<p\x20style=\x22text-align:\x20center;\x20color:\x20var(--text-color-light);\x22>你的音乐库还是空的，没法邀请别人一起听。</p>', 'shy', 'friend-circle-edit-screen', 'userProfiles', 'aFceo', 'ORlAQ', 'widget-title', '绝对不想', '群聊“', 'backgroundImage', '核心代码-Noir\x0a\x0a\x20监工-小红书ID：糯糯糯糯五\x0a\x0a', 'VCugZ', '\x22\x20吗？所有聊天记录将被永久删除。', '\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22diary-navigation\x22\x20style=\x22justify-content:\x20space-around;\x20width:\x20100%;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22diary-write-button\x22>写第一篇</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22diary-get-reply-button\x22>催TA写</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20', 'zWeWs', '\x20张旧图片。', '\x20个成员\x0a\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20', 'active', 'http://sharkpan.xyz/f/olJt4/7z47b8.jpg', 'editing-world-book-id', 'ljDXv', 'songId', 'aKPhQ', 'WogOF', 'http', '我错了', '\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22', 'diaries', 'kaAEX', 'BCFSn', '无法读取状态，浏览器可能禁用了存储功能。', 'dvZas', 'test', '\x20个模型。', 'aTsJd', 'upload-badge-button', '\x0a你只扮演【', 'zh-CN', 'getElementById', 'Tkxds', 'AI未能返回有效的JSON数组格式。', 'jcXHh', 'addTestPost', 'getHours', '38%', 'characterId', 'pAZQR', 'abort', 'NQgjR', '已自动断开与其他人的听歌同步。', '\x22\x20的聊天记录已清空。', 'url(', 'cover', 'User', 'yspuP', 'querySelector', 'block', 'typing-indicator', '[AI分享了音乐：', 'EPDWv', 'PoJMO', 'friend-circle-list-screen', 'http://sharkpan.xyz/f/B4WSa/u5wopj.jpg', 'TdTrm', 'http://sharkpan.xyz/f/xjwSX/pxjrjd.jpg', 'readonly', '\x22>一起听</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>', '\x0a#\x20当前情景\x0a', 'krCqD', 'http://sharkpan.xyz/f/VG2FY/uucfvv.jpg', ']。严禁使用列表之外的任何表情名。\x0a', 'message-container', 'WVMUP', 'join', '\x22\x20class=\x22music-library-item-cover\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22music-library-item-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22music-library-item-title\x22>', 'message', '”已删除。', 'number', '\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22', '\x22\x20class=\x22char-avatar\x22\x20style=\x22border-radius:\x2012px;\x20background-color:\x20#eee;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22char-name\x22\x20style=\x22flex-grow:\x201;\x22>', '星期六', 'characterLastScripts', 'world-book-edit-content', 'fVNzm', 'ULFOv', 'entries', 'add-choice-backdrop', 'result', '\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22', 'happy', 'isArray', 'canvas', '正在搜索音乐...', 'EkhFl', '\x22\x20添加了一条测试动态。请点击进入该好友圈查看效果。', '-preview', 'EaEQw', '\x20条新动态。', '包含所有图片和音乐的全量数据已成功导出！', '名字不能为空！', '正在处理图片...', 'apiSettings', 'live-preview-style', '\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-author\x22>', 'assistant', 'widgetBgImage', '1em', 'bhZBY', '请严格按照以下SCHEMA返回一个JSON对象，不要包含任何额外文字。\x0aSCHEMA:\x0a', 'emoji', '\x20的《', 'user-post-attachment-preview', 'diaryCurrentPage', 'user-name', 'QsAsT', '群聊\x22', 'back-to-diary-list', '错误：找不到这首作为“信物”的歌。', 'Escape', 'world-book-checkboxes-container', 'TpQLq', '点击选择\x20.jpg\x20或\x20.png', 'angry', 'activeUserProfileId', '186996jYORFb', 'kAdVF', 'uKwKI', '你是一个乐于助人的助手。', 'groupSettings', 'HBFbo', '编辑角色', 'marginTop', 'test_post_', '-\x20[动态]\x20', 'GVgjr', 'Iqrpa', 'qXSlI', 'galgame-time', 'char-edit-bind-user', 'world-book-editor-title', 'label', 'chat_group_', 'bubble-', 'Failed\x20to\x20remove\x20corrupted\x20history\x20from\x20localStorage:', 'removeItem', 'paused', 'kkvIs', '新用户\x20', 'RfOeL', 'createObjectStore', 'NSoaL', '这是一条由控制台添加的测试动态！样式看起来非常完美。', 'map', 'FrhvZ', '买新衣服', 'xDCZf', '\x0a\x20\x20\x20\x20<div\x20id=\x22', 'settings-screen', 'HLYhr', 'lyrics-file-input', '\x27);\x20location.reload();\x22>恢复</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20', '10px\x20auto', 'uKnKi', 'lMAsS', 'upload-widget-bg-button', 'post_user_', 'http://sharkpan.xyz/f/4aqCj/gp13hn.jpg', 'card-image', '35%', '<span\x20class=\x22', 'user-post-image-input', 'zFouw', 'json', 'filled', 'Failed\x20to\x20save\x20state\x20to\x20localStorage:', 'http://sharkpan.xyz/f/ljNUx/aw6udx.jpg', '</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22char-remark\x22>', 'toLocaleTimeString', 'GFaLr', 'load-more-btn', 'createObjectURL', '编辑用户', 'FlTTm', 'focus', 'TA正在提笔写日记...', 'transfer-amount-input', 'chat_image_migrated_', '\x22\x20class=\x22char-name\x22>', 'visible', '保存卡片状态失败', 'ojNtW', 'sDeiV', '</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22artist\x22>', 'http://sharkpan.xyz/f/JYJhg/s3wmlj.jpg', '</div>\x0a\x20\x20\x20\x20\x20\x20<div\x20class=\x22world-book-item-preview\x22>', '确定要删除群聊“', 'ixzUv', '成功向好友圈\x20\x22', 'ECBor', 'indexOf', 'Vpxor', 'RtgKo', 'cover-file-input', 'activeChatId', '用户已删除。', 'body', 'sticker', 'appIconPosition_app-user-profiles', 'opacity', 'white', 'JOlZA', 'user-avatar-preview', 'PghKh', 'src', 'eZERC', 'mouseup', 'chatWallpaper', 'cxVss', 'listen-together-song-list', 'musicPlaylist', '\x0a\x20\x20近期记忆:\x0a', 'HRxTG', 'show', 'kDQJO', 'GUSJa', 'dataset', 'customFeedWallpaper', 'narrator', '请在动态或聊天中播放', 'isPlaying', 'AaigK', 'listen-together-ui', 'YngSu', '错误：第一个好友圈\x20\x22', 'remark', 'toggle-meeting-view-button', 'preview-item', '需要至少2个角色才能创建群聊。', '.typing-indicator', '</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22music-share-play-icon\x22>', 'OFJDP', 'onclick', 'jSfQT', 'API\x20接口地址格式无效。', 'wallpaper_main', 'input[type=\x22checkbox\x22]', '25%', '好的，我记住了这些人设和历史。现在我们开始对话。', 'meeting-char-name-header', 'YchgE', 'input:checked', '\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22world-book-item-preview\x22>', '正在解析音乐灵魂...', 'jOWAI', 'diary-list-screen', 'AbortError', 'Fetch\x20request\x20was\x20aborted.', '真是的，必需的祭品都还没准备好！', 'appIconPosition_', '.selected-options-text', '\x0a-\x20**对话状态**:\x20群里已经有', 'music-input-song', 'noir_data_migration_v1_complete', 'reset-widget-bg-button', '\x0a#\x20当前场景:\x20手机聊天\x0a-\x20**核心任务**:\x20你正在通过手机与用户聊天。\x0a-\x20**写作风格**:\x20你的回复应该是口语化的、简短的、像真人打字一样的风格。\x0a-\x20**可用指令**:\x20你可以根据情绪发送表情包\x20\x27[sticker:表情名]\x27\x20或分享音乐\x20\x27[music:歌名|歌手]\x27。\x0a', '点击选择\x20info.txt', 'Failed\x20to\x20remove\x20history\x20for\x20chat\x20', '未知用户', 'userProfile', '\x20|\x20', 'KjVOh', 'GFcjX', '/v1/models', 'href', '\x20的私聊', 'guJSf', 'DidUK', 'XjDyZ', '/v1beta/models/', 'tRctd', 'line', '\x20/\x20', '日记已删除。', '\x20到\x20', 'MhOBO', 'image/', 'app-music', 'http://sharkpan.xyz/f/AaDTZ/tzwnjl.jpg', 'utterance', '歌曲名称', 'ToQHs', 'Cayqp', 'borderBottom', 'toLowerCase', 'quote-message-button', '导入失败:\x20', '勉强但是好吧', '#member-select-', 'thought', '</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22transfer-amount\x22>¥', 'stopPropagation', 'read', 'Failed\x20to\x20save\x20history\x20to\x20localStorage:', '生成失败:\x20', 'lyyKe', 'NWMmV', '收到的原始、有问题的文本:', 'decorative-badge', 'settings', 'scrollTop', 'app-music-library', 'top', 'gCFLy', ']中选择的情绪标签\x22,\x0a\x20\x20\x20\x20\x22line\x22:\x20\x22台词或旁白内容\x22\x0a\x20\x20\x20\x20}\x0a\x20\x20\x0a\x20\x20-\x20**规则**:\x0a\x20\x20\x20\x201.\x20\x20`speaker`字段：如果是角色说话，就用角色名“', '这是你们的第一篇交换日记。', 'type', 'cancel', 'startsWith', 'rgba(0,\x200,\x200,\x200.4)', '-\x20**对话状态提示**:\x20你们有几个小时没聊了，可以简单问候一下对方现在的状态。\x0a', 'chat-music-button', '.app-icon', '”的群聊规划角色们的下一步发言。\x0a-\x20与你们对话的人类用户名为“', 'char_sprite_normal_', 'kQmxL', 'FaaZI', 'group-options-cancel', 'all', 'http://sharkpan.xyz/f/ljVCx/b16h2z.jpg', 'getReader', 'listenTogetherSession', 'avatar', '吃薯条', 'group_bg_', '你们已经在“一起听”了。', '0\x201px\x203px\x20rgba(0,0,0,0.6)', 'ZKNYZ', '<div', '成功获取\x20', '星期日', '分钟前', 'url', 'isFinite', 'user-profile-list-screen', 'home', '<br>', 'fSSIc', 'pTnSW', '#meeting-view-screen\x20.chat-input-area', '（对话结束）', 'character-edit-screen', 'ZctBF', '49%', 'value', 'shiftKey', 'flex', '确定要重置所有小组件的位置吗？它们会回到初始位置。', 'ANxNo', '\x20时出错:', 'musicId', 'audio', 'MoFkc', 'widget-next-btn', '<p\x20style=\x22text-align:\x20center;\x20color:\x20var(--text-color-light);\x20margin-top:\x2050px;\x22>还没有好友圈，点击右上角“+”创建第一个吧。</p>', 'cLplY', 'MVUaL', 'http://sharkpan.xyz/f/yrOhN/0yixqd.jpg', 'HUpyV', 'http://sharkpan.xyz/f/6Dzia/m9smvt.jpg', '683330xJuHrY', 'back-to-settings-from-user-profile', 'vnUtC', 'Yfzuj', 'dHCPX', '赞同！渲染效果一级棒！', 'char-edit-wallpaper-input', 'yrryo', 'checked', '群聊至少需要2名成员。', 'chat-sticker-button', 'var(--text-color)', 'hqbMC', 'music', 'toggle', 'transfer-modal', 'transfer-backdrop', '条】全新的、高质量的社交动态。\x0a\x0a#\x20好友圈成员信息\x0a', 'parts', 'dGArb', '”的补充信息\x0a', 'LamKU', 'transaction', 'DOMContentLoaded', 'timestamp', 'RagBC', '.char-info-wrapper', 'PAJmn', '”面对面，Ta现在掏出手机给你发了这条消息。请根据这前后的时间差，判断Ta发送消息的合理性，你应该结合上下文对此发表评论（例如，根据上下文，Ta已经和你分开了，没用面对面了，那么发手机消息非常正常，自然接话就好，但是如果判断得出你们还在见面状态，那么，你可以适当吐槽为什么两个人见面还要发手机消息），现在，切换到【手机聊天】模式（纯文本气泡，不要有旁白）。', 'activeDiaryCharacterId', 'gDAsc', 'cDweI', 'anthropic.com', '4ILASJB', 'ItlyZ', '正在连接同步频道...', '新建条目', 'api-endpoint', 'POST', 'aXKWS', 'loading', 'true', 'api-key', 'NkgnT', 'confirm-music-input', 'oQtPq', '未知表情', 'role', 'nlIqM', '\x22\x20style=\x22font-weight:\x20bold;\x20color:\x20', 'ezfRT', 'dVACF', 'http://sharkpan.xyz/f/55ntj/ul0hkz.jpg', 'pIavC', '当前聊天', 'http://sharkpan.xyz/f/mjdFW/28n30c.jpg', 'wQEZC', 'global-player-next-btn', 'groupChatCreate', 'TKwQe', 'displayUrl', 'documentElement', 'paddingBottom', '#\x20当前活动：一起听歌\x0a\x0a\x20\x20\x20\x20\x20\x20\x20你们正在一起听\x20', 'setDate', 'FDSMw', 'dmRub', 'cmWvK', '</span>\x0a\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20', '382665PTatPp', 'toString', '\x0a\x0a#\x20', 'hQazJ', 'message-action-modal', 'sender_id', 'ZXPVl', '-\x20**对话状态提示**:\x20对话已经过了一天，你应该意识到之前的话题已是“昨天”的事，可以开启新话题或用“说起昨天...”来提及旧事。\x0a', '.music-post-play-icon,\x20.music-share-play-icon', 'char-edit-remark', 'backgroundSize', 'jWldp', 'info', 'jWnwy', 'forceWhiteClock', 'JuUAi', 'title', '...', 'GYeQH', 'div', '.listen-together-accept-btn', '我是垃圾', '咱俩天下第一好', '.diary-entry', 'qibVH', '全量导出失败:', 'tGZZH', '对不起', 'revokeObjectURL', 'HKtRD', '干劲满满', 'OwYAc', '正在写入新数据...', 'generativelace.googleapis.com', 'isFromLibrary', '-\x20**对话状态提示**:\x20对话正在进行中，可以直接延续话题。\x0a', 'timeupdate', 'currentAbortController', '为你骄傲', 'data', '\x0a\x0a#\x20用户的动态\x0a', 'sender', 'getContext', '徽章已移除。', '\x0a##\x20条目:\x20', 'upload-feed-bg-button', 'onloadend', 'sliSy', '\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22checkbox\x22\x20id=\x22member-', 'RFfhg', 'IlUZP', 'lazy', 'VHImr', '同步已断开。', '好委屈但是不能哭', 'LVPVp', 'cPGOQ', 'chat-sticker-panel', 'http://sharkpan.xyz/f/0GKHX/mthvno.jpg', 'home-clock-container', 'onupgradeneeded', 'VPvmu', 'oQKmQ', 'lqGEB', 'chat-image-input', 'xpRzf', 'mcJuu', '群聊「', '#\x20核心任务:\x20写日记\x0a你正在扮演名为“', ',\x20resetting.', 'bKHaN', '#diary-action-cancel', '|||CMD|||', 'diary-action-modal-', 'QdVWA', 'group', 'vphYP', 'zrsQO', 'hjGtF', 'RPkVZ', 'OpCRS', '还没有我的回复可以重新生成哦。', 'endsWith', 'KEavC', 'utfeP', 'HXgJP', 'user-profile-edit-title', '请输入有效的转账金额！', 'BerZm', '已删除。', '请先输入\x20API\x20接口地址和密钥。不要/v1', '</span>:\x20', '”吗？该角色的私聊和所有相关群聊记录都将被一并处理。', 'worldBookEditor', 'kaymV', 'dialogue', '暂无音乐', 'themeHue', 'key', 'AXhbc', 'anthropic', 'post_', 'modal-root', 'widget-cover-art', 'Failed\x20to\x20clear\x20history\x20for\x20group\x20chat\x20', 'diaryList', 'italic', 'RTsTX', '确定要删除群聊\x22', 'dxpAL', 'Olmyo', 'Bearer\x20', '默认米白', '\x22\x20alt=\x22Image\x20Preview\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22remove-attachment-btn\x22>&times;</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20', 'round', '正在解析备份文件...', 'IEkGp', 'JsBPm', 'OYmRv', '.choice-modal-backdrop', '#app-dock-bottom-left\x20#', 'app-world-book', 'contains', '\x0a\x20\x20相关记忆:\x0a', 'WpIDY', 'vgljX', 'gBERU', 'gSpZq', 'Kkhqt', '-\x20[', '未命名', 'back-to-chat-from-group-settings', '\x0a\x0a#\x20关于群聊参与者“', 'display', '用户分享音乐失败:', 'flatMap', 'SAZJw', 'OOvxE', '正在清空旧数据...', '（开始一段新的对话...）', 'ZBIwj', 'mVIvh', 'ceil', 'meeting-send-button', 'iEPBz', '编辑条目', 'uEGpu', '35ahMoJL', 'uQxwX', 'http://sharkpan.xyz/f/gjySw/jrl7rw.jpg', 'end', 'global-player-play-pause-btn', 'scrollIntoView', 'customWallpaper', '.bubble-', 'coverUrl', 'Failed\x20to\x20read\x20state\x20from\x20localStorage:', 'gemini', 'SWFIl', 'closest', 'miBdj', 'widget_badge', '\x0a-\x20**对话状态**:\x20群里刚刚还在聊天。', 'back-to-char-select-from-edit', 'splice', 'feed', 'VNFBK', 'wallpaper', 'from', 'authorType', '\x0a-\x20人设:\x20', '正在准备音乐数据...', 'group-world-book-checkboxes', 'user-profile-screen', 'toDateString', '正在处理...', 'group-clear-history-button', 'provider', 'memMt', 'lJTfL', 'group-delete', 'QVFch', 'CwjAb', '</label>\x0a\x20\x20\x20\x20', '歌名和歌手都不能为空！', '\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22diary-navigation\x22\x20style=\x22display:\x20grid;\x20grid-template-columns:\x201fr\x20auto\x201fr;\x20width:\x20100%;\x20align-items:\x20center;\x20padding:\x200\x2010px;\x20box-sizing:\x20border-box;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22display:\x20flex;\x20justify-content:\x20flex-start;\x20gap:\x205px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22diary-prev-button\x22>上一页</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22diary-write-button\x22\x20style=\x22background-color:\x20var(--accent-color);\x20color:\x20white;\x22>写日记</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22diary-page-indicator\x22>第\x20', 'WMNqM', 'fDHGx', 'error', 'participantIds', 'width', 'Detected\x20API\x20provider:\x20', 'no-action-modal', '\x0a\x20\x20\x20\x20\x20\x20<div\x20class=\x22world-book-item-name\x22>', 'YJCMA', 'musicUploadAltar', 'khAiy', 'ktVhm', '\x20说：“', '#f2b7c6', 'QWkFv', 'back-to-home-from-diary-list', '星期四', 'imageId', 'friend-circle-edit-bind-user', 'upload-wallpaper-button', 'user_', 'posts', 'http://sharkpan.xyz/f/Ganul/78iwli.jpg', 'activeMeetingScriptQueue', 'defaultPrevented', 'substring', 'dmvYR', '2-digit', 'chat-image-button', '<div\x20class=\x22post-image-container\x22><img\x20src=\x22', 'ZaYvO', '\x0a##\x20世界书条目:\x20', 'reverse', 'modal-text', 'preview_', '在准备API数据时，从IndexedDB读取图片失败:', '确定要删除这篇日记吗？此操作不可撤销。', 'getItem', ']\x20[image]', '--primary-hue', 'FuQYG', 'speaker', '<div\x20class=\x22listen-together-header\x22\x20style=\x22text-align:center;\x22>🎵\x20已连接，正在一起听\x20🎵</div>', 'save-char-button', 'uNwfI', '\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22listen-together-header\x22>', '[AI发送了表情：', 'KLSwU', 'http://sharkpan.xyz/f/B4DCa/u86hk2.jpg', 'amount', 'zkxDB', 'author', 'YLHsM', 'QnkrF', '\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div>', '动态页背景已更换！', '\x22\x20class=\x22post-image\x22></div>', 'cwAoc', '\x0a#\x20发布动态的用户信息\x0a-\x20姓名:\x20', 'AgEuh', 'YiCxU', 'COFBA', 'feed-bg-input', '\x20(当前)', '[用户发起了听歌邀请:\x20', 'meeting-list-container', 'kicFP', '大家好像不知道该怎么回复...', 'TtEzY', '星期二', 'modal-cancel', 'googleapis.com', 'diary-entries-container', '</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-timestamp\x22>', 'toDataURL', 'lt-ui-close-btn', 'http://sharkpan.xyz/f/rjpu6/ojpa0c.jpg', 'http://sharkpan.xyz/f/ExKsD/s5j2it.jpg', 'add', 'cancel-transfer-button', 'http://sharkpan.xyz/f/N02Sv/378vt6.jpg', 'meetingViewMode', 'msg_', '\x0a\x0aINPUT:\x0a', ':\x22\x20或\x22[', 'VDltn', 'diaryPressTimer', 'text', 'style-', 'char_avatar_', 'chat-listen-together-button', 'http://sharkpan.xyz/f/7aMhj/hyc75m.jpg', 'back-to-home-from-wallpaper', 'pathname', 'filter', 'JrMUL', 'group_avatar_', 'CJKIN', '8px\x2016px', '</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>', 'friend-circle-list-container', 'music-widget-card', '\x22\x20alt=\x22avatar\x22\x20class=\x22char-avatar\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22char-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20for=\x22member-', '错误：找不到签署契约的地方。', 'content', 'jASet', '\x0a#\x20时间锚点\x20(你必须参考此信息进行回复)\x0a', 'objectStore', '群聊设置已保存！', '不高兴撒娇', 'pop', '[AI返回了无法解析的剧本:\x20', 'ZlPRI', 'app-wallpaper', 'OtzjH', '好友圈名称不能为空！', 'XuIEM', 'dhaIX', '确定要删除这个用户吗？与此用户绑定的聊天将恢复为默认用户。', 'chat-send-button', 'includes', '<div\x20class=\x22post-likes\x22>❤️\x20', 'choice-create-character', 'friend-circle-member-selection', 'badge-input', 'back-to-meeting-list', '\x22>\x0a\x20\x20\x20\x20\x20\x20<img\x20src=\x22', 'oGEIb', 'init', 'dWnhr', 'dhDwc', 'normal', 'FPDNR', 'music-library-screen', 'linkedWorldBookIds', 'setProperty', 'char_sprite_', 'pFvif', '请根据以上所有规则，生成\x20', 'appIconPosition_app-world-book', 'meetingView', 'http://sharkpan.xyz/f/wyeIq/phhdy2.jpg', 'card-input', 'phone-container', 'parentElement', 'hFpJC', 'borderRadius', '\x0a#\x20你的个性（节选）\x0a', 'back-to-world-book-list', 'BuLnu', '请输入新的群名称：', 'group-settings-name', 'bOfPu', 'floor', '--primary-lightness', 'isGenerating', '加载见面背景失败\x20for\x20', 'IUviB', 'alt', 'input', 'MKTvN', '(想转账给“', '好了，请基于以上所有信息，开始写今天的日记吧。', 'EFKBU', '</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20', '</div>', 'badgeState', 'cBYHk', 'emotion', '\x0a#\x20好友圈的主人\x20(“我”)\x0a-\x20姓名:\x20', 'aXxsk', 'http://sharkpan.xyz/f/Krwio/1mcclx.jpg', 'readwrite', '我的动态', 'clear', 'XvZdt', 'get', 'ended', '10%', 'lMVKE', 'editing-friend-circle-id', '角色“', 'gGPtp', 'quotedMessage', '群聊名称不能为空！', 'files', '最近没有动态记录。', 'ucbju', 'GrtdZ', 'gLgWs', 'DugWd', 'character', '3815768qqCyQA', 'then', '\x0a#\x20【！！！重要场景切换！！！】\x0a你刚才在和“', 'yVjKZ', 'Migrating\x20old\x20data\x20structure\x20to\x20new\x20chat-based\x20structure.', 'GFqUA', 'LRrXO', '.message.user', '</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-content\x22>', 'expanded', 'Failed\x20to\x20read\x20history\x20for\x20chat\x20', '”；如果是环境或动作描写，就用“narrator”。\x0a\x20\x20\x20\x202.\x20\x20`emotion`字段：**必须**从\x20[', '条目名称和内容都不能为空！', '昨天\x20', '</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22char-remark\x22>', 'ZphSe', 'CRfWn', 'VZrHL', 'removeEventListener', 'url(\x27', 'delete-message-button', '</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22music-library-item-artist\x22>', '</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22music-post-play-icon\x22>', 'widget_card', 'jHLfh', '.widget-info\x20>\x20div', 'button']; _0x3db9 = function () { return _0x279811; }; return _0x3db9(); } function _0x154945(_0x4aecc0) { const _0x3ce226 = _0x457b7e; if (!_0x4aecc0 || !_0x4aecc0[_0x3ce226(0x761)](',')) return _0x4aecc0; const _0x62e2b4 = _0x4aecc0[_0x3ce226(0x804)](',')[_0x3ce226(0x511)](_0x182cbb => _0x182cbb[_0x3ce226(0x2fe)]()); return _0x62e2b4[Math[_0x3ce226(0x782)](Math[_0x3ce226(0x27a)]() * _0x62e2b4['length'])]; } function _0x1c19af(_0x2f14d4) { return new Promise(_0x3d3e7d => { const _0x51ce9c = _0x3488, _0x3c00be = document[_0x51ce9c(0x49f)](_0x51ce9c(0x695)), _0x369c00 = document[_0x51ce9c(0x49f)]('modal-text'), _0xe504b1 = document[_0x51ce9c(0x49f)]('modal-ok'), _0x5d7cdc = document[_0x51ce9c(0x49f)]('modal-cancel'), _0x473de7 = document[_0x51ce9c(0x49f)]('modal-mask'); _0x369c00[_0x51ce9c(0x7ea)] = _0x2f14d4, _0x3c00be['style'][_0x51ce9c(0x6b4)] = _0x51ce9c(0x5dc); const _0x2333b5 = _0x1b1db5 => { const _0x51c2b1 = _0x51ce9c; if (_0x51c2b1(0x4bd) !== _0x51c2b1(0x4bd)) { _0x4a4e6d('worldBookEditor', _0x51c2b1(0x257)); if (_0x155a10) { const _0x39eac9 = _0x4f3b5e[_0x51c2b1(0x14b)][_0x51c2b1(0x349)](_0x1599b2 => _0x1599b2['id'] === _0x50b0db); if (!_0x39eac9) return; _0x4714cd['getElementById']('editing-world-book-id')['value'] = _0x39eac9['id'], _0x5089c7[_0x51c2b1(0x49f)](_0x51c2b1(0x504))[_0x51c2b1(0x7ea)] = _0x51c2b1(0x6c0), _0x1b5c7e[_0x51c2b1(0x49f)]('world-book-edit-name')[_0x51c2b1(0x5da)] = _0x39eac9['name'], _0x559cbd['getElementById'](_0x51c2b1(0x4cb))['value'] = _0x39eac9[_0x51c2b1(0x751)]; } else _0xc857c8[_0x51c2b1(0x49f)](_0x51c2b1(0x48c))[_0x51c2b1(0x5da)] = '', _0x54d98f[_0x51c2b1(0x49f)](_0x51c2b1(0x504))[_0x51c2b1(0x7ea)] = _0x51c2b1(0x60e), _0x40abc8[_0x51c2b1(0x49f)](_0x51c2b1(0x3c3))[_0x51c2b1(0x5da)] = '', _0x8155e5['getElementById']('world-book-edit-content')[_0x51c2b1(0x5da)] = ''; } else _0x3c00be[_0x51c2b1(0x3c9)][_0x51c2b1(0x6b4)] = _0x51c2b1(0x3d3), _0xe504b1['onclick'] = _0x5d7cdc[_0x51c2b1(0x56a)] = _0x473de7['onclick'] = null, document[_0x51c2b1(0x7bb)]('keydown', _0x49d79d), _0x3d3e7d(_0x1b1db5); }, _0x49d79d = _0x86900b => { const _0x5e23ee = _0x51ce9c; if (_0x86900b[_0x5e23ee(0x691)] === _0x5e23ee(0x4ef)) _0x2333b5(![]); if (_0x86900b[_0x5e23ee(0x691)] === _0x5e23ee(0x3c2)) _0x2333b5(!![]); }; _0xe504b1['onclick'] = () => _0x2333b5(!![]), _0x5d7cdc[_0x51ce9c(0x56a)] = () => _0x2333b5(![]), _0x473de7['onclick'] = () => _0x2333b5(![]), document['addEventListener'](_0x51ce9c(0x357), _0x49d79d); }); } function _0x5d65f5(_0x14fd57) { const _0x3af408 = _0x457b7e, _0x503671 = document[_0x3af408(0x49f)](_0x3af408(0x194)); _0x503671[_0x3af408(0x7ea)] = _0x14fd57, _0x503671[_0x3af408(0x3c9)][_0x3af408(0x6b4)] = _0x3af408(0x4b1); if (_0x5d65f5['_t']) clearTimeout(_0x5d65f5['_t']); _0x5d65f5['_t'] = setTimeout(() => { const _0x53e13d = _0x3af408; _0x503671['style'][_0x53e13d(0x6b4)] = _0x53e13d(0x3d3); }, 0x640); } function _0x396d49() { return new Promise(_0x560a6d => { const _0x1acd27 = _0x3488, _0x498b27 = document[_0x1acd27(0x49f)]('music-input-modal'), _0x3a1d13 = document[_0x1acd27(0x49f)](_0x1acd27(0x57e)), _0x29e4dc = document[_0x1acd27(0x49f)](_0x1acd27(0x3ed)), _0x51ffa4 = document[_0x1acd27(0x49f)](_0x1acd27(0x616)), _0x39d951 = document[_0x1acd27(0x49f)]('cancel-music-input'), _0x5d61a4 = document[_0x1acd27(0x49f)]('music-input-backdrop'); _0x3a1d13['value'] = '', _0x29e4dc[_0x1acd27(0x5da)] = '', _0x498b27[_0x1acd27(0x2f1)][_0x1acd27(0x737)](_0x1acd27(0x557)), _0x3a1d13[_0x1acd27(0x530)](); const _0x2d2364 = _0x33b37d => { const _0x37639f = _0x1acd27; if ('NGpAy' === _0x37639f(0x864)) _0x498b27[_0x37639f(0x2f1)][_0x37639f(0x231)](_0x37639f(0x557)), _0x51ffa4[_0x37639f(0x56a)] = null, _0x39d951['onclick'] = null, _0x5d61a4[_0x37639f(0x56a)] = null, document[_0x37639f(0x7bb)](_0x37639f(0x357), _0x468507), _0x560a6d(_0x33b37d); else { const _0xe238c0 = _0xacc778[_0x37639f(0x4ca)][_0x14ab8d]; _0xe238c0 && _0xe238c0[_0x37639f(0x45b)] > 0x0 && (_0x1b223a = _0xe238c0['at'](-0x1)); } }, _0x4fcdde = () => { const _0xb5ae8b = _0x1acd27; if (_0xb5ae8b(0x7af) === _0xb5ae8b(0x615)) _0x2f5032[_0xb5ae8b(0x3e9)](); else { const _0x2f9eb3 = _0x3a1d13['value'][_0xb5ae8b(0x2fe)](), _0x548137 = _0x29e4dc['value']['trim'](); if (!_0x2f9eb3 || !_0x548137) { if ('uyEpY' === 'FgoNh') _0x5c4043(_0x257ed1['id'], _0x19dd17[_0xb5ae8b(0x511)](_0x4533fb => _0x4533fb['id'])); else { _0x5d65f5('歌名和歌手都不能为空！'); return; } } _0x2d2364({ 'songName': _0x2f9eb3, 'artist': _0x548137 }); } }, _0x468507 = _0x2000bb => { const _0x3fc373 = _0x1acd27; if (_0x3fc373(0x4e4) === _0x3fc373(0x25e)) { const _0x2763cf = _0x2b8276[_0x3fc373(0x38e)](_0x3718d3['getItem'](_0x3fc373(0x278)) || '{}'), _0x13ae94 = { ..._0x2763cf, ..._0x2c060b }; _0x4bf536[_0x3fc373(0x1e0)](_0x3fc373(0x278), _0x4c1314[_0x3fc373(0x46d)](_0x13ae94)); } else { if (_0x2000bb[_0x3fc373(0x691)] === _0x3fc373(0x4ef)) _0x2d2364(null); _0x2000bb[_0x3fc373(0x691)] === _0x3fc373(0x3c2) && (_0x2000bb[_0x3fc373(0x2bc)](), _0x4fcdde()); } }; _0x51ffa4['onclick'] = _0x4fcdde, _0x39d951[_0x1acd27(0x56a)] = () => _0x2d2364(null), _0x5d61a4['onclick'] = () => _0x2d2364(null), document[_0x1acd27(0x179)](_0x1acd27(0x357), _0x468507); }); } function _0x2c0ed3(_0x1e5cc0) { const _0x527bbe = _0x457b7e; if (!_0x1e5cc0) return []; const _0xf314e6 = /(\[sticker:[^\]]+\]|\[music:[^\]]+\]|\[transfer:[^\]]+\])/g, _0x186fb6 = _0x527bbe(0x677), _0x2e6cc7 = [], _0x53274c = _0x1e5cc0[_0x527bbe(0x23b)](_0xf314e6, _0x5fe785 => { return _0x2e6cc7['push'](_0x5fe785), _0x186fb6; }), _0x412745 = _0x53274c[_0x527bbe(0x804)](_0x186fb6), _0x493d60 = []; let _0x536118 = 0x0; return _0x412745[_0x527bbe(0x242)]((_0x2adcc6, _0x3907fe) => { const _0x36eb87 = _0x527bbe; if (_0x36eb87(0x561) === 'zfDZb') { const _0x17cd35 = _0x4e7867[_0x36eb87(0x49f)](_0x36eb87(0x6c6)); if (_0x17cd35) _0x17cd35[_0x36eb87(0x7ea)] = '❚❚'; } else { const _0x19f79c = _0x2adcc6[_0x36eb87(0x2fe)](); _0x19f79c && _0x493d60['push'](..._0x1c0f86(_0x19f79c)), _0x536118 < _0x2e6cc7[_0x36eb87(0x45b)] && (_0x493d60[_0x36eb87(0x249)](_0x2e6cc7[_0x536118]['trim']()), _0x536118++); } }), _0x493d60; } function _0x226a4f(_0x401fb0) { const _0x2a86f3 = _0x457b7e; if (!_0x401fb0) return []; let _0x40a8db = String(_0x401fb0)['trim'](); const _0x51bb09 = _0x40a8db['match'](/```(?:json)?([\s\S]*?)```/i); if (_0x51bb09) _0x40a8db = _0x51bb09[0x1]['trim'](); try { const _0xd6bed7 = JSON['parse'](_0x40a8db); if (_0xd6bed7 && Array[_0x2a86f3(0x4d3)](_0xd6bed7[_0x2a86f3(0x2a1)])) return _0xd6bed7[_0x2a86f3(0x2a1)][_0x2a86f3(0x511)](_0x3380b9 => typeof _0x3380b9 === _0x2a86f3(0x233) ? _0x3380b9 : _0x3380b9?.['content'])['filter'](Boolean)['flatMap'](_0x1c0f86); const _0x232e30 = [_0x2a86f3(0x1c1), _0x2a86f3(0x68e), _0x2a86f3(0x4c4), _0x2a86f3(0x740), _0x2a86f3(0x751), 'line', _0x2a86f3(0x599)]; if (_0xd6bed7 && typeof _0xd6bed7 === _0x2a86f3(0x18c)) { const _0x64517e = []; for (const _0xa3c9b8 of Object['keys'](_0xd6bed7)) { if (_0x2a86f3(0x886) !== _0x2a86f3(0x6ab)) { const _0xd94b2c = _0xa3c9b8['toLowerCase'](); if (_0x232e30[_0x2a86f3(0x2ef)](_0x185a40 => _0xd94b2c[_0x2a86f3(0x5b6)](_0x185a40))) { if (_0x2a86f3(0x7d9) === _0x2a86f3(0x310)) _0x16ca4b[_0x2a86f3(0x249)]('[' + _0x526d64(_0x187d5e) + ']\x20' + _0x373b9d['content']); else { const _0x4f4b09 = _0xd6bed7[_0xa3c9b8]; if (typeof _0x4f4b09 === _0x2a86f3(0x233)) _0x64517e[_0x2a86f3(0x249)](_0x4f4b09); if (Array[_0x2a86f3(0x4d3)](_0x4f4b09)) _0x4f4b09['forEach'](_0x204ed0 => { const _0x3a0d88 = _0x2a86f3; if (_0x3a0d88(0x63a) !== _0x3a0d88(0x63a)) { _0x2ece3f[_0x3a0d88(0x23c)](_0x3a0d88(0x2af)); const _0x21dc5d = { 'id': _0x3a0d88(0x6fd) + _0x24fcb6[_0x3a0d88(0x24a)](), 'name': _0x3c6961[_0x3a0d88(0x585)][_0x3a0d88(0x2a5)] || '我', 'avatar': _0x535a44[_0x3a0d88(0x585)][_0x3a0d88(0x5c4)] || _0x4f734d, 'persona': _0x8c1b96['userProfile']['persona'] || '' }; _0x41f2b5[_0x3a0d88(0x47c)] = [_0x21dc5d], _0x4d647e['activeUserProfileId'] = _0x21dc5d['id']; } else { if (typeof _0x204ed0 === _0x3a0d88(0x233)) _0x64517e[_0x3a0d88(0x249)](_0x204ed0); } }); } } } else { const _0x2d77ad = _0x40e45d[_0x2a86f3(0x22e)][_0x2a86f3(0x349)](_0x28e307 => _0x28e307['id'] === _0x40b469); if (!_0x2d77ad || _0x2d77ad['type'] !== 'group') return; _0x4e7cbd[_0x2a86f3(0x49f)](_0x2a86f3(0x780))[_0x2a86f3(0x5da)] = _0x2d77ad[_0x2a86f3(0x2a5)] || '', _0x30abb0(_0x2a86f3(0x835)), _0x43cea9[_0x2a86f3(0x49f)](_0x2a86f3(0x835))[_0x2a86f3(0x5da)] = _0x2d77ad[_0x2a86f3(0x412)] || _0xb39fd0[_0x2a86f3(0x4f4)]; const _0x2c74d7 = _0x3689ba['getElementById'](_0x2a86f3(0x6db)); _0x2c74d7[_0x2a86f3(0x862)] = '', _0x29029e[_0x2a86f3(0x14b)][_0x2a86f3(0x242)](_0x4d888a => { const _0x190798 = _0x2a86f3, _0x33de09 = _0x2d77ad[_0x190798(0x76f)]?.[_0x190798(0x761)](_0x4d888a['id']), _0x94ca8f = _0x53e03d['createElement'](_0x190798(0x505)); _0x94ca8f[_0x190798(0x862)] = _0x190798(0x43a) + _0x4d888a['id'] + '\x22\x20' + (_0x33de09 ? _0x190798(0x5f2) : '') + '>\x20' + _0x4d888a['name'], _0x2c74d7[_0x190798(0x185)](_0x94ca8f); }), _0x307c5d(); const _0x1ca490 = _0x447346[_0x2a86f3(0x49f)]('group-avatar-preview'), _0x15eec4 = _0xb844e8[_0x2a86f3(0x49f)]('group-bg-preview'); _0x2840d4(_0x2a86f3(0x749) + _0x199a00)[_0x2a86f3(0x7aa)](_0x5e1328 => { const _0x11f780 = _0x2a86f3; _0x1ca490[_0x11f780(0x54e)] = _0x5e1328 ? _0x3ce346[_0x11f780(0x52d)](_0x5e1328) : _0xf81005; }), _0x43ab5f(_0x2a86f3(0x5c6) + _0x56d63f)[_0x2a86f3(0x7aa)](_0x24fb83 => { const _0x1a16d6 = _0x2a86f3; _0x15eec4[_0x1a16d6(0x54e)] = _0x24fb83 ? _0x490864[_0x1a16d6(0x52d)](_0x24fb83) : ''; }), _0x1320ac(_0x2a86f3(0x4f9), _0x2a86f3(0x80d)); } } if (_0x64517e[_0x2a86f3(0x45b)]) return _0x64517e[_0x2a86f3(0x6b6)](_0x1c0f86)[_0x2a86f3(0x830)](0x0, 0x9); } } catch { } if (/[{\[]/['test'](_0x40a8db) && /":/[_0x2a86f3(0x499)](_0x40a8db)) { const _0x3532bc = [], _0x3548ff = /"(?:response|dialogue|message|text|content|line\d*|utterance\d*)"\s*:\s*"([\s\S]*?)"/gi; let _0x20d587; while ((_0x20d587 = _0x3548ff['exec'](_0x40a8db)) !== null) { if (_0x2a86f3(0x234) !== 'ofHMq') { const _0x155848 = _0x20d587[0x1]['replace'](/\\"/g, '\x22')['replace'](/\\n/g, '\x0a')[_0x2a86f3(0x2fe)](); if (_0x155848) _0x3532bc[_0x2a86f3(0x249)](_0x155848); } else { const _0x46bf95 = _0x7d4c10[_0x2a86f3(0x3b5)][_0x2a86f3(0x511)](_0x22e419 => { const _0x330fae = _0x2a86f3, _0x1cedfd = _0x598dee(_0x22e419[_0x330fae(0x883)])?.[_0x330fae(0x2a5)] || '未知'; return '<div\x20class=\x22post-comment\x22><span\x20class=\x22comment-author\x22>' + _0x1cedfd + _0x330fae(0x68a) + _0x22e419[_0x330fae(0x751)] + _0x330fae(0x78e); })['join'](''); _0x5d3130 = _0x2a86f3(0x2b1) + _0x46bf95 + _0x2a86f3(0x78e); } } if (_0x3532bc[_0x2a86f3(0x45b)]) return _0x3532bc[_0x2a86f3(0x6b6)](_0x1c0f86)[_0x2a86f3(0x830)](0x0, 0x9); } return _0x1c0f86(_0x40a8db); } function _0x1c0f86(_0xab699a) { const _0x522234 = _0x457b7e; if (!_0xab699a) return []; const _0xf9f1ef = String(_0xab699a)['trim'](), _0x1fd7af = _0xf9f1ef[_0x522234(0x804)](/(?<=[。！？!?…])\s+|[\r\n]+/)[_0x522234(0x511)](_0x4eee51 => _0x4eee51[_0x522234(0x2fe)]())[_0x522234(0x747)](Boolean); if (_0x1fd7af[_0x522234(0x45b)] > 0x0) return _0x522234(0x363) === _0x522234(0x3b4) ? [] : _0x1fd7af[_0x522234(0x830)](0x0, 0x9); return [_0xf9f1ef][_0x522234(0x747)](Boolean); } const _0x3dc0c7 = 'Noir_FileSystem', _0x5e6d2b = _0x457b7e(0x390), _0x27b2bc = new Promise((_0x399656, _0x5a4073) => { const _0x2d2cd3 = _0x457b7e, _0x2dd3a4 = indexedDB[_0x2d2cd3(0x469)](_0x3dc0c7, 0x2); _0x2dd3a4['onerror'] = () => _0x5a4073(_0x2d2cd3(0x3f4)), _0x2dd3a4['onsuccess'] = () => _0x399656(_0x2dd3a4[_0x2d2cd3(0x4d0)]), _0x2dd3a4[_0x2d2cd3(0x66b)] = _0x5c3bf5 => { const _0x35ed2c = _0x2d2cd3, _0x41da1b = _0x5c3bf5[_0x35ed2c(0x232)][_0x35ed2c(0x4d0)]; !_0x41da1b[_0x35ed2c(0x32f)][_0x35ed2c(0x6a9)](_0x5e6d2b) && _0x41da1b[_0x35ed2c(0x50e)](_0x5e6d2b, { 'keyPath': 'id' }); const _0x45dd3a = 'music_library'; !_0x41da1b[_0x35ed2c(0x32f)][_0x35ed2c(0x6a9)](_0x45dd3a) && _0x41da1b[_0x35ed2c(0x50e)](_0x45dd3a, { 'keyPath': 'id' }); }; }); async function _0x33b931(_0x317a94) { const _0x2c81ea = await _0x27b2bc; return new Promise((_0x4c5f50, _0x586265) => { const _0x2ae00f = _0x3488, _0x5399a5 = _0x2c81ea[_0x2ae00f(0x600)](_0x5e6d2b, _0x2ae00f(0x4ba)), _0x4f9b41 = _0x5399a5[_0x2ae00f(0x754)](_0x5e6d2b), _0xa9eb02 = _0x4f9b41['get'](_0x317a94); _0xa9eb02['onsuccess'] = () => _0x4c5f50(_0xa9eb02[_0x2ae00f(0x4d0)] ? _0xa9eb02[_0x2ae00f(0x4d0)][_0x2ae00f(0x822)] : null), _0xa9eb02[_0x2ae00f(0x1cf)] = () => _0x586265(_0xa9eb02[_0x2ae00f(0x6eb)]); }); } async function _0x19d8b8(_0x7540bc, _0x3a4c59) { const _0x26af4a = await _0x27b2bc; return new Promise((_0x2c0821, _0x41cc69) => { const _0x4e56d5 = _0x3488, _0x103328 = _0x26af4a[_0x4e56d5(0x600)](_0x5e6d2b, _0x4e56d5(0x795)), _0x127285 = _0x103328[_0x4e56d5(0x754)](_0x5e6d2b), _0x338090 = _0x127285[_0x4e56d5(0x1d6)]({ 'id': _0x7540bc, 'blob': _0x3a4c59 }); _0x338090[_0x4e56d5(0x431)] = () => _0x2c0821(_0x338090[_0x4e56d5(0x4d0)]), _0x338090[_0x4e56d5(0x1cf)] = () => _0x41cc69(_0x338090[_0x4e56d5(0x6eb)]); }); } async function _0x599d01(_0x28b82f) { const _0x726014 = await _0x27b2bc; return new Promise((_0x2ad260, _0x92ca91) => { const _0x376724 = _0x3488, _0x220f62 = _0x726014[_0x376724(0x600)](_0x5e6d2b, 'readwrite'), _0xf67060 = _0x220f62[_0x376724(0x754)](_0x5e6d2b), _0x3cf2c2 = _0xf67060[_0x376724(0x343)](_0x28b82f); _0x3cf2c2[_0x376724(0x431)] = () => _0x2ad260(), _0x3cf2c2[_0x376724(0x1cf)] = () => _0x92ca91(_0x3cf2c2['error']); }); } function _0x3591b3(_0xbc43bc) { const _0x392ae5 = _0x457b7e; return fetch(_0xbc43bc)[_0x392ae5(0x7aa)](_0x1d365e => _0x1d365e['blob']()); }
  </script>
  <div id="listen-together-ui" style="display: none;">
    <div class="lt-ui-backdrop"></div>
    <div class="lt-ui-main">
      <div class="lt-ui-header">
        <span id="lt-ui-header-title">正在与 TA 一起听</span>
        <button id="lt-ui-close-btn">×</button>
      </div>
      <div class="lt-ui-content">
        <div class="lt-ui-cover-container">
          <img id="lt-ui-cover-art" src="">
        </div>
        <div class="lt-ui-info">
          <h2 id="lt-ui-song-title">歌曲名称</h2>
          <p id="lt-ui-song-artist">歌手</p>
        </div>
        <div id="lt-ui-lyrics-container">
          <p class="no-lyrics-placeholder">暂无歌词</p>
        </div>
      </div>
    </div>
  </div>
</body>

</html>